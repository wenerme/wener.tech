<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Wener Live & Life" href="/opensearch.xml"><title data-react-helmet="true">Ubuntu 家用 | Wener Live &amp; Life</title><meta data-react-helmet="true" property="og:title" content="Ubuntu 家用 | Wener Live &amp; Life"><meta data-react-helmet="true" name="description" content="Ubuntu 家用"><meta data-react-helmet="true" property="og:description" content="Ubuntu 家用"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/styles.98d7e791.css">
<link rel="preload" href="/styles.db525e9c.js" as="script">
<link rel="preload" href="/runtime~main.9ed579b3.js" as="script">
<link rel="preload" href="/main.a19982b4.js" as="script">
<link rel="preload" href="/1.e57eaa8c.js" as="script">
<link rel="preload" href="/2.a8fb53a6.js" as="script">
<link rel="preload" href="/3.2daa48db.js" as="script">
<link rel="preload" href="/ccc49370.3ba1b900.js" as="script">
<link rel="preload" href="/3dcfdb15.b824a754.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong class="navbar__title">Wener</strong></a><a class="navbar__item navbar__link" href="/notes/java/java">笔记</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/story">故事</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a><a class="navbar__item navbar__link" href="/notes/tool/network/ip-lookup">工具</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong class="navbar__title">Wener</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/java">笔记</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/story">故事</a></li><li class="menu__list-item"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/tool/network/ip-lookup">工具</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_1mse">Ubuntu 家用</h1><div class="margin-vert--md"><time datetime="2017-02-09T00:00:00.000Z" class="blogPostDate_3bQP">February 9, 2017  · 8 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ubuntu-家用"></a>Ubuntu 家用<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ubuntu-家用" title="Direct link to heading">#</a></h1><ul><li>Ubuntu 桌面版</li><li>安装至少需要 1024*768 的显示器</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> upgrade</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> dist-upgrade</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 桌面版没有 sshd</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y openssh-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># brew</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">brew </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> gcc redis tmux mosh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 容器服务配置</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 使用阿里提供的仓库进行安装会非常快</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sh</span><span class="token plain"> -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 安装完毕后为当前用户添加权限,需要退出重新登录才能生效</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">usermod</span><span class="token plain"> -aG docker </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$USER</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 安装完成建议选择一家容器镜像,比如 https://cr.console.aliyun.com 或者 daocloud</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull gogs/gogs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker network create --subnet</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.0/24 home-net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 准备数据目录</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chown</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$USER</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token environment constant" style="color:rgb(130, 170, 255)">$USER</span><span class="token plain"> /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ==========</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 监控配置</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ==========</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull grafana/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull prom/container-exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull prom/prometheus</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.10 -d --restart always -v /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/grafana:/var/lib/grafana </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/grafana.ini:/etc/grafana/grafana.ini </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name grafana grafana/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">nohup</span><span class="token plain"> node_exporter </span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">2</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">node_exporter.log </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.21 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v /sys/fs/cgroup:/cgroup </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name container-exporter prom/container-exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.20 -d --restart always -v /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/prom:/prometheus </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/prom.yaml:/etc/prometheus/prometheus.yml </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name prom prom/prometheus</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Web 服务</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 选择需要的 Caddy 插件用于构建容器</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> -p /tmp/caddy </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /tmp/caddy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;https://caddyserver.com/download/build?os=linux&amp;arch=amd64&amp;features=cors%2Cexpires%2Cfilemanager%2Cgit%2Chugo%2Cipfilter%2Cjsonp%2Cjwt%2Clocale%2Cmailout%2Cminify%2Cmultipass%2Cprometheus%2Cratelimit%2Crealip%2Csearch%2Cupload&#x27;</span><span class="token plain"> -O caddy.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> -zxvf caddy.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker build -t home/caddy -f caddy.Dockerfile </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.30  -d --restart always -v /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/Caddyfile:/etc/Caddyfile </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/caddy:/data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$HOME</span><span class="token plain">/.caddy:/root/.caddy </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -p </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain">:80 -p </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain">:443 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name web home/caddy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="caddydockerfile"></a>caddy.Dockerfile<a aria-hidden="true" tabindex="-1" class="hash-link" href="#caddydockerfile" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-Dockerfile codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FROM alpine</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MAINTAINER wener &lt;wener@wener.me&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">COPY caddy /app/caddy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">VOLUME     [ &quot;/data&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WORKDIR    /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXPOSE 2015</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXPOSE 2000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENTRYPOINT [&quot;/app/caddy&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CMD [&quot;-conf&quot;,&quot;/etc/Caddyfile&quot;,&quot;-log&quot;,&quot;./internal/log&quot;]</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="grafanaini"></a>grafana.ini<a aria-hidden="true" tabindex="-1" class="hash-link" href="#grafanaini" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ini codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">##################### Grafana Configuration Example #####################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Everything has defaults so you only need to uncomment things you want to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># possible values : production, development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; app_mode = production</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># instance name, defaults to HOSTNAME environment variable value or hostname if HOSTNAME var is empty</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; instance_name = ${HOSTNAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Paths ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[paths]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;data = /var/lib/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Directory where grafana can store logs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;logs = /var/log/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Directory where grafana will automatically scan and look for plugins</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;plugins = /var/lib/grafana/plugins</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Server ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[server]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Protocol (http or https)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;protocol = http</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The ip address to bind to, empty will bind to all interfaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;http_addr =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The http port  to use</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;http_port = 3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The public facing domain name used to access grafana from a browser</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">domain = d.yikaiye.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Redirect to correct domain if host header does not match domain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Prevents DNS rebinding attacks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enforce_domain = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 使用 /monitor 作为路径,以便于反向代理</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;root_url = %(protocol)s://%(domain)s:%(http_port)s/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">root_url = /monitor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Log web requests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;router_logging = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the path relative working path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;static_root_path = public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># enable gzip</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_gzip = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https certs &amp; key file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cert_file =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cert_key =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Database ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[database]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;mysql&quot;, &quot;postgres&quot; or &quot;sqlite3&quot;, it&#x27;s your choice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;type = sqlite3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;host = 127.0.0.1:3306</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;name = grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;user = root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;password =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;postgres&quot; only, either &quot;disable&quot;, &quot;require&quot; or &quot;verify-full&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;ssl_mode = disable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;sqlite3&quot; only, path relative to data_path setting</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;path = grafana.db</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Session ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[session]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;memory&quot;, &quot;file&quot;, &quot;redis&quot;, &quot;mysql&quot;, &quot;postgres&quot;, default is &quot;file&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;provider = file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Provider config options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># memory: not have any config yet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># file: session dir path, is relative to grafana data_path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis: config like redis server e.g. `addr=127.0.0.1:6379,pool_size=100,db=grafana`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># mysql: go-sql-driver/mysql dsn config string, e.g. `user:password@tcp(127.0.0.1:3306)/database_name`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgres: user=a password=b host=localhost port=5432 dbname=c sslmode=disable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;provider_config = sessions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Session cookie name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_name = grafana_sess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># If you use session in https only, default is false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_secure = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Session life time, default is 86400</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;session_life_time = 86400</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Analytics ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[analytics]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Server reporting, sends usage counters to stats.grafana.org every 24 hours.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># No ip addresses are being tracked, only simple counters to track</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># running instances, dashboard and error counts. It is very helpful to us.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Change this option to false to disable reporting.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;reporting_enabled = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Set to false to disable all checks to https://grafana.net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># for new vesions (grafana itself and plugins), check is used</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># in some UI views to notify that grafana or plugin update exists</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This option does not cause any auto updates, nor send any information</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># only a GET request to http://grafana.net to get latest versions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">check_for_updates = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Google Analytics universal tracking code, only enabled if you specify an id here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;google_analytics_ua_id =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Security ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[security]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># default admin user, created on startup</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;admin_user = admin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># default admin password, can be changed before first start of grafana,  or in profile settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;admin_password = admin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># used for signing</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;secret_key = SW2YcwTIb9zpOOhoPsMm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Auto-login remember days</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;login_remember_days = 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_username = grafana_user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_remember_name = grafana_remember</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># disable gravatar profile images</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;disable_gravatar = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># data source proxy whitelist (ip_or_domain:port separated by spaces)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;data_source_proxy_whitelist =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[snapshots]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># snapshot sharing options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">external_enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;external_snapshot_url = https://snapshots-origin.raintank.io</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;external_snapshot_name = Publish to snapshot.raintank.io</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Users ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[users]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 禁用注册功能</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">allow_sign_up = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 不允许非管理员创建组织</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">allow_org_create = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Set to true to automatically assign new users to the default organization (id 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auto_assign_org = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Default role new users will be automatically assigned (if disabled above is set to true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auto_assign_org_role = Viewer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Background text for the user field on the login page</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">login_hint = 用户名</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Default UI theme (&quot;dark&quot; or &quot;light&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">default_theme = light</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Anonymous Auth ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[auth.anonymous]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># enable anonymous access</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># specify organization name that should be used for unauthenticated users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;org_name = Main Org.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># specify role for unauthenticated users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;org_role = Viewer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Auth Proxy ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[auth.proxy]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;header_name = X-WEBAUTH-USER</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;header_property = username</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;auto_sign_up = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Basic Auth ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[auth.basic]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### SMTP / Emailing ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[smtp]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;host = localhost:25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;user =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;password =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cert_file =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;key_file =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;skip_verify = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;from_address = admin@grafana.localhost</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[emails]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;welcome_email_on_sign_up = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Logging ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;console&quot;, &quot;file&quot;, &quot;syslog&quot;. Default is console and  file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Use space to separate multiple modes, e.g. &quot;console file&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;mode = console, file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;trace&quot;, &quot;debug&quot;, &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;, &quot;critical&quot;, default is &quot;info&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level = info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;console&quot; mode only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log.console]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># log line format, valid options are text, console and json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;format = console</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;file&quot; mode only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log.file]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># log line format, valid options are text, console and json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;format = text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This enables automated log rotate(switch of following options), default is true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;log_rotate = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Max line number of single file, default is 1000000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;max_lines = 1000000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Max size shift of single file, default is 28 means 1 &lt;&lt; 28, 256MB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;max_size_shift = 28</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Segment log daily, default is true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;daily_rotate = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Expired days of log file(delete after max days), default is 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;max_days = 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log.syslog]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># log line format, valid options are text, console and json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;format = text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Syslog network type and address. This can be udp, tcp, or unix. If left blank, the default unix endpoints will be used.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;network =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;address =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Syslog facility. user, daemon and local0 through local7 are valid.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;facility =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Syslog tag. By default, the process&#x27; argv[0] is used.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;tag =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### AMQP Event Publisher ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[event_publisher]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;rabbitmq_url = amqp://localhost/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;exchange = grafana_events</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;#################################### Dashboard JSON files ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[dashboards.json]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;path = /var/lib/grafana/dashboards</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Internal Grafana Metrics ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics available at HTTP API Url /api/metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Disable / Enable internal metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled           = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Publish interval</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;interval_seconds  = 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Send internal metrics to Graphite</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; [metrics.graphite]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; address = localhost:2003</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; prefix = prod.grafana.%(instance_name)s.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Internal Grafana Metrics ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Url used to to import dashboards directly from Grafana.net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[grafana_net]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">url = https://grafana.net</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="promyaml"></a>prom.yaml<a aria-hidden="true" tabindex="-1" class="hash-link" href="#promyaml" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">     5s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Attach these labels to any time series or alerts when communicating with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># external systems (federation, remote storage, Alertmanager).</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">external_labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">monitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;dev-monitor&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">rule_files</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> mysql.rules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># A scrape configuration containing exactly one endpoint to scrape:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Here it&#x27;s Prometheus itself.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">scrape_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;prometheus&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Override the global default and scrape targets from this job every 5 seconds.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 5s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> container_exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;172.18.1.21:9104&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> node_exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;172.18.1.1:9100&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> caddy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;172.18.1.30:2000&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="caddyfile"></a>Caddyfile<a aria-hidden="true" tabindex="-1" class="hash-link" href="#caddyfile" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">:80 {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  log internal/access.log {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      rotate {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          size 50</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          age  14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          keep 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  prometheus :2000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  root .</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  internal ./internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  filemanager /file {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    show file/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  proxy /monitor 172.18.1.10:3000 {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    without /monitor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    transparent</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo vim /etc/udev/rules.d/75-persistent-net-generator.rules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, ATTR{address}==&quot;f0:42:1c:85:07:41&quot;, NAME=&quot;eth0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo vim /etc/network/interfaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></section></article><div><a href="https://github.com/wenerme/wener/edit/master/story/2017/2017-02-09-ubuntu-home.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/story/jraphql"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Java with GraphQL</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/story/attack-on-programmer"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">进击的程序猿 »</div></a></div></nav></div></div><div class="col col--2"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#caddydockerfile" class="table-of-contents__link">caddy.Dockerfile</a></li><li><a href="#grafanaini" class="table-of-contents__link">grafana.ini</a></li><li><a href="#promyaml" class="table-of-contents__link">prom.yaml</a></li><li><a href="#caddyfile" class="table-of-contents__link">Caddyfile</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">笔记</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/notes/java/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/os/alpine/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes/kubernetes">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip/voip">VoIP</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Projects</h4><ul class="footer__items"><li class="footer__item">
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              - <a class="footer__link-item" href="https://github.com/wenerme/wener/actions" title="wenerme/wener - ci">
                <img style="vertical-align: middle;opacity: .4;" src="https://github.com/wenerme/wener/workflows/Build/badge.svg">
                </a>
              </div>
              </li><li class="footer__item"><a href="https://apis.wener.me" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wener&#x27;s Apis</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/story">Blog</a></li><li class="footer__item"><a href="https://github.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Wener Site" src="/img/wener-logo.svg"></div><div>Copyright © 1992-2021 Wener - 构建时间 2021-02-20 02:54</div></div></div></footer></div>
<script src="/styles.db525e9c.js"></script>
<script src="/runtime~main.9ed579b3.js"></script>
<script src="/main.a19982b4.js"></script>
<script src="/1.e57eaa8c.js"></script>
<script src="/2.a8fb53a6.js"></script>
<script src="/3.2daa48db.js"></script>
<script src="/ccc49370.3ba1b900.js"></script>
<script src="/3dcfdb15.b824a754.js"></script>
</body>
</html>