(window.webpackJsonp=window.webpackJsonp||[]).push([[281],{1027:function(e,n,r){"use strict";r.d(n,"a",(function(){return u})),r.d(n,"b",(function(){return d}));var t=r(0),a=r.n(t);function c(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function s(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){c(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function l(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},c=Object.keys(e);for(t=0;t<c.length;t++)r=c[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(t=0;t<c.length;t++)r=c[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var i=a.a.createContext({}),p=function(e){var n=a.a.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):s(s({},n),e)),r},u=function(e){var n=p(e.components);return a.a.createElement(i.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},b=a.a.forwardRef((function(e,n){var r=e.components,t=e.mdxType,c=e.originalType,o=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),u=p(r),b=t,d=u["".concat(o,".").concat(b)]||u[b]||m[b]||c;return r?a.a.createElement(d,s(s({ref:n},i),{},{components:r})):a.a.createElement(d,s({ref:n},i))}));function d(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var c=r.length,o=new Array(c);o[0]=b;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:t,o[1]=s;for(var i=2;i<c;i++)o[i]=r[i];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"},355:function(e,n,r){"use strict";r.r(n),r.d(n,"frontMatter",(function(){return o})),r.d(n,"metadata",(function(){return s})),r.d(n,"toc",(function(){return l})),r.d(n,"default",(function(){return p}));var t=r(3),a=r(8),c=(r(0),r(1027)),o={id:"app-cookbook",title:"K8S Apps"},s={unversionedId:"devops/kubernetes/app/app-cookbook",id:"devops/kubernetes/app/app-cookbook",isDocsHomePage:!1,title:"K8S Apps",description:"debug",source:"@site/notes/devops/kubernetes/app/app-cookbook.md",slug:"/devops/kubernetes/app/app-cookbook",permalink:"/notes/devops/kubernetes/app/app-cookbook",editUrl:"https://github.com/wenerme/wener/edit/master/notes/devops/kubernetes/app/app-cookbook.md",version:"current",sidebar:"docs",previous:{title:"Rancher UI",permalink:"/notes/devops/kubernetes/platform/rancher"},next:{title:"ArgoCD \u7248\u672c",permalink:"/notes/devops/kubernetes/app/argo-cd-version"}},l=[{value:"debug",id:"debug",children:[]},{value:"helm",id:"helm",children:[]},{value:"metallb",id:"metallb",children:[]},{value:"cert-manager",id:"cert-manager",children:[]},{value:"ingress-nginx",id:"ingress-nginx",children:[]},{value:"rancher",id:"rancher",children:[]}],i={toc:l};function p(e){var n=e.components,r=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(t.a)({},i,r,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"debug"},"debug"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"kubectl get pod -w --all-namespaces\nkubectl get events -w --all-namespaces\n\nsource <(kubectl completion bash)\nsource <(helm completion bash)\n")),Object(c.b)("h2",{id:"helm"},"helm"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"# alpine 3.12 \u5b89\u88c5 helm\napk add helm -X https://mirrors.aliyun.com/alpine/edge/testing/\n\n# K3S\nexport KUBECONFIG=/etc/rancher/k3s/k3s.yaml\n\nhelm repo add wener https://charts.wener.tech\nhelm search repo wener/\n\n# \u8865\u5168\nsource <(helm completion bash)\n")),Object(c.b)("h2",{id:"metallb"},"metallb"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"# registry \u9ed8\u8ba4\u5199\u4e86 docker.io\ncat <<YAML > metallb.values.yaml\ncontroller:\n  image:\n    registry: docker.mirrors.ustc.edu.cn\nspeaker:\n  image:\n    registry: docker.mirrors.ustc.edu.cn\nconfigInline:\n  address-pools:\n  - name: default\n    protocol: layer2\n    # default address space\n    addresses:\n    - 10.10.128.0/18\nYAML\n\nhelm upgrade -i metallb wener/metallb -n metallb-system --create-namespace -f metallb.values.yaml\n")),Object(c.b)("h2",{id:"cert-manager"},"cert-manager"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"# direct install crd\ncat <<YAML > cert-manager.values.yaml\ninstallCRDs: true\nYAML\n\nhelm upgrade -i cert-manager wener/cert-manager -n cert-manager --create-namespace -f cert-manager.values.yaml\n")),Object(c.b)("h2",{id:"ingress-nginx"},"ingress-nginx"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},'# DaemonSet hostPort 80\ncat <<YAML > ingress-nginx.values.yaml\nconfig:\n  hide-headers: "Server"\ncontroller:\n  image:\n    # use mirror\n    # k8s.gcr.io/ingress-nginx/controller\n    repository: registry.cn-hongkong.aliyuncs.com/cmi/ingress-nginx_controller\n    # disable digest\n    digest: ""\n  kind: DaemonSet\n  hostPort:\n    enabled: true\n  metrics:\n    enabled: false\n    # kube-prometheus\n    serviceMonitor:\n      enabled: true\n  prometheusRule:\n    enabled: false\n  admissionWebhooks:\n    patch:\n      image:\n        repository: registry.cn-hongkong.aliyuncs.com/cmi/jettech_kube-webhook-certgen\nYAML\n\nhelm upgrade -i ingress-nginx wener/ingress-nginx -n ingress-nginx --create-namespace -f ingress-nginx.values.yaml\n')),Object(c.b)("h2",{id:"rancher"},"rancher"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"\n# latest\n# helm repo add rancher https://releases.rancher.com/server-charts/latest\n# stable\nhelm repo add rancher https://releases.rancher.com/server-charts/stable\n\n# https://rancher.com/docs/rancher/v2.x/en/installation/resources/chart-options\ncat <<YAML > rancher.values.yaml\nhostname: rancher.my.corp\n\n# use cert-manager\n# privateCA: true\n# rancher mirror\nsystemDefaultRegistry: registry.cn-hangzhou.aliyuncs.com\n# 1 for test only - default 3\nreplicas: 1\nYAML\n\nhelm upgrade -i rancher rancher/rancher -n cattle-system --create-namespace -f rancher.values.yaml\n\n# \u67e5\u770b\u5b89\u88c5\u72b6\u6001\nkubectl -n cattle-system rollout status deploy/rancher\n# \u9a8c\u8bc1\u5b89\u88c5\nkubectl -n cattle-system get deploy rancher\n\n# \u8f6c\u53d1\u8bbf\u95ee rancher\nkubectl port-forward -n cattle-system svc/rancher --address 0.0.0.0 8080:80\n")))}p.isMDXComponent=!0}}]);