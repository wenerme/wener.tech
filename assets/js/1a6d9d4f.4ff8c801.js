/*! For license information please see 1a6d9d4f.4ff8c801.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[46231],{57078:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>a,frontMatter:()=>r,metadata:()=>c,toc:()=>h});var l=s(11527),i=s(47214);const r={title:"\u6211\u7684 K8S \u5b9e\u8df5",tags:["Practices","Thoughs"]},t="\u6211\u7684 K8S \u5b9e\u8df5",c={id:"devops/kubernetes/k8s-my-practice",title:"\u6211\u7684 K8S \u5b9e\u8df5",description:"- \u4e00\u5b9a\u8282\u70b9\u89c4\u6a21\u540e\u6ce8\u610f\u8282\u70b9\u89d2\u8272\u5212\u5206",source:"@site/../notes/devops/kubernetes/k8s-my-practice.md",sourceDirName:"devops/kubernetes",slug:"/devops/kubernetes/my-practice",permalink:"/notes/devops/kubernetes/my-practice",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/k8s-my-practice.md",tags:[{label:"Practices",permalink:"/notes/tags/practices"},{label:"Thoughs",permalink:"/notes/tags/thoughs"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1664421654,formattedLastUpdatedAt:"Sep 29, 2022",frontMatter:{title:"\u6211\u7684 K8S \u5b9e\u8df5",tags:["Practices","Thoughs"]},sidebar:"docs",previous:{title:"K8S \u8bcd\u6c47\u8868",permalink:"/notes/devops/kubernetes/glossary"},next:{title:"K8S \u4f7f\u7528\u7ecf\u9a8c",permalink:"/notes/devops/kubernetes/story"}},d={},h=[{value:"Disto \u9009\u62e9\u5f88\u91cd\u8981",id:"disto-\u9009\u62e9\u5f88\u91cd\u8981",level:2},{value:"\u4f18\u5148\u624b\u5199 Yaml",id:"\u4f18\u5148\u624b\u5199-yaml",level:2},{value:"\u670d\u52a1\u4e4b\u95f4\u8bb2\u6c42\u914d\u5408",id:"\u670d\u52a1\u4e4b\u95f4\u8bb2\u6c42\u914d\u5408",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u8d44\u6e90",id:"\u8d44\u6e90",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"\u6211\u7684-k8s-\u5b9e\u8df5",children:"\u6211\u7684 K8S \u5b9e\u8df5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e00\u5b9a\u8282\u70b9\u89c4\u6a21\u540e\u6ce8\u610f\u8282\u70b9\u89d2\u8272\u5212\u5206\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5b58\u50a8"}),"\n",(0,l.jsx)(n.li,{children:"\u8ba1\u7b97"}),"\n",(0,l.jsx)(n.li,{children:"\u8fb9\u7f18 - Ingress"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5982\u679c\u8981\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u53ef\u4f18\u5148\u8003\u8651 \u5206\u5e03\u5f0f \u6570\u636e \u800c\u4e0d\u662f \u5206\u5e03\u5f0f\u5b58\u50a8+\u6570\u636e\u5e93\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f18\u5148\u652f\u6301\u5206\u5e03\u5f0f\u7684\u6570\u636e\u5e93 \u5f39\u6027\u66f4\u597d\u3001\u6027\u80fd\u66f4\u597d"}),"\n",(0,l.jsx)(n.li,{children:"\u5206\u5e03\u5f0f\u5b58\u50a8+\u6570\u636e\u5e93 \u6027\u80fd\u5c34\u5c2c\uff0c\u4e14\u9700\u8981\u7ef4\u62a4\u989d\u5916\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u670d\u52a1"}),"\n",(0,l.jsx)(n.li,{children:"\u901a\u7528\u7684 \u5206\u5e03\u5f0f\u5b58\u50a8\u670d\u52a1 \u5bf9 \u5e26\u5bbd\u548c\u78c1\u76d8\u8981\u6c42\u975e\u5e38\u9ad8"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"disto-\u9009\u62e9\u5f88\u91cd\u8981",children:"Disto \u9009\u62e9\u5f88\u91cd\u8981"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u57fa\u7840\u6295\u5165\uff0c\u4f46\u6301\u7eed\u6536\u76ca"}),"\n",(0,l.jsx)(n.li,{children:"\u5982\u679c\u89c4\u6a21\u5c0f\u4f18\u5148\u9009\u62e9\u88c1\u526a\u8fc7\u7684 disto - k0s, k3s"}),"\n",(0,l.jsx)(n.li,{children:"\u786e\u5b9a\u597d\u6838\u5fc3\u72b6\u6001\u5982\u4f55\u5b58\u50a8\u3001\u5907\u4efd\u3001\u6062\u590d"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4f18\u5148\u624b\u5199-yaml",children:"\u4f18\u5148\u624b\u5199 Yaml"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u624b\u5199 Yaml \u66f4\u66f4\u597d\u7406\u89e3\u90e8\u7f72\u903b\u8f91"}),"\n",(0,l.jsx)(n.li,{children:"\u8fd0\u7ef4\u9700\u8981\u5bf9\u8fd0\u7ef4\u7684\u670d\u52a1\u6709\u5145\u5206\u4e86\u89e3"}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{title:"\u4e3b\u8981\u96be\u70b9",type:"tip",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u77e5\u9053\u5f53\u524d Pod \u4fe1\u606f\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/notes/devops/kubernetes/faq#pod-fieldref",children:"\u4f7f\u7528 fieldRef \u83b7\u53d6"})}),"\n",(0,l.jsx)(n.li,{children:"\u901a\u8fc7 API \u83b7\u53d6"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u77e5\u9053\u591a\u8282\u70b9\u4fe1\u606f\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/wenerme/kube-stub-cluster/blob/d373937971ae53ea2d17f82b852e684058920234/citus/citus.sts.yaml#L46-L76",children:"citus.sts.yaml#L46-L76"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/wenerme/kube-stub-cluster/blob/d373937971ae53ea2d17f82b852e684058920234/keydb/keydb.sts.yaml#L22-L36",children:"keydb.sts.yaml#L22-L36"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 init shell \u521d\u59cb\u5316\u73af\u5883"}),"\n"]})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e00\u5f00\u59cb\u4f7f\u7528 Helm \u53ef\u80fd\u80fd\u7528\uff0c\u4f46\u5347\u7ea7\u7ef4\u62a4\u6709\u98ce\u9669 - \u4e0d\u6562\u968f\u610f\u52a8\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u80fd\u8c03\u6574\u7684\u53c2\u6570\u6709\u9650"}),"\n",(0,l.jsx)(n.li,{children:"Helm \u4e0d\u4e00\u5b9a\u80fd\u6ee1\u8db3\u9700\u6c42 - \u4f8b\u5982: \u4e00\u4e9b\u5bc6\u94a5\u4fe1\u606f\u8981\u660e\u6587"}),"\n",(0,l.jsx)(n.li,{children:"\u6ee1\u8db3\u5c01\u88c5\u590d\u7528\u9700\u6c42"}),"\n",(0,l.jsx)(n.li,{children:"\u503e\u5411\u4e8e\u4e00\u4e2a Helm Chart \u4e00\u4e2a\u90e8\u7f72"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4e00\u5f00\u59cb\u4f7f\u7528 Operator \u4f1a\u9690\u85cf\u66f4\u591a\u7ec6\u8282\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5b8c\u5168\u9ed1\u76d2\uff0c\u53ef\u63a7\u6027\u66f4\u4f4e"}),"\n",(0,l.jsx)(n.li,{children:"Operator \u53ef\u4ee5\u5c06\u90e8\u7f72\u53d8\u4e3a\u670d\u52a1 - \u4f8b\u5982: DBaaS"}),"\n",(0,l.jsx)(n.li,{children:"\u6ee1\u8db3\u66f4\u9ad8\u9636\u9700\u6c42"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u83b7\u53d6 replicas\ncurl https://kubernetes/apis/apps/v1/namespaces/ \\\n  -H \"Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" < NAMESPACE > /statefulsets/ < STATEFULSET > -k \\\n  | jq '.spec.replicas'\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u670d\u52a1\u4e4b\u95f4\u8bb2\u6c42\u914d\u5408",children:"\u670d\u52a1\u4e4b\u95f4\u8bb2\u6c42\u914d\u5408"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6240\u4ee5\u624d\u9700\u8981\u7f16\u6392"}),"\n",(0,l.jsx)(n.li,{children:"\u4f8b\u5982: \u503e\u5411\u4e8e nginx \u800c\u4e0d\u662f traeifk"}),"\n",(0,l.jsx)(n.li,{children:"\u4f8b\u5982: \u4f7f\u7528 cert-manager \u800c\u4e0d\u662f web server \u81ea\u5e26\u7684 acme"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u90e8\u7f72\u6df7\u5408\u67b6\u6784\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6ce8\u610f\u90e8\u5206\u7ec4\u4ef6\u9650\u5b9a\u4e86 Linux\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"metallb"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u955c\u50cf\u9700\u8981\u652f\u6301\u591a\u67b6\u6784 - \u5927\u591a\u955c\u50cf\u90fd\u662f\u5355\u67b6\u6784"}),"\n",(0,l.jsx)(n.li,{children:"\u9664\u975e\u6709\u660e\u663e\u7684\u9700\u8981\uff0c\u5426\u5219\u907f\u514d\u6df7\u5408\u67b6\u6784"}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u8003\u8651\u90e8\u7f72\u4e00\u4e2a\u7eaf aarch64 \u67b6\u6784\u4e5f\u4e0d\u8981\u548c x86 \u6df7\u5408"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5206\u5e03\u5f0f\u5b58\u50a8/\u975e\u672c\u5730\u5b58\u50a8\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9664\u975e\u5fc5\u8981\u5426\u5219\u4e0d\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u5b58\u50a8"}),"\n",(0,l.jsx)(n.li,{children:"\u601d\u8003\u5206\u5e03\u5f0f\u5b58\u50a8\u7684\u76ee\u7684\u548c\u6536\u76ca"}),"\n",(0,l.jsx)(n.li,{children:"\u5206\u5e03\u5f0f\u5b58\u50a8\u90fd\u6709\u5341\u5206\u660e\u663e\u7684\u526f\u4f5c\u7528"}),"\n",(0,l.jsxs)(n.li,{children:["\u5f53\u9700\u8981\u72b6\u6001\u7684\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u8d2d\u4e70\u670d\u52a1\u6216\u8005\u989d\u5916\u63d0\u4f9b\u76f8\u5173\u670d\u52a1\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6570\u636e\u5e93"}),"\n",(0,l.jsx)(n.li,{children:"\u5bf9\u8c61\u5b58\u50a8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["StatefulSet \u5176\u4ed6\u4f5c\u7528\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u7528\u4e8e\u83b7\u53d6\u7a33\u5b9a\u7684 Hostname \u548c IP - \u4e0d\u4e00\u5b9a\u662f\u56e0\u4e3a\u9700\u8981\u4f7f\u7528\u5b58\u50a8"}),"\n",(0,l.jsx)(n.li,{children:"Pod \u7684\u540d\u5b57\u53ef\u4ee5\u66f4\u77ed - \u907f\u514d\u8d85\u51fa\u9650\u5236\u6216\u88ab\u622a\u53d6"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u96c6\u7fa4\u5c0f\u7684\u65f6\u5019 mount \u4e3b\u673a\u76ee\u5f55\u6216\u8005\u4f7f\u7528 local pvc \u4e5f\u4e0d\u5931\u4e3a\u7ba1\u7406\u5b58\u50a8\u7684\u529e\u6cd5"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u8d44\u6e90",children:"\u8d44\u6e90"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Prometheus \u4f1a\u5360\u7528\u8f83\u591a\u5185\u5b58\u548c\u90e8\u5206 CPU\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5efa\u8bae\u5c3d\u91cf\u590d\u7528\uff0c\u907f\u514d\u91cd\u590d\u90e8\u7f72"}),"\n",(0,l.jsx)(n.li,{children:"linkerd \u4f1a\u90e8\u7f72 prometheus"}),"\n",(0,l.jsx)(n.li,{children:"lens \u4f1a\u90e8\u7f72 prometheus"}),"\n",(0,l.jsx)(n.li,{children:"consul \u76f8\u5173\u670d\u52a1\u4e5f\u53ef\u4ee5\u96c6\u6210 prometheus"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5173\u6ce8 DaemonSet\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"ingress \u90e8\u7f72\u4e3a DS \u65b9\u4fbf\u4f7f\u7528 - \u56e0\u4e3a\u662f nginx+controller\uff0c \u5185\u5b58\u5927\u7ea6 100M - request 100m, 90Mi"}),"\n",(0,l.jsx)(n.li,{children:"consul \u90e8\u7f72\u4f1a\u6709\u4e00\u4e2a\u8282\u70b9 agent DS - limit 100\uff0c100"}),"\n",(0,l.jsx)(n.li,{children:"node-exporter \u4f1a\u90e8\u7f72\u4e3a DS - \u8d44\u6e90\u5360\u7528\u975e\u5e38\u5c0f - r 10m, 24Mi, limit: 200m, 100Mi"}),"\n",(0,l.jsx)(n.li,{children:"metallb \u4f1a\u90e8\u7f72 DS \u4f5c\u4e3a speaker"}),"\n"]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},3354:(e,n,s)=>{var l=s(50959),i=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,c=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function h(e,n,s){var l,r={},h=null,o=null;for(l in void 0!==s&&(h=""+s),void 0!==n.key&&(h=""+n.key),void 0!==n.ref&&(o=n.ref),n)t.call(n,l)&&!d.hasOwnProperty(l)&&(r[l]=n[l]);if(e&&e.defaultProps)for(l in n=e.defaultProps)void 0===r[l]&&(r[l]=n[l]);return{$$typeof:i,type:e,key:h,ref:o,props:r,_owner:c.current}}n.Fragment=r,n.jsx=h,n.jsxs=h},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>t});var l=s(50959);const i={},r=l.createContext(i);function t(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);