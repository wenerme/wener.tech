/*! For license information please see e443649d.9415ff19.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[42459],{29775:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>o,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=n(11527),t=n(47214);const a={title:"Nginx FAQ",tags:["FAQ"]},i="Nginx FAQ",l={id:"devops/web/nginx/nginx-faq",title:"Nginx FAQ",description:"a client request body is buffered to a temporary file",source:"@site/../notes/devops/web/nginx/nginx-faq.md",sourceDirName:"devops/web/nginx",slug:"/devops/web/nginx/faq",permalink:"/notes/devops/web/nginx/faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/web/nginx/nginx-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1677583228,formattedLastUpdatedAt:"Feb 28, 2023",frontMatter:{title:"Nginx FAQ",tags:["FAQ"]},sidebar:"docs",previous:{title:"Nginx \u5e38\u7528\u914d\u7f6e",permalink:"/notes/devops/web/nginx/cookbook"},next:{title:"Nginx Modules",permalink:"/notes/devops/web/nginx/modules"}},c={},d=[{value:"a client request body is buffered to a temporary file",id:"a-client-request-body-is-buffered-to-a-temporary-file",level:2},{value:"\u91cd\u5b9a\u5411\u6ca1\u6709\u7aef\u53e3",id:"\u91cd\u5b9a\u5411\u6ca1\u6709\u7aef\u53e3",level:2},{value:"request_uri vs uri",id:"request_uri-vs-uri",level:2},{value:"host vs http_host",id:"host-vs-http_host",level:2},{value:"ssl passthrough",id:"ssl-passthrough",level:2}];function h(e){const s={a:"a",annotation:"annotation",code:"code",h1:"h1",h2:"h2",li:"li",math:"math",mi:"mi",mrow:"mrow",msub:"msub",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"nginx-faq",children:"Nginx FAQ"}),"\n",(0,r.jsx)(s.h2,{id:"a-client-request-body-is-buffered-to-a-temporary-file",children:"a client request body is buffered to a temporary file"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"client_body_buffer_size"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"\u91cd\u5b9a\u5411\u6ca1\u6709\u7aef\u53e3",children:"\u91cd\u5b9a\u5411\u6ca1\u6709\u7aef\u53e3"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-conf",children:"# \u4f7f\u7528 http_host\nproxy_set_header Host $http_host;\n# \u6216\u8005\nproxy_set_header Host $host:$server_port;\n"})}),"\n",(0,r.jsxs)(s.h2,{id:"request_uri-vs-uri",children:[(0,r.jsxs)(s.span,{className:"katex",children:[(0,r.jsx)(s.span,{className:"katex-mathml",children:(0,r.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,r.jsxs)(s.semantics,{children:[(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mi,{children:"r"}),(0,r.jsx)(s.mi,{children:"e"}),(0,r.jsx)(s.mi,{children:"q"}),(0,r.jsx)(s.mi,{children:"u"}),(0,r.jsx)(s.mi,{children:"e"}),(0,r.jsx)(s.mi,{children:"s"}),(0,r.jsxs)(s.msub,{children:[(0,r.jsx)(s.mi,{children:"t"}),(0,r.jsx)(s.mi,{children:"u"})]}),(0,r.jsx)(s.mi,{children:"r"}),(0,r.jsx)(s.mi,{children:"i"}),(0,r.jsx)(s.mi,{children:"v"}),(0,r.jsx)(s.mi,{children:"s"})]}),(0,r.jsx)(s.annotation,{encoding:"application/x-tex",children:"request_uri vs "})]})})}),(0,r.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.854em",verticalAlign:"-0.1944em"}}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"re"}),(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"u"}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"es"}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,r.jsx)(s.span,{className:"msupsub",children:(0,r.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,r.jsxs)(s.span,{className:"vlist-r",children:[(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.1514em"},children:(0,r.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,r.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,r.jsx)(s.span,{className:"mord mathnormal mtight",children:"u"})})]})}),(0,r.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,r.jsx)(s.span,{})})})]})})]}),(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]}),"uri"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"$request_uri"})," - \u4fdd\u7559\u67e5\u8be2\u53c2\u6570\uff0c",(0,r.jsx)(s.code,{children:"?"})," \u90e8\u5206"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"$uri"})," - \u53ea\u6709\u8def\u5f84"]}),"\n"]}),"\n",(0,r.jsxs)(s.h2,{id:"host-vs-http_host",children:[(0,r.jsxs)(s.span,{className:"katex",children:[(0,r.jsx)(s.span,{className:"katex-mathml",children:(0,r.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,r.jsxs)(s.semantics,{children:[(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mi,{children:"h"}),(0,r.jsx)(s.mi,{children:"o"}),(0,r.jsx)(s.mi,{children:"s"}),(0,r.jsx)(s.mi,{children:"t"}),(0,r.jsx)(s.mi,{children:"v"}),(0,r.jsx)(s.mi,{children:"s"})]}),(0,r.jsx)(s.annotation,{encoding:"application/x-tex",children:"host vs "})]})})}),(0,r.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.6944em"}}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"h"}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"os"}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,r.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,r.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]}),"http_host"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["$host\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u6a21\u5757\u5b9a\u4e49\u53d8\u91cf"}),"\n",(0,r.jsxs)(s.li,{children:["\u53ef\u80fd\u662f HTTP Host \u5934\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u6b64\u65f6\u4e0e ",(0,r.jsx)(s.code,{children:"$http_host"})," \u7c7b\u4f3c"]}),"\n",(0,r.jsx)(s.li,{children:"\u5c0f\u5199\uff0c\u6ca1\u6709\u7aef\u53e3"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:"\u53ef\u80fd\u662f URL \u4e2d\u7684 HOST"}),"\n",(0,r.jsx)(s.li,{children:"\u53ef\u80fd\u662f \u7b2c\u4e00\u4e2a server_name"}),"\n",(0,r.jsx)(s.li,{children:"\u5982\u679c server_name \u5305\u542b\u6b63\u5219\uff0c\u90a3\u4e48 $host \u4e5f\u4f1a - \u5bfc\u81f4\u51fa\u73b0\u96be\u770b\u7684\u8def\u5f84"}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"$server_name"})," \u603b\u662f\u7b2c\u4e00\u4e2a ",(0,r.jsx)(s.code,{children:"server_name"})]}),"\n",(0,r.jsx)(s.li,{children:"\u53ef\u80fd\u4e0d\u5305\u542b port"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["$http_host\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u901a\u8fc7 ",(0,r.jsx)(s.a,{href:"http://nginx.org/en/docs/http/ngx_http_core_module.html#variables",children:"$http_HEADER"})," \u5b9a\u4e49"]}),"\n",(0,r.jsx)(s.li,{children:"\u4e0e HTTP \u5934\u4e2d\u4fe1\u606f\u4fdd\u6301\u4e00\u81f4"}),"\n",(0,r.jsx)(s.li,{children:"\u5305\u542b port"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"ssl-passthrough",children:"ssl passthrough"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"by sni"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"nginx -V | grep stream_ssl_preread_module\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-conf",children:"stream {\n\n  map $ssl_preread_server_name $targetBackend {\n    ab.mydomain.com  upstream1.example.com:443;\n    xy.mydomain.com  upstream2.example.com:443;\n  }\n\n  server {\n    listen 443;\n\n    proxy_connect_timeout 1s;\n    proxy_timeout 3s;\n    resolver 1.1.1.1;\n\n    proxy_pass $targetBackend;\n    ssl_preread on;\n  }\n}\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://gist.github.com/kekru/c09dbab5e78bf76402966b13fa72b9d2",children:"https://gist.github.com/kekru/c09dbab5e78bf76402966b13fa72b9d2"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"by stream"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-conf",children:"stream {\n  server {\n    listen 443;\n    proxy_pass backend.example.com:443;\n  }\n}\n"})})]})}function o(e={}){const{wrapper:s}={...(0,t.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},3354:(e,s,n)=>{var r=n(50959),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,s,n){var r,a={},d=null,h=null;for(r in void 0!==n&&(d=""+n),void 0!==s.key&&(d=""+s.key),void 0!==s.ref&&(h=s.ref),s)i.call(s,r)&&!c.hasOwnProperty(r)&&(a[r]=s[r]);if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===a[r]&&(a[r]=s[r]);return{$$typeof:t,type:e,key:d,ref:h,props:a,_owner:l.current}}s.Fragment=a,s.jsx=d,s.jsxs=d},11527:(e,s,n)=>{e.exports=n(3354)},47214:(e,s,n)=>{n.d(s,{Z:()=>l,a:()=>i});var r=n(50959);const t={},a=r.createContext(t);function i(e){const s=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);