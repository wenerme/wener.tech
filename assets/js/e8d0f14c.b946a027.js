/*! For license information please see e8d0f14c.b946a027.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[30730],{34811:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var i=l(11527),s=l(47214);const r={title:"Bazel"},t="Bazel",c={id:"dev/build/bazel/README",title:"Bazel",description:"- bazelbuild/bazel",source:"@site/../notes/dev/build/bazel/README.md",sourceDirName:"dev/build/bazel",slug:"/dev/build/bazel/",permalink:"/notes/dev/build/bazel/",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/dev/build/bazel/README.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1642767775,formattedLastUpdatedAt:"Jan 21, 2022",frontMatter:{title:"Bazel"},sidebar:"docs",previous:{title:"\u6784\u5efa",permalink:"/notes/dev/build/"},next:{title:"Bazel Awesome",permalink:"/notes/dev/build/bazel/awesome"}},d={},a=[{value:"Starlark",id:"starlark",level:2},{value:"Notes",id:"notes",level:2},{value:"Remote Execution",id:"remote-execution",level:2},{value:"Remote Caching",id:"remote-caching",level:2},{value:"The remote downloader can only be used in combination with gRPC caching",id:"the-remote-downloader-can-only-be-used-in-combination-with-grpc-caching",level:2},{value:"Failed to query remote execution capabilities: INTERNAL: http2 exception",id:"failed-to-query-remote-execution-capabilities-internal-http2-exception",level:2},{value:".bazelrc",id:"bazelrc",level:2},{value:"Notes",id:"notes-1",level:2},{value:"query",id:"query",level:2},{value:"bzlmod",id:"bzlmod",level:2},{value:"BUILD vs BUILD.bazel",id:"build-vs-buildbazel",level:2},{value:"Fetching @local_config_xcode",id:"fetching-local_config_xcode",level:2},{value:"from google",id:"from-google",level:2},{value:"output",id:"output",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",hr:"hr",li:"li",mdxadmonitiontitle:"mdxadmonitiontitle",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"bazel",children:"Bazel"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/bazelbuild/bazel",children:"bazelbuild/bazel"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u591a\u8bed\u8a00"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u591a\u5e73\u53f0"}),"\n",(0,i.jsx)(n.li,{children:"Starlark DSL"}),"\n",(0,i.jsx)(n.li,{children:"reproduce build"}),"\n",(0,i.jsxs)(n.li,{children:["remote cache\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"WebDAV"}),"\n",(0,i.jsx)(n.li,{children:"bazel-remote"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"remote build"}),"\n",(0,i.jsx)(n.li,{children:"\u81ea\u884c\u51c6\u5907\u73af\u5883 - \u4e0b\u8f7d JDK\u3001\u4e0b\u8f7d Golang SDK \u7b49"}),"\n",(0,i.jsx)(n.li,{children:"\u81ea\u884c\u7ef4\u62a4\u4f9d\u8d56 - \u4e0b\u8f7d JAR\u3001\u4e0b\u8f7d go mod"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bazelbuild/examples",children:"bazelbuild/examples"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/google/bazel-common",children:"google/bazel-common"})}),"\n",(0,i.jsxs)(n.li,{children:["\u955c\u50cf\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://mirror.bazel.build",children:"https://mirror.bazel.build"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bazelbuild/rules_python/issues/400#issuecomment-776810051",children:"https://github.com/bazelbuild/rules_python/issues/400#issuecomment-776810051"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Bazel \u955c\u50cf\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://mirrors.huaweicloud.com/bazel/",children:"https://mirrors.huaweicloud.com/bazel/"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://bazel.build/users.html",children:"Users"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Abseil, TensorFlow, gRPC"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Kubernetes 1.21 \u79fb\u9664 bazel \u6784\u5efa - ",(0,i.jsx)(n.a,{href:"https://github.com/BenTheElder/enhancements/blob/master/keps/sig-testing/2420-reducing-kubernetes-build-maintenance/README.md",children:"KEP#2420"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"go build cache \u8db3\u591f\u4f18\u79c0"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Pants, Buck: created and developed by ex-Googlers at Twitter and Foursquare, and Facebook"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"When to use Bazel",type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u58f0\u660e\u5f0f\u6784\u5efa"}),"\n",(0,i.jsx)(n.li,{children:"\u589e\u91cf\u7f16\u8bd1"}),"\n",(0,i.jsx)(n.li,{children:"Remote Cache \u548c Remote Execution"}),"\n",(0,i.jsx)(n.li,{children:"Reproduce \u6784\u5efa"}),"\n",(0,i.jsx)(n.li,{children:"\u591a\u8bed\u8a00\u591a\u5e73\u53f0\u590d\u6742\u6784\u5efa"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"\u5927\u591a\u65f6\u5019\u4e0d\u9700\u8981\u4f7f\u7528 Bazel"})}),"\n"]})}),"\n",(0,i.jsxs)(n.admonition,{type:"caution",children:[(0,i.jsxs)(n.mdxadmonitiontitle,{children:["When ",(0,i.jsx)(n.strong,{children:"not"})," to use Bazel"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6240\u6709\u88ab\u4f9d\u8d56\u7684\u5185\u5bb9\u90fd\u4f1a\u8fdb\u884c\u660e\u786e\u5b9a\u4e49 - \u76ee\u5f55\u4e0b\u5305\u542b BUILD.bazel"}),"\n",(0,i.jsxs)(n.li,{children:["\u4f9d\u8d56\u53d8\u5316\u9700\u8981\u91cd\u65b0\u751f\u6210\u5404\u79cd BUILD.bazel\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u662f\u4e00\u79cd\u5f00\u53d1\u8d1f\u62c5 - \u56e0\u6b64\u89c4\u6a21\u4e0d\u5927\u65f6\u4e0d\u5efa\u8bae\u4f7f\u7528 Bazel"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Bazel \u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u7f13\u5b58\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4e0d\u4f1a\u4f7f\u7528 go \u7684\u5168\u5c40\u7f13\u5b58"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u4f1a\u4f7f\u7528 npm/yarn \u7684\u5168\u5c40\u7f13\u5b58"}),"\n",(0,i.jsx)(n.li,{children:"\u597d\u5904: Remote \u6267\u884c, \u8de8\u4e3b\u673a\u5171\u4eab"}),"\n",(0,i.jsx)(n.li,{children:"\u574f\u5904: \u78c1\u76d8\u7a7a\u95f4, \u7f51\u7edc\u73af\u5883"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Bazel \u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u5de5\u5177\u94fe\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6bcf\u4e2a WORKSPACE \u90fd\u4f1a\u4e0b\u8f7d toolchain - \u4f8b\u5982 go,node"}),"\n",(0,i.jsx)(n.li,{children:"\u597d\u5904: \u786e\u4fdd\u73af\u5883\u7248\u672c"}),"\n",(0,i.jsx)(n.li,{children:"\u574f\u5904: \u5360\u7528\u78c1\u76d8\u7a7a\u95f4, \u56fd\u5185\u73af\u5883\u4e0b\u8f7d\u53ef\u80fd\u6709\u95ee\u9898"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Bazel \u8fd0\u884c\u73af\u5883\u590d\u6742 - \u5982\u679c\u9700\u8981\u5206\u53d1\u7ed9\u5176\u4ed6\u4eba\u7f16\u8f91\u6784\u5efa\u7684\u573a\u666f\u4e0d\u5efa\u8bae\u4f7f\u7528\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"JDK, Python, coreutils"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Bazel \u542f\u52a8\u548c\u5206\u6790\u9700\u8981\u65f6\u95f4 - \u5982\u679c\u73b0\u884c\u6784\u5efa\u65f6\u95f4 < 10m \u65f6\u4e0d\u5efa\u8bae\u4f7f\u7528"}),"\n"]})]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Bazel \u5b98\u65b9\u6784\u5efa\u7684\u4e0d\u652f\u6301 musl"}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'brew install bazel\n\n# \u6784\u5efa\nbazel build //:ProjectRunner\n# \u67e5\u770b\u4f9d\u8d56\u56fe\nbazel query  --nohost_deps --noimplicit_deps "deps(//:ProjectRunner)" --output graph | dot -Tpng -o graph.png\nimgcat graph.png\n\n# \u505c\u6b62\u540e\u53f0\u670d\u52a1\nbazel shutdown\n\n# Build all\nbazel build //...\n'})}),"\n",(0,i.jsx)(n.h2,{id:"starlark",children:"Starlark"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/master/skylark/language.html",children:"https://docs.bazel.build/versions/master/skylark/language.html"})}),"\n",(0,i.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["workspace - \u5de5\u4f5c\u7a7a\u95f4\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"WORKSPACE, WORKSPACE.bazel \u6240\u5728\u76ee\u5f55"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["repository - \u4ed3\u5e93\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@"})," - root repository - WORKSPACE \u6240\u5728\u76ee\u5f55"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53ef\u5b9a\u4e49\u5916\u90e8\u4ed3\u5e93 - ",(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/external.html",children:"external"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"bind, local_repository, new_local_repository"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["package\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"BUILD \u6240\u5728\u76ee\u5f55"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["target\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"=files+rules"}),"\n",(0,i.jsx)(n.li,{children:"files \u5206\u4e3a\u6e90\u6587\u4ef6\u548c\u751f\u6210\u6587\u4ef6"}),"\n",(0,i.jsx)(n.li,{children:"package_group"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["label - \u6807\u7b7e\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"target \u7684\u540d\u5b57\u53eb\u505a label - label \u552f\u4e00\u6807\u8bc6 target"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@myrepo//my/app/main:app_binary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["@myrepo// - \u4ed3\u5e93\u540d\u5b57\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5728 repo \u5185\u53ef\u5ffd\u7565\uff0c\u5199\u4f5c ",(0,i.jsx)(n.code,{children:"//my/app/main:app_binary"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["my/app/main - un-qualified package name - \u5305\u540d\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"+repo=fully-qualified package name"}),"\n",(0,i.jsxs)(n.li,{children:["\u5728\u5305\u5185\u53ef\u5ffd\u7565\uff0c\u5199\u4f5c ",(0,i.jsx)(n.code,{children:":app_binary"})," \u6216 ",(0,i.jsx)(n.code,{children:"app_binary"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["app_binary - un-qualified target name\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5982\u679c\u540d\u5b57\u4e0e\u6700\u540e\u90e8\u5206\u540d\u5b57\u76f8\u540c\uff0c\u53ef\u5ffd\u7565\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"//my/app/lib:lib"})," = ",(0,i.jsx)(n.code,{children:"//my/app/lib"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:".bzl - extension"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/be/overview.html",children:"be"})," - Bazel BUILD Encyclopedia"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"remote-execution",children:"Remote Execution"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/master/remote-execution.html",children:"Remote Execution"})}),"\n",(0,i.jsxs)(n.li,{children:["Self Host\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/twitter/scoot",children:"twitter/scoot"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bazelbuild/bazel-buildfarm",children:"bazelbuild/bazel-buildfarm"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"remote-caching",children:"Remote Caching"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/master/remote-caching.html",children:"Remote Caching"})}),"\n",(0,i.jsxs)(n.li,{children:["\u5b58\u50a8\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"nginx"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/buchgr/bazel-remote/",children:"bazel-remote"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["ac.v2 cas.v2 raw.v2\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"hash, blob"}),"\n",(0,i.jsx)(n.li,{children:"cas=Content addressed storage"}),"\n",(0,i.jsx)(n.li,{children:"ac=Action cache"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"bazel \u4e0d\u8d1f\u8d23\u5220\u9664\u7f13\u5b58"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/command-line-reference.html#flag--experimental_remote_downloader",children:"--experimental_remote_downloader"})}),"\n",(0,i.jsx)(n.li,{children:"HTTP 8080"}),"\n",(0,i.jsx)(n.li,{children:"gRPC 9092"}),"\n",(0,i.jsx)(n.li,{children:"Profiling 6060"}),"\n",(0,i.jsx)(n.li,{children:"--config_file BAZEL_REMOTE_CONFIG_FILE"}),"\n",(0,i.jsx)(n.li,{children:"--experimental_remote_asset_api"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  -u 1000 \\\n  -v $PWD/cache:/data -p 8080:8080 -p 9092:9092 \\\n  --name bazel-remote-cache buchgr/bazel-remote-cache\ncurl http://localhost:8080/status\n\nbazel build //src/main:app --remote_cache=http://localhost:9092\n# remote asset\nbazel build //src/main:app --experimental_remote_downloader=grpc://localhost:9092 --remote_cache=grpc://localhost:9092\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"remote asset is broken",type:"caution",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["not works with go-sdk ",(0,i.jsx)(n.a,{href:"https://github.com/bazelbuild/bazel/issues/13206",children:"#13206"})]}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"build:cache --remote_download_minimal\nbuild:cache --remote_cache=http://localhost:8080\n"})}),"\n",(0,i.jsx)(n.h2,{id:"the-remote-downloader-can-only-be-used-in-combination-with-grpc-caching",children:"The remote downloader can only be used in combination with gRPC caching"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# from\nbazel build //src/main:app --experimental_remote_downloader=grpc://localhost:9090 --remote_cache=http://localhost:9090\n# to\nbazel build //src/main:app --experimental_remote_downloader=grpc://localhost:9090 --remote_cache=grpc://localhost:9090\n"})}),"\n",(0,i.jsx)(n.h2,{id:"failed-to-query-remote-execution-capabilities-internal-http2-exception",children:"Failed to query remote execution capabilities: INTERNAL: http2 exception"}),"\n",(0,i.jsx)(n.h2,{id:"bazelrc",children:".bazelrc"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:".bazelignore"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4e0d\u80fd\u4f7f\u7528\u4efb\u610f\u73af\u5883\u53d8\u91cf\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u53ef\u8003\u8651\u9884\u5148\u751f\u6210 ",(0,i.jsx)(n.a,{href:"https://github.com/stratum/stratum/pull/878/files",children:"https://github.com/stratum/stratum/pull/878/files"})]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["system\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"/etc/bazel.bazelrc"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"%ProgramData%\\bazel.bazelrc"})}),"\n",(0,i.jsx)(n.li,{children:"BAZEL_SYSTEM_BAZELRC_PATH"}),"\n",(0,i.jsx)(n.li,{children:"--nosystem_rc"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["workspace\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:".bazelrc"}),"\n",(0,i.jsx)(n.li,{children:"--noworkspace_rc"}),"\n",(0,i.jsx)(n.li,{children:"$workspace/tools/bazel.rc"}),"\n",(0,i.jsx)(n.li,{children:"--nomaster_bazelrc"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["home\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"$HOME/.bazelrc"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"%USERPROFILE%\\.bazelrc"}),", ",(0,i.jsx)(n.code,{children:"%HOME%/.bazelrc"})]}),"\n",(0,i.jsx)(n.li,{children:"--nohome_rc"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"--bazelrc"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/tensorflow/tensorflow/blob/master/.bazelrc",children:"https://github.com/tensorflow/tensorflow/blob/master/.bazelrc"})}),"\n",(0,i.jsxs)(n.li,{children:["\u53d8\u91cf\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"%workspace%"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"build --announce_rc\nbuild --copt -O0\nbuild --disk_cache=/tmp/bazel-disk-cache\n# Set convenient location for Bazel files to cache\nstartup --output_user_root=/tmp/bazel-cache/output-root\n\nbuild --verbose_failures=true\n# Profile build\nbuild --profile=/tmp/bazel.profile.json\n\n# JVM \u9650\u5236\n# startup --host_jvm_args=-Xmx3g --host_jvm_args=-Xms2g\n\n\ntry-import %workspace%/.bazelrc.user\n\n# Include git version info\nbuild --stamp\nbuild --workspace_status_command 'echo STABLE_GIT_COMMIT $(git rev-parse HEAD)'\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# https://github.com/bazelbuild/bazelisk/blob/master/stamp.sh\nbuild:release -c opt --stamp --workspace_status_command="$PWD/stamp.sh"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Running bazel inside a `docker build` command causes trouble, cf:\n#   https://github.com/bazelbuild/bazel/issues/134\n# The easiest solution is to set up a bazelrc file forcing --batch.\nstartup --batch\n\n# Similarly, we need to workaround sandboxing issues:\n#   https://github.com/bazelbuild/bazel/issues/418\nbuild  --verbose_failures --spawn_strategy=standalone --strategy=Genrule=standalone\ntest --spawn_strategy=standalone\n\n# Force bazel output to use colors (good for jenkins) and print useful errors.\ncommon --color=yes\n\n# Configure tests - increase timeout, print errors and timeout warnings\ntest --verbose_failures --test_output=errors --test_verbose_timeout_warnings\n"})}),"\n",(0,i.jsx)(n.h2,{id:"notes-1",children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/build-ref.html",children:"https://docs.bazel.build/versions/main/build-ref.html"})}),"\n",(0,i.jsx)(n.li,{children:"workspace"}),"\n",(0,i.jsxs)(n.li,{children:["package\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"BUILD"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"target"}),"\n",(0,i.jsx)(n.li,{children:"label"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"query",children:"query"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"bazel-collector"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/query.html",children:"https://docs.bazel.build/versions/main/query.html"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/query-how-to.html",children:"https://docs.bazel.build/versions/main/query-how-to.html"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'bazel query //...\n\nbazel query set(BUILD, some-dir/BUILD)\nbazel query rdeps(//..., set(//:all //some-dir:all))\nbazel query rdeps(//..., set(some-file.java, some-file.sh))\n\nbazel query rebuildfiles(some-ext.bzl, some-dir/another-ext.bzl)\n\nbazel query kind("*_test", <sub query>)\nbazel query kind("artifact_ci_release", <sub query>)\n\nbazel query "allpaths(//foo, third_party/...)" --notool_deps --output graph | dot -Tsvg > /tmp/deps.svg\n'})}),"\n",(0,i.jsx)(n.h2,{id:"bzlmod",children:"bzlmod"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"bazel 5.0+"}),"\n",(0,i.jsx)(n.li,{children:"MODULE.bazel"}),"\n",(0,i.jsx)(n.li,{children:"--experimental_enable_bzlmod"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bazelbuild/bazel-central-registry",children:"https://github.com/bazelbuild/bazel-central-registry"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/bzlmod.html",children:"https://docs.bazel.build/versions/main/bzlmod.html"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.google.com/document/d/1moQfNcEIttsk6vYanNKIy3ZuK53hQUFq1b1r0rmsYVg/edit",children:"https://docs.google.com/document/d/1moQfNcEIttsk6vYanNKIy3ZuK53hQUFq1b1r0rmsYVg/edit"})}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(n.h2,{id:"build-vs-buildbazel",children:"BUILD vs BUILD.bazel"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bazelbuild/bazel/issues/4517",children:"bazel#4517"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"fetching-local_config_xcode",children:"Fetching @local_config_xcode"}),"\n",(0,i.jsx)(n.h2,{id:"from-google",children:"from google"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"google"}),(0,i.jsx)(n.th,{children:"os"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"blaze"}),(0,i.jsx)(n.td,{children:"bazel"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sponge"}),(0,i.jsx)(n.td,{children:"bru, BuildBuddy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"tap"}),(0,i.jsx)(n.td,{children:"BuildKite, CircleCI"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"forge"}),(0,i.jsx)(n.td,{children:"BuildFarm, BuildBarn"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"cider"}),(0,i.jsx)(n.td,{})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"output",children:"output"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"macOS /private/var/tmp"}),"\n",(0,i.jsx)(n.li,{children:"Linux ~/.cache/bazel"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.bazel.build/versions/main/output_directories.html",children:"https://docs.bazel.build/versions/main/output_directories.html"})}),"\n",(0,i.jsxs)(n.li,{children:["out/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_bazel_$USER"})," - outputUserRoot - ",(0,i.jsx)(n.code,{children:"--output_user_root"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["install/ - installBase\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["$MD5(installation manifest)\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"_embedded_binaries/"}),"\n",(0,i.jsx)(n.li,{children:"builtins_bzl/"}),"\n",(0,i.jsx)(n.li,{children:"platforms/"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["$MD5(workspace path) - outputBase - ",(0,i.jsx)(n.code,{children:"--output_base"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"command.log"}),"\n",(0,i.jsx)(n.li,{children:"java.log"}),"\n",(0,i.jsx)(n.li,{children:"action_cache/"}),"\n",(0,i.jsx)(n.li,{children:"action_outs/"}),"\n",(0,i.jsxs)(n.li,{children:["external/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"go_sdk/ - \u7f13\u5b58\u7684 Go SDK"}),"\n",(0,i.jsx)(n.li,{children:"bazel_gazelle_go_repository_cache/ - \u7f13\u5b58\u7684 Go \u4ed3\u5e93"}),"\n",(0,i.jsx)(n.li,{children:"org_golang_google_genproto/"}),"\n",(0,i.jsx)(n.li,{children:"remotejdk11_macos/"}),"\n",(0,i.jsx)(n.li,{children:"remote_java_tools_darwin/"}),"\n",(0,i.jsx)(n.li,{children:"com_google_protobuf/"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["server/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"jvm.out"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["execroot/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"__main__"}),"/ - $WORKSPACE\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["bazel-out/ - outputPath\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"stable-status.txt"}),"\n",(0,i.jsx)(n.li,{children:"volatile-status.txt"}),"\n",(0,i.jsxs)(n.li,{children:["darwin-fastbuild/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"bin/ - $(BINDIR)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"host/ - BuildConfiguration"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"external"}),"\n",(0,i.jsx)(n.li,{children:"$PACKAGES -> realpath"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"bazel-remote-logs/"}),"\n",(0,i.jsx)(n.li,{children:"bazel-workers/"}),"\n",(0,i.jsx)(n.li,{children:"install -> installBase"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"bazel-out"}),"\n",(0,i.jsx)(n.li,{children:"bazel-bin"}),"\n",(0,i.jsx)(n.li,{children:"bazel-testlogs"}),"\n",(0,i.jsx)(n.li,{children:"bazel-$WORKSPACE"}),"\n",(0,i.jsx)(n.li,{children:"TEST_TMPDIR=~/.cache/bazel"}),"\n",(0,i.jsx)(n.li,{children:"--output_user_root"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"project_dir = ctx.path(ctx.attr.file_in_project).dirname"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"__workspace_dir__"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# all go_sdk - \u6bcf\u4e2a 400MB\ndu -csh /private/var/tmp/_bazel_$USER/*/external/go_sdk\n\n# outputPath & action_cache\nbazel clean\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},3354:(e,n,l)=>{var i=l(50959),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,c=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function a(e,n,l){var i,r={},a=null,o=null;for(i in void 0!==l&&(a=""+l),void 0!==n.key&&(a=""+n.key),void 0!==n.ref&&(o=n.ref),n)t.call(n,i)&&!d.hasOwnProperty(i)&&(r[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===r[i]&&(r[i]=n[i]);return{$$typeof:s,type:e,key:a,ref:o,props:r,_owner:c.current}}n.Fragment=r,n.jsx=a,n.jsxs=a},11527:(e,n,l)=>{e.exports=l(3354)},47214:(e,n,l)=>{l.d(n,{Z:()=>c,a:()=>t});var i=l(50959);const s={},r=i.createContext(s);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);