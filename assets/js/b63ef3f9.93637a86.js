"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[58483],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return g}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),s=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),m=s(n),g=r,k=m["".concat(o,".").concat(g)]||m[g]||u[g]||l;return n?a.createElement(k,i(i({ref:t},d),{},{components:n})):a.createElement(k,i({ref:t},d))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},92737:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return p},contentTitle:function(){return o},metadata:function(){return s},toc:function(){return d},default:function(){return m}});var a=n(87462),r=n(63366),l=(n(67294),n(3905)),i=["components"],p={id:"data",title:"Spring Data"},o=void 0,s={unversionedId:"java/spring/data",id:"java/spring/data",title:"Spring Data",description:"Tips",source:"@site/notes/java/spring/spring-data.md",sourceDirName:"java/spring",slug:"/java/spring/data",permalink:"/notes/java/spring/data",editUrl:"https://github.com/wenerme/wener/edit/master/notes/java/spring/spring-data.md",tags:[],version:"current",frontMatter:{id:"data",title:"Spring Data"},sidebar:"docs",previous:{title:"Spring Cloud",permalink:"/notes/java/spring/cloud"},next:{title:"Spring Data REST",permalink:"/notes/java/spring/data-rest"}},d=[{value:"Tips",id:"tips",children:[],level:2},{value:"Note",id:"note",children:[{value:"\u6620\u5c04 - org.springframework.data.mapping",id:"\u6620\u5c04---orgspringframeworkdatamapping",children:[],level:3}],level:2},{value:"MongoDB",id:"mongodb",children:[],level:2},{value:"Entity Versions",id:"entity-versions",children:[],level:2},{value:"Spring Data \u67e5\u8be2\u5173\u952e\u5b57",id:"spring-data-\u67e5\u8be2\u5173\u952e\u5b57",children:[],level:2},{value:"Spring Data \u8fd4\u56de\u7ed3\u679c\u7c7b\u578b",id:"spring-data-\u8fd4\u56de\u7ed3\u679c\u7c7b\u578b",children:[],level:2},{value:"JPA Repository \u65b9\u6cd5\u8bed\u6cd5",id:"jpa-repository-\u65b9\u6cd5\u8bed\u6cd5",children:[],level:2},{value:"\u5355\u72ec\u4f7f\u7528 Repository",id:"\u5355\u72ec\u4f7f\u7528-repository",children:[],level:2},{value:"\u5b9e\u73b0\u81ea\u5b9a\u4e49\u63a5\u53e3",id:"\u5b9e\u73b0\u81ea\u5b9a\u4e49\u63a5\u53e3",children:[],level:2},{value:"\u4e3a\u6240\u6709 Repository \u6dfb\u52a0\u81ea\u5b9a\u4e49\u65b9\u6cd5",id:"\u4e3a\u6240\u6709-repository-\u6dfb\u52a0\u81ea\u5b9a\u4e49\u65b9\u6cd5",children:[],level:2},{value:"\u5728 Query \u4e2d\u4f7f\u7528 SpEL \u6765\u4e66\u5199\u901a\u7528\u7684 SQL",id:"\u5728-query-\u4e2d\u4f7f\u7528-spel-\u6765\u4e66\u5199\u901a\u7528\u7684-sql",children:[],level:2},{value:"Spring Web \u96c6\u6210",id:"spring-web-\u96c6\u6210",children:[{value:"\u76f4\u63a5\u4f7f\u7528\u5b9e\u4f53\u548c\u7279\u6b8a\u53c2\u6570",id:"\u76f4\u63a5\u4f7f\u7528\u5b9e\u4f53\u548c\u7279\u6b8a\u53c2\u6570",children:[],level:3},{value:"\u4f7f\u7528\u591a\u4e2a\u5206\u9875\u53c2\u6570",id:"\u4f7f\u7528\u591a\u4e2a\u5206\u9875\u53c2\u6570",children:[],level:3},{value:"Spring HATEOAS \u652f\u6301\u5206\u9875",id:"spring-hateoas-\u652f\u6301\u5206\u9875",children:[],level:3},{value:"\u4f7f\u7528 Querydsl \u5b9e\u73b0\u67e5\u8be2\u53c2\u6570\u7ed1\u5b9a",id:"\u4f7f\u7528-querydsl-\u5b9e\u73b0\u67e5\u8be2\u53c2\u6570\u7ed1\u5b9a",children:[],level:3}],level:2},{value:"\u4f7f\u7528 Hibernate \u5b9e\u73b0\u8f6f\u5220\u9664",id:"\u4f7f\u7528-hibernate-\u5b9e\u73b0\u8f6f\u5220\u9664",children:[],level:2},{value:"\u81ea\u52a8\u751f\u6210\u521b\u5efa\u65f6\u95f4\u5b57\u6bb5\u548c\u66f4\u65b0\u65f6\u95f4\u5b57\u6bb5",id:"\u81ea\u52a8\u751f\u6210\u521b\u5efa\u65f6\u95f4\u5b57\u6bb5\u548c\u66f4\u65b0\u65f6\u95f4\u5b57\u6bb5",children:[],level:2},{value:"\u94fe\u63a5\u65ad\u5f00\u5f02\u5e38",id:"\u94fe\u63a5\u65ad\u5f00\u5f02\u5e38",children:[],level:2},{value:"Not a managed type",id:"not-a-managed-type",children:[],level:2},{value:"\u4f7f\u7528 QueryDSL \u6784\u5efa\u52a8\u6001\u67e5\u8be2",id:"\u4f7f\u7528-querydsl-\u6784\u5efa\u52a8\u6001\u67e5\u8be2",children:[],level:2}],u={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"tips"},"Tips"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/spring-projects/spring-data-examples"},"Spring Data \u793a\u4f8b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://docs.spring.io/spring-data/commons/docs/current/reference/html/"},"Spring Data Commons \u6587\u6863")),(0,l.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u5c06 PathVariable \u4ece\u4e3b\u952e\u8f6c\u4e3a\u5b9e\u4f53\u7684\u8f6c\u6362\u5668\u4e3a DomainClassConverter",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e3b\u8981\u4f7f\u7528: Repositories, RepositoryInformation, RepositoryInvoker \u8fdb\u884c\u64cd\u4f5c")))),(0,l.kt)("h2",{id:"note"},"Note"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"RepositoryMetadata"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"RepositoryInformation"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"RepositoryQuery")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u62bd\u8c61\u63a5\u53e3, \u7528\u4e8e\u6267\u884c\u6240\u6709\u6570\u636e\u4ed3\u5e93\u64cd\u4f5c"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"PartTree")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u5c06\u65b9\u6cd5\u540d\u8f6c\u6362\u4e3a\u67e5\u8be2\u65b9\u6cd5"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"^(find|read|get|query|stream|count|exists|delete|remove)((\\p{Lu}.*?))??By")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"PersistenceExceptionTranslationInterceptor")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5904\u7406\u6570\u636e\u4ed3\u5e93\u8c03\u7528\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u8be2\u65b9\u6cd5\u5904\u7406\u94fe"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"SurroundingTransactionDetectorMethodInterceptor"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e8b\u52a1\u8bbe\u7f6e"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ExposeInvocationInterceptor")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"DefaultMethodInvokingMethodInterceptor"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5904\u7406 ",(0,l.kt)("inlineCode",{parentName:"li"},"default")," \u65b9\u6cd5"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"RepositoryFactorySupport$QueryExecutorMethodInterceptor"))))),(0,l.kt)("h3",{id:"\u6620\u5c04---orgspringframeworkdatamapping"},"\u6620\u5c04 - org.springframework.data.mapping"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5904\u7406\u4e0d\u540c SpringData \u6301\u4e45\u5316\u7684\u4e2d\u95f4\u5c42\u6620\u5c04"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PersistentEntity<T, P extends PersistentProperty<P>> extends Iterable<P>"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u6301\u4e45\u5316\u5bf9\u8c61"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PersistentProperty"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u6301\u4e45\u5316\u5bf9\u8c61\u7684\u5c5e\u6027"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Association"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8868\u793a\u5c5e\u6027\u4e4b\u95f4\u7684\u5173\u8054"))),(0,l.kt)("li",{parentName:"ul"},"\u4e3b\u8981\u5b9e\u73b0",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"JpaPersistentPropertyImpl"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"JPA \u6301\u4e45\u5316\u5bf9\u8c61\u7684\u5c5e\u6027"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"MutablePersistentEntity<T, P extends PersistentProperty<P>> extends PersistentEntity<T, P>"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5305\u542b\u4e86\u4fee\u6539\u65b9\u6cd5"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"IdentifierAccessor")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PersistentPropertyAccessor")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"MappingContext"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6620\u5c04\u4e0a\u4e0b\u6587"),(0,l.kt)("li",{parentName:"ul"},"\u8bb0\u5f55\u4e86\u6240\u6709\u5df2\u77e5\u7684\u5b9e\u4f53\u7c7b\u578b"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PersistentPropertyPath"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8868\u793a\u4e00\u4e2a\u6301\u4e45\u5c5e\u6027\u7684\u8def\u5f84")))))),(0,l.kt)("h2",{id:"mongodb"},"MongoDB"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"// SpringData \u67e5\u8be2\u65e5\u5fd7\nlogging.level.org.springframework.data.mongodb.core.MongoTemplate: DEBUG\n\n// MongoDB \u7684\u65e5\u5fd7\u5de5\u5177\u7c7b com.mongodb.diagnostics.logging.Loggers\n// \u524d\u7f00 org.mongodb.driver \u4f8b\u5982 \u64cd\u4f5c operation\nlogging.level.org.mongodb.driver.operation: INFO\n// \u6216\u8005\u6253\u5f00\u5168\u91cf\u7684\n// \u6ce8\u610f, \u4f9d\u7136\u662f\u770b\u4e0d\u5230\u53d1\u9001\u7684\u67e5\u8be2\nlogging.level.org.mongodb.driver: INFO\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"MongoDB \u7684 Repository \u5b9e\u73b0",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"org.springframework.data.mongodb.repository.support.SimpleMongoRepository")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"org.springframework.data.mongodb.repository.support.QueryDslMongoRepository")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"MongoQueryMethod"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u89e3\u6790 Mongo \u7684 Query \u6ce8\u89e3"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PartTreeMongoQuery"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u65b9\u6cd5\u89e3\u6790\u540e\u7684 Query \u5b9e\u4f8b"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"org.springframework.data.mongodb.core.query.Query"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5b9e\u9645\u67e5\u8be2"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"org.springframework.data.mongodb.repository.support.SpringDataMongodbQuery"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"QueryDSL Mongo \u7684\u67e5\u8be2\u5bf9\u8c61")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"\ninterface MyRepo{\n  // \u53ea\u8fd4\u56de tags \u5b57\u6bb5\n  // \u6ce8\u610f: QueryDSL \u7684 Predicate \u4e0d\u4f1a\u88ab\u4f7f\u7528\n  @Query(fields = \"{'tags':1}\")\n  List<PageDocument> findTagsBy(Predicate predicate);\n  // \u5efa\u8bae\u57fa\u4e8e QueryDslMongoRepository \u5c06\u67e5\u8be2\u5bf9\u8c61\u4e0a\u7684 Path \u53c2\u6570\u66b4\u9732\u51fa\u6765, \u4f8b\u5982\n  List<T> findAll(Predicate predicate, Path<?>... paths);\n}\n\n")),(0,l.kt)("h2",{id:"entity-versions"},"Entity Versions"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/spring-projects/spring-data-envers"},"spring-projects/spring-data-envers")),(0,l.kt)("li",{parentName:"ul"},"JPA \u6269\u5c55, \u57fa\u4e8e hibernate envers")),(0,l.kt)("h2",{id:"spring-data-\u67e5\u8be2\u5173\u952e\u5b57"},"Spring Data \u67e5\u8be2\u5173\u952e\u5b57"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u903b\u8f91\u5173\u952e\u8bcd"),(0,l.kt)("th",{parentName:"tr",align:null},"\u5173\u952e\u8bcd\u8868\u8fbe\u5f0f"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"AND"),(0,l.kt)("td",{parentName:"tr",align:null},"And")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"OR"),(0,l.kt)("td",{parentName:"tr",align:null},"Or")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"AFTER"),(0,l.kt)("td",{parentName:"tr",align:null},"After, IsAfter")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"BEFORE"),(0,l.kt)("td",{parentName:"tr",align:null},"Before, IsBefore")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"CONTAINING"),(0,l.kt)("td",{parentName:"tr",align:null},"Containing, IsContaining, Contains")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"BETWEEN"),(0,l.kt)("td",{parentName:"tr",align:null},"Between, IsBetween")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ENDING_WITH"),(0,l.kt)("td",{parentName:"tr",align:null},"EndingWith, IsEndingWith, EndsWith")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"EXISTS"),(0,l.kt)("td",{parentName:"tr",align:null},"Exists")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"FALSE"),(0,l.kt)("td",{parentName:"tr",align:null},"False, IsFalse")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GREATER_THAN"),(0,l.kt)("td",{parentName:"tr",align:null},"GreaterThan, IsGreaterThan")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GREATER_THAN_EQUALS"),(0,l.kt)("td",{parentName:"tr",align:null},"GreaterThanEqual, IsGreaterThanEqual")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IN"),(0,l.kt)("td",{parentName:"tr",align:null},"In, IsIn")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IS"),(0,l.kt)("td",{parentName:"tr",align:null},"Is, Equals, (or no keyword)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IS_NOT_NULL"),(0,l.kt)("td",{parentName:"tr",align:null},"NotNull, IsNotNull")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IS_NULL"),(0,l.kt)("td",{parentName:"tr",align:null},"Null, IsNull")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"LESS_THAN"),(0,l.kt)("td",{parentName:"tr",align:null},"LessThan, IsLessThan")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"LESS_THAN_EQUAL"),(0,l.kt)("td",{parentName:"tr",align:null},"LessThanEqual, IsLessThanEqual")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"LIKE"),(0,l.kt)("td",{parentName:"tr",align:null},"Like, IsLike")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NEAR"),(0,l.kt)("td",{parentName:"tr",align:null},"Near, IsNear")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NOT"),(0,l.kt)("td",{parentName:"tr",align:null},"Not, IsNot")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NOT_IN"),(0,l.kt)("td",{parentName:"tr",align:null},"NotIn, IsNotIn")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NOT_LIKE"),(0,l.kt)("td",{parentName:"tr",align:null},"NotLike, IsNotLike")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"REGEX"),(0,l.kt)("td",{parentName:"tr",align:null},"Regex, MatchesRegex, Matches")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"STARTING_WITH"),(0,l.kt)("td",{parentName:"tr",align:null},"StartingWith, IsStartingWith, StartsWith")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"TRUE"),(0,l.kt)("td",{parentName:"tr",align:null},"True, IsTrue")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"WITHIN"),(0,l.kt)("td",{parentName:"tr",align:null},"Within, IsWithin")))),(0,l.kt)("h2",{id:"spring-data-\u8fd4\u56de\u7ed3\u679c\u7c7b\u578b"},"Spring Data \u8fd4\u56de\u7ed3\u679c\u7c7b\u578b"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u8fd4\u56de\u7c7b\u578b"),(0,l.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"void"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4e0d\u8fd4\u56de\u503c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u539f\u5b50\u7c7b\u578b"),(0,l.kt)("td",{parentName:"tr",align:null},"Java \u539f\u5b50\u7c7b\u578b\u503c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u5305\u88c5\u7c7b\u578b"),(0,l.kt)("td",{parentName:"tr",align:null},"Java \u5305\u88c5\u7c7b\u578b\u503c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T"),(0,l.kt)("td",{parentName:"tr",align:null},"An unique entity. Expects the query method to return one result at most. In case no result is found null is returned. More than one result will trigger an IncorrectResultSizeDataAccessException.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Iterator","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"An Iterator.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Collection","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A Collection.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"List","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A List.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Optional","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A Java 8 or Guava Optional. Expects the query method to return one result at most. In case no result is found Optional.empty()/Optional.absent() is returned. More than one result will trigger an IncorrectResultSizeDataAccessException.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Stream","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A Java 8 Stream.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Future","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A Future. Expects method to be annotated with @Async and requires Spring\u2019s asynchronous method execution capability enabled.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"CompletableFuture","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A Java 8 CompletableFuture. Expects method to be annotated with @Async and requires Spring\u2019s asynchronous method execution capability enabled.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ListenableFuture"),(0,l.kt)("td",{parentName:"tr",align:null},"A org.springframework.util.concurrent.ListenableFuture. Expects method to be annotated with @Async and requires Spring\u2019s asynchronous method execution capability enabled.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Slice"),(0,l.kt)("td",{parentName:"tr",align:null},"A sized chunk of data with information whether there is more data available. Requires a Pageable method parameter.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Page","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A Slice with additional information, e.g. the total number of results. Requires a Pageable method parameter.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GeoResult","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A result entry with additional information, e.g. distance to a reference location.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GeoResults","<","T>"),(0,l.kt)("td",{parentName:"tr",align:null},"A list of GeoResult","<","T> with additional information, e.g. average distance to a reference location.")))),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u7a7a\u95f4\u5750\u6807\u7c7b\u578b(GeoResult, GeoResults, GeoPage)\u53ea\u6709\u5728\u5b58\u50a8\u7c7b\u578b\u652f\u6301\u7a7a\u95f4\u7c7b\u578b\u65f6\u8fd4\u56de")),(0,l.kt)("h2",{id:"jpa-repository-\u65b9\u6cd5\u8bed\u6cd5"},"JPA Repository \u65b9\u6cd5\u8bed\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://docs.spring.io/spring-data/data-jpa/docs/current/reference/html/#jpa.query-methods.query-creation"},"Repository \u65b9\u6cd5\u8bed\u6cd5"))),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Keyword"),(0,l.kt)("th",{parentName:"tr",align:null},"Sample"),(0,l.kt)("th",{parentName:"tr",align:null},"JPQL snippet"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"And"),(0,l.kt)("td",{parentName:"tr",align:null},"findByLastnameAndFirstname"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.lastname = ?1 and x.firstname = ?2")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Or"),(0,l.kt)("td",{parentName:"tr",align:null},"findByLastnameOrFirstname"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.lastname = ?1 or x.firstname = ?2")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Is,Equals"),(0,l.kt)("td",{parentName:"tr",align:null},"findByFirstname,findByFirstnameIs,findByFirstnameEquals"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.firstname = ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Between"),(0,l.kt)("td",{parentName:"tr",align:null},"findByStartDateBetween"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.startDate between ?1 and ?2")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"LessThan"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeLessThan"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age ","<"," ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"LessThanEqual"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeLessThanEqual"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age \u21d0 ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GreaterThan"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeGreaterThan"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age > ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GreaterThanEqual"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeGreaterThanEqual"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age >= ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"After"),(0,l.kt)("td",{parentName:"tr",align:null},"findByStartDateAfter"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.startDate > ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Before"),(0,l.kt)("td",{parentName:"tr",align:null},"findByStartDateBefore"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.startDate ","<"," ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IsNull"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeIsNull"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age is null")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IsNotNull,NotNull"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAge(Is)NotNull"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age not null")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Like"),(0,l.kt)("td",{parentName:"tr",align:null},"findByFirstnameLike"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.firstname like ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NotLike"),(0,l.kt)("td",{parentName:"tr",align:null},"findByFirstnameNotLike"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.firstname not like ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"StartingWith"),(0,l.kt)("td",{parentName:"tr",align:null},"findByFirstnameStartingWith"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.firstname like ?1 (parameter bound with appended %)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"EndingWith"),(0,l.kt)("td",{parentName:"tr",align:null},"findByFirstnameEndingWith"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.firstname like ?1 (parameter bound with prepended %)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Containing"),(0,l.kt)("td",{parentName:"tr",align:null},"findByFirstnameContaining"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.firstname like ?1 (parameter bound wrapped in %)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"OrderBy"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeOrderByLastnameDesc"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age = ?1 order by x.lastname desc")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Not"),(0,l.kt)("td",{parentName:"tr",align:null},"findByLastnameNot"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.lastname ","<","> ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"In"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeIn(Collection","<","Age> ages)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age in ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NotIn"),(0,l.kt)("td",{parentName:"tr",align:null},"findByAgeNotIn(Collection","<","Age> age)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.age not in ?1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"True"),(0,l.kt)("td",{parentName:"tr",align:null},"findByActiveTrue()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.active = true")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"False"),(0,l.kt)("td",{parentName:"tr",align:null},"findByActiveFalse()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where x.active = false")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IgnoreCase"),(0,l.kt)("td",{parentName:"tr",align:null},"findByFirstnameIgnoreCase"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2026 where UPPER(x.firstame) = UPPER(?1)")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// Enables the distinct flag for the query\nList<Person> findDistinctPeopleByLastnameOrFirstname(String lastname, String firstname);\nList<Person> findPeopleDistinctByLastnameOrFirstname(String lastname, String firstname);\n\n\n// \u4f7f\u7528 Top \u548c First\nUser findFirstByOrderByLastnameAsc();\nUser findTopByOrderByAgeDesc();\nPage<User> queryFirst10ByLastname(String lastname, Pageable pageable);\nSlice<User> findTop3ByLastname(String lastname, Pageable pageable);\nList<User> findFirst10ByLastname(String lastname, Sort sort);\nList<User> findTop10ByLastname(String lastname, Pageable pageable);\n\n// \u8fd4\u56de\u7ed3\u679c\u6d41\n@Query("select u from User u")\nStream<User> findAllByCustomQueryAndStream();\n// \u53ea\u8fd4\u56de\u7ed3\u679c\u7247\u6bb5\nSlice<User> findTop3ByLastname(String lastname, Pageable pageable);\n\n// \u9009\u62e9\u5355\u4e2a\u8fd4\u56de,\u53ef\u8fd4\u56de Optional\nUser findFirstByOrderByLastnameAsc();\nOptional<User> findTopByOrderByAgeDesc();\n\n// \u5f02\u6b65\u64cd\u4f5c\n@Async\nFuture<User> findByFirstname(String firstname);               \n@Async\nCompletableFuture<User> findOneByFirstname(String firstname);\n@Async\nListenableFuture<User> findOneByLastname(String lastname);\n\nLong countByLastname(String lastname);\nLong deleteByLastname(String lastname);\nList<User> removeByLastname(String lastname);\n')),(0,l.kt)("h2",{id:"\u5355\u72ec\u4f7f\u7528-repository"},"\u5355\u72ec\u4f7f\u7528 Repository"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"RepositoryFactorySupport factory = \u2026 // Instantiate factory here\nUserRepository repository = factory.getRepository(UserRepository.class);\n")),(0,l.kt)("h2",{id:"\u5b9e\u73b0\u81ea\u5b9a\u4e49\u63a5\u53e3"},"\u5b9e\u73b0\u81ea\u5b9a\u4e49\u63a5\u53e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"interface UserRepositoryCustom {\n  public void someCustomMethod(User user);\n}\nclass UserRepositoryImpl implements UserRepositoryCustom {\n\n  public void someCustomMethod(User user) {\n    // Your custom implementation\n  }\n}\ninterface UserRepository extends CrudRepository<User, Long>, UserRepositoryCustom {\n\n  // Declare query methods here\n}\n")),(0,l.kt)("h2",{id:"\u4e3a\u6240\u6709-repository-\u6dfb\u52a0\u81ea\u5b9a\u4e49\u65b9\u6cd5"},"\u4e3a\u6240\u6709 Repository \u6dfb\u52a0\u81ea\u5b9a\u4e49\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@NoRepositoryBean\npublic interface MyRepository<T, ID extends Serializable>\n  extends PagingAndSortingRepository<T, ID> {\n\n  void sharedCustomMethod(ID id);\n}\n\npublic class MyRepositoryImpl<T, ID extends Serializable>\n  extends SimpleJpaRepository<T, ID> implements MyRepository<T, ID> {\n\n  private final EntityManager entityManager;\n\n  // \u6784\u9020\u51fd\u6570\u5fc5\u987b\u8981\u8981\u6709\u8fd9\u6837\u7684\u4f9d\u8d56\u6ce8\u5165\n  public MyRepositoryImpl(JpaEntityInformation entityInformation, EntityManager entityManager) {\n    super(entityInformation, entityManager);\n\n    // Keep the EntityManager around to used from the newly introduced methods.\n    this.entityManager = entityManager;\n  }\n\n  public void sharedCustomMethod(ID id) {\n    // implementation goes here\n  }\n}\n\n@Configuration\n@EnableJpaRepositories(repositoryBaseClass = MyRepositoryImpl.class)\nclass ApplicationConfiguration { \u2026 }\n")),(0,l.kt)("h2",{id:"\u5728-query-\u4e2d\u4f7f\u7528-spel-\u6765\u4e66\u5199\u901a\u7528\u7684-sql"},"\u5728 Query \u4e2d\u4f7f\u7528 SpEL \u6765\u4e66\u5199\u901a\u7528\u7684 SQL"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@MappedSuperclass\npublic abstract class AbstractMappedType {\n  String attribute;\n}\n\n@Entity\npublic class ConcreteType extends AbstractMappedType { \u2026 }\n\n@NoRepositoryBean\npublic interface MappedTypeRepository<T extends AbstractMappedType> extends Repository<T, Long> {\n  @Query("select t from #{#entityName} t where t.attribute = ?1")\n  List<T> findAllByAttribute(String attribute);\n}\n\npublic interface ConcreteRepository extends MappedTypeRepository<ConcreteType> { \u2026 }\n')),(0,l.kt)("h2",{id:"spring-web-\u96c6\u6210"},"Spring Web \u96c6\u6210"),(0,l.kt)("h3",{id:"\u76f4\u63a5\u4f7f\u7528\u5b9e\u4f53\u548c\u7279\u6b8a\u53c2\u6570"},"\u76f4\u63a5\u4f7f\u7528\u5b9e\u4f53\u548c\u7279\u6b8a\u53c2\u6570"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\n@RequestMapping("/users")\npublic class UserController {\n\n  @RequestMapping("/{id}")\n  public String showUserForm(@PathVariable("id") User user, Model model) {\n\n    model.addAttribute("user", user);\n    return "userForm";\n  }\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"DomainClassConverter")," \u5b9e\u73b0\u53c2\u6570\u5b9e\u4f53\u7684\u6ce8\u5165"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"HandlerMethodArgumentResolver")," \u5b9e\u73b0\u7279\u6b8a\u53c2\u6570(Pageable,Sort)\u7684\u6ce8\u5165")),(0,l.kt)("h3",{id:"\u4f7f\u7528\u591a\u4e2a\u5206\u9875\u53c2\u6570"},"\u4f7f\u7528\u591a\u4e2a\u5206\u9875\u53c2\u6570"),(0,l.kt)("p",null,"\u4ee5\u4e0b\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"foo_page")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"bar_page")," \u6307\u5b9a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public String showUsers(Model model,\n      @Qualifier("foo") Pageable first,\n      @Qualifier("bar") Pageable second) { \u2026 }\n')),(0,l.kt)("h3",{id:"spring-hateoas-\u652f\u6301\u5206\u9875"},"Spring HATEOAS \u652f\u6301\u5206\u9875"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\nclass PersonController {\n\n  @Autowired PersonRepository repository;\n\n  @RequestMapping(value = "/persons", method = RequestMethod.GET)\n  HttpEntity<PagedResources<Person>> persons(Pageable pageable,\n    PagedResourcesAssembler assembler) {\n\n    Page<Person> persons = repository.findAll(pageable);\n    return new ResponseEntity<>(assembler.toResources(persons), HttpStatus.OK);\n  }\n}\n')),(0,l.kt)("h3",{id:"\u4f7f\u7528-querydsl-\u5b9e\u73b0\u67e5\u8be2\u53c2\u6570\u7ed1\u5b9a"},"\u4f7f\u7528 Querydsl \u5b9e\u73b0\u67e5\u8be2\u53c2\u6570\u7ed1\u5b9a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\nclass UserController {\n\n  @Autowired UserRepository repository;\n\n  @RequestMapping(value = "/", method = RequestMethod.GET)\n  String index(Model model, @QuerydslPredicate(root = User.class) Predicate predicate,    \n          Pageable pageable, @RequestParam MultiValueMap<String, String> parameters) {\n\n    model.addAttribute("users", repository.findAll(predicate, pageable));\n\n    return "index";\n  }\n}\n\n/* \u5b9a\u5236\u5316\u7ed1\u5b9a\u65b9\u5f0f */\ninterface UserRepository extends CrudRepository<User, String>,\n                                 QueryDslPredicateExecutor<User>,                \n                                 QuerydslBinderCustomizer<QUser> {               \n\n  @Override\n  default public void customize(QuerydslBindings bindings, QUser user) {\n\n    bindings.bind(user.username).first((path, value) -> path.contains(value))    \n    bindings.bind(String.class)\n      .first((StringPath path, String value) -> path.containsIgnoreCase(value));\n    bindings.excluding(user.password);                                           \n  }\n}\n')),(0,l.kt)("h2",{id:"\u4f7f\u7528-hibernate-\u5b9e\u73b0\u8f6f\u5220\u9664"},"\u4f7f\u7528 Hibernate \u5b9e\u73b0\u8f6f\u5220\u9664"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Entity\n@Where("deleted = 0") // Hibernate \u6ce8\u89e3\nclass User{\n  String name;\n  Integer deleted;\n}\n')),(0,l.kt)("h2",{id:"\u81ea\u52a8\u751f\u6210\u521b\u5efa\u65f6\u95f4\u5b57\u6bb5\u548c\u66f4\u65b0\u65f6\u95f4\u5b57\u6bb5"},"\u81ea\u52a8\u751f\u6210\u521b\u5efa\u65f6\u95f4\u5b57\u6bb5\u548c\u66f4\u65b0\u65f6\u95f4\u5b57\u6bb5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// ==================== #1 =======================\n\n@EntityListeners({AuditingEntityListener.class})\n@MappedSuperclass\n@Data\n@ToString\n@EqualsAndHashCode\npublic abstract class AbstractEntity implements Serializable { }\n\n// ==================== #2 =======================\n\n@Entity\n@Table(name = "entities")    \npublic class Entity {\n  ...\n\n  private Date created;\n  private Date updated;\n\n  @PrePersist\n  protected void onCreate() {\n    created = new Date();\n  }\n\n  @PreUpdate\n  protected void onUpdate() {\n    updated = new Date();\n  }\n}\n\n// =================== #3 ========================\n\n@MappedSuperclass\npublic abstract class AbstractTimestampEntity {\n    @Temporal(TemporalType.TIMESTAMP)\n    @Column(name = "created", nullable = false)\n    private Date created;\n\n    @Temporal(TemporalType.TIMESTAMP)\n    @Column(name = "updated", nullable = false)\n    private Date updated;\n\n    @PrePersist\n    protected void onCreate() {\n      updated = created = new Date();\n    }\n\n    @PreUpdate\n    protected void onUpdate() {\n      updated = new Date();\n    }\n}\n\n@Entity\n@Table(name = "campaign")\npublic class Campaign extends AbstractTimestampEntity implements Serializable {\n  // ...\n}\n// =================== #4 ========================\n\n@EqualsAndHashCode(callSuper = true)\n@Entity\n@Data\n@Accessors(chain = true)\n@EntityListeners(AuditingEntityListener.class)\npublic class User extends AbstractPersistable<Long> {\n    String username;\n    String address;\n\n    @CreatedDate\n    @Temporal(TemporalType.TIMESTAMP)\n    private Date createdDate;\n\n    @LastModifiedDate\n    @Temporal(TemporalType.TIMESTAMP)\n    private Date lastModifiedDate;\n}\n')),(0,l.kt)("h2",{id:"\u94fe\u63a5\u65ad\u5f00\u5f02\u5e38"},"\u94fe\u63a5\u65ad\u5f00\u5f02\u5e38"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"DataAccessResourceFailureException: could not prepare statement; nested exception is org.hibernate.exception.JDBCConnectionException: could not prepare statement\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Caused by: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: The last packet successfully received from the server was 48,054,727 milliseconds ago.  The last packet sent successfully to the server was 48,054,727 milliseconds ago. is longer than the server configured value of 'wait_timeout'. You should consider either expiring and/or testing connection validity before use in your application, increasing the server configured values for client timeouts, or using the Connector/J connection property 'autoReconnect=true' to avoid this problem.\n")),(0,l.kt)("p",null,"\u4e3a MySQL \u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"&autoReconnect=true&failOverReadOnly=false&maxReconnects=10")," \u94fe\u63a5\u53c2\u6570"),(0,l.kt)("h2",{id:"not-a-managed-type"},"Not a managed type"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@SpringBootApplication\n@EntityScan(basePackageClasses = MyEntityPackage.class)\nclass MyApp{\n\n}\n")),(0,l.kt)("h2",{id:"\u4f7f\u7528-querydsl-\u6784\u5efa\u52a8\u6001\u67e5\u8be2"},"\u4f7f\u7528 QueryDSL \u6784\u5efa\u52a8\u6001\u67e5\u8be2"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface BaseRepository<T, ID extends Serializable>\n        extends JpaRepository<T, ID>, JpaSpecificationExecutor<T>, QueryDslPredicateExecutor<T> {\n}\npublic interface UserRepository extends BaseRepository<User,Long> {\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"PathBuilder builder = new PathBuilder<>(entityType, Preconditions.checkNotNull(CaseFormat.UPPER_CAMEL.converterTo(CaseFormat.LOWER_CAMEL).convert(entityType.getSimpleName())));\n\npublic Page<T> query(Map<String, Object> params, Pageable pageable) {\n    BooleanExpression[] expressions = new BooleanExpression[params.size()];\n    int i = 0;\n    for (Map.Entry<String, Object> entry : params.entrySet()) {\n        expressions[i++] = builder.get(entry.getKey()).eq(entry.getValue());\n        Expressions.path(entityType, entry.getKey());\n    }\n    return repository.findAll(BooleanExpression.allOf(expressions), pageable);\n}\n")))}m.isMDXComponent=!0}}]);