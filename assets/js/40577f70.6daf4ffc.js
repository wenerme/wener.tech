/*! For license information please see 40577f70.6daf4ffc.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[35828],{86364:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var i=s(2488),t=s(62780);const l={tags:["Version"]},r="Citus Version",c={id:"db/relational/postgresql/citus-version",title:"Citus Version",description:"| version                 | date       |",source:"@site/../notes/db/relational/postgresql/citus-version.md",sourceDirName:"db/relational/postgresql",slug:"/db/relational/postgresql/citus-version",permalink:"/notes/db/relational/postgresql/citus-version",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/citus-version.md",tags:[{label:"Version",permalink:"/notes/tags/version"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1690351481,formattedLastUpdatedAt:"Jul 26, 2023",frontMatter:{tags:["Version"]},sidebar:"docs",previous:{title:"Citus Columnar",permalink:"/notes/db/relational/postgresql/citus-columnar"},next:{title:"Citus",permalink:"/notes/db/relational/postgresql/citus"}},d={},a=[{value:"Citus v12",id:"citus-v12",level:2},{value:"Citus v11",id:"citus-v11",level:2},{value:"Citus v10",id:"citus-v10",level:2}];function o(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.M)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"citus-version",children:"Citus Version"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"version"}),(0,i.jsx)(e.th,{children:"date"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.a,{href:"#citus-v11",children:"Citus v11"})}),(0,i.jsx)(e.td,{children:"2022-06-15"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.a,{href:"#citus-v10",children:"Citus v10"})}),(0,i.jsx)(e.td,{children:"2021-02-16"})]})]})]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://www.citusdata.com/updates/",children:"https://www.citusdata.com/updates/"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"citus-v12",children:"Citus v12"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["schema-based sharding\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"schema=shard"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://www.citusdata.com/blog/2023/07/18/citus-12-schema-based-sharding-for-postgres/",children:"https://www.citusdata.com/blog/2023/07/18/citus-12-schema-based-sharding-for-postgres/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"set citus.enable_schema_based_sharding to on;\n"})}),"\n",(0,i.jsx)(e.h2,{id:"citus-v11",children:"Citus v11"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5f00\u6e90\u6240\u6709\u4f01\u4e1a\u7248\u529f\u80fd\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Citus v10 \u5f00\u6e90\u4e86\u5206\u7247\u5e73\u8861"}),"\n",(0,i.jsx)(e.li,{children:"Citus v11 \u5f00\u6e90\u4e86\u6240\u6709\u5269\u4e0b\u7684\u4f01\u4e1a\u7248\u529f\u80fd"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u903b\u8f91\u590d\u5236\u7684 Rebalance - \u4e0d\u963b\u585e\u5199"}),"\n",(0,i.jsxs)(e.li,{children:["\u66f4\u5b8c\u5584\u7684\u5143\u6570\u636e\u540c\u6b65 - \u591a\u7528\u6237\u3001RLS - \u96c6\u7fa4\u89d2\u8272\u3001\u6388\u6743\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u8fde\u4efb\u610f\u8282\u70b9\uff0c\u4e0d\u518d\u9700\u8981\u8fde coordinator\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u9ed8\u8ba4\u9690\u85cf\u5206\u7247\u8868 - \u907f\u514d\u770b\u8d77\u6765\u5f88\u4e71\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53ef\u9488\u5bf9\u5173\u95ed ",(0,i.jsx)(e.code,{children:"SET citus.show_shards_for_app_name_prefixes TO 'psql';"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5168\u90e8\u5173\u95ed ",(0,i.jsx)(e.code,{children:"SET citus.override_table_visibility TO off;"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u79df\u6237\u9694\u79bb\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9488\u5bf9\u79df\u6237\u7684 citus_stat_statements"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7ec6\u7c92\u5ea6\u63a7\u5236\u8282\u70b9\u95f4\u6388\u6743\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"pg_dist_authinfo"}),"\n",(0,i.jsx)(e.li,{children:"citus.node_conninfo \u652f\u6301 sslkey,sslcert"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5185\u90e8\u94fe\u63a5\u8d70\u5185\u90e8\u94fe\u63a5\u6c60\u8def\u7531\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"pg_dist_poolinfo"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["COPY \u907f\u514d\u6821\u9a8c JSON/JSONB - \u63d0\u9ad8\u6570\u636e\u52a0\u8f7d\u6027\u80fd - \u4e4b\u524d\u4f1a\u5bfc\u81f4\u4e24\u6b21\u6821\u9a8c\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u53ef\u5173\u95ed ",(0,i.jsx)(e.code,{children:"SET citus.skip_jsonb_validation_in_copy TO off;"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u96c6\u7fa4\u4fe1\u606f\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"citus_check_cluster_node_health()"}),"\n",(0,i.jsx)(e.li,{children:"citus_backend_gpid() - gpid -> global_pid - \u5168\u5c40\u8bc6\u522b\u6bcf\u4e2a\u4f1a\u8bdd"}),"\n",(0,i.jsx)(e.li,{children:"citus_stat_activity"}),"\n",(0,i.jsx)(e.li,{children:"citus_dist_stat_activity"}),"\n",(0,i.jsx)(e.li,{children:"citus_lock_waits"}),"\n",(0,i.jsx)(e.li,{children:"pg_cancel_backend() \u548c pg_terminate_backend() \u652f\u6301 gpid"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u65b0\u589e helper\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"run_command_on_coordinator"}),"\n",(0,i.jsx)(e.li,{children:"run_command_on_all_nodes"}),"\n",(0,i.jsx)(e.li,{children:"citus_is_coordinator"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Preview\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Triggers on distributed tables\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"SET citus.enable_unsafe_triggers TO on;"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5347\u7ea7\nALTER EXTENSION citus\nUPDATE\n;\n\nCALL citus_finish_citus_upgrade();\n\n-- \u591a\u7528\u6237\n-- =======\n-- ALTER|CREATE|DROP ROLE \u4f1a \u540c\u6b65/\u5e7f\u64ad \u5230\u5176\u4ed6\u8282\u70b9\n-- GRANT/REVOKE \u4e5f\u4f1a \u540c\u6b65 \u5230\u5176\u4ed6\u8282\u70b9\n-- \u914d\u7f6e citus.enable_alter_database_owner \u540c\u6b65\u4fee\u6539 db owner - ALTER DATABASE \u2026 OWNER TO\nCREATE ROLE create_role_test CREATEDB CREATEROLE LOGIN REPLICATION CONNECTION\nLIMIT\n  105 PASSWORD 'type_your_passwd' VALID UNTIL '2045-05-05 00:00:00.00+00';\n\n-- \u56e0\u4e3a\u7528\u6237\u548c\u6743\u9650\u90fd\u540c\u6b65\u4e86\uff0c\u6240\u4ee5 RLS \u4e5f\u80fd\u751f\u6548\nCREATE POLICY user_mod ON events FOR\nSELECT\n  TO rls_tenant_1 USING (current_user = 'rls_tenant_' | | tenant_id:: text);\n\n-- \u91cd\u65b0\u5e73\u8861\n-- =======\nSELECT\n  rebalance_table_shards();\n\n-- \u5355\u4e2a\u8868\nSELECT\n  rebalance_table_shards('users');\n\n-- \u6ca1\u6709 pk \u6216 replica identity,\n-- \u9002\u7528\u4e8e\u6ca1\u6709\u66f4\u65b0\u548c\u5220\u9664\u7684\u8868 - \u8fc1\u79fb\u5b8c\u6210\u540e\u6062\u590d\nSELECT\n  rebalance_table_shards(\n    'test_table',\n    shard_transfer_mode = > 'force_logical'\n  );\n\n-- \u79df\u6237\u9694\u79bb\n-- =======\nSELECT\n  isolate_tenant_to_new_shard('table_name', tenant_id);\n\nSELECT\n  isolate_tenant_to_new_shard('orders', 135);\n\n-- CASCADE \u540c\u65f6\u9650\u5b9a co-located \u8868\nSELECT\n  isolate_tenant_to_new_shard('orders', 135, 'CASCADE');\n\n-- \u96c6\u7fa4\u4fe1\u606f\n-- =======\nselect\n  key,\n  citus_backend_gpid()\nFROM\n  distributed_table;\n\nSELECT\n  global_pid,\n  query,\n  state\nFROM\n  citus_stat_activity\nWHERE\n  query ilike 'INSER%'\n  and global_pid != citus_backend_gpid();\n\n-- \u7c7b\u4f3c citus_stat_activity\uff0c\u4f46\u4e0d\u5305\u542b\u5185\u90e8\u540e\u7aef\nSELECT\n  global_pid,\n  query,\n  state\nFROM\n  citus_dist_stat_activity\nWHERE\n  query ilike 'INSER%'\n  and global_pid != citus_backend_gpid();\n\nSELECT\n  *\nFROM\n  citus_lock_waits;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u26a0\ufe0f \u5e9f\u5f03\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Shard placement invalidation"}),"\n",(0,i.jsx)(e.li,{children:"Append-distributed tables - \u63a8\u8350\u4f7f\u7528 hash-distributed tables"}),"\n",(0,i.jsx)(e.li,{children:"\u5206\u5e03\u5f0f cstore_fdw \u8868 - v10 \u5185\u7f6e\u5217\u5b58\u50a8"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://www.citusdata.com/updates/v11-0/",children:"https://www.citusdata.com/updates/v11-0/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"citus-v10",children:"Citus v10"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Shard rebalance - \u4f1a\u963b\u585e\u8bfb"}),"\n",(0,i.jsx)(e.li,{children:"\u5185\u7f6e\u5217\u5b58\u50a8 - columner"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,t.M)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},38088:(n,e,s)=>{var i=s(96651),t=Symbol.for("react.element"),l=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,c=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function a(n,e,s){var i,l={},a=null,o=null;for(i in void 0!==s&&(a=""+s),void 0!==e.key&&(a=""+e.key),void 0!==e.ref&&(o=e.ref),e)r.call(e,i)&&!d.hasOwnProperty(i)&&(l[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps)void 0===l[i]&&(l[i]=e[i]);return{$$typeof:t,type:n,key:a,ref:o,props:l,_owner:c.current}}e.Fragment=l,e.jsx=a,e.jsxs=a},2488:(n,e,s)=>{n.exports=s(38088)},62780:(n,e,s)=>{s.d(e,{I:()=>c,M:()=>r});var i=s(96651);const t={},l=i.createContext(t);function r(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);