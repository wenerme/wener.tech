"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[94158],{49613:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(59496);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,c=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,f=d["".concat(c,".").concat(m)]||d[m]||p[m]||l;return n?r.createElement(f,i(i({ref:t},u),{},{components:n})):r.createElement(f,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6958:function(e,t,n){n.r(t),n.d(t,{assets:function(){return k},contentTitle:function(){return m},default:function(){return g},frontMatter:function(){return d},metadata:function(){return f},toc:function(){return h}});var r=n(49613),a=Object.defineProperty,l=Object.defineProperties,i=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))c.call(t,n)&&u(e,n,t[n]);if(o)for(var n of o(t))s.call(t,n)&&u(e,n,t[n]);return e};const d={title:"etcd"},m="etcd",f={unversionedId:"db/kv/etcd",id:"db/kv/etcd",title:"etcd",description:"- etcd.conf.yml",source:"@site/../notes/db/kv/etcd.md",sourceDirName:"db/kv",slug:"/db/kv/etcd",permalink:"/notes/db/kv/etcd",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/kv/etcd.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1690946986,formattedLastUpdatedAt:"Aug 2, 2023",frontMatter:{title:"etcd"},sidebar:"docs",previous:{title:"dragonflydb",permalink:"/notes/db/kv/dragonflydb"},next:{title:"FoundationDB",permalink:"/notes/db/kv/foundationdb"}},k={},h=[{value:"etcdctl",id:"etcdctl",level:2},{value:"\u914d\u7f6e {configuration}",id:"\u914d\u7f6e-configuration",level:2},{value:"limits",id:"limits",level:2}],b={toc:h};function g(e){var t,n=e,{components:a}=n,u=((e,t)=>{var n={};for(var r in e)c.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&o)for(var r of o(e))t.indexOf(r)<0&&s.call(e,r)&&(n[r]=e[r]);return n})(n,["components"]);return(0,r.kt)("wrapper",(t=p(p({},b),u),l(t,i({components:a,mdxType:"MDXLayout"}))),(0,r.kt)("h1",p({},{id:"etcd"}),"etcd"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/etcd-io/etcd/blob/main/etcd.conf.yml.sample"}),"etcd.conf.yml")),(0,r.kt)("li",{parentName:"ul"},"adopters:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"kubernetes"),(0,r.kt)("li",{parentName:"ul"},"vitess"),(0,r.kt)("li",{parentName:"ul"},"Apache APISIX"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://discovery.etcd.io"}),"https://discovery.etcd.io"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u53d1\u73b0\u9636\u6bb5"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"https://discovery.etcd.io/${UUID}")))),(0,r.kt)("li",{parentName:"ul"},"\u5b58\u50a8 ",(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/etcd-io/bbolt"}),"etcd-io/bbolt")),(0,r.kt)("li",{parentName:"ul"},"\u53c2\u8003",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://etcd.io/docs/v3.5/integrations/"}),"https://etcd.io/docs/v3.5/integrations/")))),(0,r.kt)("li",{parentName:"ul"},"v3 API"),(0,r.kt)("li",{parentName:"ul"},"RBAC")),(0,r.kt)("admonition",p({},{type:"tip"}),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"\u9002\u7528\u4e8e \u5c11\u91cf\u66f4\u65b0\uff0c\u5927\u91cf\u8bfb\u53d6\u7684\u573a\u666f"),(0,r.kt)("li",{parentName:"ul"},"\u9891\u7e41\u66f4\u65b0\u5bfc\u81f4 snapshot \u589e\u957f\u5f88\u5feb"),(0,r.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4 2GiB \u5b58\u50a8"),(0,r.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4 value \u4e0a\u9650 1.5MiB"),(0,r.kt)("li",{parentName:"ul"},"v2 API - 3.5 \u5e9f\u5f03, 3.6 \u9000\u5f79"))),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),'# Docker\n# ==========\ndocker run --rm -it \\\n  -v $PWD/data:/data \\\n  -p 2379:2379 \\\n  -e ETCD_AUTO_COMPACTION_MODE=revision \\\n  -e ETCD_AUTO_COMPACTION_RETENTION=1000 \\\n  -e ETCD_QUOTA_BACKEND_BYTES=4294967296 \\\n  -e ETCD_SNAPSHOT_COUNT=50000 \\\n  --name etcd quay.io/coreos/etcd:v3.5.0 \\\n  etcd --advertise-client-urls=http://127.0.0.1:2379 --listen-client-urls http://0.0.0.0:2379 --data-dir /data\n\n# macOS\n# ==========\nbrew install etcd\n\n# \u670d\u52a1\u7aef\n# ==========\netcd\n\n# \u5ba2\u6237\u7aef\n# ==========\netcdctl put key "value"\netcdctl get ket\n\n# \u5176\u4ed6\u670d\u52a1\n# stateless pass-through etcd TCP connection forwarding proxy\netcd gateway\n# stateless etcd v3 gRPC L7 reverse proxy\netcd grpc-proxy\n')),(0,r.kt)("h2",p({},{id:"etcdctl"}),"etcdctl"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",p({parentName:"tr"},{align:null}),"etcdctl flag"),(0,r.kt)("th",p({parentName:"tr"},{align:null}),"env"),(0,r.kt)("th",p({parentName:"tr"},{align:null}),"demo"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",p({parentName:"tr"},{align:null})),(0,r.kt)("td",p({parentName:"tr"},{align:null}),"ETCDCTL_API"),(0,r.kt)("td",p({parentName:"tr"},{align:null}),"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",p({parentName:"tr"},{align:null}),"--endpoints"),(0,r.kt)("td",p({parentName:"tr"},{align:null})),(0,r.kt)("td",p({parentName:"tr"},{align:null}),"localhost:2379")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"etcdctl check perf|datascale"),(0,r.kt)("li",{parentName:"ul"},"etcdctl put|get|watch|lock|del"),(0,r.kt)("li",{parentName:"ul"},"etcdctl snapshot save|status|restore"),(0,r.kt)("li",{parentName:"ul"},"etcdctl member list|add|promote|remove|update"),(0,r.kt)("li",{parentName:"ul"},"etcdctl user list|add|get|delete|passwd|grant-role|revoke-role"),(0,r.kt)("li",{parentName:"ul"},"etcdctl role list|add|get|delete|grant-permission|revoke-permission"),(0,r.kt)("li",{parentName:"ul"},"etcdctl auth enable|status|disable"),(0,r.kt)("li",{parentName:"ul"},"permission",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"read,readwrite"),(0,r.kt)("li",{parentName:"ul"},"prefix")))),(0,r.kt)("h2",p({},{id:"\u914d\u7f6e-configuration"}),"\u914d\u7f6e {configuration}"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-yaml"}),"# Member\n# ==============================\nname: default # \u6210\u5458\u540d\u5b57\ndata-dir: ${name}.etcd # \u6570\u636e\u76ee\u5f55\nwal-dir: # WAL \u65e5\u5fd7\u76ee\u5f55\n\n# \u5feb\u7167\u5230\u78c1\u76d8\u7684 \u4e8b\u52a1\u6570\nsnapshot-count: 10000\n# \u5fc3\u8df3\u95f4\u9694 ms\nheartbeat-interval: 100\n# \u9009\u4e3e\u8d85\u65f6 ms\nelection-timeout: 1000\n\n# \u540e\u7aef\u6570\u636e\u5927\u5c0f\u62a5\u8b66\u9600\u503c - 0 \u7981\u7528\nquota-backend-bytes: 0\n\n# peer traffic.\n# \u9017\u53f7\u5206\u9694\u591a\u4e2a\nlisten-peer-urls: http://localhost:2380\n# client traffic.\nlisten-client-urls: http://localhost:2379\n\n# \u4fdd\u7559\u5feb\u7167\u6587\u4ef6 - 0 \u65e0\u9650\nmax-snapshots: 5\n# \u4fdd\u7559 WAL \u6587\u4ef6\nmax-wals: 5\n\n# CORS \u57df\u540d - \u9017\u53f7\u5206\u9694\ncors:\n\n# List of this member's peer URLs to advertise to the rest of the cluster.\n# The URLs needed to be a comma-separated list.\ninitial-advertise-peer-urls: http://localhost:2380\n\n# List of this member's client URLs to advertise to the public.\n# The URLs needed to be a comma-separated list.\nadvertise-client-urls: http://localhost:2379\n\n# Discovery URL used to bootstrap the cluster.\ndiscovery:\n\n# exit,proxy\ndiscovery-fallback: 'proxy'\n\n# HTTP proxy to use for traffic to discovery service.\ndiscovery-proxy:\n\n# DNS domain used to bootstrap initial cluster.\ndiscovery-srv:\n\n# Initial cluster configuration for bootstrapping.\ninitial-cluster:\n\n# Initial cluster token for the etcd cluster during bootstrap.\ninitial-cluster-token: 'etcd-cluster'\n\n# Initial cluster state ('new' or 'existing').\ninitial-cluster-state: 'new'\n\n# Reject reconfiguration requests that would cause quorum loss.\nstrict-reconfig-check: false\nenable-pprof: true\n\nclient-transport-security:\n  # Path to the client server TLS cert file.\n  cert-file:\n\n  # Path to the client server TLS key file.\n  key-file:\n\n  # Enable client cert authentication.\n  client-cert-auth: false\n\n  # Path to the client server TLS trusted CA cert file.\n  trusted-ca-file:\n\n  # Client TLS using generated certificates\n  auto-tls: false\n\npeer-transport-security:\n  # Path to the peer server TLS cert file.\n  cert-file:\n\n  # Path to the peer server TLS key file.\n  key-file:\n\n  # Enable peer client cert authentication.\n  client-cert-auth: false\n\n  # Path to the peer server TLS trusted CA cert file.\n  trusted-ca-file:\n\n  # Peer TLS using generated certificates.\n  auto-tls: false\n\n# The validity period of the self-signed certificate, the unit is year.\nself-signed-cert-validity: 1\n\nlog-level: debug\nlogger: zap\n# default, stderr, stdout\nlog-outputs: [stderr]\nenable-log-rotation: false\nlog-rotation-config-json: '{\"maxsize\": 100, \"maxage\": 0, \"maxbackups\": 0, \"localtime\": false, \"compress\": false}'\n\n# Clustering\n# ==============================\n\n# periodic - \u57fa\u4e8e\u95f4\u9694\uff0c\u9ed8\u8ba4\u5355\u4f4d\u4e3a\u5c0f\u65f6\n# revision - \u57fa\u4e8e\u7248\u672c\nauto-compaction-mode: periodic\nauto-compaction-retention: '1'\n\nenable-v2: false\n\n# v2 Proxy\n# on,off\nproxy: 'off'\nproxy-failure-wait: 5000\nproxy-refresh-interval: 30000\nproxy-dial-timeout: 1000\nproxy-write-timeout: 5000\nproxy-read-timeout: 0\n\n# Unsafe\n# ==============================\n# \u5f3a\u5236\u521b\u5efa\u5355\u6210\u5458\u96c6\u7fa4\nforce-new-cluster: false\nunsafe-no-fsync: false\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://etcd.io/docs/v3.5/op-guide/configuration/"}),"https://etcd.io/docs/v3.5/op-guide/configuration/"))),(0,r.kt)("h2",p({},{id:"limits"}),"limits"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",p({parentName:"tr"},{align:null}),"flag"),(0,r.kt)("th",p({parentName:"tr"},{align:"right"}),"default"),(0,r.kt)("th",p({parentName:"tr"},{align:null}),"note"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",p({parentName:"tr"},{align:null}),"--max-request-bytes"),(0,r.kt)("td",p({parentName:"tr"},{align:"right"}),"1.5MiB"),(0,r.kt)("td",p({parentName:"tr"},{align:null}))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",p({parentName:"tr"},{align:null}),"--quota-backend-bytes"),(0,r.kt)("td",p({parentName:"tr"},{align:"right"}),"2GiB"),(0,r.kt)("td",p({parentName:"tr"},{align:null}),"\u63a8\u8350 8GiB")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://etcd.io/docs/v3.5/dev-guide/limit/"}),"https://etcd.io/docs/v3.5/dev-guide/limit/"))))}g.isMDXComponent=!0}}]);