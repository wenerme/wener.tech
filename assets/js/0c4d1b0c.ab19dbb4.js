/*! For license information please see 0c4d1b0c.ab19dbb4.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[71246],{1065:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});var i=s(11527),r=s(47214);const l={title:"NATS FAQ",tags:["FAQ"]},c="NATS FAQ",t={id:"queue/nats/nats-faq",title:"NATS FAQ",description:"- Pub \u4e0d\u652f\u6301 wildcard",source:"@site/../notes/queue/nats/nats-faq.md",sourceDirName:"queue/nats",slug:"/queue/nats/faq",permalink:"/notes/queue/nats/faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/queue/nats/nats-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1702882608,formattedLastUpdatedAt:"Dec 18, 2023",frontMatter:{title:"NATS FAQ",tags:["FAQ"]},sidebar:"docs",previous:{title:"NATS Design",permalink:"/notes/queue/nats/design"},next:{title:"NATS JetStream",permalink:"/notes/queue/nats/jetstream"}},d={},a=[{value:"Limits",id:"limits",level:2},{value:"MAX_PAYLOAD_EXCEEDED",id:"max_payload_exceeded",level:2},{value:"Subjects",id:"subjects",level:2},{value:"delay",id:"delay",level:2},{value:"Remaping",id:"remaping",level:2},{value:"Service Bus",id:"service-bus",level:2},{value:"NATS vs NATS Streaming vs NATS JetStream",id:"nats-vs-nats-streaming-vs-nats-jetstream",level:2},{value:"cannot create a queue subscription for a consumer without a deliver group",id:"cannot-create-a-queue-subscription-for-a-consumer-without-a-deliver-group",level:2},{value:"503 status from $SYS.REQ.SERVER.PING, ensure a system account is used with appropriate permissions",id:"503-status-from-sysreqserverping-ensure-a-system-account-is-used-with-appropriate-permissions",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"nats-faq",children:"NATS FAQ"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pub \u4e0d\u652f\u6301 wildcard"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"limits",children:"Limits"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["subject\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4e0d\u5efa\u8bae\u8d85\u8fc7 16 token\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4e5f\u5c31\u662f\u8bf4 ",(0,i.jsx)(n.code,{children:"."})," \u5c11\u4e8e 15 \u4e2a"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u63a8\u8350 ",(0,i.jsx)(n.code,{children:"[a-zA-Z0-9]"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u5141\u8bb8\u7684\u4e00\u4e9b\u7279\u6b8a\u7b26\u53f7 ",(0,i.jsx)(n.code,{children:"'!@#$%^&*()_;:\\'\\\"?,<+-=~"}),",```"]}),"\n",(0,i.jsxs)(n.li,{children:["\u63a8\u8350\u5206\u9694\u7b26 ",(0,i.jsx)(n.code,{children:"/#$-~"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["KV - ",(0,i.jsx)(n.code,{children:"$KV.<bucket>.<key>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"KV-Operation"}),"\n",(0,i.jsxs)(n.li,{children:["bucket - \u540d\u5b57 ",(0,i.jsx)(n.code,{children:"/^[-\\w]+$/"})]}),"\n",(0,i.jsxs)(n.li,{children:["search key - ",(0,i.jsx)(n.code,{children:"/^[-/=.>*\\w]+$/"})]}),"\n",(0,i.jsxs)(n.li,{children:["key - ",(0,i.jsx)(n.code,{children:"/^[-/=.\\w]+$/"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"ObjectStore"}),"\n",(0,i.jsxs)(n.li,{children:["\u6d88\u606f\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["max_payload=1 MB\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6700\u5927 64 MB"}),"\n",(0,i.jsxs)(n.li,{children:["\u63a8\u8350\u4e0d\u8d85\u8fc7 8 MB\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Base64 \u7f16\u7801\u540e 6 MB"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u5982\u679c\u60f3\u8981\u652f\u6301 10MB Base64 \u5219\u9700\u8981 13MB, \u53ef\u4ee5\u8003\u8651\u8bbe\u7f6e\u4e3a 15MB"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"max_pending=64 MB"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["subjects\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u76ee\u524d\u65e0\u6570\u91cf\u9650\u5236"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["max_connections=64K\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u8fde\u63a5\u6570\u91cf"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"max_control_line=4KB"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.nats.io/running-a-nats-service/configuration",children:"https://docs.nats.io/running-a-nats-service/configuration"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"max_payload_exceeded",children:"MAX_PAYLOAD_EXCEEDED"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"max_payload \u9ed8\u8ba4 1 MB"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"subjects",children:"Subjects"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$SYS"})," - \u7cfb\u7edf\u529f\u80fd\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$SYS.REQ.USER.AUTH"})," - auth callout"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$SYS.REQ.SERVER.{server-id}.RELOAD"})," - \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"$JS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"$KV"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$G"})," - global account"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"_INBOX"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_R_"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"leafnode"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"delay",children:"delay"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Jetstream\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["NAK \u8fd4\u56de\u5e26 delay \u65f6\u95f4\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Backoff"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Nats defered message ",(0,i.jsx)(n.a,{href:"https://github.com/nats-io/nats-server/issues/3403",children:"#3403"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PUBLISH \u65f6\u6307\u5b9a"}),"\n",(0,i.jsx)(n.li,{children:"Nats-Before"}),"\n",(0,i.jsx)(n.li,{children:"Nats-Not-Before"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/nats-io/nats-server/issues/2846",children:"https://github.com/nats-io/nats-server/issues/2846"})}),"\n",(0,i.jsxs)(n.li,{children:["Consumer Ack/Nak Backoffs ",(0,i.jsx)(n.del,{children:(0,i.jsx)(n.a,{href:"https://github.com/nats-io/nats-server/pull/2812",children:"#2812"})})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"remaping",children:"Remaping"}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4e0d\u652f\u6301 ",(0,i.jsx)(n.code,{children:">"})," \u901a\u914d\u7b26"]}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u6d4b\u8bd5\nnats server mapping "a.*.*" "b.{{wildcard(2)}}.{{wildcard(1)}}" a.x.y # b.y.x\nnats server mapping "a.*" "b.{{wildcard(1)}}" a.x                     # b.x\n\nnats server mapping "tenant.X.service.*" "service.{{wildcard(1)}}" tenant.X.service.a # service.a\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wildcard(N)"})," - 2.8+ - \u7b2c N \u4e2a\u901a\u914d"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$N"})," -> ",(0,i.jsx)(n.code,{children:"$1"})," \u4ee5\u524d\u7684\u903b\u8f91\uff0c\u5360\u4f4d"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"split(wildcard index, delimter)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"splitfromleft(wildcard index, offset)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"splitfromright(wildcard index, offset)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"slicefromleft(wildcard index, number of characters)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"slicefromright(wildcard index, number of characters)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"partition(number of partitions, wildcard token positions...)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.nats.io/nats-concepts/subject_mapping",children:"https://docs.nats.io/nats-concepts/subject_mapping"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"service-bus",children:"Service Bus"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["NATS\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"fire and forget - NATS JetStream"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Azure ServiceBus - ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview",children:"https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/nats-io/nats-server/issues/1288",children:"https://github.com/nats-io/nats-server/issues/1288"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"nats-vs-nats-streaming-vs-nats-jetstream",children:"NATS vs NATS Streaming vs NATS JetStream"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["NATS\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PubSub"}),"\n",(0,i.jsx)(n.li,{children:'most once - "send-and-pray" - \u7c7b\u4f3c UDP'}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["NATS Streaming - STAN\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"least once - \u7c7b\u4f3c TCP"}),"\n",(0,i.jsx)(n.li,{children:"request-reply over nats core - protobuf"}),"\n",(0,i.jsx)(n.li,{children:"Streaming Module is a client to a NATS Server"}),"\n",(0,i.jsx)(n.li,{children:"\u6d88\u606f\u5b58\u50a8\u3001\u6d88\u606f ACK"}),"\n",(0,i.jsx)(n.li,{children:"\u72ec\u7acb\u670d\u52a1\u3001\u534f\u8bae\u4e0d\u540c"}),"\n",(0,i.jsxs)(n.li,{children:["\u9650\u5236\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4e0d\u80fd\u79fb\u9664\u5df2\u7ecf ACK \u6d88\u606f"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u80fd NAck"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u80fd Pull"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0e NATS 2.0 \u8d26\u53f7\u5b89\u5168\u96c6\u6210\u8f83\u5dee"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u80fd \u9650\u5236\u5ba2\u6237\u7aef\u8ba2\u9605"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u80fd \u6c34\u5e73\u6269\u5bb9"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["NATS JetStream - \u53d6\u4ee3 NATS Streaming\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"nats \u5185\u7f6e"}),"\n",(0,i.jsx)(n.li,{children:"STAN \u6240\u6709\u80fd\u529b+\u65b0\u7684\u529f\u80fd"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://gcoolinfo.medium.com/ec2d9f426dc8",children:"Comparing NATS, NATS Streaming and NATS JetStream"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cannot-create-a-queue-subscription-for-a-consumer-without-a-deliver-group",children:"cannot create a queue subscription for a consumer without a deliver group"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"2.4+ nats \u4fee\u590d"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"503-status-from-sysreqserverping-ensure-a-system-account-is-used-with-appropriate-permissions",children:"503 status from $SYS.REQ.SERVER.PING, ensure a system account is used with appropriate permissions"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0d\u8981\u7528 ",(0,i.jsx)(n.code,{children:"server info"}),", \u7528 ",(0,i.jsx)(n.code,{children:"account info"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["server \u547d\u4ee4\u9700\u8981\u66f4\u9ad8\u7684\u6743\u9650 ",(0,i.jsx)(n.code,{children:" $SYS.REQ.SERVER.>"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.nats.io/running-a-nats-service/configuration/sys_accounts",children:"https://docs.nats.io/running-a-nats-service/configuration/sys_accounts"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},3354:(e,n,s)=>{var i=s(50959),r=Symbol.for("react.element"),l=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,t=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function a(e,n,s){var i,l={},a=null,o=null;for(i in void 0!==s&&(a=""+s),void 0!==n.key&&(a=""+n.key),void 0!==n.ref&&(o=n.ref),n)c.call(n,i)&&!d.hasOwnProperty(i)&&(l[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===l[i]&&(l[i]=n[i]);return{$$typeof:r,type:e,key:a,ref:o,props:l,_owner:t.current}}n.Fragment=l,n.jsx=a,n.jsxs=a},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>t,a:()=>c});var i=s(50959);const r={},l=i.createContext(r);function c(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);