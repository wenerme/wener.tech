/*! For license information please see 1ff7c2e8.0d9bd983.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[63622],{60231:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var t=r(11527),i=r(47214);const l={title:"Linkerd \u5e38\u89c1\u95ee\u9898",tags:["FAQ"]},s="Linkerd \u5e38\u89c1\u95ee\u9898",o={id:"devops/service/linkerd-faq",title:"Linkerd \u5e38\u89c1\u95ee\u9898",description:"\u95ee\u9898\u6392\u67e5",source:"@site/../notes/devops/service/linkerd-faq.md",sourceDirName:"devops/service",slug:"/devops/service/linkerd-faq",permalink:"/notes/devops/service/linkerd-faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/service/linkerd-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1637477347,formattedLastUpdatedAt:"Nov 21, 2021",frontMatter:{title:"Linkerd \u5e38\u89c1\u95ee\u9898",tags:["FAQ"]},sidebar:"docs",previous:{title:"Kuma",permalink:"/notes/devops/service/kuma"},next:{title:"Linkerd Version",permalink:"/notes/devops/service/linkerd-version"}},a={},d=[{value:"\u95ee\u9898\u6392\u67e5",id:"\u95ee\u9898\u6392\u67e5",level:2},{value:"error: unable to retrieve the complete list of server APIs: tap.linkerd.io/v1alpha1: the server is currently unable to handle the request",id:"error-unable-to-retrieve-the-complete-list-of-server-apis-taplinkerdiov1alpha1-the-server-is-currently-unable-to-handle-the-request",level:2},{value:"linkerd-proxy-injector - remote error: tls: bad certificate",id:"linkerd-proxy-injector---remote-error-tls-bad-certificate",level:2},{value:"cni",id:"cni",level:2},{value:"Failed to initialize identity service",id:"failed-to-initialize-identity-service",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"linkerd-\u5e38\u89c1\u95ee\u9898",children:"Linkerd \u5e38\u89c1\u95ee\u9898"}),"\n",(0,t.jsx)(n.h2,{id:"\u95ee\u9898\u6392\u67e5",children:"\u95ee\u9898\u6392\u67e5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5 proxy \u662f\u5426\u6b63\u5e38\n# --context default \u6307\u5b9a\u5176\u4ed6\u4e0a\u4e0b\u6587\n# \u786e\u4fdd linkerd \u662f\u6b63\u5e38\u7684\nlinkerd check --proxy -n linkerd\n# \u68c0\u67e5\u5176\u4ed6\u7a7a\u95f4\nlinkerd check --proxy -n ingress-nginx\n\n# config.linkerd.io/enable-debug-sidecar=true\n# --enable-debug-sidecar\nlinkerd inject --enable-debug-sidecar whoami.deploy.yaml | kubectl -n default apply -f -\n"})}),"\n",(0,t.jsx)(n.h2,{id:"error-unable-to-retrieve-the-complete-list-of-server-apis-taplinkerdiov1alpha1-the-server-is-currently-unable-to-handle-the-request",children:"error: unable to retrieve the complete list of server APIs: tap.linkerd.io/v1alpha1: the server is currently unable to handle the request"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \u9a8c\u8bc1\u670d\u52a1\u6b63\u5e38\nkubectl get apiservices\nkubectl get pods -n kube-system\n\n# hook \u5b58\u5728\nkubectl get validatingwebhookconfigurations\nkubectl get mutatingwebhookconfigurations\n\nlinkerd -n linkerd tap deploy/web\n# Error: HTTP error, status Code [503] (unexpected API response: Error trying to reach service: 'x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0')\n\n# \u91cd\u542f linkerd\nkubectl rollout restart -n linkerd deployment\n\n# \u67e5\u770b\u4e8b\u4ef6\nkubectl get events --field-selector reason=IssuerUpdated -n linkerd\n"})}),"\n",(0,t.jsx)(n.h2,{id:"linkerd-proxy-injector---remote-error-tls-bad-certificate",children:"linkerd-proxy-injector - remote error: tls: bad certificate"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/linkerd/linkerd2/issues/3754",children:"#3754"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"linkerd upgrade --identity-trust-anchors-file=./ca.crt\n"})}),"\n",(0,t.jsx)(n.h2,{id:"cni",children:"cni"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u81ea\u52a8\u91cd\u5199 Pod \u7684 iptables \u89c4\u5219"}),"\n",(0,t.jsx)(n.li,{children:"\u5b89\u88c5\u540e\u5219\u4e0d\u518d\u9700\u8981 init - \u8be5 Container \u9700\u8981 NET_ADMIN \u6743\u9650"}),"\n",(0,t.jsx)(n.li,{children:"\u9002\u7528\u4e8e\u96c6\u7fa4\u5bf9\u6743\u9650\u9650\u5236\u7684\u6bd4\u8f83\u4e25\u8c28\u7684\u573a\u666f"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88c5 CNI\nlinkerd install-cni | kubectl apply -f -\n# \u5b89\u88c5\u540e\nlinkerd install --linkerd-cni-enabled | kubectl apply -f -\n\n# HELM \u5b89\u88c5 CNI\nhelm install linkerd2-cni linkerd2/linkerd2-cni\n# check\nlinkerd check --pre --linkerd-cni-enabled\n"})}),"\n",(0,t.jsx)(n.h2,{id:"failed-to-initialize-identity-service",children:"Failed to initialize identity service"})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},3354:(e,n,r)=>{var t=r(50959),i=Symbol.for("react.element"),l=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function d(e,n,r){var t,l={},d=null,c=null;for(t in void 0!==r&&(d=""+r),void 0!==n.key&&(d=""+n.key),void 0!==n.ref&&(c=n.ref),n)s.call(n,t)&&!a.hasOwnProperty(t)&&(l[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===l[t]&&(l[t]=n[t]);return{$$typeof:i,type:e,key:d,ref:c,props:l,_owner:o.current}}n.Fragment=l,n.jsx=d,n.jsxs=d},11527:(e,n,r)=>{e.exports=r(3354)},47214:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>s});var t=r(50959);const i={},l=t.createContext(i);function s(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);