/*! For license information please see bd0b5089.b1d9b25e.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[19789],{47:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>a,frontMatter:()=>c,metadata:()=>d,toc:()=>l});var o=r(11527),s=r(47214);const c={title:"Drone Runner"},t="drone runner",d={id:"service/forge/drone/drone-runner",title:"Drone Runner",description:"- exec runner \u76ee\u524d\u7528\u4e0d\u4e86 - \u65e0\u6cd5\u6ce8\u5165 git cred",source:"@site/../notes/service/forge/drone/drone-runner.md",sourceDirName:"service/forge/drone",slug:"/service/forge/drone/runner",permalink:"/notes/service/forge/drone/runner",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/forge/drone/drone-runner.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1675652392,formattedLastUpdatedAt:"Feb 6, 2023",frontMatter:{title:"Drone Runner"},sidebar:"docs",previous:{title:"Drone Pipeline",permalink:"/notes/service/forge/drone/pipeline"},next:{title:"Forge Awesome",permalink:"/notes/service/forge/awesome"}},i={},l=[{value:"exec runner",id:"exec-runner",level:2},{value:"docker runner",id:"docker-runner",level:2},{value:"kubernates runner",id:"kubernates-runner",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"drone-runner",children:"drone runner"}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["exec runner \u76ee\u524d\u7528\u4e0d\u4e86 - \u65e0\u6cd5\u6ce8\u5165 git cred\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u65b0\u7684\u63d2\u4ef6\u57fa\u4e8e container"}),"\n",(0,o.jsx)(n.li,{children:"exec \u4e0d\u518d\u7ef4\u62a4\u4e86"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,o.jsx)(n.h2,{id:"exec-runner",children:"exec runner"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"/etc/drone-runner-exec/config"}),"\n",(0,o.jsx)(n.li,{children:"~/.drone-runner-exec/config"}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-exec",children:"drone-runners/drone-runner-exec"})," \u5df2\u7ecf\u88ab\u5f52\u6863"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl -L https://github.com/drone-runners/drone-runner-exec/releases/latest/download/drone_runner_exec_linux_amd64.tar.gz | tar zx\nsudo install -t /usr/local/bin drone-runner-exec\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:"DRONE_RPC_PROTO=https\nDRONE_RPC_HOST=drone.company.com\nDRONE_RPC_SECRET=super-duper-secret\nDRONE_LOG_FILE=/var/log/drone-runner-exec/log.txt\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u914d\u7f6e UI \u540e\u53ef\u8bbf\u95ee runner \u7684\u754c\u9762\uff0c :3000"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"DRONE_UI_USERNAME=root"}),"\n",(0,o.jsx)(n.li,{children:"DRONE_UI_PASSWORD=root"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# daemon \u524d\u53f0\u8fd0\u884c\ndrone-runner-exec daemon /etc/drone-runner-exec/config\n\nDRONE_DEBUG=true drone-runner-exec service run --config /etc/drone-runner-exec/config\n\n# \u670d\u52a1\u6a21\u5f0f - \u540e\u53f0\ndrone-runner-exec service install # \u4e0d\u662f OpenRC /etc/init.d/drone-runner-exec\ndrone-runner-exec service start   # service run\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"var"}),(0,o.jsx)(n.th,{children:"e.g."})]})}),(0,o.jsx)(n.tbody,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"DRONE_RUNNER_ROOT"}),(0,o.jsx)(n.td,{children:"/tmp"})]})})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.drone.io/runner/exec/configuration/reference/",children:"https://docs.drone.io/runner/exec/configuration/reference/"})}),"\n",(0,o.jsxs)(n.li,{children:["\u6ce8\u518c\u7684 Webhook ",(0,o.jsx)(n.code,{children:"https://drone.dev.zhang66.cn/hook?secret="})]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"docker-runner",children:"docker runner"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker run --detach \\\n  --volume=/var/run/docker.sock:/var/run/docker.sock \\\n  --env=DRONE_RPC_PROTO=https \\\n  --env=DRONE_RPC_HOST=drone.company.com \\\n  --env=DRONE_RPC_SECRET=super-duper-secret \\\n  --env=DRONE_RUNNER_CAPACITY=2 \\\n  --env=DRONE_RUNNER_NAME=first-runner \\\n  --publish=3000:3000 \\\n  --restart=always \\\n  --name=runner \\\n  drone/drone-runner-docker:1\n\ndocker run --rm -it \\\n  --volume=/var/run/docker.sock:/var/run/docker.sock \\\n  --env-file=config \\\n  --publish=3000:3000 \\\n  --name=drone-runner drone/drone-runner-docker:1\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["DRONE_RUNNER_CLONE_IMAGE=docker/git:1\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"clone \u5230 /drone/src/.git/"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.drone.io/runner/docker/configuration/reference/",children:"https://docs.drone.io/runner/docker/configuration/reference/"})}),"\n",(0,o.jsx)(n.li,{children:"DRONE_RUNNER_VOLUMES"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'if [ ! -z "${DRONE_NETRC_FILE}" ]; then\n\techo $DRONE_NETRC_FILE > $HOME/.netrc\n\tchmod 600 $HOME/.netrc\nfi\nunset DRONE_SCRIPT\nunset DRONE_NETRC_MACHINE\nunset DRONE_NETRC_USERNAME\nunset DRONE_NETRC_PASSWORD\nunset DRONE_NETRC_FILE\nset -e\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-docker/blob/7e9969423c0883c0300c974bbb7583e3d9ece875/engine/compiler/shell/shell.go#L37-L50",children:"https://github.com/drone-runners/drone-runner-docker/blob/7e9969423c0883c0300c974bbb7583e3d9ece875/engine/compiler/shell/shell.go#L37-L50"})}),"\n",(0,o.jsxs)(n.li,{children:["DRONE_BUILD_DEBUG=true\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u4f1a\u8bbe\u7f6e DRONE_TMATE_HOST"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"kubernates-runner",children:"kubernates runner"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-kube",children:"drone-runners/drone-runner-kube"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-kube/blob/master/command/daemon/config.go",children:"https://github.com/drone-runners/drone-runner-kube/blob/master/command/daemon/config.go"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  --name=drone-runner-kube drone/drone-runner-kube\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.drone.io/runner/kubernetes/installation/",children:"https://docs.drone.io/runner/kubernetes/installation/"})}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},3354:(e,n,r)=>{var o=r(50959),s=Symbol.for("react.element"),c=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,d=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,n,r){var o,c={},l=null,u=null;for(o in void 0!==r&&(l=""+r),void 0!==n.key&&(l=""+n.key),void 0!==n.ref&&(u=n.ref),n)t.call(n,o)&&!i.hasOwnProperty(o)&&(c[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps)void 0===c[o]&&(c[o]=n[o]);return{$$typeof:s,type:e,key:l,ref:u,props:c,_owner:d.current}}n.Fragment=c,n.jsx=l,n.jsxs=l},11527:(e,n,r)=>{e.exports=r(3354)},47214:(e,n,r)=>{r.d(n,{Z:()=>d,a:()=>t});var o=r(50959);const s={},c=o.createContext(s);function t(e){const n=o.useContext(c);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(c.Provider,{value:n},e.children)}}}]);