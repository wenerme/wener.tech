/*! For license information please see 0211f410.c3900686.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[6820],{2026:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>t,default:()=>a,frontMatter:()=>r,metadata:()=>d,toc:()=>h});var s=i(11527),l=i(47214);const r={title:"UEFI"},t="UEFI",d={id:"os/linux/boot/uefi",title:"UEFI",description:"- .efi \u5b58\u50a8\u5728 ESP/EFI System Partition \u5206\u533a",source:"@site/../notes/os/linux/boot/uefi.md",sourceDirName:"os/linux/boot",slug:"/os/linux/boot/uefi",permalink:"/notes/os/linux/boot/uefi",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/boot/uefi.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1676530464,formattedLastUpdatedAt:"Feb 16, 2023",frontMatter:{title:"UEFI"},sidebar:"docs",previous:{title:"U-Boot",permalink:"/notes/os/linux/boot/uboot"},next:{title:"Build",permalink:"/notes/os/linux/build"}},o={},h=[{value:"AlpineLinux",id:"alpinelinux",level:2},{value:"OVMF",id:"ovmf",level:2},{value:"AAVMF",id:"aavmf",level:2},{value:"EFISTUB",id:"efistub",level:2},{value:"Why UEFI / UEFI vs BIOS",id:"why-uefi--uefi-vs-bios",level:2},{value:"you need to load the kernel first",id:"you-need-to-load-the-kernel-first",level:2}];function c(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"uefi",children:"UEFI"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[".efi \u5b58\u50a8\u5728 ESP/EFI System Partition \u5206\u533a\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5206\u533a\u6807\u8bc6 EF"}),"\n",(0,s.jsx)(e.li,{children:"\u5206\u533a\u683c\u5f0f\u4e3a FAT \u6216 FAT32"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"efibootmgr - \u7ba1\u7406 efi \u53d8\u91cf\uff0c\u63a7\u5236\u4f7f\u7528\u7684\u542f\u52a8\u6587\u4ef6"}),"\n",(0,s.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://edk2-docs.gitbook.io/understanding-the-uefi-secure-boot-chain",children:"Understanding UEFI Secure Boot Chain"})}),"\n",(0,s.jsxs)(e.li,{children:["wikipedia ",(0,s.jsx)(e.a,{href:"https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface",children:"UEFI"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://wiki.alpinelinux.org/wiki/Alpine_and_UEFI",children:"Alpine and UEFI"})}),"\n",(0,s.jsxs)(e.li,{children:["debian ",(0,s.jsx)(e.a,{href:"https://wiki.debian.org/UEFI",children:"UEFI"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://wiki.ubuntu.com/EFIBootLoaders",children:"EFIBootLoaders"})}),"\n",(0,s.jsxs)(e.li,{children:["ubuntu ",(0,s.jsx)(e.a,{href:"https://wiki.ubuntu.com/UEFI/OVMF",children:"UEFI/OVMF"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://blog.system76.com/post/139138591598/howto-uefi-qemu-guest-on-ubuntu-xenial-host",children:"Howto: QEMU w/ Ubuntu Xenial host + UEFI guest"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4f7f\u7528 UEFI \u5efa\u8bae\u4f7f\u7528 GRUB Bootloader"}),"\n"]})}),"\n",(0,s.jsx)(e.h2,{id:"alpinelinux",children:"AlpineLinux"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6700\u5c0f UEFI/GPT \u5206\u533a"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"mount point"}),(0,s.jsx)(e.th,{children:"type"}),(0,s.jsx)(e.th,{children:"size"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"/boot, /efi"}),(0,s.jsx)(e.td,{children:"EFI Boot"}),(0,s.jsx)(e.td,{children:"260MiB"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"/"}),(0,s.jsx)(e.td,{children:"root"}),(0,s.jsx)(e.td,{children:"1-32 GiB"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"non"}),(0,s.jsx)(e.td,{children:"swap"}),(0,s.jsx)(e.td,{children:"1-2GiB"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"ovmf",children:"OVMF"}),"\n",(0,s.jsx)(e.p,{children:"\u57fa\u4e8e EDK II \u7528\u4e8e\u652f\u6301\u865a\u62df\u673a EFI \u542f\u52a8\u7684\u56fa\u4ef6"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"OVMF - Open Virtual Machine Firmware"}),"\n",(0,s.jsx)(e.li,{children:"OVMF/OVMF.fd - x86_64 \u5b9e\u9645\u8fd0\u884c\u7684\u56fa\u4ef6"}),"\n",(0,s.jsx)(e.li,{children:"OVMF/OVMF_CODE.fd"}),"\n",(0,s.jsxs)(e.li,{children:["OVMF/OVMF_VARS.fd\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u201ctemplate\u201d used to emulate persistent NVRAM storage"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"OVMF/QEMU_EFI.fd - aarch64"}),"\n",(0,s.jsx)(e.li,{children:"ovmf/bios.bin - \u8f6f\u8fde\u63a5\u6307\u5411 OVMF.fd \u6216 QEMU_EFI.fd"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# -pflash path/to/OVMF.fd - emulated flash, fully support UEFI variables\n# -bios bios.bin - variables will be partially emulated, and non-volatile, variables may lose their contents after a reboot\n# -L . - \u540c bios\n# qemu-system-x86_64 -L .\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"apk add ovmf\n# /usr/share/OVMF/\n# /usr/share/ovmf/bios.bin\n"})}),"\n",(0,s.jsx)(e.h2,{id:"aavmf",children:"AAVMF"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["AAVMF - ARM Architecture Virtual Machine Firmware\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"EFI Development Kit II platform that enables UEFI support for QEMU/KVM ARM Virtual Machines."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"UEFI firmware for aarch64 virtual machines"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Distro"}),(0,s.jsx)(e.th,{children:"Package"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"RHEL/CentOS"}),(0,s.jsx)(e.td,{children:"AAVMF/edk2-aarch64"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Debian/Ubuntu"}),(0,s.jsx)(e.td,{children:"qemu-efi"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"AlpineLinux"}),(0,s.jsx)(e.td,{children:"aavmf"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"efistub",children:"EFISTUB"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u4e00\u79cd\u542f\u52a8\u65b9\u5f0f\uff0c\u5c06 linux \u5185\u6838 \u8f6c\u4e3a efi \u6587\u4ef6\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Linux \u5185\u6838\u53ef\u76f4\u63a5\u901a\u8fc7 EFI \u542f\u52a8"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"Linux 3.3+"}),"\n",(0,s.jsxs)(e.li,{children:["archlinux ",(0,s.jsx)(e.a,{href:"https://wiki.archlinux.org/title/EFISTUB",children:"EFISTUB"})]}),"\n"]}),"\n",(0,s.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(e.h2,{id:"why-uefi--uefi-vs-bios",children:"Why UEFI / UEFI vs BIOS"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u76f8\u540c\u70b9\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u56fa\u4ef6\u63a5\u53e3"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["BIOS\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"MBR/Master Boot Record \u5b58\u50a8\u5206\u533a"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["UEFI\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"GPT/GUID partition table \u5206\u533a"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301 2TB \u5b58\u50a8\u8bbe\u5907"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301\u8d85\u8fc7 4 \u4e2a\u4e3b\u5206\u533a"}),"\n",(0,s.jsx)(e.li,{children:"\u56fa\u4ef6\u652f\u6301\u4f7f\u7cfb\u7edf\u542f\u52a8\u66f4\u5feb"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301\u5b89\u5168\u542f\u52a8 - \u7cfb\u7edf\u5b8c\u6574\u6027\u68c0\u67e5"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301\u7f51\u7edc"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301\u56fe\u5f62\u754c\u9762"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"you-need-to-load-the-kernel-first",children:"you need to load the kernel first"}),"\n",(0,s.jsx)(e.p,{children:"\u6ce8\u610f\u5728\u8fd9\u4e4b\u524d\u7684\u9519\u8bef"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"error: out of memory\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53ef\u80fd\u662f\u5728 linux \u52a0\u8f7d\u5185\u6838\u65f6\u51fa\u73b0\uff0c\u9700\u8981\u589e\u52a0\u5185\u5b58\u3002"}),"\n",(0,s.jsx)(e.p,{children:"QEMU \u9ed8\u8ba4\u5185\u5b58\u542f\u52a8 alpine lts efi \u5931\u8d25\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# -accel hvf \u4f1a\u5931\u8d25\nqemu-system-x86_64 -m 2G -bios OVMF/OVMF.fd -hda /dev/rdisk2\n"})})]})}function a(n={}){const{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},3354:(n,e,i)=>{var s=i(50959),l=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,d=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function h(n,e,i){var s,r={},h=null,c=null;for(s in void 0!==i&&(h=""+i),void 0!==e.key&&(h=""+e.key),void 0!==e.ref&&(c=e.ref),e)t.call(e,s)&&!o.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===r[s]&&(r[s]=e[s]);return{$$typeof:l,type:n,key:h,ref:c,props:r,_owner:d.current}}e.Fragment=r,e.jsx=h,e.jsxs=h},11527:(n,e,i)=>{n.exports=i(3354)},47214:(n,e,i)=>{i.d(e,{Z:()=>d,a:()=>t});var s=i(50959);const l={},r=s.createContext(l);function t(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);