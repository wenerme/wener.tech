/*! For license information please see 90bcced3.0aaab97f.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[86443],{41776:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var s=r(11527),t=r(47214);const i={title:"React Query"},l="React Query",c={id:"web/react/react-query",title:"React Query",description:"- TanStack/query",source:"@site/../notes/web/react/react-query.md",sourceDirName:"web/react",slug:"/web/react/query",permalink:"/notes/web/react/query",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/react/react-query.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1701146597,formattedLastUpdatedAt:"Nov 28, 2023",frontMatter:{title:"React Query"},sidebar:"docs",previous:{title:"React Practice",permalink:"/notes/web/react/practice"},next:{title:"React Route",permalink:"/notes/web/react/router"}},a={},d=[{value:"QueryClient",id:"queryclient",level:2},{value:"useQuery",id:"usequery",level:2},{value:"Persist",id:"persist",level:2},{value:"broadcast",id:"broadcast",level:2},{value:"React Query v5",id:"react-query-v5",level:2},{value:"React Query v4",id:"react-query-v4",level:2},{value:"React Query v3",id:"react-query-v3",level:2},{value:"React Query v2.x",id:"react-query-v2x",level:2},{value:"useMutation",id:"usemutation",level:3},{value:"isLoading vs isFetching",id:"isloading-vs-isfetching",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"react-query",children:"React Query"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/TanStack/query",children:"TanStack/query"})}),"\n",(0,s.jsxs)(n.li,{children:["\u9ed8\u8ba4\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5f00\u542f refetchOnMount, refetchOnWindowFocus, refetchOnReconnect"}),"\n",(0,s.jsx)(n.li,{children:"cacheTime 5 \u5206\u949f - \u4e0d\u518d\u4f7f\u7528\u7684\u7684\u6570\u636e\u4fdd\u7559 5 \u5206\u949f"}),"\n",(0,s.jsx)(n.li,{children:"retry=3, retryDelay exponential"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://react-query.tanstack.com/docs/comparison",children:"vs SWR vs Apollo Client"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"vs SWR - \u652f\u6301\u4fee\u6539\uff0c\u66f4\u597d\u7684\u7f13\u5b58\u72b6\u6001\u7ba1\u7406"}),"\n",(0,s.jsx)(n.li,{children:"vs Apollo - \u652f\u6301 GraphQL \u548c \u4e00\u822c\u8bf7\u6c42\uff0c\u9488\u5bf9 GraphQL \u7684 entity \u7f13\u5b58\u6ca1\u6709 apollo \u5f3a"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/dano-inc/react-query-helper",children:"dano-inc/react-query-helper"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://tkdodo.eu/blog/practical-react-query",children:"Practical React Query"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://react-query.tanstack.com/guides/important-defaults",children:"Important Defaults"})}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"-"}),(0,s.jsx)(n.th,{children:"condition"}),(0,s.jsx)(n.th,{children:"note"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"status"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"idle"}),(0,s.jsx)(n.td,{children:"isIdle"}),(0,s.jsx)(n.td,{children:"enabled:false \u6216 mutation \u672a\u6267\u884c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"loading"}),(0,s.jsx)(n.td,{children:"isLoading"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"error"}),(0,s.jsx)(n.td,{children:"isError,isLoadingError,isRefetchError"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"success"}),(0,s.jsx)(n.td,{children:"isSuccess"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"initialData"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"isFetching"}),(0,s.jsx)(n.td,{children:"loading \u6216 \u540e\u53f0\u8bf7\u6c42"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"isFetched"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"isFetchedAfterMount"}),(0,s.jsx)(n.td,{children:"\u907f\u514d\u663e\u793a\u7f13\u5b58\u6570\u636e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"isRefetching"}),(0,s.jsx)(n.td,{children:"isFetching && !isLoading"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"options"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"staleTime"}),(0,s.jsx)(n.td,{children:"isStale"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"isPlaceholderData"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"keepPreviousData"}),(0,s.jsx)(n.td,{children:"isPreviousData"}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"queryclient",children:"QueryClient"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6846\u67b6\u65e0\u5173\u5ba2\u6237\u7aef"}),"\n",(0,s.jsx)(n.li,{children:"\u64cd\u4f5c\u6570\u636e\u9700\u8981 queryKey"}),"\n",(0,s.jsx)(n.li,{children:"\u6267\u884c\u67e5\u8be2\u9700\u8981 queryFn"}),"\n",(0,s.jsx)(n.li,{children:"fetchQuery - \u4f1a\u8fd4\u56de\u6570\u636e"}),"\n",(0,s.jsx)(n.li,{children:"prefetchQuery - \u4e0d\u4f1a\u8fd4\u56de\u6570\u636e"}),"\n",(0,s.jsx)(n.li,{children:"getQueryData"}),"\n",(0,s.jsx)(n.li,{children:"setQueryData"}),"\n",(0,s.jsx)(n.li,{children:"getQueriesData"}),"\n",(0,s.jsx)(n.li,{children:"setQueriesData"}),"\n",(0,s.jsxs)(n.li,{children:["Queries\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"invalidate"}),"\n",(0,s.jsx)(n.li,{children:"refetch"}),"\n",(0,s.jsx)(n.li,{children:"cancel"}),"\n",(0,s.jsx)(n.li,{children:"remove"}),"\n",(0,s.jsx)(n.li,{children:"reset"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"getQueryState"}),"\n",(0,s.jsx)(n.li,{children:"isFetching"}),"\n",(0,s.jsx)(n.li,{children:"isMutating"}),"\n",(0,s.jsx)(n.li,{children:"getLogger"}),"\n",(0,s.jsx)(n.li,{children:"getDefaultOptions"}),"\n",(0,s.jsx)(n.li,{children:"setDefaultOptions"}),"\n",(0,s.jsx)(n.li,{children:"setQueryDefaults"}),"\n",(0,s.jsx)(n.li,{children:"getMutationDefaults"}),"\n",(0,s.jsx)(n.li,{children:"setMutationDefaults"}),"\n",(0,s.jsx)(n.li,{children:"getQueryCache"}),"\n",(0,s.jsx)(n.li,{children:"getMutationCache"}),"\n",(0,s.jsx)(n.li,{children:"clear"}),"\n",(0,s.jsx)(n.li,{children:"resumePausedMutations"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usequery",children:"useQuery"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u901a\u8fc7 QueryObserver \u76d1\u542c\u67e5\u8be2\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u76d1\u542c client + options"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u7531 useQuery \u5904\u7406\u7684\u9009\u9879 - \u7531 QueryObserver \u5904\u7406\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"enabled, refetchInterval, refetchIntervalInBackground, refetchOnWindowFocus, refetchOnReconnect, notifyOnChangeProps, onSuccess, onError, onSettled, useErrorBoundary, select, suspense, keepPreviousData, placeholderData"}),"\n",(0,s.jsxs)(n.li,{children:["notifyOnChangeProps\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u54ea\u4e9b\u89e6\u53d1 rerender"}),"\n",(0,s.jsxs)(n.li,{children:["\u4f8b\u5982: ",(0,s.jsx)(n.code,{children:"['data', 'error']"})," \u5728 date \u548c error \u53d8\u5316\u65f6\u89e6\u53d1"]}),"\n",(0,s.jsx)(n.li,{children:"\u8bbe\u7f6e\u4e3a all \u5219\u6240\u6709\u72b6\u6001\u53d8\u5316\u90fd\u4f1a rerender"}),"\n",(0,s.jsxs)(n.li,{children:["\u9ed8\u8ba4\u4f7f\u7528 getter \u8ddf\u8e2a\u4f7f\u7528\u60c5\u51b5\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"Object.defineProperty(trackedResult, key, {configurable: false,enumerable: true,get:()=>{/* \u6dfb\u52a0\u8ddf\u8e2a key */}})"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u7531 QueryObserver \u5b9e\u73b0\u76d1\u542c\u903b\u8f91"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// \u76d1\u542c\u6570\u636e\nconst observer = new QueryObserver(queryClient, { queryKey: ['posts'] });\n\nconst unsubscribe = observer.subscribe((result) => {\n  console.log(result);\n  unsubscribe();\n});\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/TanStack/query/blob/main/packages/query-core/src/queryObserver.ts",children:"https://github.com/TanStack/query/blob/main/packages/query-core/src/queryObserver.ts"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"persist",children:"Persist"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Note"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6574\u4f53 persist \u800c\u4e0d\u662f\u5355\u6761\u8bb0\u5f55\u7ef4\u5ea6 - ",(0,s.jsx)(n.a,{href:"https://github.com/TanStack/query/discussions/2649",children:"#2649"})]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["PersistQueryClientProvider\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4f1a\u4ece persistQueryClient unsubscribe"}),"\n",(0,s.jsx)(n.li,{children:"\u4f1a\u5904\u7406 restore - persistQueryClient \u8fd4\u56de\u7684 promise \u88ab resolve"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { PersistQueryClientProvider } from '@tanstack/react-query-persist-client';\nimport { createSyncStoragePersister } from '@tanstack/query-sync-storage-persister';\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      cacheTime: 1000 * 60 * 60 * 24, // 24 hours\n    },\n  },\n});\n\nconst persister = createSyncStoragePersister({\n  storage: window.localStorage,\n});\n\nReactDOM.createRoot(rootElement).render(\n  <PersistQueryClientProvider client={queryClient} persistOptions={{ persister }}>\n    <App />\n  </PersistQueryClientProvider>,\n);\n\n//\nconst [unsubscribe, promise] = persistQueryClient({\n  queryClient,\n  persister: localStoragePersister,\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"broadcast",children:"broadcast"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5b9e\u73b0\u57fa\u4e8e broadcast-channel"}),"\n",(0,s.jsx)(n.li,{children:"\u76d1\u542c Cache \u4e8b\u4ef6\uff0c\u5e7f\u64ad\u5230\u5176\u4ed6 tab"}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"version",children:"Version"}),"\n",(0,s.jsx)(n.h2,{id:"react-query-v5",children:"React Query v5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4f18\u5316 Typescript \u4f7f\u7528\u4f53\u9a8c\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5355\u5bf9\u8c61 option \u80fd\u83b7\u53d6\u5230\u6b63\u5e38\u7c7b\u578b\uff0c\u4e4b\u524d queryKey \u4e3a\u72ec\u7acb\u53c2\u6570"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"import { queryOptions } from '@tanstack/react-query'"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9884\u5148\u5b9a\u4e49\u597d\u67e5\u8be2"}),"\n",(0,s.jsx)(n.li,{children:"\u6301\u6709\u7c7b\u578b\u4fe1\u606f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u79fb\u9664 onSuccess \u548c onError\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4ece cache \u8fd4\u56de\u65f6\u4e0d\u4f1a\u89e6\u53d1"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose",children:"https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/TanStack/query/discussions/5279",children:"https://github.com/TanStack/query/discussions/5279"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"cacheTime -> gcTime"}),"\n",(0,s.jsx)(n.li,{children:"keepPreviousData -> placeholderData"}),"\n",(0,s.jsx)(n.li,{children:"loading -> pending"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"useMutationState"})}),"\n",(0,s.jsxs)(n.li,{children:["suspense\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"useSuspenseQuery"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"useSuspenseInfiniteQuery"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"useSuspenseQueries"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["createPersister\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u53ef\u5355\u72ec\u7f13\u5b58 Query - \u4e4b\u524d\u53ea\u80fd\u5168\u91cf\u7f13\u5b58"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://tanstack.com/query/v5/docs/react/plugins/createPersister",children:"https://tanstack.com/query/v5/docs/react/plugins/createPersister"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://tanstack.com/blog/announcing-tanstack-query-v5",children:"https://tanstack.com/blog/announcing-tanstack-query-v5"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"react-query-v4",children:"React Query v4"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"@tanstack/react-query"})}),"\n",(0,s.jsx)(n.li,{children:"Keys \u5fc5\u987b\u4e3a\u6570\u7ec4"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://react-query-alpha.tanstack.com/guides/migrating-to-react-query-4",children:"Migrating to React Query 4"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"react-query-v3",children:"React Query v3"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u62c6\u5206 QueryCache \u4e3a QueryClient \u548c\u66f4\u5e95\u5c42\u7684 MutationCache, QueryCache"}),"\n",(0,s.jsx)(n.li,{children:"useQueryCache -> useQueryClient"}),"\n",(0,s.jsx)(n.li,{children:"QueryClientProvider \u53d6\u4ee3 ReactQueryConfigProvider \u548c ReactQueryCacheProvider"}),"\n",(0,s.jsx)(n.li,{children:"\u65b0\u589e useQueries"}),"\n",(0,s.jsxs)(n.li,{children:["\u5305\u542b devtools - ",(0,s.jsx)(n.code,{children:"react-query/devtools"})]}),"\n",(0,s.jsxs)(n.li,{children:["useQuery \u53c2\u6570\u4e0d\u518d\u662f key\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u63a8\u8350\u901a\u8fc7 lambada \u4f20\u9012\u53c2\u6570"}),"\n",(0,s.jsxs)(n.li,{children:["\u5982\u679c\u8fd8\u662f\u8981 key ",(0,s.jsx)(n.code,{children:"useQuery(['post', id], context => fetchPost(context.queryKey[1]))"})]}),"\n",(0,s.jsx)(n.li,{children:"enabled \u9009\u9879\u5fc5\u987b\u4e3a boolean - \u5426\u5219\u4f1a\u8b66\u544a"}),"\n",(0,s.jsxs)(n.li,{children:["\u652f\u6301 select \u90e8\u5206\u6570\u636e - \u51cf\u5c11\u91cd\u65b0\u6e32\u67d3\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"useQuery('user',fetchUser,{select:user=>user.username})"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5e9f\u5f03 usePaginatedQuery, \u6dfb\u52a0 ",(0,s.jsx)(n.code,{children:"keepPreviousData: true"})," \u5b9e\u73b0\u7c7b\u4f3c\u529f\u80fd"]}),"\n",(0,s.jsx)(n.li,{children:"useInfiniteQuery \u652f\u6301\u524d\u540e\u53cc\u5411\u67e5\u8be2"}),"\n",(0,s.jsxs)(n.li,{children:["useMutation\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u8fd4\u56de\u5bf9\u8c61\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4e4b\u524d ",(0,s.jsx)(n.code,{children:"const [mutate, { status, reset }] = useMutation()"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u73b0\u5728 ",(0,s.jsx)(n.code,{children:"const { mutate, mutateAsync, status, reset } = useMutation()"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"mutate \u4e0d\u8fd4\u56de promise, mutateAsync \u8fd4\u56de promise"}),"\n",(0,s.jsxs)(n.li,{children:["mutate \u652f\u6301\u56de\u8c03 ",(0,s.jsx)(n.code,{children:"mutate('todo',{onSuccess(){},onError(){},onSettled(){}})"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u652f\u6301 retry - \u65ad\u7ebf\u91cd\u8054\u4f1a\u91cd\u8bd5\uff0c\u9ed8\u8ba4\u5931\u8d25\u4e0d\u4f1a\u91cd\u8bd5"}),"\n",(0,s.jsx)(n.li,{children:"\u652f\u6301\u6301\u4e45\u5316\u7136\u540e\u6062\u590d"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"QueryObserver, InfiniteQueryObserver, QueriesObserver - \u53ef\u7528\u4e8e\u76d1\u542c\u6570\u636e\u53d8\u5316"}),"\n",(0,s.jsx)(n.li,{children:"useIsFetching - \u652f\u6301 key \u53c2\u6570"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://react-query.tanstack.com/guides/migrating-to-react-query-3",children:"v3"})," - 2020-12-15"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"react-query-v2x",children:"React Query v2.x"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { useQuery, QueryCache, ReactQueryCacheProvider } from 'react-query';\nimport { ReactQueryDevtools } from 'react-query-devtools';\n\nconst queryCache = new QueryCache();\n\nexport default function App() {\n  return (\n    <>\n      {/* \u7f13\u5b58 */}\n      <ReactQueryCacheProvider queryCache={queryCache}>\n        <Example />\n      </ReactQueryCacheProvider>\n      {/* \u5f00\u53d1\u5de5\u5177 */}\n      <ReactQueryDevtools initialIsOpen />\n    </>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const key = '';\nconst {\n  data, // \u83b7\u53d6\u5230\u7684\u6570\u636e\u6216\u8005\u662f\u4e0a\u6b21\u7f13\u5b58\u7684\u6570\u636e\n  error, // \u9519\u8bef\n  failureCount,\n  status, // \u72b6\u6001 - idle, loading, error, success\n  isError = status == 'error',\n  isIdle = status == 'idle',\n  isLoading = status == 'loading',\n  isSuccess = status == 'success',\n  isFetched, // \u5df2\u7ecf\u83b7\u53d6\n  isFetchedAfterMount, // \u662f\u5426\u5728 mount \u540e\u83b7\u53d6\u8fc7\n  isFetching, // \u662f\u5426\u6b63\u5728\u83b7\u53d6\n  isStale, // \u6570\u636e\u5df2\u5931\u6548\n  isPreviousData, // \u4f7f\u7528\u7684\u4e0a\u6b21\u6570\u636e\n  isPlaceholderData, // \u4f7f\u7528\u7684\u5360\u4f4d\u6570\u636e\n  refetch, // \u4ece\u65b0\u83b7\u53d6 - \u9664\u975e throwOnError \u5426\u5219\u5f02\u5e38\u53ea\u4f1a log\n  remove, // \u4ece\u7f13\u5b58\u79fb\u9664\u67e5\u8be2\n} = useQuery(\n  key,\n  /* fetcher */ (...key) => fetch(key.join()).then((v) => v.json()),\n  /* config */ {\n    enabled: true, // \u662f\u5426\u67e5\u8be2\n\n    // \u5931\u6548\u63a7\u5236\n    cacheTime: 1000 * 6 * 5, // 5m\n    staleTime: 0, // \u5931\u6548\u65f6\u95f4 - \u9ed8\u8ba4\u8fd4\u56de\u5373\u5931\u6548 - \u8bbe\u7f6e\u5931\u6548\u65f6\u95f4\u53ef\u51cf\u5c11\u8bf7\u6c42 - \u8bbe\u7f6e\u4e3a Infinity \u4e0d\u5931\u6548\n    // \u91cd\u8bd5\u63a7\u5236\n    retry: 3, // \u91cd\u8bd5\u5224\u65ad - Boolean | Int | Function(failureCount, error) => shouldRetry | Boolean\n    retryDelay: (attempt) => Math.min(attempt > 1 ? 2 ** attempt * 1000 : 1000, 30 * 1000), // \u91cd\u8bd5\u5ef6\u8fdf - Function(retryAttempt: Int) => Int\n    // \u5237\u65b0\u63a7\u5236\n    refetchInterval: false, // \u5237\u65b0\u95f4\u9694 - Boolean | Integer\n    refetchIntervalInBackground: false, // \u540e\u53f0\u5237\u65b0 - Boolean\n    refetchOnMount: true, // \u5728 mount \u65f6\u5237\u65b0 - boolean | 'always'\n    refetchOnReconnect: true, // \u7f51\u7edc\u6062\u590d\u65f6\u5237\u65b0\n    refetchOnWindowFocus: true, // \u7a97\u53e3\u83b7\u53d6\u7126\u70b9\u65f6\u5237\u65b0\n\n    // \u521d\u59cb\n    initialData: undefined, // \u521d\u59cb\u6570\u636e - any | ()=>any\n    initialStale: true, //  \u521d\u59cb\u5931\u6548 - \u5982\u679c\u8bbe\u7f6e\u4e86\u5219\u521d\u59cb\u6570\u636e\u8ba4\u4e3a\u662f\u6709\u6548\u6570\u636e - \u4f1a\u88ab\u7f13\u5b58 - boolean | ()=>boolean\n    placeholderData: undefined, // \u5360\u4f4d\u6570\u636e - loading \u7684\u65f6\u5019\u7528 - any | ()=>any\n\n    // \u72b6\u6001\u53d8\u5316\u56de\u8c03\n    notifyOnStatusChange: true, // \u72b6\u6001\u53d8\u5316 rerender - \u8bbe\u7f6e\u4e3a false \u5219 data \u6216 error \u53d8\u5316\u65f6\u624d rerender\n    onSuccess: undefined, // \u6210\u529f\u56de\u8c03 - (data)=>data\n    onError: undefined, // \u9519\u8bef\u56de\u8c03 - (error)=>void\n    onSettled: undefined, // \u5b8c\u6210\u56de\u8c03 - (data,error)=>data\n    suspense: false, // \u542f\u7528 react suspense \u6a21\u5f0f - loading \u548c error \u65f6\u4f1a suspense\n\n    queryFnParamsFilter: undefined, // \u67e5\u8be2\u53c2\u6570\u8fc7\u6ee4 - args=>filteredArgs\n    queryKeySerializerFn: undefined,\n    isDataEqual: undefined, // \u81ea\u5b9a\u4e49\u6bd4\u8f83\u64cd\u4f5c\n    keepPreviousData: false, // \u4fdd\u7559\u4e0a\u6b21\u6570\u636e - key \u53d8\u5316\u65f6\n    structuralSharing: true, // \u7ed3\u6784\u5316\u5171\u4eab - \u8de8\u67e5\u8be2\u7f13\u5b58\u5171\u4eab\n    useErrorBoundary: false,\n  },\n);\n\n// \u5206\u9875\u67e5\u8be2\nconst {\n  data = undefined,\n  resolvedData, // \u4e0a\u6b21\u6210\u529f\u6570\u636e - \u5ffd\u7565 key\n  latestData, // \u672c\u6b21\u67e5\u8be2\u6570\u636e\n  ...queryInfo\n} = usePaginatedQuery(queryKey, queryFn, options);\n\n// \u7011\u5e03\u6d41 - queryFn \u4f1a\u591a\u63a5\u53d7\u4e00\u4e2a fetchMoreVariable\nconst {\n  isFetchingMore, // false | 'next' | 'previous'\n  fetchMore, // Function(fetchMoreVariableOverride) => Promise<TResult | undefined>\n  canFetchMore,\n  ...queryInfo\n} = useInfiniteQuery(queryKey, queryFn, {\n  ...queryOptions,\n  getFetchMore: (lastPage, allPages) => fetchMoreVariable,\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usemutation",children:"useMutation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const [\n  mutate, // \u4fee\u6539\u64cd\u4f5c\n  { status, isIdle, isLoading, isSuccess, isError, data, error, reset },\n] = useMutation(mutationFn, {\n  onMutate,\n  onSuccess,\n  onError,\n  onSettled,\n  throwOnError,\n  useErrorBoundary,\n});\n\nconst promise = mutate(variables, {\n  onSuccess,\n  onSettled,\n  onError,\n  throwOnError,\n});\n"})}),"\n",(0,s.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(n.h2,{id:"isloading-vs-isfetching",children:"isLoading vs isFetching"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["isLoading \u662f status=loading\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9002\u7528\u4e8e\u7b2c\u4e00\u6b21 loading \u5224\u65ad"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["isFetching \u662f\u540e\u53f0\u6b63\u5728\u83b7\u53d6\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5373\u4fbf\u662f\u6b63\u5728\u83b7\u53d6\uff0cisLoading \u4e5f\u53ef\u80fd\u4e3a false - \u56e0\u4e3a\u6709\u4e0a\u6b21\u6570\u636e"}),"\n",(0,s.jsx)(n.li,{children:"\u9002\u7528\u4e8e\u6570\u636e\u52a0\u8f7d\u5224\u65ad - \u5237\u65b0\u52a0\u8f7d\u8fc7\u7a0b\u663e\u793a"}),"\n"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},3354:(e,n,r)=>{var s=r(50959),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,c=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function d(e,n,r){var s,i={},d=null,o=null;for(s in void 0!==r&&(d=""+r),void 0!==n.key&&(d=""+n.key),void 0!==n.ref&&(o=n.ref),n)l.call(n,s)&&!a.hasOwnProperty(s)&&(i[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===i[s]&&(i[s]=n[s]);return{$$typeof:t,type:e,key:d,ref:o,props:i,_owner:c.current}}n.Fragment=i,n.jsx=d,n.jsxs=d},11527:(e,n,r)=>{e.exports=r(3354)},47214:(e,n,r)=>{r.d(n,{Z:()=>c,a:()=>l});var s=r(50959);const t={},i=s.createContext(t);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);