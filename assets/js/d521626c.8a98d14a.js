/*! For license information please see d521626c.8a98d14a.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[51324],{16984:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var r=a(2488),t=a(62780);const s={title:"arthas"},i="arthas",l={id:"java/lib/arthas",title:"arthas",description:"- alibaba/arthas",source:"@site/../notes/java/lib/arthas.md",sourceDirName:"java/lib",slug:"/java/lib/arthas",permalink:"/notes/java/lib/arthas",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/java/lib/arthas.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1691332314,formattedLastUpdatedAt:"Aug 6, 2023",frontMatter:{title:"arthas"},sidebar:"docs",previous:{title:"JDWP",permalink:"/notes/java/jdwp"},next:{title:"CHANGELOG",permalink:"/notes/java/lib/changes"}},o={},c=[{value:"\u5e38\u7528",id:"\u5e38\u7528",level:2},{value:"Commands",id:"commands",level:2},{value:"redefine",id:"redefine",level:3},{value:"Arthas Tunnel",id:"arthas-tunnel",level:2},{value:"Spring Boot Starter",id:"spring-boot-starter",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,t.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"arthas",children:"arthas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/alibaba/arthas",children:"alibaba/arthas"})}),"\n",(0,r.jsxs)(n.li,{children:["IDEA \u63d2\u4ef6\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://plugins.jetbrains.com/plugin/13581-arthas-idea",children:"https://plugins.jetbrains.com/plugin/13581-arthas-idea"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"OGNL \u8bed\u6cd5"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -O https://arthas.aliyun.com/arthas-boot.jar\n\n# web console http://127.0.0.1:8563\n# --tunnel-server 'ws://127.0.0.1:7777/ws'\njava -jar arthas-boot.jar -h # \u5e2e\u52a9\njava -jar arthas-boot.jar 1  # \u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c - Docker \u91cc pid \u4e3a 1\n\n# Alpine\ncurl -O https://arthas.aliyun.com/arthas-boot.jar\ntouch /proc/1/cwd/.attach_pid1 && kill -SIGQUIT 1 && sleep 2 && ls /proc/1/root/tmp/.java_pid$1\njava -jar arthas-boot.jar 1\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sc -d com.wener.Application\nvmtool --action getInstances --className java.lang.String --limit 10\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://arthas.aliyun.com/doc/dashboard.html",children:"https://arthas.aliyun.com/doc/dashboard.html"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/alibaba/arthas/issues/71",children:"https://github.com/alibaba/arthas/issues/71"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/younggungun/Arthas-Learning/issues/1",children:"https://github.com/younggungun/Arthas-Learning/issues/1"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5e38\u7528",children:"\u5e38\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u89c2\u5bdf Spring HTTP \u8bf7\u6c42\u7684\u54cd\u5e94\u65f6\u95f4\nwatch org.springframework.web.servlet.DispatcherServlet doService '{params[0].getRequestURI()+\" \"+ #cost}' -n 5 -x 3 '#cost>1'\n\n# \u89c2\u5bdf Spring \u54cd\u5e94\u5934\u4fe1\u606f\nwatch org.springframework.web.servlet.DispatcherServlet doService '{params[0].getRequestURI()+\"  header=\"+params[1].getHeaders(\"trace-id\")}' -n 10 -x 3 -f\n\n# \u89c2\u5bdf MyBatis SQL\nwatch org.apache.ibatis.mapping.BoundSql getSql '{params,returnObj,target.parameterObject,throwExp}' -n 5 -x 3\n\n# JDBC\nwatch java.sql.Connection prepareStatement '{params,throwExp}' -n 5 -x 3 'clazz.getName().startsWith(\"com.mysql\") and params.length==1' and #cost>1\n\nwatch java.sql.Connection prepareStatement '{params,throwExp}' -n 5 -x 3\n\ntt -t org.springframework.data.redis.connection.jedis.JedisConnectionFactory getConnection\ntt -t org.springframework.data.redis.cache.DefaultRedisCacheWriter get\n\n# Controller \u65b9\u6cd5\u5185\u4e0d\u6162\uff0c\u4f46\u6574\u4f53\u6162\u65f6\uff0c\u6392\u67e5\u8bf7\u6c42\u65b9\u6cd5\u524d\u7684\u903b\u8f91\n# getMethodArgumentValues \u6162\u8bf4\u660e\u6ce8\u89e3\u6821\u9a8c\u95ee\u9898\n# doInvoke \u6162\u8bf4\u660e\u662f\u65b9\u6cd5\u6162\ntrace org.springframework.web.method.support.InvocableHandlerMethod invokeForRequest\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/WangJi92/arthas-idea-plugin/issues/80",children:"https://github.com/WangJi92/arthas-idea-plugin/issues/80"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"commands",children:"Commands"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["tt - TimeTunnel - \u8bb0\u5f55\u73b0\u573a\uff0c\u901a\u8fc7 index \u56de\u67e5\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-l"})," list"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-s"})," search, Advice \u5bf9\u8c61"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-i INDEX"})," \u56de\u67e5"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"trace - \u8ddf\u8e2a\u5411\u4e0b\u8c03\u7528\u65b9\u6cd5\u65f6\u95f4\u6d88\u8017"}),"\n",(0,r.jsx)(n.li,{children:"stack - \u83b7\u53d6\u8c03\u7528\u94fe - \u5c1d\u8bd5\u5f80\u4e0a\u6392\u67e5\u6162\u7684\u8282\u70b9"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trace demo.MathGame run\n"})}),"\n",(0,r.jsx)(n.h3,{id:"redefine",children:"redefine"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u751f\u6210\u6e90\u7801\njad --source-only com.example.demo.arthas.user.UserController > /tmp/UserController.java\n# \u7f16\u8bd1\nmc /tmp/UserController.java -d /tmp\n# \u52a0\u8f7d\nredefine /tmp/com/example/demo/arthas/user/UserController.class\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4e0d\u652f\u6301\u65b0\u65b9\u6cd5\u65b0\u5b57\u6bb5"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"arthas-tunnel",children:"Arthas Tunnel"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"java -jar arthas-tunnel-server.jar\n"})}),"\n",(0,r.jsx)(n.h2,{id:"spring-boot-starter",children:"Spring Boot Starter"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"http://localhost:8080/actuator/arthas",children:"http://localhost:8080/actuator/arthas"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>com.taobao.arthas</groupId>\n    <artifactId>arthas-spring-boot-starter</artifactId>\n    <version>${arthas.version}</version>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"arthas.agent-id=XXX\narthas.tunnel-server=ws://127.0.0.1:7777/ws\n"})}),"\n",(0,r.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/notes/java/faq#unable-to-get-pid-of-linuxthreads-manager-thread",children:"Unable to get pid of LinuxThreads manager thread"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},38088:(e,n,a)=>{var r=a(96651),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,a){var r,s={},c=null,h=null;for(r in void 0!==a&&(c=""+a),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(h=n.ref),n)i.call(n,r)&&!o.hasOwnProperty(r)&&(s[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===s[r]&&(s[r]=n[r]);return{$$typeof:t,type:e,key:c,ref:h,props:s,_owner:l.current}}n.Fragment=s,n.jsx=c,n.jsxs=c},2488:(e,n,a)=>{e.exports=a(38088)},62780:(e,n,a)=>{a.d(n,{I:()=>l,M:()=>i});var r=a(96651);const t={},s=r.createContext(t);function i(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);