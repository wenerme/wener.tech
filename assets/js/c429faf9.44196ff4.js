/*! For license information please see c429faf9.44196ff4.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[7068],{9292:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>a});var t=r(2488),n=r(62780);const i={title:"Longhorn \u5e38\u89c1\u95ee\u9898"},s="Longhorn \u5e38\u89c1\u95ee\u9898",l={id:"devops/kubernetes/storage/longhorn-faq",title:"Longhorn \u5e38\u89c1\u95ee\u9898",description:"Longhorn on K3S",source:"@site/../notes/devops/kubernetes/storage/longhorn-faq.md",sourceDirName:"devops/kubernetes/storage",slug:"/devops/kubernetes/storage/longhorn-faq",permalink:"/notes/devops/kubernetes/storage/longhorn-faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/storage/longhorn-faq.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1617462276,formattedLastUpdatedAt:"Apr 3, 2021",frontMatter:{title:"Longhorn \u5e38\u89c1\u95ee\u9898"},sidebar:"docs",previous:{title:"Local PV",permalink:"/notes/devops/kubernetes/storage/local-pv"},next:{title:"Longhorn \u7248\u672c",permalink:"/notes/devops/kubernetes/storage/longhorn-version"}},d={},a=[{value:"Longhorn on K3S",id:"longhorn-on-k3s",level:2},{value:"Error deploying driver: failed to get kubelet root dir, no related proc for root-dir detection, error out",id:"error-deploying-driver-failed-to-get-kubelet-root-dir-no-related-proc-for-root-dir-detection-error-out",level:2},{value:"MountVolume.SetUp failed for volume &quot;registration-dir&quot; : hostPath type check failed: /var/lib/rancher/k3s/agent/kubelet/plugins_registry is not a directory",id:"mountvolumesetup-failed-for-volume-registration-dir--hostpath-type-check-failed-varlibrancherk3sagentkubeletplugins_registry-is-not-a-directory",level:2},{value:"Unable to attach or mount volumes: unmounted volumes=[registration-dir], unattached volumes=[registration-dir lib-modules socket-dir host-dev host-sys longhorn-service-account-token-7ppv2 pods-mount-dir host kubernetes-csi-dir]: timed out waiting for the condition",id:"unable-to-attach-or-mount-volumes-unmounted-volumesregistration-dir-unattached-volumesregistration-dir-lib-modules-socket-dir-host-dev-host-sys-longhorn-service-account-token-7ppv2-pods-mount-dir-host-kubernetes-csi-dir-timed-out-waiting-for-the-condition",level:2},{value:"cannot find disk config file, maybe due to a mount error",id:"cannot-find-disk-config-file-maybe-due-to-a-mount-error",level:2},{value:"\u8282\u70b9 Allocated \u4e3a\u8d1f",id:"\u8282\u70b9-allocated-\u4e3a\u8d1f",level:2},{value:"\u5378\u8f7d",id:"\u5378\u8f7d",level:2},{value:"driver name driver.longhorn.io not found in the list of registered CSI drivers",id:"driver-name-driverlonghornio-not-found-in-the-list-of-registered-csi-drivers",level:2},{value:"Still connecting to unix:///csi/csi.sock",id:"still-connecting-to-unixcsicsisock",level:2}];function c(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"longhorn-\u5e38\u89c1\u95ee\u9898",children:"Longhorn \u5e38\u89c1\u95ee\u9898"}),"\n",(0,t.jsx)(o.h2,{id:"longhorn-on-k3s",children:"Longhorn on K3S"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.a,{href:"https://longhorn.io/docs/1.1.0/advanced-resources/os-distro-specific/csi-on-k3s/",children:"https://longhorn.io/docs/1.1.0/advanced-resources/os-distro-specific/csi-on-k3s/"})}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"error-deploying-driver-failed-to-get-kubelet-root-dir-no-related-proc-for-root-dir-detection-error-out",children:"Error deploying driver: failed to get kubelet root dir, no related proc for root-dir detection, error out"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-yaml",children:"csi:\n  # 1.0.2\n  # https://github.com/longhorn/longhorn/issues/1861#issuecomment-705297295\n  kubeletRootDir: /var/lib/rancher/k3s/agent/kubelet\n"})}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.a,{href:"https://github.com/longhorn/longhorn/issues/1861",children:"#1861"})}),"\n"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:'time="2021-02-23T16:39:59Z" level=error msg="failed to get arg root-dir. Need to specify \\"--kubelet-root-dir\\" in your Longhorn deployment yaml.: failed to get kubelet root dir, no related proc for root-dir detection, error out"\ntime="2021-02-23T16:39:59Z" level=fatal msg="Error deploying driver: failed to get arg root-dir. Need to specify \\"--kubelet-root-dir\\" in your Longhorn deployment yaml.: failed to get kubelet root dir, no related proc for root-dir detection, error out"\n'})}),"\n",(0,t.jsx)(o.h2,{id:"mountvolumesetup-failed-for-volume-registration-dir--hostpath-type-check-failed-varlibrancherk3sagentkubeletplugins_registry-is-not-a-directory",children:'MountVolume.SetUp failed for volume "registration-dir" : hostPath type check failed: /var/lib/rancher/k3s/agent/kubelet/plugins_registry is not a directory'}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"# \u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u6267\u884c\nsudo mkdir /var/lib/rancher/k3s/agent/kubelet/plugins_registry\n"})}),"\n",(0,t.jsx)(o.h2,{id:"unable-to-attach-or-mount-volumes-unmounted-volumesregistration-dir-unattached-volumesregistration-dir-lib-modules-socket-dir-host-dev-host-sys-longhorn-service-account-token-7ppv2-pods-mount-dir-host-kubernetes-csi-dir-timed-out-waiting-for-the-condition",children:"Unable to attach or mount volumes: unmounted volumes=[registration-dir], unattached volumes=[registration-dir lib-modules socket-dir host-dev host-sys longhorn-service-account-token-7ppv2 pods-mount-dir host kubernetes-csi-dir]: timed out waiting for the condition"}),"\n",(0,t.jsx)(o.h2,{id:"cannot-find-disk-config-file-maybe-due-to-a-mount-error",children:"cannot find disk config file, maybe due to a mount error"}),"\n",(0,t.jsx)(o.p,{children:"\u8282\u70b9\u4e0a\u78c1\u76d8\u4e0d\u5b58\u5728\uff0c\u5220\u9664\u91cd\u5efa"}),"\n",(0,t.jsx)(o.h2,{id:"\u8282\u70b9-allocated-\u4e3a\u8d1f",children:"\u8282\u70b9 Allocated \u4e3a\u8d1f"}),"\n",(0,t.jsx)(o.p,{children:"\u5220\u9664 disk \u4ece\u65b0\u521b\u5efa\uff0c\u5982\u679c\u9009\u62e9\u7684\u76ee\u5f55\u4e0d\u5b58\u5728\u53ef\u80fd\u4e5f\u4f1a\u6709\u95ee\u9898"}),"\n",(0,t.jsx)(o.h2,{id:"\u5378\u8f7d",children:"\u5378\u8f7d"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"kubectl delete -f https://raw.githubusercontent.com/longhorn/longhorn/v1.1.0/deploy/longhorn.yaml\nkubectl delete -f https://raw.githubusercontent.com/longhorn/longhorn/v1.1.0/uninstall/uninstall.yaml\n\n# \u5982\u679c CRD \u8fd8\u5728\u53ef\u4ee5\u5f3a\u5236\u5220\u9664\nfor crd in $(kubectl get crd -o jsonpath={.items[*].metadata.name} | tr ' ' '\\n' | grep longhorn.rancher.io); do\n  kubectl -n ${NAMESPACE} get $crd -o yaml | sed \"s/\\- longhorn.rancher.io//g\" | kubectl apply -f -\n  kubectl -n ${NAMESPACE} delete $crd --all\n  kubectl delete crd/$crd\ndone\n"})}),"\n",(0,t.jsx)(o.h2,{id:"driver-name-driverlonghornio-not-found-in-the-list-of-registered-csi-drivers",children:"driver name driver.longhorn.io not found in the list of registered CSI drivers"}),"\n",(0,t.jsx)(o.h2,{id:"still-connecting-to-unixcsicsisock",children:"Still connecting to unix:///csi/csi.sock"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"longhorn-csi-plugin \u542f\u52a8\u5931\u8d25"}),"\n"]})]})}function u(e={}){const{wrapper:o}={...(0,n.M)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},38088:(e,o,r)=>{var t=r(96651),n=Symbol.for("react.element"),i=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function a(e,o,r){var t,i={},a=null,c=null;for(t in void 0!==r&&(a=""+r),void 0!==o.key&&(a=""+o.key),void 0!==o.ref&&(c=o.ref),o)s.call(o,t)&&!d.hasOwnProperty(t)&&(i[t]=o[t]);if(e&&e.defaultProps)for(t in o=e.defaultProps)void 0===i[t]&&(i[t]=o[t]);return{$$typeof:n,type:e,key:a,ref:c,props:i,_owner:l.current}}o.Fragment=i,o.jsx=a,o.jsxs=a},2488:(e,o,r)=>{e.exports=r(38088)},62780:(e,o,r)=>{r.d(o,{I:()=>l,M:()=>s});var t=r(96651);const n={},i=t.createContext(n);function s(e){const o=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);