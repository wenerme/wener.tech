/*! For license information please see 095edb70.70dc2454.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[46864],{34904:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});var s=l(2488),i=l(62780);const r={title:"atlas"},a="atlas",t={id:"languages/go/lib/atlas",title:"atlas",description:"- ariga/atlas",source:"@site/../notes/languages/go/lib/atlas.md",sourceDirName:"languages/go/lib",slug:"/languages/go/lib/atlas",permalink:"/notes/languages/go/lib/atlas",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/languages/go/lib/atlas.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1655970411,formattedLastUpdatedAt:"Jun 23, 2022",frontMatter:{title:"atlas"},sidebar:"docs",previous:{title:"Go2",permalink:"/notes/languages/go/go2"},next:{title:"bluge",permalink:"/notes/languages/go/lib/bluge"}},c={},d=[{value:"DSL",id:"dsl",level:2}];function o(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,i.M)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"atlas",children:"atlas"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/ariga/atlas",children:"ariga/atlas"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Apache-2.0, Go"}),"\n",(0,s.jsx)(e.li,{children:"Schema \u8fc1\u79fb\u5de5\u5177"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301 PostgresSQL, MySQL, MariaDB, SQLite"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301\u4f5c\u4e3a terraform \u7684 provider"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'brew install ariga/tap/atlas\n\natlas schema apply -u "sqlite://test.db" -f schema.hcl # \u5e94\u7528\u8fc1\u79fb\natlas schema inspect -u "sqlite://test.db"             # \u751f\u6210 schema\natlas serve --storage "sqlite://test.db"               # WebUI\n\n# dev \u73af\u5883\u7528\u4e8e\u9884\u5148\u9a8c\u8bc1\natlas schema apply --url "sqlite://prod.db" --dev-url "sqlite://prod.db" -f schema.hcl\n\natlas migrate new          # \u751f\u6210 migrations/\u65f6\u95f4\u6233.sql\natlas migrate validate     # \u5bf9\u6bd4 migrations/atlas.sum\natlas migrate hash --force # \u5f3a\u5236\u91cd\u65b0\u751f\u6210 migrations/atlas.sum\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-hcl",metastring:'title="schema.hcl"',children:'schema "main" {\n\n}\n\ntable "users" {\n  schema = schema.main\n  column "id" {\n    null = false\n    type = int\n  }\n  column "name" {\n    null = true\n    type = varchar(100)\n  }\n  primary_key {\n    columns = [column.id]\n  }\n}\n\ntable "posts" {\n  schema = schema.main\n  column "id" {\n    null = false\n    type = int\n  }\n  column "title" {\n    null = true\n    type = varchar(100)\n  }\n  column "body" {\n    null = true\n    type = text\n  }\n  column "author_id" {\n    null = true\n    type = int\n  }\n  primary_key {\n    columns = [column.id]\n  }\n  foreign_key "fk_posts_author_id" {\n    columns     = [column.author_id]\n    ref_columns = [table.users.column.id]\n    on_update   = NO_ACTION\n    on_delete   = NO_ACTION\n  }\n  index "idx_posts_author_id" {\n    unique  = false\n    columns = [column.author_id]\n  }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"dsl",children:"DSL"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9ed8\u8ba4 DSL \u540d\u5b57 atlas.hcl"}),"\n",(0,s.jsxs)(e.li,{children:["schema\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"charset"}),"\n",(0,s.jsx)(e.li,{children:"collate"}),"\n",(0,s.jsx)(e.li,{children:"comment"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["table\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"schema - \u5f15\u7528\u5b9a\u4e49\u7684 schema"}),"\n",(0,s.jsxs)(e.li,{children:["column\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"type"}),"\n",(0,s.jsx)(e.li,{children:"null"}),"\n",(0,s.jsx)(e.li,{children:"default"}),"\n",(0,s.jsx)(e.li,{children:"as - \u751f\u6210\u5217"}),"\n",(0,s.jsx)(e.li,{children:"comment"}),"\n",(0,s.jsx)(e.li,{children:"collate"}),"\n",(0,s.jsx)(e.li,{children:"auto_increment - MySQL, SQLite"}),"\n",(0,s.jsxs)(e.li,{children:["identity\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"generated - ALWAYS"}),"\n",(0,s.jsx)(e.li,{children:"start"}),"\n",(0,s.jsx)(e.li,{children:"increment"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["primary_key\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"columns"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["foreign_key\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"columns"}),"\n",(0,s.jsx)(e.li,{children:"ref_columns"}),"\n",(0,s.jsx)(e.li,{children:"on_delete - CASCADE, NO_ACTION"}),"\n",(0,s.jsx)(e.li,{children:"on_update"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["index\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["on\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"column"}),"\n",(0,s.jsx)(e.li,{children:"desc"}),"\n",(0,s.jsx)(e.li,{children:"prefix - \u7d22\u5f15\u591a\u957f - MySQL, MariaDB"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"unique"}),"\n",(0,s.jsx)(e.li,{children:"type - HASH, GIN, BRIN, FULLTEXT"}),"\n",(0,s.jsxs)(e.li,{children:["options\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"page_per_range"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"where - \u90e8\u5206\u7d22\u5f15 - PostgreSQL, SQLite"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["check\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"expr"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["partition - PostgreSQL\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"type=RANGE"}),"\n",(0,s.jsxs)(e.li,{children:["by\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"column"}),"\n",(0,s.jsx)(e.li,{children:"expr"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"variable"}),"\n",(0,s.jsxs)(e.li,{children:["env - ",(0,s.jsx)(e.code,{children:"--env local"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"src"}),"\n",(0,s.jsx)(e.li,{children:"url"}),"\n",(0,s.jsx)(e.li,{children:"dev"}),"\n",(0,s.jsx)(e.li,{children:"schemas"}),"\n",(0,s.jsxs)(e.li,{children:["migration_dir\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["url - ",(0,s.jsx)(e.code,{children:"file://migrations"})]}),"\n",(0,s.jsx)(e.li,{children:"format - atlas, flyway, liquibase, goose, golang-migrate"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5176\u4ed6\u5c5e\u6027\u4f1a\u4f5c\u4e3a schema.hcl \u7684\u53d8\u91cf - ",(0,s.jsx)(e.code,{children:"--var tenant=wener"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-hcl",children:'schema "a" {}\nschema "b" {}\n\n// \u591a schema \u540c\u540d\u8868\ntable "a" "users" {\n  schema = schema.a\n}\ntable "b" "users" {\n  schema = schema.b\n}\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-hcl",children:'env "local" {\n  src = "schema.hcl"\n\n  url = "sqlite://prod.db"\n  dev = "sqlite://dev.db"\n\n  schemas = ["main"]\n}\n'})})]})}function h(n={}){const{wrapper:e}={...(0,i.M)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}},38088:(n,e,l)=>{var s=l(96651),i=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,t=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(n,e,l){var s,r={},d=null,o=null;for(s in void 0!==l&&(d=""+l),void 0!==e.key&&(d=""+e.key),void 0!==e.ref&&(o=e.ref),e)a.call(e,s)&&!c.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===r[s]&&(r[s]=e[s]);return{$$typeof:i,type:n,key:d,ref:o,props:r,_owner:t.current}}e.Fragment=r,e.jsx=d,e.jsxs=d},2488:(n,e,l)=>{n.exports=l(38088)},62780:(n,e,l)=>{l.d(e,{I:()=>t,M:()=>a});var s=l(96651);const i={},r=s.createContext(i);function a(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);