/*! For license information please see fbcde1d5.51de6e2b.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[55462],{8437:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var s=i(11527),r=i(47214);const l={title:"QEMU FAQ",tags:["FAQ"]},t="QEMU FAQ",c={id:"os/virt/qemu/qemu-faq",title:"QEMU FAQ",description:"- 7 ways we harden our KVM hypervisor at Google Cloud: security in plaintext",source:"@site/../notes/os/virt/qemu/qemu-faq.md",sourceDirName:"os/virt/qemu",slug:"/os/virt/qemu/faq",permalink:"/notes/os/virt/qemu/faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/virt/qemu/qemu-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1704307832,formattedLastUpdatedAt:"Jan 3, 2024",frontMatter:{title:"QEMU FAQ",tags:["FAQ"]},sidebar:"docs",previous:{title:"QEMU \u6587\u6863",permalink:"/notes/os/virt/qemu/doc"},next:{title:"Qemu Image",permalink:"/notes/os/virt/qemu/img"}},d={},a=[{value:"\u6301\u5d4c\u5957\u865a\u62df\u5316",id:"\u6301\u5d4c\u5957\u865a\u62df\u5316",level:2},{value:"RNG",id:"rng",level:2},{value:"\u73af\u5883\u68c0\u6d4b",id:"\u73af\u5883\u68c0\u6d4b",level:2},{value:"\u8bbf\u95ee\u8fdc\u7a0b\u955c\u50cf",id:"\u8bbf\u95ee\u8fdc\u7a0b\u955c\u50cf",level:2},{value:"qemu: uncaught target signal 4 (Illegal instruction) - core dumped",id:"qemu-uncaught-target-signal-4-illegal-instruction---core-dumped",level:2},{value:"qemu-s390x: warning: &#39;msa5-base&#39; requires &#39;klmd-sha-512&#39;",id:"qemu-s390x-warning-msa5-base-requires-klmd-sha-512",level:2},{value:"virtfs",id:"virtfs",level:2},{value:"convert \u540e\u65e0\u6cd5\u542f\u52a8",id:"convert-\u540e\u65e0\u6cd5\u542f\u52a8",level:2},{value:"Overhead",id:"overhead",level:2},{value:"\u786c\u4ef6\u52a0\u901f",id:"\u786c\u4ef6\u52a0\u901f",level:2},{value:"USB",id:"usb",level:2},{value:"-accel kvm: failed to initialize kvm: Permission denied",id:"-accel-kvm-failed-to-initialize-kvm-permission-denied",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"qemu-faq",children:"QEMU FAQ"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://cloudplatform.googleblog.com/2017/01/7-ways-we-harden-our-KVM-hypervisor-at-Google-Cloud-security-in-plaintext.html",children:"7 ways we harden our KVM hypervisor at Google Cloud: security in plaintext"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6301\u5d4c\u5957\u865a\u62df\u5316",children:"\u6301\u5d4c\u5957\u865a\u62df\u5316"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5927\u591a\u4e91\u5e73\u53f0\u90fd\u4e0d\u652f\u6301\u5d4c\u5957\u865a\u62df\u5316"}),"\n",(0,s.jsx)(n.li,{children:"\u88f8\u91d1\u5c5e\u670d\u52a1\u5668 \u652f\u6301\u865a\u62df\u5316"}),"\n",(0,s.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://cloud.google.com/compute/docs/instances/nested-virtualization/overview",children:"GCP \u5d4c\u5957\u865a\u62df\u5316\u7b80\u4ecb"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Intel Haswell+\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sandy Bridge, Ivy Bridge \u4e0d\u53ef\u4ee5"}),"\n",(0,s.jsx)(n.li,{children:"AMD \u4e0d\u53ef\u4ee5"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://ignite.readthedocs.io/en/stable/cloudprovider/",children:"Cloud Provider Instances with KVM support"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"GCP - \u6240\u6709\u652f\u6301"}),"\n",(0,s.jsx)(n.li,{children:"DO - \u6240\u6709\u652f\u6301"}),"\n",(0,s.jsx)(n.li,{children:"Azure Dv3, Ev3 - 4C16G+ - $140/mo"}),"\n",(0,s.jsx)(n.li,{children:"Packet - 4C8G+ - ~$50/mo"}),"\n",(0,s.jsxs)(n.li,{children:["AWS ",(0,s.jsx)(n.code,{children:"*.metal"})," - \u88f8\u91d1\u5c5e\u670d\u52a1\u5668 - 48CPU+"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"rng",children:"RNG"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u5efa\u8bae\u9ed8\u8ba4\u6dfb\u52a0\uff0c\u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u975e\u5e38\u6162\u610f\u5916 Hang \u4f4f"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"-device virtio-rng-pci\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u9ed8\u8ba4 ",(0,s.jsx)(n.code,{children:"/dev/random"}),"\u3002 \u53ef\u81ea\u5b9a\u4e49\u53c2\u6570"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"-object rng-random,filename=/dev/hwrng,id=rng0 -device virtio-rng-pci,rng=rng0\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"qemu-system-x86_64 -object rng-random,filename=/dev/urandom,id=rng0 -device virtio-rng-pci,rng=rng0,bus=pci.0,addr=0x7\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.qemu.org/docs/master/system/devices/vhost-user-rng.html",children:"https://www.qemu.org/docs/master/system/devices/vhost-user-rng.html"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u73af\u5883\u68c0\u6d4b",children:"\u73af\u5883\u68c0\u6d4b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# KVM \u8981\u6c42 Intel VT, AMD-V\negrep '(vmx|svm)' /proc/cpuinfo\n\nmodprobe kvm\nmodprobe kvm-intel\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u8bbf\u95ee\u8fdc\u7a0b\u955c\u50cf",children:"\u8bbf\u95ee\u8fdc\u7a0b\u955c\u50cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# apk add qemu-block-ssh\nqemu -drive file=ssh://host/path/to/file,if=virtio,cache=none\n"})}),"\n",(0,s.jsx)(n.h2,{id:"qemu-uncaught-target-signal-4-illegal-instruction---core-dumped",children:"qemu: uncaught target signal 4 (Illegal instruction) - core dumped"}),"\n",(0,s.jsx)(n.p,{children:"ppc64le \u5f02\u5e38"}),"\n",(0,s.jsx)(n.h2,{id:"qemu-s390x-warning-msa5-base-requires-klmd-sha-512",children:"qemu-s390x: warning: 'msa5-base' requires 'klmd-sha-512'"}),"\n",(0,s.jsx)(n.p,{children:"s390x \u5f02\u5e38"}),"\n",(0,s.jsx)(n.h2,{id:"virtfs",children:"virtfs"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://wiki.qemu.org/Documentation/9psetup",children:"https://wiki.qemu.org/Documentation/9psetup"})}),"\n",(0,s.jsxs)(n.p,{children:["ProjectZero\nQEMU: virtfs permits guest to access entire host filesystem\n",(0,s.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=13753950",children:"https://news.ycombinator.com/item?id=13753950"})]}),"\n",(0,s.jsx)(n.h2,{id:"convert-\u540e\u65e0\u6cd5\u542f\u52a8",children:"convert \u540e\u65e0\u6cd5\u542f\u52a8"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5728 macOS \u4e0b\u4ece qcow2 \u8f6c\u6362\u4e3a raw \u540e\u5206\u533a\u4fe1\u606f\u4e22\u5931"}),"\n",(0,s.jsx)(n.li,{children:"Linux \u672a\u9047\u5230\u8fd9\u6837\u7684\u95ee\u9898"}),"\n",(0,s.jsx)(n.li,{children:"\u8f6c\u6362\u540e\u53ef\u4f7f\u7528 fdisk \u68c0\u67e5\u5206\u533a\u4fe1\u606f"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"overhead",children:"Overhead"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"http://www.brightcomputing.com/blog/containerization-vs.-virtualization-more-on-overhead",children:"Containerization vs. Virtualization \u2013 More on Overhead"})}),"\n",(0,s.jsx)(n.h2,{id:"\u786c\u4ef6\u52a0\u901f",children:"\u786c\u4ef6\u52a0\u901f"}),"\n",(0,s.jsx)(n.p,{children:"\u5f00\u542f\u786c\u4ef6\u52a0\u901f\u548c\u4e0d\u5f00\u542f\u6027\u80fd\u53ef\u80fd\u76f8\u5dee 10 \u500d+\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"qemu-system-x86_64 -accel help\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"tcg - JIT \u6a21\u5f0f"}),"\n",(0,s.jsxs)(n.li,{children:["macOS - hvf, hax\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"hvf \u5b9e\u73b0\u4e0d\u662f\u5f88\u5b8c\u6574\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u65e0\u6cd5\u8fd0\u884c\u7684\u60c5\u51b5"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u52a0\u901f\u6709\u95ee\u9898\uff0c\u5c1d\u8bd5\u4fee\u6539 smp \u4e3a 1"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Windows - hyper, hax"}),"\n",(0,s.jsx)(n.li,{children:"Linux - kvm"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usb",children:"USB"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/qemu/qemu/blob/master/docs/usb2.txt",children:"https://github.com/qemu/qemu/blob/master/docs/usb2.txt"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://unix.stackexchange.com/a/251406/47774",children:"https://unix.stackexchange.com/a/251406/47774"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"qemu-system-x86_64 \\\n  -enable-kvm \\\n  -M q35 \\\n  -m 2G \\\n  -usb -usbdevice host:16b2:1001 \\\n  -usb -usbdevice host:0529:0001 \\\n  -usbdevice tablet \\\n  -net nic \\\n  -net bridge,br=br0 \\\n  -vga qxl \\\n  -spice port=5930,disable-ticketing \\\n  -device virtio-serial-pci \\\n  -device virtserialport,chardev=spicechannel0,name=com.redhat.spice.0 \\\n  -chardev spicevmc,id=spicechannel0,name=vdagent \\\n  -drive file=/mnt/data/win-patch.img,if=virtio\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-accel-kvm-failed-to-initialize-kvm-permission-denied",children:"-accel kvm: failed to initialize kvm: Permission denied"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"addgroup $USER kvm\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},3354:(e,n,i)=>{var s=i(50959),r=Symbol.for("react.element"),l=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,c=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function a(e,n,i){var s,l={},a=null,o=null;for(s in void 0!==i&&(a=""+i),void 0!==n.key&&(a=""+n.key),void 0!==n.ref&&(o=n.ref),n)t.call(n,s)&&!d.hasOwnProperty(s)&&(l[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===l[s]&&(l[s]=n[s]);return{$$typeof:r,type:e,key:a,ref:o,props:l,_owner:c.current}}n.Fragment=l,n.jsx=a,n.jsxs=a},11527:(e,n,i)=>{e.exports=i(3354)},47214:(e,n,i)=>{i.d(n,{Z:()=>c,a:()=>t});var s=i(50959);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);