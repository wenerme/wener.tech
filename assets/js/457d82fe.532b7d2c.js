/*! For license information please see 457d82fe.532b7d2c.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[87836],{66864:(n,s,e)=>{e.r(s),e.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>j,frontMatter:()=>l,metadata:()=>t,toc:()=>h});var d=e(2488),i=e(62780);const l={title:"dRAID"},r="dRAID - Distributed RAID",t={id:"os/linux/fs/zfs/zfs-draid",title:"dRAID",description:"- OpenZFS 2.1+",source:"@site/../notes/os/linux/fs/zfs/zfs-draid.md",sourceDirName:"os/linux/fs/zfs",slug:"/os/linux/fs/zfs/draid",permalink:"/notes/os/linux/fs/zfs/draid",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/fs/zfs/zfs-draid.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1678946104,formattedLastUpdatedAt:"Mar 16, 2023",frontMatter:{title:"dRAID"},sidebar:"docs",previous:{title:"ZFS \u547d\u4ee4\u884c",permalink:"/notes/os/linux/fs/zfs/cli"},next:{title:"ZFS \u5e38\u89c1\u95ee\u9898",permalink:"/notes/os/linux/fs/zfs/faq"}},c={},h=[{value:"Expansion",id:"expansion",level:2}];function x(n){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.M)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.h1,{id:"draid---distributed-raid",children:"dRAID - Distributed RAID"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"OpenZFS 2.1+"}),"\n",(0,d.jsxs)(s.li,{children:["dRAID \u533a\u522b\u4e8e\u4e4b\u524d\u7684 RAIDz \u65b9\u5f0f\u5904\u7406\u5907\u76d8\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u4e4b\u524d\u662f\u7269\u7406\u5907\u76d8\uff0c\u73b0\u5728\u662f\u903b\u8f91\u5907\u76d8"}),"\n",(0,d.jsxs)(s.li,{children:["\u6ca1\u6709\u5907\u76d8\u6982\u5ff5\uff0c\u6709\u5bb9\u707e\u80fd\u529b\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u5907\u76d8 - \u51b7\u5907\u4efd"}),"\n",(0,d.jsx)(s.li,{children:"\u5bb9\u707e - \u4ece\u5f02\u5e38\u6062\u590d"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.li,{children:"\u4f4d\u7f6e\u52a8\u6001\u5206\u914d - \u4f20\u7edf RAID \u76d8\u4f4d\u89d2\u8272\u56fa\u5b9a"}),"\n",(0,d.jsx)(s.li,{children:"\u9002\u7528\u4e8e\u5927\u89c4\u6a21\u5b58\u50a8\uff0c\u5c0f\u89c4\u6a21\u5efa\u8bae\u4f7f\u7528\u4f20\u7edf RAIDz"}),"\n",(0,d.jsx)(s.li,{children:"group into rows - 16MB"}),"\n",(0,d.jsx)(s.li,{children:"\u5b9e\u73b0\u57fa\u4e8e RAIDz\uff0c\u4f46 allocate \u65b9\u5f0f\u6709\u533a\u522b"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.li,{children:"dRAID \u76f8\u5f53\u4e8e\u662f\u5728\u4e00\u7ec4\u6570\u636e\u91cc\u589e\u52a0\u4e86\u4e00\u4e2a strip \u4f5c\u4e3a\u5907\u7528\u6253\u6563\u5230\u6240\u6709\u76d8"}),"\n",(0,d.jsxs)(s.li,{children:["\u683c\u5f0f ",(0,d.jsx)(s.code,{children:"draid[<parity>][:<data>d][:<children>c][:<spares>s]"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["parity - 1-3, \u9ed8\u8ba4 1\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u6821\u9a8c\u6570\u636e/\u4e3b\u6570\u636e"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["data - \u6bcf\u4e2a\u5197\u4f59\u7ec4\u7684\u786c\u76d8\u6570\u91cf \u9ed8\u8ba4 8\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u6570\u91cf\u5c0f - IOPS \u9ad8\uff0c\u538b\u7f29\u6bd4\u9ad8\uff0c\u6062\u590d\u901f\u5ea6\u5feb"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["children - \u4ea4\u53c9\u9a8c\u8bc1\u78c1\u76d8\u6570\u91cf\uff0c\u907f\u514d\u78c1\u76d8\u591a\u7684\u65f6\u5019\u914d\u7f6e\u9519\u8bef\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u603b\u7684\u78c1\u76d8\u6570\u91cf"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["spares - \u5206\u5e03\u5f0f\u70ed\u5907\u6570\u91cf - \u9ed8\u8ba4 0\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u5f02\u5e38\u5feb\u901f\u6062\u590d - S -> D,P"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.li,{children:"\u914d\u7f6e\u7684\u662f\u6bcf strip"}),"\n",(0,d.jsx)(s.li,{children:"draid1:2:0 -> RAIDz1"}),"\n",(0,d.jsx)(s.li,{children:"D+P \u4e3a\u4e00\u4e2a\u7ec4\uff0c\u5206\u5e03\u5230 C-S \u4e2a\u786c\u76d8\u4e2d"}),"\n",(0,d.jsx)(s.li,{children:"S \u4e3a\u5168\u5c40 - \u6240\u6709\u7ec4\u5171\u7528"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\u4f18\u52bf\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["\u5feb\u901f\u6062\u590d\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u4f20\u7edf\u6a21\u5f0f\u7684\u6027\u80fd\u74f6\u9888\u5728\u4e8e\u5355\u76d8 - \u901f\u5ea6\u6162"}),"\n",(0,d.jsx)(s.li,{children:"spare \u5206\u6563\u540e\u6240\u6709\u76d8\u90fd\u5728\u6062\u590d - \u6ca1\u6709\u74f6\u9888"}),"\n",(0,d.jsx)(s.li,{children:"dRAID \u6362\u76d8\u74f6\u9888\u4e5f\u5728 - \u4f46\u662f\u573a\u666f\u4e0a\u6765\u8bf4\u6ca1\u90a3\u4e48\u91cd\u8981"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.li,{children:"\u786c\u76d8\u6027\u80fd\u5229\u7528\u7387\u66f4\u9ad8"}),"\n",(0,d.jsx)(s.li,{children:"\u80fd\u52a0\u76d8"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\u52a3\u52bf\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["fixed strip width - \u53ef\u80fd\u7528\u66f4\u591a\u7a7a\u95f4\uff0c\u538b\u7f29\u6bd4\u4f1a\u4f4e\u4e00\u4e9b\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"draid2:4:1 - 4kn - 24KiB meta"}),"\n",(0,d.jsxs)(s.li,{children:["draid2:8:1 - 4kn - 40KiB meta\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u5b9e\u73b0\u4e86\u7279\u6b8a vdev \u7a7a\u95f4\u5206\u914d - 12KiB"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.li,{children:"RAIDz2 - 12KiB"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\u5bb9\u9519\u6027\u4f4e\u4e8e\u4f20\u7edf\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["\u4f8b\u5982 9 \u76d8 draid1:2:0 / RAIDz1\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"draid1:2:0 \u6700\u591a\u53ea\u80fd\u574f 1 \u4e2a - \u7b2c\u4e8c\u4e2a\u574f\u4f1a\u5f71\u54cd\u6570\u636e - \u6ca1\u6709\u76d8\u4f4d\u6982\u5ff5"}),"\n",(0,d.jsx)(s.li,{children:"RAIDz1 - \u7b2c\u4e8c\u4e2a\u574f\u53ef\u80fd\u4e0d\u5f71\u54cd\uff0c\u53ea\u8981\u4e0d\u5728\u4e00\u4e2a\u5206\u7ec4 - 9 \u76d8 3 \u5206\u7ec4 - \u56fa\u5b9a\u76d8\u4f4d"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\u4f8b\u5982 draid1:4d:11c:1s\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"11 \u4e2a\u76d8"}),"\n",(0,d.jsx)(s.li,{children:"1p 4d 1s - \u6bcf\u4e2a strip \u4f7f\u7528 5 \u4e2a\u76d8 + \u4e00\u4e2a\u5907\u7528"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\u53c2\u8003\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:(0,d.jsx)(s.a,{href:"https://github.com/openzfs/zfs/blob/c14ad80fcbcfc011686f01a89644eea7c028a879/module/zfs/vdev_draid.c#L45-L167",children:"module/zfs/vdev_draid.c#L45-L167"})}),"\n",(0,d.jsx)(s.li,{children:(0,d.jsx)(s.a,{href:"https://openzfs.github.io/openzfs-docs/Basic%20Concepts/dRAID%20Howto.html",children:"dRAID"})}),"\n",(0,d.jsx)(s.li,{children:(0,d.jsx)(s.a,{href:"https://arstechnica.com/gadgets/2021/07/a-deep-dive-into-openzfs-2-1s-new-distributed-raid-topology/",children:"OpenZFS 2.1 is out\u2014let\u2019s talk about its brand-new dRAID vdevs"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.admonition,{title:"\u4f7f\u7528\u573a\u666f",type:"tip",children:(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["dRAID \u7528\u4e8e\u78c1\u76d8\u975e\u5e38\u591a\u7684\u573a\u666f\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"\u727a\u7272\u4e00\u70b9\u4f7f\u7528\u7a7a\u95f4\u6362\u53d6\u66f4\u5feb\u7684\u6062\u590d\u901f\u5ea6"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.li,{children:"vdev >= 20 dRAID"}),"\n",(0,d.jsx)(s.li,{children:"vdev 10-20 - \u914c\u60c5"}),"\n",(0,d.jsx)(s.li,{children:"vdev <= 8 \u9009\u62e9 RAIDz"}),"\n"]})}),"\n",(0,d.jsx)(s.h2,{id:"expansion",children:"Expansion"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:(0,d.jsx)(s.a,{href:"https://www.youtube.com/watch?v=yF2KgQGmUic",children:"Raid-Z Expansion"})}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.strong,{children:"\u4f20\u7edf RAID 4/5/6"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"sda"}),(0,d.jsx)(s.th,{children:"sdb"}),(0,d.jsx)(s.th,{children:"sdc"}),(0,d.jsx)(s.th,{children:"sdd"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"1"}),(0,d.jsx)(s.td,{children:"2"}),(0,d.jsx)(s.td,{children:"3"}),(0,d.jsx)(s.td,{children:"P1-3"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"4"}),(0,d.jsx)(s.td,{children:"5"}),(0,d.jsx)(s.td,{children:"6"}),(0,d.jsx)(s.td,{children:"P4-6"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"sda"}),(0,d.jsx)(s.th,{children:"sdb"}),(0,d.jsx)(s.th,{children:"sdc"}),(0,d.jsx)(s.th,{children:"sdd"}),(0,d.jsx)(s.th,{children:"sde"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"1"}),(0,d.jsx)(s.td,{children:"2"}),(0,d.jsx)(s.td,{children:"3"}),(0,d.jsx)(s.td,{children:"4"}),(0,d.jsx)(s.td,{children:"P1-4"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"5"}),(0,d.jsx)(s.td,{children:"6"}),(0,d.jsx)(s.td,{children:"7"}),(0,d.jsx)(s.td,{children:"8"}),(0,d.jsx)(s.td,{children:"P5-8"})]})]})]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"P - parity group - strip"}),"\n",(0,d.jsx)(s.li,{children:"\u5206\u7ec4\u53d8\u5316"}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.strong,{children:"RAID-Z expansion: reflow"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"sda"}),(0,d.jsx)(s.th,{children:"sdb"}),(0,d.jsx)(s.th,{children:"sdc"}),(0,d.jsx)(s.th,{children:"sdd"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"1P"}),(0,d.jsx)(s.td,{children:"2"}),(0,d.jsx)(s.td,{children:"3"}),(0,d.jsx)(s.td,{children:"4"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"5P"}),(0,d.jsx)(s.td,{children:"6"}),(0,d.jsx)(s.td,{children:"7"}),(0,d.jsx)(s.td,{children:"8"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"9P"}),(0,d.jsx)(s.td,{children:"10"}),(0,d.jsx)(s.td,{children:"11"}),(0,d.jsx)(s.td,{children:"12"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"sda"}),(0,d.jsx)(s.th,{children:"sdb"}),(0,d.jsx)(s.th,{children:"sdc"}),(0,d.jsx)(s.th,{children:"sdd"}),(0,d.jsx)(s.th,{children:"sde"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"1P"}),(0,d.jsx)(s.td,{children:"2"}),(0,d.jsx)(s.td,{children:"3"}),(0,d.jsx)(s.td,{children:"4"}),(0,d.jsx)(s.td,{children:"5P"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:"6"}),(0,d.jsx)(s.td,{children:"7"}),(0,d.jsx)(s.td,{children:"8"}),(0,d.jsx)(s.td,{children:"9P"}),(0,d.jsx)(s.td,{children:"10"})]})]})]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"P - parity group - logical strip"}),"\n",(0,d.jsx)(s.li,{children:"\u5206\u7ec4\u6ca1\u53d8 - \u5bb9\u707e\u80fd\u529b\u6ca1\u53d8"}),"\n",(0,d.jsx)(s.li,{children:"\u4e0d\u4fee\u6539 block \u6307\u9488"}),"\n",(0,d.jsx)(s.li,{children:"\u987a\u5e8f\u8bfb\u5199"}),"\n",(0,d.jsx)(s.li,{children:"strip \u72ec\u7acb"}),"\n",(0,d.jsx)(s.li,{children:"parity group \u8fc1\u79fb\u65f6\u4f1a\u786e\u4fdd\u4e4b\u524d\u6570\u636e\u4e0d\u88ab\u8986\u76d6 - \u907f\u514d\u8fc1\u79fb\u8fc7\u7a0b\u5f02\u5e38\uff0c\u4e22\u5931\u6570\u636e"}),"\n",(0,d.jsx)(s.li,{children:"\u8fc1\u79fb\u8fc7\u7a0b\u6162 - \u56e0\u4e3a\u5168\u90e8\u6570\u636e\u90fd\u4f1a\u52a8"}),"\n"]})]})}function j(n={}){const{wrapper:s}={...(0,i.M)(),...n.components};return s?(0,d.jsx)(s,{...n,children:(0,d.jsx)(x,{...n})}):x(n)}},38088:(n,s,e)=>{var d=e(96651),i=Symbol.for("react.element"),l=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,t=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function h(n,s,e){var d,l={},h=null,x=null;for(d in void 0!==e&&(h=""+e),void 0!==s.key&&(h=""+s.key),void 0!==s.ref&&(x=s.ref),s)r.call(s,d)&&!c.hasOwnProperty(d)&&(l[d]=s[d]);if(n&&n.defaultProps)for(d in s=n.defaultProps)void 0===l[d]&&(l[d]=s[d]);return{$$typeof:i,type:n,key:h,ref:x,props:l,_owner:t.current}}s.Fragment=l,s.jsx=h,s.jsxs=h},2488:(n,s,e)=>{n.exports=e(38088)},62780:(n,s,e)=>{e.d(s,{I:()=>t,M:()=>r});var d=e(96651);const i={},l=d.createContext(i);function r(n){const s=d.useContext(l);return d.useMemo((function(){return"function"==typeof n?n(s):{...s,...n}}),[s,n])}function t(n){let s;return s=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),d.createElement(l.Provider,{value:s},n.children)}}}]);