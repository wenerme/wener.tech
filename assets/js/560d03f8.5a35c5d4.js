/*! For license information please see 560d03f8.5a35c5d4.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[49427],{7851:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>a});var s=t(11527),r=t(47214);const i={tags:["Client"]},l="Client",o={id:"queue/nats/nats-client",title:"Client",description:"- NodeJS",source:"@site/../notes/queue/nats/nats-client.md",sourceDirName:"queue/nats",slug:"/queue/nats/client",permalink:"/notes/queue/nats/client",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/queue/nats/nats-client.md",tags:[{label:"Client",permalink:"/notes/tags/client"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1695042174,formattedLastUpdatedAt:"Sep 18, 2023",frontMatter:{tags:["Client"]},sidebar:"docs",previous:{title:"nats",permalink:"/notes/queue/nats/cli"},next:{title:"NATS Conf",permalink:"/notes/queue/nats/conf"}},c={},a=[{value:"Request/Reply",id:"requestreply",level:2},{value:"NodeJS Websocket",id:"nodejs-websocket",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"client",children:"Client"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["NodeJS\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["nats - ",(0,s.jsx)(n.strong,{children:"\u4e0d\u652f\u6301 websocket"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["NodeJS/Browser - Websocket\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"nats.ws"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5b98\u65b9 Client\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"WebSocket"}),"\n",(0,s.jsx)(n.li,{children:"C, C#, Crystal, Deno, Elixir, Go, Java, Nginx, NodeJS, Ruby, Pure Ruby"}),"\n",(0,s.jsx)(n.li,{children:"Python Asyncio, Python Torando, Rust"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Connectors/Utils\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5b98\u65b9: Spark, Redis PubSub, Kafka Bridge, MQ Series Bridge, Replicator"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://nats.io/download/",children:"Clients"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// \u6700\u591a 10 \u6b21\u91cd\u8fde\nexport const DEFAULT_MAX_RECONNECT_ATTEMPTS = 10;\n// \u91cd\u8fde\u968f\u673a\u95f4\u9694\u8303\u56f4\nexport const DEFAULT_JITTER = 100;\n// jitter for tls\nexport const DEFAULT_JITTER_TLS = 1000;\n// Ping interval\nexport const DEFAULT_PING_INTERVAL = 2 * 60 * 1000; // 2 minutes\nexport const DEFAULT_MAX_PING_OUT = 2;\n\n// DISCONNECT Parameters, 2 sec wait, 10 tries\n// \u91cd\u8fde\u95f4\u9694\nexport const DEFAULT_RECONNECT_TIME_WAIT = 2 * 1000;\n\n// \u91cd\u8fde\u95f4\u9694\u8ba1\u7b97\u903b\u8f91\nconst reconnectDelayHandler = () => {\n  let extra = options.tls ? options.reconnectJitterTLS : options.reconnectJitter;\n  if (extra) {\n    extra++;\n    extra = Math.floor(Math.random() * extra);\n  }\n  return options.reconnectTimeWait + extra;\n};\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/nats-io/nats.deno/blob/main/nats-base-client/options.ts",children:"https://github.com/nats-io/nats.deno/blob/main/nats-base-client/options.ts"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"requestreply",children:"Request/Reply"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Request/Reply\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"client: subscribe INBOX"}),"\n",(0,s.jsx)(n.li,{children:"client: publish subject"}),"\n",(0,s.jsx)(n.li,{children:"server: reply -> publish(msg.replay) -> client.INBOX"}),"\n",(0,s.jsx)(n.li,{children:"client: handle reply"}),"\n",(0,s.jsx)(n.li,{children:"client: unsubscribe INBOX"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"nodejs-websocket",children:"NodeJS Websocket"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function polyfillWebSocket(ws?: any): MaybePromise<boolean> {\n  const globalThis = getGlobalThis();\n  if ('WebSocket' in globalThis) {\n    return false;\n  }\n  if (ws) {\n    const { WebSocket } = ws;\n    Object.assign(globalThis, { WebSocket });\n  }\n  return import('ws').then((ws) => polyfillWebSocket(ws));\n}\n\nconst { connect } = await import('nats.ws');\nconst client = await connect({\n  servers: ['wss://nats.example.com:443'],\n});\nconsole.log(client.stats());\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},3354:(e,n,t)=>{var s=t(50959),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function a(e,n,t){var s,i={},a=null,d=null;for(s in void 0!==t&&(a=""+t),void 0!==n.key&&(a=""+n.key),void 0!==n.ref&&(d=n.ref),n)l.call(n,s)&&!c.hasOwnProperty(s)&&(i[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===i[s]&&(i[s]=n[s]);return{$$typeof:r,type:e,key:a,ref:d,props:i,_owner:o.current}}n.Fragment=i,n.jsx=a,n.jsxs=a},11527:(e,n,t)=>{e.exports=t(3354)},47214:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>l});var s=t(50959);const r={},i=s.createContext(r);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);