/*! For license information please see bb353236.145ba2ee.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[46216],{11597:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var s=r(11527),o=r(47214);const t={title:"Puppeteer"},i="Puppeteer",l={id:"web/browser/chrome/puppeteer",title:"Puppeteer",description:"- puppeteer",source:"@site/../notes/web/browser/chrome/puppeteer.md",sourceDirName:"web/browser/chrome",slug:"/web/browser/chrome/puppeteer",permalink:"/notes/web/browser/chrome/puppeteer",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/browser/chrome/puppeteer.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1706172619,formattedLastUpdatedAt:"Jan 25, 2024",frontMatter:{title:"Puppeteer"},sidebar:"docs",previous:{title:"DevTool Protocol",permalink:"/notes/web/browser/chrome/devtools-protocol"},next:{title:"V8",permalink:"/notes/web/browser/chrome/v8"}},c={},a=[{value:"browser",id:"browser",level:2},{value:"adblock",id:"adblock",level:2},{value:"\u6dfb\u52a0\u6269\u5c55",id:"\u6dfb\u52a0\u6269\u5c55",level:2},{value:"Notes",id:"notes",level:2},{value:"Docker user",id:"docker-user",level:2},{value:"AlpineLinux musl",id:"alpinelinux-musl",level:2},{value:"Failed to adjust OOM score of renderer with pid 799: Permission denied",id:"failed-to-adjust-oom-score-of-renderer-with-pid-799-permission-denied",level:2},{value:"Failed to connect to the bus: Failed to connect to socket /var/run/dbus/system_bus_socket: No such file or directory",id:"failed-to-connect-to-the-bus-failed-to-connect-to-socket-varrundbussystem_bus_socket-no-such-file-or-directory",level:2},{value:"The profile appears to be in use by another Chromium process on another computer",id:"the-profile-appears-to-be-in-use-by-another-chromium-process-on-another-computer",level:2},{value:"Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are &quot;tcp&quot; and on UNIX &quot;unix&quot;)",id:"failed-to-connect-to-the-bus-could-not-parse-server-address-unknown-address-type-examples-of-valid-types-are-tcp-and-on-unix-unix",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"puppeteer",children:"Puppeteer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer",children:"puppeteer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/notes/web/browser/chrome/headless",children:"Chrome Devtools Protocol"})," \u5ba2\u6237\u7aef"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4f7f\u7528\u4e86 ",(0,s.jsx)(n.a,{href:"/notes/web/browser/chrome/for-testing",children:"Chrome for Testing"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Alpine \u4e0b\u6709\u95ee\u9898 ",(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer/issues/7746",children:"#7746"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5728 Alpine \u4e0b\u989d\u5916\u5b89\u88c5\uff0c\u7136\u540e\u914d\u7f6e PUPPETEER_EXECUTABLE_PATH"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4fdd\u6301\u6d4f\u89c8\u5668\u8fd0\u884c ",(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer/issues/8261",children:"#8261"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer/blob/main/packages/browsers/src/detectPlatform.ts",children:"https://github.com/puppeteer/puppeteer/blob/main/packages/browsers/src/detectPlatform.ts"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm add puppeteer\n\n# linux \u4f9d\u8d56\napk add nss nspr at-spi2-atk cups-libs libxcomposite mesa-gbm libxkbcommon pango cairo alsa-lib\n# at-spi2-core\n\n# Linux \u73af\u5883\u4f7f\u7528\nexport DISPLAY=:1\n\nnode\n.editor\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"var puppeteer = await import('puppeteer');\nvar browser = await puppeteer.launch();\nvar page = await browser.newPage();\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Browser\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4e8b\u4ef6\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"disconnected"}),"\n",(0,s.jsx)(n.li,{children:"targetchanged - URL \u53d8\u5316"}),"\n",(0,s.jsx)(n.li,{children:"targetcreated - \u4f8b\u5982 window.open, browser.newPage"}),"\n",(0,s.jsx)(n.li,{children:"targetdestroyed"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["BrowserContext\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e8b\u4ef6: targetchanged, targetcreated, targetdestroyed"}),"\n",(0,s.jsx)(n.li,{children:"\u53ef\u4ee5\u521b\u5efa incognito \u4e0a\u4e0b\u6587"}),"\n",(0,s.jsx)(n.li,{children:"Target - page, background_page, service_worker, shared_worker, other, browser, webview"}),"\n",(0,s.jsxs)(n.li,{children:["Page - \u6b63\u5e38\u7f51\u9875\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Frame"}),"\n",(0,s.jsx)(n.li,{children:"mainFrame - \u5f53\u524d\u4e3b\u7a97\u53e3"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# macOS \u624b\u52a8\u542f\u52a8\n/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome --remote-debugging-port=9222 --no-first-run --no-default-browser-check --user-data-dir=$(mktemp -d -t 'chrome-remote_data_dir')\n\n# Windows\n\"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\" --remote-debugging-port=9222\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://127.0.0.1:9222/json/version",children:"http://127.0.0.1:9222/json/version"})}),"\n",(0,s.jsxs)(n.li,{children:["\u9ed8\u8ba4\u4f7f\u7528 --remote-debugging-port=0\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u968f\u673a port"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer/blob/v14.4.1/docs/api.md",children:"https://github.com/puppeteer/puppeteer/blob/v14.4.1/docs/api.md"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// \u83b7\u53d6\u5f53\u524d\u7684 ws url\nbrowser.wsEndpoint();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"browser",children:"browser"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"~/.cache/puppeteer/chrome"}),"\n",(0,s.jsxs)(n.li,{children:["PUPPETEER_SKIP_DOWNLOAD=true\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u907f\u514d\u4e0b\u8f7d"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser"}),"\n",(0,s.jsx)(n.li,{children:"PUPPETEER_DOWNLOAD_BASE_URL"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.del,{children:"PUPPETEER_SKIP_CHROMIUM_DOWNLOAD"})," -> PUPPETEER_SKIP_DOWNLOAD"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.del,{children:"PUPPETEER_DOWNLOAD_HOST"})," -> PUPPETEER_DOWNLOAD_BASE_URL"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.del,{children:"PUPPETEER_CHROMIUM_REVISION"})," -> PUPPETEER_BROWSER_REVISION"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",metastring:'title=".npmrc"',children:'puppeteer_download_base_url="https://cdn.npmmirror.com/binaries/chrome-for-testing"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npx @puppeteer/browsers --help\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://pptr.dev/browsers-api",children:"https://pptr.dev/browsers-api"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://googlechromelabs.github.io/chrome-for-testing/last-known-good-versions.json",children:"https://googlechromelabs.github.io/chrome-for-testing/last-known-good-versions.json"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"adblock",children:"adblock"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm add puppeteer-extra puppeteer-extra-plugin-adblocker\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const puppeteer = require('puppeteer-extra');\n\n// Add adblocker plugin, which will transparently block ads in all pages you\n// create using puppeteer.\nconst { DEFAULT_INTERCEPT_RESOLUTION_PRIORITY } = require('puppeteer');\nconst AdblockerPlugin = require('puppeteer-extra-plugin-adblocker');\npuppeteer.use(\n  AdblockerPlugin({\n    // Optionally enable Cooperative Mode for several request interceptors\n    interceptResolutionPriority: DEFAULT_INTERCEPT_RESOLUTION_PRIORITY,\n  }),\n);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/ghostery/adblocker",children:"https://github.com/ghostery/adblocker"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://raw.githubusercontent.com/cliqz-oss/adblocker/master/packages/adblocker/assets/easylist/easylistgermany.txt",children:"https://raw.githubusercontent.com/cliqz-oss/adblocker/master/packages/adblocker/assets/easylist/easylistgermany.txt"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6dfb\u52a0\u6269\u5c55",children:"\u6dfb\u52a0\u6269\u5c55"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"--disable-extensions-except=/path/to/extension"}),"\n",(0,s.jsx)(n.li,{children:"--load-extension=/path/to/extension"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["@puppeteer/browsers\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5b89\u88c5\u548c\u542f\u52a8\u6d4f\u89c8\u5668"}),"\n",(0,s.jsxs)(n.li,{children:["\u542f\u52a8 ",(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer/blob/main/packages/browsers/src/launch.ts",children:"https://github.com/puppeteer/puppeteer/blob/main/packages/browsers/src/launch.ts"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["puppeteer-core\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CDP API"}),"\n",(0,s.jsx)(n.li,{children:"launch & connect"}),"\n",(0,s.jsxs)(n.li,{children:["launch \u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"@puppeteer/browsers"})," \u542f\u52a8\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer/blob/main/packages/puppeteer-core/src/node/ProductLauncher.ts",children:"https://github.com/puppeteer/puppeteer/blob/main/packages/puppeteer-core/src/node/ProductLauncher.ts"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(n.h2,{id:"docker-user",children:"Docker user"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"addgroup -S pptruser\nadduser -S -g pptruser pptruser\nmkdir -p /home/pptruser/Downloads /app\nchown -R pptruser:pptruser /home/pptruser\nchown -R pptruser:pptruser /app\n"})}),"\n",(0,s.jsx)(n.h2,{id:"alpinelinux-musl",children:"AlpineLinux musl"}),"\n",(0,s.jsx)(n.p,{children:"\u9ed8\u8ba4\u4e0b\u8f7d\u7684\u4e0d\u652f\u6301"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Error relocating /chrome-linux/chrome: __mbrlen: symbol not found\nError relocating /chrome-linux/chrome: __close: symbol not found\nError relocating /chrome-linux/chrome: initstate_r: symbol not found\nError relocating /chrome-linux/chrome: random_r: symbol not found\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md#running-on-alpine",children:"https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md#running-on-alpine"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apk add chromium chromium-lang\n# chromium-chromedriver\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"var browser = await puppeteer.launch({\n  executablePath: '/usr/bin/chromium-browser',\n  headless: false,\n  args: ['--no-sandbox', '--disable-gpu'],\n});\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["root \u5fc5\u987b\u8981 ",(0,s.jsx)(n.code,{children:"--no-sandbox"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-adjust-oom-score-of-renderer-with-pid-799-permission-denied",children:"Failed to adjust OOM score of renderer with pid 799: Permission denied"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"--no-sandbox"}),"\n",(0,s.jsx)(n.li,{children:"SYS_ADMIN"}),"\n",(0,s.jsx)(n.li,{children:"seccomp"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/Zenika/alpine-chrome/issues/109",children:"https://github.com/Zenika/alpine-chrome/issues/109"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/Zenika/alpine-chrome/blob/master/examples/k8s/deployment.yml",children:"https://github.com/Zenika/alpine-chrome/blob/master/examples/k8s/deployment.yml"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-connect-to-the-bus-failed-to-connect-to-socket-varrundbussystem_bus_socket-no-such-file-or-directory",children:"Failed to connect to the bus: Failed to connect to socket /var/run/dbus/system_bus_socket: No such file or directory"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apk add dbus\nservice dbus start\n"})}),"\n",(0,s.jsx)(n.h2,{id:"the-profile-appears-to-be-in-use-by-another-chromium-process-on-another-computer",children:"The profile appears to be in use by another Chromium process on another computer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"The profile appears to be in use by another Chromium process on another computer. Chromium has locked the profile so that it doesn't get corrupted. If you are sure no other processes are using this profile, you can unlock the profile and relaunch Chromium.\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# $DataDir/Singleton*\nrm -rf ~/.config/chromium/Singleton*\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SingletonSocket"}),"\n",(0,s.jsx)(n.li,{children:"SingletonLock"}),"\n",(0,s.jsx)(n.li,{children:"SingletonCookie"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-connect-to-the-bus-could-not-parse-server-address-unknown-address-type-examples-of-valid-types-are-tcp-and-on-unix-unix",children:'Failed to connect to the bus: Could not parse server address: Unknown address type (examples of valid types are "tcp" and on UNIX "unix")'})]})}function d(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},3354:(e,n,r)=>{var s=r(50959),o=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function a(e,n,r){var s,t={},a=null,p=null;for(s in void 0!==r&&(a=""+r),void 0!==n.key&&(a=""+n.key),void 0!==n.ref&&(p=n.ref),n)i.call(n,s)&&!c.hasOwnProperty(s)&&(t[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===t[s]&&(t[s]=n[s]);return{$$typeof:o,type:e,key:a,ref:p,props:t,_owner:l.current}}n.Fragment=t,n.jsx=a,n.jsxs=a},11527:(e,n,r)=>{e.exports=r(3354)},47214:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>i});var s=r(50959);const o={},t=s.createContext(o);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);