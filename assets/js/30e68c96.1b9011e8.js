/*! For license information please see 30e68c96.1b9011e8.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[47548],{51842:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>o,frontMatter:()=>d,metadata:()=>s,toc:()=>h});var r=i(11527),l=i(47214);const d={title:"HW Accel"},t="HW Accel",s={id:"service/media/hardware-accel",title:"HW Accel",description:"| OS      | HW Acceleration         |",source:"@site/../notes/service/media/hardware-accel.md",sourceDirName:"service/media",slug:"/service/media/hardware-accel",permalink:"/notes/service/media/hardware-accel",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/media/hardware-accel.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1659031280,formattedLastUpdatedAt:"Jul 28, 2022",frontMatter:{title:"HW Accel"},sidebar:"docs",previous:{title:"\u5b57\u5e55",permalink:"/notes/service/media/format/subtitle"},next:{title:"HEVC",permalink:"/notes/service/media/hevc"}},c={},h=[{value:"FFmpeg",id:"ffmpeg",level:2},{value:"vaInitialize failed with error code 18",id:"vainitialize-failed-with-error-code-18",level:2},{value:"\u770b\u4e0d\u5230\u663e\u5361",id:"\u770b\u4e0d\u5230\u663e\u5361",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"hw-accel",children:"HW Accel"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"OS"}),(0,r.jsx)(n.th,{children:"HW Acceleration"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Linux"}),(0,r.jsx)(n.td,{children:"QSV, NVENC, AMF, VA-API"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Windows"}),(0,r.jsx)(n.td,{children:"QSV, NVENC, AMF"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"MacOS"}),(0,r.jsx)(n.td,{children:"VideoToolbox"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"RPi"}),(0,r.jsx)(n.td,{children:"V4L2"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Vendor"}),(0,r.jsx)(n.th,{children:"HW Acceleration"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"NVIDIA"}),(0,r.jsx)(n.td,{children:"NVENC"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"AMD"}),(0,r.jsx)(n.td,{children:"AMF, VA-API"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Intel"}),(0,r.jsx)(n.td,{children:"QSV, VA-API"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Apple"}),(0,r.jsx)(n.td,{children:"VideoToolbox"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"RPi"}),(0,r.jsx)(n.td,{children:"V4L2"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Project"}),(0,r.jsx)(n.th,{children:"Graphics Gen"}),(0,r.jsx)(n.th,{children:"Repo"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"oneVPL"}),(0,r.jsx)(n.td,{children:"gen12+"}),(0,r.jsxs)(n.td,{children:["\u200b",(0,r.jsx)(n.a,{href:"https://github.com/oneapi-src/oneVPL",children:"https://github.com/oneapi-src/oneVPL"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"iHD driver"}),(0,r.jsx)(n.td,{children:"gen8+"}),(0,r.jsxs)(n.td,{children:["\u200b",(0,r.jsx)(n.a,{href:"https://github.com/intel/media-driver",children:"https://github.com/intel/media-driver"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Libva"}),(0,r.jsx)(n.td,{children:"gen5+"}),(0,r.jsxs)(n.td,{children:["\u200b",(0,r.jsx)(n.a,{href:"https://github.com/intel/libva",children:"https://github.com/intel/libva"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"MSDK"}),(0,r.jsx)(n.td,{children:"gen8 ~ gen12(Rocket Lake)"}),(0,r.jsxs)(n.td,{children:["\u200b",(0,r.jsx)(n.a,{href:"https://github.com/Intel-Media-SDK/MediaSDK",children:"https://github.com/Intel-Media-SDK/MediaSDK"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"i965 driver"}),(0,r.jsx)(n.td,{children:"gen5 ~ gen9.5"}),(0,r.jsxs)(n.td,{children:["\u200b",(0,r.jsx)(n.a,{href:"https://github.com/intel/intel-vaapi-driver",children:"https://github.com/intel/intel-vaapi-driver"})]})]})]})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Intel QuickSync (QSV)\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u57fa\u4e8e VAAPI"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u6ca1\u6709\u786c\u89e3\u652f\u6301 H.264 / AVC 10-bit\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5347\u7ea7\u4e3a HEVC 10-bit"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["/usr/lib/dri/ - \u5b89\u88c5\u7684\u9a71\u52a8\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"iHD_drv_video.so"}),"\n",(0,r.jsx)(n.li,{children:"i965_drv_video.so"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/dev/dri/render*"})," DRM render node"]}),"\n",(0,r.jsx)(n.li,{children:"i915"}),"\n",(0,r.jsx)(n.li,{children:"i965"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat /proc/cpuinfo | grep "model name" | uniq\n\napk add pciutils\nlspci -nn | egrep -i "3d|display|vga"\n\napk add lshw\nlshw -C display\nlshw -c video\n\napk add inxi\ninxi -G\n\n# i915_cur_delayinfo\nsudo sh -c \'cat /sys/kernel/debug/dri/*/name\'\n\n\nls /dev/dri\n\n# VA-API\n# ==========\n# AlpineLinux edge/testing libva-utils\napk -X https://mirrors.sjtug.sjtu.edu.cn/alpine/edge/testing add libva-utils\nvainfo\n# https://github.com/intel/libva-utils\n# /dev/dri/renderXX\n\n# Intel QSV\n# =============\napk add intel-media-driver libva-intel-driver\nsudo LIBVA_TRACE=/tmp/libva_trace.log DRI_PRIME=1 LIBVA_DRIVER_NAME=iHD vainfo\n\nLIBVA_TRACE=/tmp/libva_trace.log DRI_PRIME=1 LIBVA_DRIVER_NAME=iHD ffmpeg -loglevel verbose -init_hw_device vaapi\n\n# options i915 enable_guc=3\n# options i915 enable_fbc=1\necho "options i915 force_probe=4692" | sudo tee /etc/modprobe.d/i915.conf\n\n# GPU freq\nsudo find /sys -type f -name gt_cur* -print0\n\n# X11\n# ==========\n# apk add vdpauinfo\n# vdpauinfo\ngrep -iE \'vdpau | dri driver\' /var/log/Xorg.0.log\n\n# FFMpeg\n# =======\nffmpeg -hide_banner -decoders | grep qsv # \u5224\u65ad\u662f\u5426\u6709\u52a0\u901f\nffmpeg -hwaccel vaapi -vaapi_device /dev/dri/renderD128 -i "video.MP4" -vf "select=eq(pict_type\\,I)" -vsync vfr -qscale:v 2 -f image2 "%08d.jpg"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"ffmpeg",children:"FFmpeg"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{h264,hevc}_{videotoolbox,amf,vaapi}"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"videotoolbox - macOS"}),"\n",(0,r.jsx)(n.li,{children:"amf - Windows"}),"\n",(0,r.jsx)(n.li,{children:"vaapi - Linux - vainfo"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["-hwaccel auto\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"dxva2,cuda,d3d11va,videotoolbox"}),"\n",(0,r.jsx)(n.li,{children:"-hwaccel_device"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ffmpeg -encoders | grep videotoolbox # \u652f\u6301\u7684 videotoolbox \u7f16\u7801\nffmpeg -h encoder=h264_videotoolbox  # \u67e5\u770b\u7f16\u7801\u5668\u9009\u9879\n\nffprobe in.mp4                           # \u5f04\u6e05\u695a\u539f\u59cb bitrate\nffmpeg -b:v 1900k -c:v h264_videotoolbox # -b:v \u5339\u914d\u539f\u59cb bitrate\n\n# \u4f7f\u7528 hwaccel \u65b9\u5f0f - \u5916\u7f6e GPU\nffmpeg \\\n  -hwaccel videotoolbox -i in.mp4 \\\n  -c:v libx265 -preset medium -crf 28 \\\n  -c:a copy \\\n  out.mp4\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["apple ",(0,r.jsx)(n.a,{href:"https://developer.apple.com/documentation/videotoolbox",children:"VideoToolbox"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Decode H.263, H.264, HEVC, MPEG1, MPEG2, MPEG4, ProRes"}),"\n",(0,r.jsx)(n.li,{children:"Encode H.264, HEVC, ProRes"}),"\n",(0,r.jsx)(n.li,{children:"\u4e0d\u652f\u6301 CRF/constant quality - \u5fc5\u987b\u6307\u5b9a -b:v"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://trac.ffmpeg.org/wiki/HWAccelIntro",children:"HWAccelIntro"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"macOS: VideoToolbox"}),"\n",(0,r.jsx)(n.li,{children:"OpenCL \u5927\u591a\u5e73\u53f0\u652f\u6301\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5 encode/decode - \u7528\u4e8e Filtering"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://trac.ffmpeg.org/wiki/Hardware/QuickSync",children:"Hardware/QuickSync"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Intel_Quick_Sync_Video",children:"Intel Quick Sync Video"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u67e5\u770b Intel CPU \u652f\u6301\u7684\u7f16\u7801"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/List_of_Macintosh_models_grouped_by_CPU_type#Intel_x86",children:"List of Macintosh models grouped by CPU type"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u67e5\u770b Macbook \u5bf9\u5e94\u7684 Intel CPU \u7248\u672c"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/intel/media-driver",children:"intel/media-driver"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Intel(R) Media Driver for VAAPI"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/joshuaboniface/rffmpeg",children:"joshuaboniface/rffmpeg"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"remote SSH FFmpeg"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["archlinux ",(0,r.jsx)(n.a,{href:"https://wiki.archlinux.org/title/Hardware_video_acceleration",children:"Hardware video acceleration"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://jellyfin.org/docs/general/administration/hardware-acceleration.html",children:"https://jellyfin.org/docs/general/administration/hardware-acceleration.html"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/intel/intel-device-plugins-for-kubernetes",children:"intel/intel-device-plugins-for-kubernetes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.techspot.com/article/1131-hevc-h256-enconding-playback/",children:"https://www.techspot.com/article/1131-hevc-h256-enconding-playback/"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elpamsoft.com/?p=Plex-Hardware-Transcoding",children:"https://www.elpamsoft.com/?p=Plex-Hardware-Transcoding"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/intel/vaapi-bypass",children:"intel/vaapi-bypass"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"vainitialize-failed-with-error-code-18",children:"vaInitialize failed with error code 18"}),"\n",(0,r.jsx)(n.h2,{id:"\u770b\u4e0d\u5230\u663e\u5361",children:"\u770b\u4e0d\u5230\u663e\u5361"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5c1d\u8bd5\u8c03\u6574 BIOS - \u4fee\u6539\u4e3a\u53ef\u5207\u6362\u663e\u5361"}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},3354:(e,n,i)=>{var r=i(50959),l=Symbol.for("react.element"),d=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function h(e,n,i){var r,d={},h=null,a=null;for(r in void 0!==i&&(h=""+i),void 0!==n.key&&(h=""+n.key),void 0!==n.ref&&(a=n.ref),n)t.call(n,r)&&!c.hasOwnProperty(r)&&(d[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===d[r]&&(d[r]=n[r]);return{$$typeof:l,type:e,key:h,ref:a,props:d,_owner:s.current}}n.Fragment=d,n.jsx=h,n.jsxs=h},11527:(e,n,i)=>{e.exports=i(3354)},47214:(e,n,i)=>{i.d(n,{Z:()=>s,a:()=>t});var r=i(50959);const l={},d=r.createContext(l);function t(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);