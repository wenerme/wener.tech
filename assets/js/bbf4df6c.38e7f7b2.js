"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[3905],{49613:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return d}});var r=t(59496);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var i=r.createContext({}),c=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(i.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},h=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,a=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=c(t),d=s,m=h["".concat(i,".").concat(d)]||h[d]||p[d]||a;return t?r.createElement(m,o(o({ref:n},u),{},{components:t})):r.createElement(m,o({ref:n},u))}));function d(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=t.length,o=new Array(a);o[0]=h;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:s,o[1]=l;for(var c=2;c<a;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}h.displayName="MDXCreateElement"},73860:function(e,n,t){t.r(n),t.d(n,{assets:function(){return f},contentTitle:function(){return d},default:function(){return b},frontMatter:function(){return h},metadata:function(){return m},toc:function(){return g}});var r=t(49613),s=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,n,t)=>n in e?s(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,p=(e,n)=>{for(var t in n||(n={}))i.call(n,t)&&u(e,t,n[t]);if(l)for(var t of l(n))c.call(n,t)&&u(e,t,n[t]);return e};const h={tags:["FAQ"]},d="SSH FAQ",m={unversionedId:"os/linux/shell/ssh/ssh-faq",id:"os/linux/shell/ssh/ssh-faq",title:"SSH FAQ",description:"tunning only user",source:"@site/../notes/os/linux/shell/ssh/ssh-faq.md",sourceDirName:"os/linux/shell/ssh",slug:"/os/linux/shell/ssh/faq",permalink:"/notes/os/linux/shell/ssh/faq",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/shell/ssh/ssh-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1694402622,formattedLastUpdatedAt:"Sep 11, 2023",frontMatter:{tags:["FAQ"]},sidebar:"docs",previous:{title:"ssh config",permalink:"/notes/os/linux/shell/ssh/config"},next:{title:"sshd",permalink:"/notes/os/linux/shell/ssh/sshd"}},f={},g=[{value:"tunning only user",id:"tunning-only-user",level:2},{value:"sshuttle user",id:"sshuttle-user",level:2},{value:"key_load_public: No such file or directory",id:"key_load_public-no-such-file-or-directory",level:2},{value:"channel 0: open failed: administratively prohibited: open failed - stdio forwarding failed",id:"channel-0-open-failed-administratively-prohibited-open-failed---stdio-forwarding-failed",level:2},{value:"\u7aef\u53e3\u8f6c\u53d1",id:"\u7aef\u53e3\u8f6c\u53d1",level:2},{value:"\u4e0d\u6821\u9a8c\u4e3b\u673a",id:"\u4e0d\u6821\u9a8c\u4e3b\u673a",level:2},{value:"no matching key exchange method found. Their offer: diffie-hellman-group1-sha1",id:"no-matching-key-exchange-method-found-their-offer-diffie-hellman-group1-sha1",level:2},{value:"no matching cipher found. Their offer: aes128-cbc,3des-cbc,aes256-cbc,twofish256-cbc,twofish-cbc,twofish128-cbc,blowfish-cbc",id:"no-matching-cipher-found-their-offer-aes128-cbc3des-cbcaes256-cbctwofish256-cbctwofish-cbctwofish128-cbcblowfish-cbc",level:2},{value:"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301 cipher",id:"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301-cipher",level:3},{value:"\u4fee\u6539\u670d\u52a1\u7aef cipher",id:"\u4fee\u6539\u670d\u52a1\u7aef-cipher",level:3},{value:"\u5f3a\u5236\u5bc6\u7801\u767b\u9646",id:"\u5f3a\u5236\u5bc6\u7801\u767b\u9646",level:2},{value:"\u67e5\u770b pubkey \u7c7b\u578b",id:"\u67e5\u770b-pubkey-\u7c7b\u578b",level:2},{value:"send_pubkey_test: no mutual signature algorithm",id:"send_pubkey_test-no-mutual-signature-algorithm",level:2},{value:"ssh into tmux",id:"ssh-into-tmux",level:2},{value:"\u4e0d\u8bb0\u5f55 localhost \u7684 host key",id:"\u4e0d\u8bb0\u5f55-localhost-\u7684-host-key",level:2},{value:"chmod ssh",id:"chmod-ssh",level:2},{value:"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7",id:"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7",level:2},{value:"scp sudo",id:"scp-sudo",level:2},{value:"ssh root forward agent",id:"ssh-root-forward-agent",level:2},{value:"expecting SSH2_MSG_KEX_ECDH_REPLY",id:"expecting-ssh2_msg_kex_ecdh_reply",level:2}],k={toc:g};function b(e){var n,t=e,{components:s}=t,u=((e,n)=>{var t={};for(var r in e)i.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&l)for(var r of l(e))n.indexOf(r)<0&&c.call(e,r)&&(t[r]=e[r]);return t})(t,["components"]);return(0,r.kt)("wrapper",(n=p(p({},k),u),a(n,o({components:s,mdxType:"MDXLayout"}))),(0,r.kt)("h1",p({},{id:"ssh-faq"}),"SSH FAQ"),(0,r.kt)("h2",p({},{id:"tunning-only-user"}),"tunning only user"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u914d\u7f6e\u9650\u5236")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),"Match User tunning\n  AllowTcpForwarding yes\n  X11Forwarding no\n  AllowAgentForwarding no\n  ForceCommand /bin/false\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u7528\u6237\u9650\u5236")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"useradd sshtunnel -m -d /home/sshtunnel -s /bin/true\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"authorized_keys")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),'from="192.168.1.10",command="/usr/bin/ls" ssh-rsa XXX\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://unix.stackexchange.com/a/337445/47774"}),"https://unix.stackexchange.com/a/337445/47774"))),(0,r.kt)("h2",p({},{id:"sshuttle-user"}),"sshuttle user"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/sshuttle/sshuttle/issues/703"}),"https://github.com/sshuttle/sshuttle/issues/703"))),(0,r.kt)("h2",p({},{id:"key_load_public-no-such-file-or-directory"}),"key_load_public: No such file or directory"),(0,r.kt)("p",null,"\u627e\u4e0d\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.ssh/id_rsa.pub"),"\uff0c\u4e0d\u5f71\u54cd\u4f7f\u7528"),(0,r.kt)("h2",p({},{id:"channel-0-open-failed-administratively-prohibited-open-failed---stdio-forwarding-failed"}),"channel 0: open failed: administratively prohibited: open failed - stdio forwarding failed"),(0,r.kt)("p",null,"\u4e0d\u5141\u8bb8 PortForward\uff0c\u9700\u8981\u5f00\u542f"),(0,r.kt)("h2",p({},{id:"\u7aef\u53e3\u8f6c\u53d1"}),"\u7aef\u53e3\u8f6c\u53d1"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"-L/LocalForward \u672c\u5730\u8f6c\u53d1"),(0,r.kt)("li",{parentName:"ul"},"-R/RemoteForward \u8fdc\u7a0b\u8f6c\u53d1")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"# \u8bbf\u95ee\u672c\u5730 80 \u4f1a\u88ab\u8f6c\u53d1\u5230 SERVER:8080\nssh -L 8080:localhost:80 SERVER -o ExitOnForwardFailure=yes\n\n# \u8bbf\u95ee SERVER:80 \u4f1a\u88ab\u8f6c\u53d1\u5230\u672c\u5730 8080 \u7aef\u53e3\n# -g \u5141\u8bb8\u5916\u90e8\u8bbf\u95ee\nssh -g -R 80:localhost:8080 SERVER -o ExitOnForwardFailure=yes\n")),(0,r.kt)("p",null,"\u5141\u8bb8\u7aef\u53e3\u8f6c\u53d1"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"/etc/ssh/sshd_config")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-conf"}),"AllowAgentForwarding yes\nAllowTcpForwarding yes\n# \u5141\u8bb8 -g\nGatewayPorts yes\n")),(0,r.kt)("h2",p({},{id:"\u4e0d\u6821\u9a8c\u4e3b\u673a"}),"\u4e0d\u6821\u9a8c\u4e3b\u673a"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@127.0.0.1 -p 2222\n\n# \u5ffd\u7565 SSH Agent\uff0c\u6d4b\u8bd5 key\nssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o IdentityAgent=none -i /tmp/sshkey root@127.0.0.1 -p 2222\n")),(0,r.kt)("h2",p({},{id:"no-matching-key-exchange-method-found-their-offer-diffie-hellman-group1-sha1"}),"no matching key exchange method found. Their offer: diffie-hellman-group1-sha1"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"~/.ssh/config")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),"KexAlgorithms +diffie-hellman-group1-sha1\n")),(0,r.kt)("h2",p({},{id:"no-matching-cipher-found-their-offer-aes128-cbc3des-cbcaes256-cbctwofish256-cbctwofish-cbctwofish128-cbcblowfish-cbc"}),"no matching cipher found. Their offer: aes128-cbc,3des-cbc,aes256-cbc,twofish256-cbc,twofish-cbc,twofish128-cbc,blowfish-cbc"),(0,r.kt)("p",null,"\u670d\u52a1\u7aef\u63d0\u4f9b\u7684 cipher \u5ba2\u6237\u7aef\u4e0d\u652f\u6301"),(0,r.kt)("h3",p({},{id:"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301-cipher"}),"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301 cipher"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),"Host gitlab.com\n     Ciphers aes256-ctc\n")),(0,r.kt)("h3",p({},{id:"\u4fee\u6539\u670d\u52a1\u7aef-cipher"}),"\u4fee\u6539\u670d\u52a1\u7aef cipher"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"/etc/ssh/ssh_config")),(0,r.kt)("p",null,"\u6dfb\u52a0 cipher"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),"Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc,aes192-cbc,aes256-cbc\n")),(0,r.kt)("h2",p({},{id:"\u5f3a\u5236\u5bc6\u7801\u767b\u9646"}),"\u5f3a\u5236\u5bc6\u7801\u767b\u9646"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"ssh user:@example.com\nssh -o PreferredAuthentications=password -o PubkeyAuthentication=no example.com\n")),(0,r.kt)("h2",p({},{id:"\u67e5\u770b-pubkey-\u7c7b\u578b"}),"\u67e5\u770b pubkey \u7c7b\u578b"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"find ~/.ssh/id_*.pub -exec ssh-keygen -l -f {} \\;\n")),(0,r.kt)("h2",p({},{id:"send_pubkey_test-no-mutual-signature-algorithm"}),"send_pubkey_test: no mutual signature algorithm"),(0,r.kt)("p",null,"openssh \u4e0d\u518d\u9ed8\u8ba4\u652f\u6301 ssh-rsa"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-conf",metastring:'title="sshd_config"',title:'"sshd_config"'}),"PubkeyAcceptedKeyTypes +ssh-rsa\n")),(0,r.kt)("p",null,"\u63a8\u8350\u4f7f\u7528 ECDSA,Ed25519"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),'ssh-keygen -t ed25519 -C "a@b.com" -f $PWD\n')),(0,r.kt)("h2",p({},{id:"ssh-into-tmux"}),"ssh into tmux"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),"Host example.org\n    RemoteCommand tmux new -A -s default\n")),(0,r.kt)("h2",p({},{id:"\u4e0d\u8bb0\u5f55-localhost-\u7684-host-key"}),"\u4e0d\u8bb0\u5f55 localhost \u7684 host key"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),"Host localhost\n    UserKnownHostsFile /dev/null\n    StrictHostKeyChecking no\n")),(0,r.kt)("h2",p({},{id:"chmod-ssh"}),"chmod ssh"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"chmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\nchmod 600 ~/.ssh/id_rsa\nchmod 644 ~/.ssh/id_rsa.pub\n\nchmod go-w ~\n\n# restorecon -R -v /root/.ssh\n")),(0,r.kt)("h2",p({},{id:"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7"}),"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"grep 'Failed password' /var/log/messages* | egrep -o 'invalid user \\w+' | egrep -o '\\w+$' | sort -u\n")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{}),"1234\na\nadmin\nansadmin\nansible\napache\napp\nappuser\nark\narkserver\nawsgui\nbigdata\nbitrix\nbot\ncarlos\ncassandra\ncentos\ncustomer\ndata\ndeepspeed\ndemo\ndeploy\ndev\ndeveloper\ndevops\ndocker\ndockeradmin\ndolphinscheduler\nelastic\nelasticsearch\nelk\nelsearch\nemqx\nengineer\nes\nesadmin\nesroot\nesuser\nfa\nftp\nftpuser\ngbase\ngit\ngitlab\ngmod\ngpadmin\nguest\nhadoop\nhalo\nhive\ninspur\njenkins\njumpserver\njupyter\nkubernetes\nlighthouse\nmail\nmapr\nmcserver\nminecraft\nmongodb\nmysql\nnexus\nnginx\nnvidia\nodoo\nodoo15\noracle\noscar\nplex\nposiflex\npostgres\nrancher\nranger\nsatisfactory\nsftp\nsftpuser\nsonar\nsquid\nsteam\nsubbu\nsupport\nteamspeak\ntest\ntester\ntestuser\ntom\ntomcat\nts\nubnt\nubuntu\nuftp\nuser\nuser1\nusername\nuucp\nvagrant\nvpn\nwww\nx\nzjw\n")),(0,r.kt)("h2",p({},{id:"scp-sudo"}),"scp sudo"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),'rsync -avz --rsync-path="sudo rsync" /tmp/test.txt svr:/tmp/\n')),(0,r.kt)("h2",p({},{id:"ssh-root-forward-agent"}),"ssh root forward agent"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"# -E \u4fdd\u7559\u73af\u5883\u53d8\u91cf\nsudo -E -s\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"--preserve-env=SSH_AUTH_SOCK")),(0,r.kt)("h2",p({},{id:"expecting-ssh2_msg_kex_ecdh_reply"}),"expecting SSH2_MSG_KEX_ECDH_REPLY"))}b.isMDXComponent=!0}}]);