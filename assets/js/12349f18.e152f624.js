/*! For license information please see 12349f18.e152f624.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[36112],{20820:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var s=t(2488),r=t(62780);const a={tags:["Kubernetes"]},c="Nats on K8S",o={id:"queue/nats/nats-k8s",title:"Nats on K8S",description:"| port | for       |",source:"@site/../notes/queue/nats/nats-k8s.md",sourceDirName:"queue/nats",slug:"/queue/nats/k8s",permalink:"/notes/queue/nats/k8s",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/queue/nats/nats-k8s.md",tags:[{label:"Kubernetes",permalink:"/notes/tags/kubernetes"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1647510739,formattedLastUpdatedAt:"Mar 17, 2022",frontMatter:{tags:["Kubernetes"]},sidebar:"docs",previous:{title:"NATS JetStream",permalink:"/notes/queue/nats/jetstream"},next:{title:"KV",permalink:"/notes/queue/nats/kv"}},l={},d=[{value:"setup nats resolver",id:"setup-nats-resolver",level:2}];function i(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.M)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"nats-on-k8s",children:"Nats on K8S"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"port"}),(0,s.jsx)(e.th,{children:"for"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"443"}),(0,s.jsx)(e.td,{children:"websocket"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"4222"}),(0,s.jsx)(e.td,{children:"client"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"6222"}),(0,s.jsx)(e.td,{children:"cluster"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"8222"}),(0,s.jsx)(e.td,{children:"monitor"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7777"}),(0,s.jsx)(e.td,{children:"metrics"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7422"}),(0,s.jsx)(e.td,{children:"leafnodes"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7522"}),(0,s.jsx)(e.td,{children:"gateways"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"1883"}),(0,s.jsx)(e.td,{children:"mqtt"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"setup-nats-resolver",children:"setup nats resolver"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/nats-io/k8s/tree/main/helm/charts/nats#nats-resolver-setup-example",children:"https://github.com/nats-io/k8s/tree/main/helm/charts/nats#nats-resolver-setup-example"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",metastring:'title="setup-nsc"',children:'[ -z "$NKEYS_PATH" ] && {\n    export NKEYS_PATH=$(pwd)/nsc/nkeys\n}\n\n[ -z "$NSC_HOME" ] && {\n    export NSC_HOME=$(pwd)/nsc/accounts\n}\n\nif [ ! -f .nsc.env ]; then\n  echo \'\n# NSC Environment Setup\nexport NKEYS_PATH=$(pwd)/nsc/nkeys\nexport NSC_HOME=$(pwd)/nsc/accounts\n\' > .nsc.env\nfi\n\nmkdir -p "$NKEYS_PATH"\nmkdir -p "$NSC_HOME"\nnsc add operator --name KO\n\n# Create system account\nnsc add account --name SYS\nnsc add user    --name sys\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"nsc generate config --sys-account SYS --nats-resolver\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"auth:\n  enabled: true\n\n  timeout: '5s'\n\n  resolver:\n    type: full\n\n    operator: #\n\n    systemAccount: #\n\n    store:\n      dir: '/etc/nats-config/accounts/jwt'\n      size: '1Gi'\n\n    resolverPreload:\n      #: #\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"helm install\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# port forward\nkubectl -n nats port-forward svc/nats 4222:4222\n\n# for JetStream\naccount=JS1\nnsc add account  --name $account\nnsc edit account --name $account --js-disk-storage -1 --js-consumer -1 --js-streams -1\nnsc add user -a $account js-user\n\n# Upload\nnsc push --system-account SYS -u nats://localhost:4222 -A\n# \u6d4b\u8bd5\nnats stream ls -s localhost --creds ./nsc/nkeys/creds/KO/JS1/js-user.creds\n\n# nats protocol\nnsc tool rtt --nats nats://localhost:4222\n# websocket\nnsc tool rtt --nats wss://nats.example.com:443\n"})})]})}function u(n={}){const{wrapper:e}={...(0,r.M)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(i,{...n})}):i(n)}},38088:(n,e,t)=>{var s=t(96651),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(n,e,t){var s,a={},d=null,i=null;for(s in void 0!==t&&(d=""+t),void 0!==e.key&&(d=""+e.key),void 0!==e.ref&&(i=e.ref),e)c.call(e,s)&&!l.hasOwnProperty(s)&&(a[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===a[s]&&(a[s]=e[s]);return{$$typeof:r,type:n,key:d,ref:i,props:a,_owner:o.current}}e.Fragment=a,e.jsx=d,e.jsxs=d},2488:(n,e,t)=>{n.exports=t(38088)},62780:(n,e,t)=>{t.d(e,{I:()=>o,M:()=>c});var s=t(96651);const r={},a=s.createContext(r);function c(n){const e=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);