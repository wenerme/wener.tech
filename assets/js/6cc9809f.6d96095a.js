/*! For license information please see 6cc9809f.6d96095a.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[50947],{22460:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>o,frontMatter:()=>r,metadata:()=>c,toc:()=>h});var i=s(11527),l=s(47214);const r={title:"KeyDB"},d="KeyDB",c={id:"db/kv/keydb",title:"KeyDB",description:"- KeyDB",source:"@site/../notes/db/kv/keydb.md",sourceDirName:"db/kv",slug:"/db/kv/keydb",permalink:"/notes/db/kv/keydb",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/kv/keydb.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1685599201,formattedLastUpdatedAt:"Jun 1, 2023",frontMatter:{title:"KeyDB"},sidebar:"docs",previous:{title:"FoundationDB",permalink:"/notes/db/kv/foundationdb"},next:{title:"KV DB Awesome",permalink:"/notes/db/kv/awesome"}},t={},h=[{value:"Active Replica",id:"active-replica",level:2},{value:"Flash",id:"flash",level:2},{value:"KeyDB vs Redis",id:"keydb-vs-redis",level:2},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",hr:"hr",li:"li",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"keydb",children:"KeyDB"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/Snapchat/KeyDB",children:"KeyDB"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"BSD-3, C++,C"}),"\n",(0,i.jsx)(n.li,{children:"\u591a\u7ebf\u7a0b Redis - IO \u591a\u7ebf\u7a0b\uff0c\u4e8b\u52a1\u5355\u7ebf\u7a0b"}),"\n",(0,i.jsx)(n.li,{children:"ModJS - \u53ef\u4ee5\u901a\u8fc7 V8 \u6269\u5c55"}),"\n",(0,i.jsx)(n.li,{children:"\u540c\u6b65 redis \u6e90\u7801 - \u7248\u672c\u5339\u914d"}),"\n",(0,i.jsx)(n.li,{children:"active-replication, multi-master, flash, s3 backup"}),"\n",(0,i.jsxs)(n.li,{children:["\u88ab Snapchat \u6536\u8d2d - 2022-05-11\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5f00\u6e90\u4f01\u4e1a\u7248\u529f\u80fd v6.3.0\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Active Replication PSYNC"}),"\n",(0,i.jsx)(n.li,{children:"Async Commands - GET, MGET"}),"\n",(0,i.jsx)(n.li,{children:"Async Rehash"}),"\n",(0,i.jsx)(n.li,{children:"In Process Background Saving - fork -> snapshot - \u53ef\u63a7\u5236\u6700\u5927\u5185\u5b58\u4f7f\u7528\u91cf"}),"\n",(0,i.jsx)(n.li,{children:"IStorage Interface - \u672a\u5305\u542b FLASH \u5b58\u50a8\u5b9e\u73b0"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.keydb.dev/docs/coming-soon/",children:"https://docs.keydb.dev/docs/coming-soon/"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Namespaces"}),"\n",(0,i.jsx)(n.li,{children:"JSON"}),"\n",(0,i.jsx)(n.li,{children:"RAFT"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"FLASH \u529f\u80fd\u5927\u7ea6\u5728 2022-09 \u53d1\u5e03"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/EQ-Alpha/ModJS",children:"EQ-Alpha/ModJS"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u57fa\u4e8e V8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u56e0\u4e3a\u652f\u6301\u591a\u7ebf\u7a0b\uff0c\u56e0\u6b64\u4f5c\u4e3a\u5355\u8282\u70b9 KeyDB \u4f1a\u6bd4\u5355\u8282\u70b9 Redis Cluster \u597d\u7ef4\u62a4\u7684\u591a\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Redis 6 I/O \u90e8\u5206\u652f\u6301\u591a\u7ebf\u7a0b"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Multi-Tenancy Support ",(0,i.jsx)(n.a,{href:"https://github.com/EQ-Alpha/KeyDB/issues/286",children:"#286"})]}),"\n",(0,i.jsxs)(n.li,{children:["SET \u6210\u5458, HASH KEY \u652f\u6301 TTL\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"EXPIREMEMBER <key> <subkey> <timeout-in-seconds> <OPTIONAL:unit-time-format>"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"EXPIREMEMBERAT <key> <subkey> <expiration-timestamp>"})}),"\n",(0,i.jsx)(n.li,{children:"PEXPIREMEMBERAT"}),"\n",(0,i.jsxs)(n.li,{children:["\u68c0\u67e5 TTL ",(0,i.jsx)(n.code,{children:"PTTL/TTL <key> <subkey>"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u4e0d\u4f1a\u4ea7\u751f expired \u4e8b\u4ef6 - ",(0,i.jsx)(n.a,{href:"https://github.com/Snapchat/KeyDB/issues/85",children:"#85"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6269\u5c55\u547d\u4ee4\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"KEYDB.CRON name [single/repeat] [optional: start] delay script numkeys [key N] [arg N]"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5468\u671f\u8fd0\u884c lua \u811a\u672c"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"KEYDB.HRENAME key [src hash key] [dst hash key]"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"KEYDB.MEXISTS key [key ...]"})}),"\n",(0,i.jsx)(n.li,{children:"KEYDB.MVCCRESTORE"}),"\n",(0,i.jsx)(n.li,{children:"keydb.nhset,keydb.nhget"}),"\n",(0,i.jsx)(n.li,{children:"stralgo"}),"\n",(0,i.jsx)(n.li,{children:"lfence,failover,reset,"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["2022 Q3 - Redis 7 ",(0,i.jsx)(n.a,{href:"https://github.com/Snapchat/KeyDB/issues/420",children:"#420"})]}),"\n",(0,i.jsxs)(n.li,{children:["WIP JSON - ",(0,i.jsx)(n.a,{href:"https://docs.keydb.dev/docs/coming-soon/",children:"coming-soon"})]}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run -it --rm \\\n  -p 6379:6379 -v $PWD/data:/data \\\n  --name keydb eqalpha/keydb:alpine_x86_64_v6.3.1 keydb-server /etc/keydb/keydb.conf \\\n  --appendonly yes \\\n  --server-threads 2 --requirepass password\n"})}),"\n",(0,i.jsx)(n.h2,{id:"active-replica",children:"Active Replica"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["active-replica yes\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u591a\u526f\u672c\uff0c\u540c\u65f6\u53ef\u8bfb\u5199"}),"\n",(0,i.jsx)(n.li,{children:"\u5355\u4e2a replicaof"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["multi-master yes\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5728\u526f\u672c\u57fa\u7840\u4e0a\u540c\u65f6\u652f\u6301\u540c\u6b65\u591a\u4e2a master \u7684\u6570\u636e"}),"\n",(0,i.jsx)(n.li,{children:"\u914d\u7f6e\u591a\u4e2a replicaof"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["cluster\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u7528\u4e8e\u6570\u636e\u5206\u7247 - \u6bcf\u4e2a\u8282\u70b9\u7684\u6570\u636e\u4e0d\u5bf9\u7b49"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# keydb-1 \u4e0a\u6267\u884c\nreplicaof keydb-0:6379\n# keydb-0 \u4e0a\u6267\u884c\nreplicaof keydb-1:6379\n"})}),"\n",(0,i.jsx)(n.h2,{id:"flash",children:"Flash"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run -d -it -p 6379:6379 \\\n  --mount type=bind,dst=/flash,src=/$PWD/flash/ \\\n  --name keydb eqalpha/keydb keydb-server /etc/keydb/keydb.conf --storage-provider flash /flash --maxmemory 1G --maxmemory-policy allkeys-lfu\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["--maxmemory-policy - \u5355\u8fbe\u5230 maxmemory \u65f6\uff0c\u5982\u4f55\u6e05\u7406\u5185\u5b58\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"noeviction"}),"\n",(0,i.jsx)(n.li,{children:"allkeys-lru"}),"\n",(0,i.jsx)(n.li,{children:"volatile-lru - \u6709\u8bbe\u7f6e expire \u7684 key"}),"\n",(0,i.jsx)(n.li,{children:"allkeys-random"}),"\n",(0,i.jsx)(n.li,{children:"volatile-random"}),"\n",(0,i.jsx)(n.li,{children:"volatile-ttl"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Flash ",(0,i.jsx)(n.a,{href:"https://docs.keydb.dev/docs/flash/",children:"https://docs.keydb.dev/docs/flash/"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"RocksDB on SSD"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u5168\u90e8\u5b58\u5185\u5b58"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u518d\u9700\u8981 Redis \u7684 RDB/AOF"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"keydb-vs-redis",children:"KeyDB vs Redis"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Redis\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IO \u591a\u7ebf\u7a0b"}),"\n",(0,i.jsx)(n.li,{children:"Redis 7 - ACL R/W \u63a7\u5236"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["KeyDB\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IO \u591a\u7ebf\u7a0b"}),"\n",(0,i.jsxs)(n.li,{children:["\u5b9a\u671f Merge Redis \u4e0a\u6e38\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Redis 6 fork - \u76ee\u524d\u5c1a\u672a\u5408\u5e76 Redis 7 \u529f\u80fd"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u517c\u5bb9 Redis \u6269\u5c55 - \u4f46\u53ea\u80fd\u5355\u7ebf\u7a0b\u6267\u884c\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4e3b\u6d41 Redis \u6269\u5c55\u7684\u534f\u8bae\u90fd\u4e0d\u80fd\u5546\u7528 - RedisStack \u7cfb\u5217"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u90e8\u5206\u64cd\u4f5c\u652f\u6301\u5e76\u884c - MVCC"}),"\n",(0,i.jsx)(n.li,{children:"\u90e8\u5206\u64cd\u4f5c\u652f\u6301 ASYNC"}),"\n",(0,i.jsx)(n.li,{children:"\u989d\u5916\u529f\u80fd - HASH Key \u652f\u6301 TTL, CRON"}),"\n",(0,i.jsx)(n.li,{children:"Active Replica - \u4e2a\u4eba\u63a8\u8350"}),"\n",(0,i.jsx)(n.li,{children:"Multi Master - \u4e2a\u4eba\u4e0d\u90a3\u4e48\u63a8\u8350"}),"\n",(0,i.jsx)(n.li,{children:"FLASH \u5b58\u50a8"}),"\n",(0,i.jsx)(n.li,{children:"S3 \u5907\u4efd/\u52a0\u8f7d"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.keydb.dev/docs/migration/",children:"https://docs.keydb.dev/docs/migration/"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.keydb.dev/docs/faq#how-is-keydb-different-than-redis",children:"https://docs.keydb.dev/docs/faq#how-is-keydb-different-than-redis"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.keydb.dev/docs/config-file",children:"https://docs.keydb.dev/docs/config-file"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"# scratch-file-path /tmp/\n\n# yes - replica \u8fd8\u6ca1\u51c6\u5907\u597d\u65f6\u4e5f\u63a5\u53d7\u5ba2\u6237\u7aef\u8bf7\u6c42\n# no - \u8fd4\u56de\u9519\u8bef\u4fe1\u606f\nreplica-serve-stale-data yes\n\n# \u5904\u7406\u8bf7\u6c42\u7684 worker \u7ebf\u7a0b\n# \u53d6\u51b3\u4e8e\u7f51\u7edc\u800c\u4e0d\u662f CPU \u6838\u5fc3\u6570\n# \u5efa\u8bae \u6700\u5927\u4e0d\u8d85\u8fc7 16\uff0c\u6700\u597d\u5c11\u4e8e 8\uff0c\u4e00\u822c 1 \u6216 2 \u5c31\u53ef\u4ee5\u4e86\nserver-threads 1\n\nserver-thread-affinity false\n\nactive-replica no\n"})})]})}function o(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},3354:(e,n,s)=>{var i=s(50959),l=Symbol.for("react.element"),r=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,c=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function h(e,n,s){var i,r={},h=null,a=null;for(i in void 0!==s&&(h=""+s),void 0!==n.key&&(h=""+n.key),void 0!==n.ref&&(a=n.ref),n)d.call(n,i)&&!t.hasOwnProperty(i)&&(r[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===r[i]&&(r[i]=n[i]);return{$$typeof:l,type:e,key:h,ref:a,props:r,_owner:c.current}}n.Fragment=r,n.jsx=h,n.jsxs=h},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>d});var i=s(50959);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);