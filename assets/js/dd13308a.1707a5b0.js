"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[20583],{49613:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(59496);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=a,g=d["".concat(c,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(g,i(i({ref:t},p),{},{components:n})):r.createElement(g,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},65067:function(e,t,n){n.r(t),n.d(t,{assets:function(){return y},contentTitle:function(){return m},default:function(){return k},frontMatter:function(){return d},metadata:function(){return g},toc:function(){return f}});var r=n(49613),a=Object.defineProperty,o=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,p=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))c.call(t,n)&&p(e,n,t[n]);if(s)for(var n of s(t))l.call(t,n)&&p(e,n,t[n]);return e};const d={title:"Decorator"},m="Decorator",g={unversionedId:"web/script/js/js-decorator",id:"web/script/js/js-decorator",title:"Decorator",description:"- \u52a8\u6001\u7c7b\u4e0d\u652f\u6301 Decorator \u8bed\u6cd5, \u4f9d\u8d56\u4ee3\u7801\u751f\u6210",source:"@site/../notes/web/script/js/js-decorator.md",sourceDirName:"web/script/js",slug:"/web/script/js/decorator",permalink:"/notes/web/script/js/decorator",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/script/js/js-decorator.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1693804740,formattedLastUpdatedAt:"Sep 4, 2023",frontMatter:{title:"Decorator"},sidebar:"docs",previous:{title:"JS Cookbook",permalink:"/notes/web/script/js/cookbook"},next:{title:"IO",permalink:"/notes/web/script/js/io"}},y={},f=[{value:"Typescript legacy",id:"typescript-legacy",level:2},{value:"Typescript next",id:"typescript-next",level:2}],v={toc:f};function k(e){var t,n=e,{components:a}=n,p=((e,t)=>{var n={};for(var r in e)c.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&s)for(var r of s(e))t.indexOf(r)<0&&l.call(e,r)&&(n[r]=e[r]);return n})(n,["components"]);return(0,r.kt)("wrapper",(t=u(u({},v),p),o(t,i({components:a,mdxType:"MDXLayout"}))),(0,r.kt)("h1",u({},{id:"decorator"}),"Decorator"),(0,r.kt)("admonition",u({},{type:"caution"}),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"\u52a8\u6001\u7c7b\u4e0d\u652f\u6301 Decorator \u8bed\u6cd5, \u4f9d\u8d56\u4ee3\u7801\u751f\u6210"))),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-js"}),'type Decorator = (value: Input, context: {\n  kind: string;\n  name: string | symbol;\n  access: {\n    get?(): unknown;\n    set?(value: unknown): void;\n  };\n  private?: boolean;\n  static?: boolean;\n  addInitializer?(initializer: () => void): void;\n}) => Output | void;\n\ntype ClassMethodDecorator = (value: Function, context: {\n  kind: "method";\n  name: string | symbol;\n  access: { get(): unknown };\n  static: boolean;\n  private: boolean;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassGetterDecorator = (value: Function, context: {\n  kind: "getter";\n  name: string | symbol;\n  access: { get(): unknown };\n  static: boolean;\n  private: boolean;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassSetterDecorator = (value: Function, context: {\n  kind: "setter";\n  name: string | symbol;\n  access: { set(value: unknown): void };\n  static: boolean;\n  private: boolean;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassFieldDecorator = (value: undefined, context: {\n  kind: "field";\n  name: string | symbol;\n  access: { get(): unknown, set(value: unknown): void };\n  static: boolean;\n  private: boolean;\n}) => (initialValue: unknown) => unknown | void;\n\ntype ClassDecorator = (value: Function, context: {\n  kind: "class";\n  name: string | undefined;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassAutoAccessorDecorator = (\n  value: {\n    get: () => unknown;\n    set: (value: unknown) => void;\n  },\n  context: {\n    kind: "accessor";\n    name: string | symbol;\n    access: { get(): unknown, set(value: unknown): void };\n    static: boolean;\n    private: boolean;\n    addInitializer(initializer: () => void): void;\n  }\n) => {\n  get?: () => unknown;\n  set?: (value: unknown) => void;\n  init?: (initialValue: unknown) => unknown;\n} | void;\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"kind",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"class"),(0,r.kt)("li",{parentName:"ul"},"method"),(0,r.kt)("li",{parentName:"ul"},"getter"),(0,r.kt)("li",{parentName:"ul"},"setter"),(0,r.kt)("li",{parentName:"ul"},"field"),(0,r.kt)("li",{parentName:"ul"},"accessor"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Symbol.annotations")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://github.com/tc39/proposal-decorators"}),"proposal-decorators")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-5-0/#decorators"}),"typescript 5.0 decorators"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u6ca1\u6709 ",(0,r.kt)("inlineCode",{parentName:"li"},"--experimentalDecorators")," flag",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4e5f\u80fd\u7528"),(0,r.kt)("li",{parentName:"ul"},"\u751f\u6210\u903b\u8f91\u4e0d\u540c"),(0,r.kt)("li",{parentName:"ul"},"\u6709\u7c7b\u578b\u68c0\u67e5"))),(0,r.kt)("li",{parentName:"ul"},"\u65b0\u7684\u903b\u8f91\u4e0d\u652f\u6301 ",(0,r.kt)("inlineCode",{parentName:"li"},"--emitDecoratorMetadata"))))),(0,r.kt)("h2",u({},{id:"typescript-legacy"}),"Typescript legacy"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ts"}),"declare type ClassDecorator = <TFunction extends Function>(target: TFunction) => TFunction | void;\ndeclare type PropertyDecorator = (target: Object, propertyKey: string | symbol) => void;\ndeclare type MethodDecorator = <T>(\n  target: Object,\n  propertyKey: string | symbol,\n  descriptor: TypedPropertyDescriptor<T>,\n) => TypedPropertyDescriptor<T> | void;\ndeclare type ParameterDecorator = (\n  target: Object,\n  propertyKey: string | symbol | undefined,\n  parameterIndex: number,\n) => void;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ts"}),"const ExposeService = (): ClassDecorator => (target) => target;\nconst ExposeMethod = (): MethodDecorator => (target) => target;\nconst ExposeField = (): PropertyDecorator => (target) => target;\n\n@ExposeService()\nclass MyService {\n  @ExposeField()\n  url: string = 'https://wener.me';\n\n  @ExposeMethod()\n  hello(name: string): string | undefined {\n    return '';\n  }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-js"}),"'use strict';\nvar __decorate =\n  (this && this.__decorate) ||\n  function (decorators, target, key, desc) {\n    var c = arguments.length,\n      r = c < 3 ? target : desc === null ? (desc = Object.getOwnPropertyDescriptor(target, key)) : desc,\n      d;\n    if (typeof Reflect === 'object' && typeof Reflect.decorate === 'function')\n      r = Reflect.decorate(decorators, target, key, desc);\n    else\n      for (var i = decorators.length - 1; i >= 0; i--)\n        if ((d = decorators[i])) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n  };\nvar __metadata =\n  (this && this.__metadata) ||\n  function (k, v) {\n    if (typeof Reflect === 'object' && typeof Reflect.metadata === 'function') return Reflect.metadata(k, v);\n  };\nconst ExposeService = () => (target) => target;\nconst ExposeMethod = () => (target) => target;\nconst ExposeField = () => (target) => target;\nlet MyService = class MyService {\n  constructor() {\n    this.url = 'https://wener.me';\n  }\n  hello(name) {\n    return '';\n  }\n};\n__decorate([ExposeField(), __metadata('design:type', String)], MyService.prototype, 'url', void 0);\n__decorate(\n  [\n    ExposeMethod(),\n    __metadata('design:type', Function),\n    __metadata('design:paramtypes', [String]),\n    __metadata('design:returntype', Object),\n  ],\n  MyService.prototype,\n  'hello',\n  null,\n);\nMyService = __decorate([ExposeService()], MyService);\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"emitDecoratorMetadata"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://www.typescriptlang.org/play?experimentalDecorators=true&emitDecoratorMetadata=true&target=99&ts=5.2.2#code/MYewdgzgLgBAogDwA4ggUwMpoE4DcCWwaMAvDABQCUAXAMIA2AhhBACJqjaNQjYkB85KI2wBzNFEoDhYiQG4AsAChlAAUQp0WPITRVlwJixgBZAJ7aCRAN4BfZUA"}),"Playground"))),(0,r.kt)("h2",u({},{id:"typescript-next"}),"Typescript next"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ts"}),"const ExposeService = () => (value: any, ctx: ClassDecoratorContext) => {};\nconst ExposeMethod = () => (value: any, ctx: ClassMethodDecoratorContext) => {};\nconst ExposeField = () => (value: any, ctx: ClassFieldDecoratorContext) => {};\n\n@ExposeService()\nclass MyService {\n  @ExposeField()\n  url: string = 'https://wener.me';\n\n  @ExposeMethod()\n  hello(name: string): string | undefined {\n    return '';\n  }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-js"}),"'use strict';\nvar __esDecorate =\n  (this && this.__esDecorate) ||\n  function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n    function accept(f) {\n      if (f !== void 0 && typeof f !== 'function') throw new TypeError('Function expected');\n      return f;\n    }\n    var kind = contextIn.kind,\n      key = kind === 'getter' ? 'get' : kind === 'setter' ? 'set' : 'value';\n    var target = !descriptorIn && ctor ? (contextIn['static'] ? ctor : ctor.prototype) : null;\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n    var _,\n      done = false;\n    for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === 'access' ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) {\n        if (done) throw new TypeError('Cannot add initializers after decoration has completed');\n        extraInitializers.push(accept(f || null));\n      };\n      var result = (0, decorators[i])(\n        kind === 'accessor' ? { get: descriptor.get, set: descriptor.set } : descriptor[key],\n        context,\n      );\n      if (kind === 'accessor') {\n        if (result === void 0) continue;\n        if (result === null || typeof result !== 'object') throw new TypeError('Object expected');\n        if ((_ = accept(result.get))) descriptor.get = _;\n        if ((_ = accept(result.set))) descriptor.set = _;\n        if ((_ = accept(result.init))) initializers.unshift(_);\n      } else if ((_ = accept(result))) {\n        if (kind === 'field') initializers.unshift(_);\n        else descriptor[key] = _;\n      }\n    }\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\n    done = true;\n  };\nvar __runInitializers =\n  (this && this.__runInitializers) ||\n  function (thisArg, initializers, value) {\n    var useValue = arguments.length > 2;\n    for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n    }\n    return useValue ? value : void 0;\n  };\nconst ExposeService = () => (value, ctx) => {};\nconst ExposeMethod = () => (value, ctx) => {};\nconst ExposeField = () => (value, ctx) => {};\nlet MyService = (() => {\n  let _classDecorators = [ExposeService()];\n  let _classDescriptor;\n  let _classExtraInitializers = [];\n  let _classThis;\n  let _instanceExtraInitializers = [];\n  let _url_decorators;\n  let _url_initializers = [];\n  let _hello_decorators;\n  var MyService = class {\n    static {\n      _classThis = this;\n    }\n    constructor() {\n      this.url =\n        (__runInitializers(this, _instanceExtraInitializers),\n        __runInitializers(this, _url_initializers, 'https://wener.me'));\n    }\n    static {\n      const _metadata = typeof Symbol === 'function' && Symbol.metadata ? Object.create(null) : void 0;\n      _url_decorators = [ExposeField()];\n      _hello_decorators = [ExposeMethod()];\n      __esDecorate(\n        this,\n        null,\n        _hello_decorators,\n        {\n          kind: 'method',\n          name: 'hello',\n          static: false,\n          private: false,\n          access: { has: (obj) => 'hello' in obj, get: (obj) => obj.hello },\n          metadata: _metadata,\n        },\n        null,\n        _instanceExtraInitializers,\n      );\n      __esDecorate(\n        null,\n        null,\n        _url_decorators,\n        {\n          kind: 'field',\n          name: 'url',\n          static: false,\n          private: false,\n          access: {\n            has: (obj) => 'url' in obj,\n            get: (obj) => obj.url,\n            set: (obj, value) => {\n              obj.url = value;\n            },\n          },\n          metadata: _metadata,\n        },\n        _url_initializers,\n        _instanceExtraInitializers,\n      );\n      __esDecorate(\n        null,\n        (_classDescriptor = { value: _classThis }),\n        _classDecorators,\n        { kind: 'class', name: _classThis.name, metadata: _metadata },\n        null,\n        _classExtraInitializers,\n      );\n      MyService = _classThis = _classDescriptor.value;\n      if (_metadata)\n        Object.defineProperty(_classThis, Symbol.metadata, {\n          enumerable: true,\n          configurable: true,\n          writable: true,\n          value: _metadata,\n        });\n      __runInitializers(_classThis, _classExtraInitializers);\n    }\n    hello(name) {\n      return '';\n    }\n  };\n  return (MyService = _classThis);\n})();\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://www.typescriptlang.org/play?target=99&ts=5.2.2&ssl=15&ssc=1&pln=1&pc=1&emitDecoratorMetadata=true&experimentalDecorators=true#code/MYewdgzgLgBAogDwA4ggUwMpoE4DcCWwaMAvDABQCUJAfObgIYA2ArmgFwNgCeANMFATsAwkwYQIAETShsDKCGzDwUNAijUaAbwC+AbgCwAKFCRYiFOgCyaKAAsQAE1IVN9Zm049+gkWIk29k7SsvKKymCq6pq6hibg0PDIqGgAYvhoTM5kVLTurBxcfAJCouIQ6ZmOIYphSipqGrSxxsYAAhYpWHiEaFTGwP4QMFbc3QREWsYwMzAdyeiVWf1GszAs2Ezs0Nj4YADmLgDkdlBQSBDsAPRXAO5oYDgAdAC2aEetq7PzlmiBDo4Vms7JkmCByGAGG9tlBdgdKDC4fsAD4sMCONAAMz2aEcUy+axm2FsGzAMCOHwJMB0xhpRiAA"}),"https://www.typescriptlang.org/play?target=99&ts=5.2.2&ssl=15&ssc=1&pln=1&pc=1&emitDecoratorMetadata=true&experimentalDecorators=true#code/MYewdgzgLgBAogDwA4ggUwMpoE4DcCWwaMAvDABQCUJAfObgIYA2ArmgFwNgCeANMFATsAwkwYQIAETShsDKCGzDwUNAijUaAbwC+AbgCwAKFCRYiFOgCyaKAAsQAE1IVN9Zm049+gkWIk29k7SsvKKymCq6pq6hibg0PDIqGgAYvhoTM5kVLTurBxcfAJCouIQ6ZmOIYphSipqGrSxxsYAAhYpWHiEaFTGwP4QMFbc3QREWsYwMzAdyeiVWf1GszAs2Ezs0Nj4YADmLgDkdlBQSBDsAPRXAO5oYDgAdAC2aEetq7PzlmiBDo4Vms7JkmCByGAGG9tlBdgdKDC4fsAD4sMCONAAMz2aEcUy+axm2FsGzAMCOHwJMB0xhpRiAA"))))}k.isMDXComponent=!0}}]);