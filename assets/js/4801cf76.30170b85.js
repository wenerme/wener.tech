/*! For license information please see 4801cf76.30170b85.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[5736],{86748:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var r=s(2488),t=s(62780);const i={title:"Nginx Ingress \u5e38\u89c1\u95ee\u9898",tags:["FAQ"]},o="Nginx Ingress \u5e38\u89c1\u95ee\u9898",a={id:"devops/kubernetes/network/nginx-ingress-faq",title:"Nginx Ingress \u5e38\u89c1\u95ee\u9898",description:"\u6cdb\u57df\u540d Host \u8def\u7531",source:"@site/../notes/devops/kubernetes/network/nginx-ingress-faq.md",sourceDirName:"devops/kubernetes/network",slug:"/devops/kubernetes/network/nginx-ingress-faq",permalink:"/notes/devops/kubernetes/network/nginx-ingress-faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/network/nginx-ingress-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1639042977,formattedLastUpdatedAt:"Dec 9, 2021",frontMatter:{title:"Nginx Ingress \u5e38\u89c1\u95ee\u9898",tags:["FAQ"]},sidebar:"docs",previous:{title:"MetalLB",permalink:"/notes/devops/kubernetes/network/metallb"},next:{title:"nginx-ingress version",permalink:"/notes/devops/kubernetes/network/nginx-ingress-version"}},l={},c=[{value:"\u6cdb\u57df\u540d Host \u8def\u7531",id:"\u6cdb\u57df\u540d-host-\u8def\u7531",level:2},{value:"\u6b63\u5219\u8def\u5f84\u5339\u914d",id:"\u6b63\u5219\u8def\u5f84\u5339\u914d",level:2},{value:"SSL Passthrough",id:"ssl-passthrough",level:2},{value:"HTTPS SNI \u8def\u7531",id:"https-sni-\u8def\u7531",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"nginx-ingress-\u5e38\u89c1\u95ee\u9898",children:"Nginx Ingress \u5e38\u89c1\u95ee\u9898"}),"\n",(0,r.jsx)(n.h2,{id:"\u6cdb\u57df\u540d-host-\u8def\u7531",children:"\u6cdb\u57df\u540d Host \u8def\u7531"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"annotations:\n  # \u53ea\u652f\u6301\u4e00\u6761 rule - \u53ef\u8003\u8651\u62c6\u5206 ingress\n  nginx.ingress.kubernetes.io/server-alias: '*.my-company.com'\n  #ingress.kubernetes.io/server-alias: '*.my-company.com'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6b63\u5219\u8def\u5f84\u5339\u914d",children:"\u6b63\u5219\u8def\u5f84\u5339\u914d"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: test-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/use-regex: 'true'\nspec:\n  rules:\n    - host: test.com\n      http:\n        paths:\n          - path: /foo/.*\n            backend:\n              serviceName: test\n              servicePort: 80\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ssl-passthrough",children:"SSL Passthrough"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u9ed8\u8ba4\u5173\u95ed - ",(0,r.jsx)(n.code,{children:"--enable-ssl-passthrough"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u901a\u8fc7\u62e6\u622a 443 \u7aef\u53e3\u5230\u672c\u5730 TCP \u4ee3\u7406, bypass NGINX, \u6027\u80fd\u5f71\u54cd\u5f88\u5927\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u672c\u5730\u4ee3\u7406\u7aef\u53e3 442"}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679c hostname \u672a\u88ab\u5904\u7406\u5219\u53c8\u4ea4\u7531 NGINX \u5904\u7406"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"\u900f\u4f20\u662f\u53d1\u9001\u5230 service \u800c\u4e0d\u662f\u72ec\u7acb\u7684 endpoint"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/ingress-nginx/issues/5686",children:"#5686"})," - \u53ef\u80fd\u5f00\u542f\u4e86\u4e5f\u4e0d\u751f\u6548"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# HELM values\ncontroller:\n  extraArgs:\n    enable-ssl-passthrough: true\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4f7f\u7528\u65b9\u5f0f"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"annotations:\n  nginx.ingress.kubernetes.io/ssl-passthrough: 'true'\n  nginx.ingress.kubernetes.io/backend-protocol: 'HTTPS'\n  kubernetes.io/ingress.allow-http: 'false'\n  nginx.ingress.kubernetes.io/secure-backends: 'true'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"https-sni-\u8def\u7531",children:"HTTPS SNI \u8def\u7531"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# \u76f8\u5173\u914d\u7f6e\n# https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#backend-certificate-authentication\nannotations:\n  # \u4fee\u6539 SNI\n  nginx.ingress.kubernetes.io/proxy-ssl-name: wener.me\n  nginx.ingress.kubernetes.io/proxy-ssl-protocols: HTTPS\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/kubernetes/issues/19333",children:"kubernetes/kubernetes#19333"})," - HTTPS Ingress controller for SNI based routing"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#ssl-passthrough",children:"ssl-passthrough"})}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},38088:(e,n,s)=>{var r=s(96651),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,s){var r,i={},c=null,u=null;for(r in void 0!==s&&(c=""+s),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(u=n.ref),n)o.call(n,r)&&!l.hasOwnProperty(r)&&(i[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===i[r]&&(i[r]=n[r]);return{$$typeof:t,type:e,key:c,ref:u,props:i,_owner:a.current}}n.Fragment=i,n.jsx=c,n.jsxs=c},2488:(e,n,s)=>{e.exports=s(38088)},62780:(e,n,s)=>{s.d(n,{I:()=>a,M:()=>o});var r=s(96651);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);