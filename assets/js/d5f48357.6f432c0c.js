/*! For license information please see d5f48357.6f432c0c.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[35818],{93109:(i,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var e=r(11527),t=r(47214);const s={title:"Libvirt"},l="Libvirt",o={id:"os/virt/libvirt/README",title:"Libvirt",description:"Tips",source:"@site/../notes/os/virt/libvirt/README.md",sourceDirName:"os/virt/libvirt",slug:"/os/virt/libvirt/",permalink:"/notes/os/virt/libvirt/",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/virt/libvirt/README.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1667482099,formattedLastUpdatedAt:"Nov 3, 2022",frontMatter:{title:"Libvirt"},sidebar:"docs",previous:{title:"KSM",permalink:"/notes/os/virt/ksm"},next:{title:"Libvirt Domain",permalink:"/notes/os/virt/libvirt/dom"}},a={},c=[{value:"Tips",id:"tips",level:2},{value:"\u9a71\u52a8",id:"\u9a71\u52a8",level:2},{value:"invalid argument: Failed to parse user &#39;qemu&#39;",id:"invalid-argument-failed-to-parse-user-qemu",level:2},{value:"XML",id:"xml",level:2},{value:"virt-install",id:"virt-install",level:2}];function h(i){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...i.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.h1,{id:"libvirt",children:"Libvirt"}),"\n",(0,e.jsx)(n.h2,{id:"tips",children:"Tips"}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:"https://github.com/libvirt/libvirt",children:"libvirt/libvirt"}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:"\u7ed1\u5b9a: c#, go, java, ocaml. perl, python, php, ruby"}),"\n",(0,e.jsx)(n.li,{children:"API \u5206\u4e3a: common, domain, domain snapshot, error, event, host, interface, network, node device, network filter, secret, storage, stream"}),"\n"]}),"\n"]}),"\n",(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:"https://libvirt.org/drivers.html",children:"libvirt"}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:"LXC \u2013 Linux Container - \u5bb9\u5668"}),"\n",(0,e.jsx)(n.li,{children:"OpenVZ \u2013 lightweight Linux container system"}),"\n",(0,e.jsx)(n.li,{children:"Kernel-based Virtual Machine/QEMU (KVM) \u2013 open source hypervisor for Linux and SmartOS"}),"\n",(0,e.jsx)(n.li,{children:"Xen \u2013 Bare-Metal hypervisor"}),"\n",(0,e.jsx)(n.li,{children:"User-mode Linux (UML) paravirtualized kernel"}),"\n",(0,e.jsx)(n.li,{children:"VirtualBox \u2013 hypervisor by Oracle (formerly Sun) for Windows, Linux, Mac OS X, and Solaris"}),"\n",(0,e.jsx)(n.li,{children:"VMware ESX and GSX \u2013 hypervisors for Intel hardware"}),"\n",(0,e.jsx)(n.li,{children:"VMware Workstation and Player \u2013 hypervisors for Windows and Linux"}),"\n",(0,e.jsx)(n.li,{children:"Hyper-V \u2013 hypervisor for Windows by Microsoft"}),"\n",(0,e.jsx)(n.li,{children:"PowerVM \u2013 hypervisor by IBM for AIX, Linux and IBM i"}),"\n",(0,e.jsx)(n.li,{children:"Parallels Workstation \u2013 hypervisor for Mac by Parallels IP Holdings GmbH"}),"\n",(0,e.jsx)(n.li,{children:"Bhyve \u2013 hypervisor for FreeBSD 10+."}),"\n"]}),"\n"]}),"\n",(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:"https://wiki.libvirt.org/page/QEMUSwitchToLibvirt",children:"QEMUSwitchToLibvirt"})}),"\n",(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:"https://wiki.libvirt.org/page/UbuntuKVMWalkthrough",children:"UbuntuKVMWalkthrough"})}),"\n",(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:"https://gist.github.com/itzg/2577205f2036f787a2bd876ae458e18e",children:"libvirt cloud-init with static networking"})}),"\n",(0,e.jsxs)(n.li,{children:["\u6982\u5ff5 - ",(0,e.jsx)(n.a,{href:"https://libvirt.org/api.html",children:"API"}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:["domain\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:"Guest Host"}),"\n"]}),"\n"]}),"\n",(0,e.jsx)(n.li,{children:"network"}),"\n",(0,e.jsx)(n.li,{children:"storage pool"}),"\n",(0,e.jsx)(n.li,{children:"storage volume"}),"\n"]}),"\n"]}),"\n",(0,e.jsxs)(n.li,{children:["\u95ee\u9898\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:["libvirtd \u672a\u6b63\u5e38\u5173\u95ed\u5bfc\u81f4 hang - 6.6.0 \u5e94\u8be5\u4f1a\u4fee\u590d\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:"https://gitlab.alpinelinux.org/alpine/aports/-/issues/11602",children:"alpine/aports#11602"})}),"\n",(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:"https://gitlab.com/libvirt/libvirt/-/issues/52",children:"libvirt/libvirt#52"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:"https://pkgs.alpinelinux.org/contents?branch=edge&name=libvirt-client&arch=x86_64&repo=community",children:"libvirt-client"})}),"\n"]}),"\n",(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:"language-bash",children:"# macOS\n# \u5b89\u88c5 vbox\nbrew install libvirt\n\n# alpine\napk add virt-install\n\n# \u68c0\u6d4b\u5bbf\u4e3b\u673a\u652f\u6301\u60c5\u51b5\nvirt-host-validate\n\n# \u542f\u52a8\u670d\u52a1\u8fdb\u7a0b\nlibvirtd -v\n\n# \u5ba2\u6237\u7aef\u8fde\u63a5\n# https://libvirt.org/uri.html\n# https://libvirt.org/remote.html\nvirsh -c vbox:///session\n# \u65e5\u5fd7\u63a7\u5236\nLIBVIRT_LOG_FILTERS=1:vbox virsh -c vbox:///session\n# export LIBVIRT_DEFAULT_URI=\"qemu+ssh://root@192.168.1.100/system\"\nvirsh -c 'qemu+ssh://root@192.168.1.2/system'\n\n# \u95ee\u9898\u6392\u67e5\n# user \u4f1a\u4f7f\u7528 /usr/local/var/run/libvirt/libvirt-sock\nLIBVIRT_LOG_FILTERS=1:* virsh -c 'qemu+ssh://admin@192.168.1.2/system' list\n# \u4fee\u6539\u4f7f\u7528\u7684 socket\nvirsh -c 'qemu+ssh://admin@192.168.1.2/system?socket=/var/run/libvirt/libvirt-sock' list\n\n# user \u4f1a\u4f7f\u7528 /usr/local/var/run/libvirt/libvirt-sock\nvirsh -c 'unix+ssh://admin@192.168.1.2/run/libvirt/libvirt-sock' list\n# \u5982\u679c\u662f\u975e root\uff0c\u5148\u9a8c\u8bc1\u80fd\u8bbf\u95ee\nvirsh -c unix:///run/libvirt/libvirt-sock list\n# \u53ef\u4ee5\u8f6c\u53d1 unix socket\nssh -R /run/libvirt/libvirt-sock:127.0.0.1:16509 admin@192.168.1.2 -Nv\n\nexport VIRSH_DEFAULT_CONNECT_URI=qemu:///system\nvirsh list --all\n\n# \u865a\u62df\u673a\u5217\u8868\nvirsh list\n\n# https://wiki.libvirt.org/page/SSHSetup\necho 'unix_sock_group = \"libvirt\"' >> /etc/libvirt/libvirtd.conf\necho 'unix_sock_rw_perms = \"0770\"' >> /etc/libvirt/libvirtd.conf\nusermod -G libvirt -a $USER\nrc-service libvirtd restart\n\nvirsh -c qemu+ssh://username@hostname/system\n"})}),"\n",(0,e.jsx)(n.h2,{id:"\u9a71\u52a8",children:"\u9a71\u52a8"}),"\n",(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:"https://pkgs.alpinelinux.org/contents?file=&path=%2Fusr%2Flib%2Flibvirt%2Fconnection-driver&name=&branch=edge&arch=x86_64",children:"https://pkgs.alpinelinux.org/contents?file=&path=%2Fusr%2Flib%2Flibvirt%2Fconnection-driver&name=&branch=edge&arch=x86_64"})}),"\n",(0,e.jsx)(n.h2,{id:"invalid-argument-failed-to-parse-user-qemu",children:"invalid argument: Failed to parse user 'qemu'"}),"\n",(0,e.jsx)(n.h2,{id:"xml",children:"XML"}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:"https://libvirt.org/format.html",children:"https://libvirt.org/format.html"})}),"\n"]}),"\n",(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:"virt-xml-validate /path/to/XML/file\n"})}),"\n",(0,e.jsx)(n.h2,{id:"virt-install",children:"virt-install"}),"\n",(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:"language-bash",children:'virt-install --virt-type kvm --name xp \\\n  --location http://httpredir.debian.org/debian/dists/squeeze/main/installer-amd64/ \\\n  --extra-args "console=ttyS0" -v --os-variant debiansqueeze \\\n  --disk size=4 --memory 512\n-n xp --vcpus 2 --import winxp\n'})}),"\n",(0,e.jsxs)(n.p,{children:["virt-install ",(0,e.jsx)(n.br,{}),"\n--connect qemu:///system ",(0,e.jsx)(n.br,{}),"\n--virt-type qemu ",(0,e.jsx)(n.br,{}),"\n--name demo ",(0,e.jsx)(n.br,{}),"\n--ram 500 ",(0,e.jsx)(n.br,{}),"\n--graphics vnc ",(0,e.jsx)(n.br,{}),"\n--disk path=/root/alp.qcow2 ",(0,e.jsx)(n.br,{}),"\n--cdrom /root/alpine-standard-3.8.0-x86_64.iso ",(0,e.jsx)(n.br,{}),"\n--os-variant=generic ",(0,e.jsx)(n.br,{}),"\n--dry-run --print-xml"]}),"\n",(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:"https://wiki.debian.org/KVM",children:"https://wiki.debian.org/KVM"})}),"\n",(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:"Usage:\n  libvirtd [options]\n\nOptions:\n  -h | --help            Display program help:\n  -v | --verbose         Verbose messages.\n  -d | --daemon          Run as a daemon & write PID file.\n  -l | --listen          Listen for TCP/IP connections.\n  -t | --timeout <secs>  Exit after timeout period.\n  -f | --config <file>   Configuration file.\n  -V | --version         Display version information.\n  -p | --pid-file <file> Change name of PID file.\n\nlibvirt management daemon:\n\n  Default paths:\n\n    Configuration file (unless overridden by -f):\n      $XDG_CONFIG_HOME/libvirt/libvirtd.conf\n\n    Sockets:\n      $XDG_RUNTIME_DIR/libvirt/libvirt-sock\n\n    TLS:\n      CA certificate:     $HOME/.pki/libvirt/cacert.pem\n      Server certificate: $HOME/.pki/libvirt/servercert.pem\n      Server private key: $HOME/.pki/libvirt/serverkey.pem\n\n    PID file:\n      $XDG_RUNTIME_DIR/libvirt/libvirtd.pid\n"})}),"\n",(0,e.jsx)(n.p,{children:"virsh -c qemu+ssh://root@127.0.0.1:2222/system?socket=/var/run/libvirt/libvirt-sock list --all"}),"\n",(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:"http://rabexc.org/posts/how-to-get-started-with-libvirt-on",children:"http://rabexc.org/posts/how-to-get-started-with-libvirt-on"})}),"\n",(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:"https://libvirt.org/formatdomain.html",children:"https://libvirt.org/formatdomain.html"})}),"\n",(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:"language-conf",children:'listen_tls = 0\nlisten_tcp=1\nauth_tcp="none"\n\n\nunix_sock_dir = "/usr/local/var/run/libvirt"\nunix_sock_ro_perms = "0777"\nunix_sock_rw_perms = "0770"\n\nauth_unix_ro = "none"\nauth_unix_rw = "none"\n'})})]})}function d(i={}){const{wrapper:n}={...(0,t.a)(),...i.components};return n?(0,e.jsx)(n,{...i,children:(0,e.jsx)(h,{...i})}):h(i)}},3354:(i,n,r)=>{var e=r(50959),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(i,n,r){var e,s={},c=null,h=null;for(e in void 0!==r&&(c=""+r),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(h=n.ref),n)l.call(n,e)&&!a.hasOwnProperty(e)&&(s[e]=n[e]);if(i&&i.defaultProps)for(e in n=i.defaultProps)void 0===s[e]&&(s[e]=n[e]);return{$$typeof:t,type:i,key:c,ref:h,props:s,_owner:o.current}}n.Fragment=s,n.jsx=c,n.jsxs=c},11527:(i,n,r)=>{i.exports=r(3354)},47214:(i,n,r)=>{r.d(n,{Z:()=>o,a:()=>l});var e=r(50959);const t={},s=e.createContext(t);function l(i){const n=e.useContext(s);return e.useMemo((function(){return"function"==typeof i?i(n):{...n,...i}}),[n,i])}function o(i){let n;return n=i.disableParentContext?"function"==typeof i.components?i.components(t):i.components||t:l(i.components),e.createElement(s.Provider,{value:n},i.children)}}}]);