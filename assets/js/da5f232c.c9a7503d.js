"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[15760],{49613:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return k}});var n=a(59496);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function u(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,m=u(e,["components","mdxType","originalType","parentName"]),c=p(a),k=l,N=c["".concat(o,".").concat(k)]||c[k]||s[k]||r;return a?n.createElement(N,i(i({ref:t},m),{},{components:a})):n.createElement(N,i({ref:t},m))}));function k(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=a.length,i=new Array(r);i[0]=c;var u={};for(var o in t)hasOwnProperty.call(t,o)&&(u[o]=t[o]);u.originalType=e,u.mdxType="string"==typeof e?e:l,i[1]=u;for(var p=2;p<r;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},15436:function(e,t,a){a.r(t),a.d(t,{assets:function(){return d},contentTitle:function(){return k},default:function(){return f},frontMatter:function(){return c},metadata:function(){return N},toc:function(){return h}});var n=a(49613),l=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,t,a)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,s=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&m(e,a,t[a]);if(u)for(var a of u(t))p.call(t,a)&&m(e,a,t[a]);return e};const c={title:"ClickHouse"},k="ClickHouse",N={unversionedId:"db/column/clickhouse",id:"db/column/clickhouse",title:"ClickHouse",description:"- yandex/ClickHouse",source:"@site/../notes/db/column/clickhouse.md",sourceDirName:"db/column",slug:"/db/column/clickhouse",permalink:"/notes/db/column/clickhouse",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/column/clickhouse.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1664328487,formattedLastUpdatedAt:"Sep 28, 2022",frontMatter:{title:"ClickHouse"},sidebar:"docs",previous:{title:"Apache Cassandra",permalink:"/notes/db/column/cassandra"},next:{title:"DuckDB",permalink:"/notes/db/column/duckdb"}},d={},h=[{value:"Note",id:"note",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"Notes",id:"notes",level:2},{value:"\u6570\u636e\u7c7b\u578b",id:"\u6570\u636e\u7c7b\u578b",level:2},{value:"Table Engine",id:"table-engine",level:2},{value:"MergeTree",id:"mergetree",level:2},{value:"Log",id:"log",level:2},{value:"\u96c6\u6210\u5f15\u64ce",id:"\u96c6\u6210\u5f15\u64ce",level:3},{value:"\u7279\u6b8a\u5f15\u64ce",id:"\u7279\u6b8a\u5f15\u64ce",level:3},{value:"\u8fd0\u7ef4",id:"\u8fd0\u7ef4",level:2},{value:"Auth",id:"auth",level:3},{value:"Stats",id:"stats",level:2},{value:"formats",id:"formats",level:2},{value:"config.xml",id:"configxml",level:2},{value:"\u5220\u9664",id:"\u5220\u9664",level:2},{value:"\u5bfc\u51fa\u6570\u636e",id:"\u5bfc\u51fa\u6570\u636e",level:2},{value:"\u5bfc\u5165\u6570\u636e",id:"\u5bfc\u5165\u6570\u636e",level:2}],g={toc:h};function f(e){var t,a=e,{components:l}=a,m=((e,t)=>{var a={};for(var n in e)o.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&u)for(var n of u(e))t.indexOf(n)<0&&p.call(e,n)&&(a[n]=e[n]);return a})(a,["components"]);return(0,n.kt)("wrapper",(t=s(s({},g),m),r(t,i({components:l,mdxType:"MDXLayout"}))),(0,n.kt)("h1",s({},{id:"clickhouse"}),"ClickHouse"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://github.com/yandex/ClickHouse"}),"yandex/ClickHouse"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Apache-2.0, C++"),(0,n.kt)("li",{parentName:"ul"},"OLAP, \u5217\u5b58\u50a8",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u6bcf\u5217\u5b58\u4e00\u4e2a\u6587\u4ef6"))),(0,n.kt)("li",{parentName:"ul"},"\u652f\u6301 Key \u8bbf\u95ee"))),(0,n.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u5e93 default"),(0,n.kt)("li",{parentName:"ul"},"DataGrip \u53ef\u4ee5\u4f7f\u7528 JDBC \u8fde\u63a5"),(0,n.kt)("li",{parentName:"ul"},"\u9002\u7528\u573a\u666f",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5e94\u7528\u3001\u7cfb\u7edf\u65e5\u5fd7"),(0,n.kt)("li",{parentName:"ul"},"timeseries-oriented"))),(0,n.kt)("li",{parentName:"ul"},"\u7aef\u53e3",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"8123 HTTP"),(0,n.kt)("li",{parentName:"ul"},"9000 native client"))),(0,n.kt)("li",{parentName:"ul"},"\u53c2\u8003",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://clickhouse.yandex/docs/en/single/"}),"\u5355\u9875\u6587\u6863")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://en.wikipedia.org/wiki/ClickHouse"}),"wiki/ClickHouse")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://clickhouse.yandex/"}),"clickhouse.yandex")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://clickhouse.yandex/docs/en/development/architecture/"}),"https://clickhouse.yandex/docs/en/development/architecture/")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://github.com/Altinity/clickhouse-operator"}),"Altinity/clickhouse-operator")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://clickhouse.com/docs/en/operations/tips/"}),"Usage Recommendations")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://clickhouse.com/docs/en/operations/requirements/"}),"Requirements")),(0,n.kt)("li",{parentName:"ul"},"Why",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://eng.uber.com/logging/"}),"Fast and Reliable Schema-Agnostic Log Analytics Platform"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Uber, ES -> ClickHouse"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://tech.ebayinc.com/engineering/ou-online-analytical-processing/"}),"Our Online Analytical Processing Journey with ClickHouse on Kubernetes"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"ebay, Druid -> ClickHouse"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://blog.cloudflare.com/http-analytics-for-6m-requests-per-second-using-clickhouse/"}),"HTTP Analytics for 6M requests per second using ClickHouse"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"cloudflare, PostgreSQL+Citus -> ClickHouse"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://www.nedmcclain.com/why-devops-love-clickhouse/amp/"}),"https://www.nedmcclain.com/why-devops-love-clickhouse/amp/"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u63a8\u8350 ext4 \u800c\u975e zfs"))),(0,n.kt)("li",{parentName:"ul"},"ClickHouse as an alternative to Elasticsearch for log storage and analysis ",(0,n.kt)("a",s({parentName:"li"},{href:"https://news.ycombinator.com/item?id=26316401"}),"HN")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://www.youtube.com/watch?v=pZkKsfr8n3M"}),"A Practical Introduction to Handling Log Data in ClickHouse"))))))),(0,n.kt)("admonition",s({},{type:"tip"}),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"immutable data"),(0,n.kt)("li",{parentName:"ul"},"\u6682\u4e0d\u652f\u6301 UDF"),(0,n.kt)("li",{parentName:"ul"},"\u5f53\u6570\u636e\u91cf\u8f83\u5c11(< 1TB)\u65f6\u4e0d\u5efa\u8bae\u4f7f\u7528"),(0,n.kt)("li",{parentName:"ul"},"\u63d2\u5165\u64cd\u4f5c\u975e\u5e38\u5feb - \u56e0\u4e3a\u662f\u5f02\u6b65\u7684\uff0c\u540e\u53f0\u4f1a\u5904\u7406"),(0,n.kt)("li",{parentName:"ul"},"keep non-timeseries data out of clickhouse"),(0,n.kt)("li",{parentName:"ul"},"dynamic subcolumns - JSON"),(0,n.kt)("li",{parentName:"ul"},"OLAP",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u9002\u5408 KV"),(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u9002\u5408\u5c0f\u6570\u636e\u7cbe\u786e\u67e5\u8be2"))))),(0,n.kt)("admonition",s({},{type:"caution"}),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301 UDF ",(0,n.kt)("a",s({parentName:"li"},{href:"https://github.com/ClickHouse/ClickHouse/issues/11"}),"#11")),(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301 UPDATE, DELETE, REPLACE, MERGE, UPSERT, INSERT UPDATE",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u53ef\u4ee5 DROP PARTITION \u5b9e\u73b0\u90e8\u5206\u6570\u636e\u5220\u9664"),(0,n.kt)("li",{parentName:"ul"},"\u652f\u6301 mutation ",(0,n.kt)("inlineCode",{parentName:"li"},"ALTER TABLE name UPDATE/DELETE column=exp WHERE filter"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u540e\u53f0\u5f02\u6b65\u6267\u884c\uff0c\u5168\u90e8\u6570\u636e\u91cd\u5199\uff0c\u975e\u539f\u5b50\u64cd\u4f5c\uff0c\u975e\u5e38\u6162"),(0,n.kt)("li",{parentName:"ul"},"\u6ee1\u8db3 GDPR \u8981\u6c42"))))),(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301\u8bfb\u5199\u5206\u79bb ",(0,n.kt)("a",s({parentName:"li"},{href:"https://github.com/ClickHouse/ClickHouse/issues/18452"}),"#18452")))),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-bash"}),'# https://hub.docker.com/r/yandex/clickhouse-server/\n# /etc/clickhouse-server/config.xml\ndocker run --rm -it \\\n  -v $PWD/data:/var/lib/clickhouse \\\n  -p 8123:8123 -p 9000:9000 \\\n  --ulimit nofile=262144:262144 \\\n  --name ch-server yandex/clickhouse-server\n\n# Client\ndocker run -it --rm --link ch-server yandex/clickhouse-client --host ch-server\n\n# \u542f\u52a8\nclickhouse-server --config-file=/etc/clickhouse-server/config.xml\nclickhouse-client --host=example.com\n\n# \u5bfc\u5165 CSV\ncat my.csv | clickhouse-client --host=example-perftest01j --query="INSERT INTO rankings_tiny FORMAT CSV"\n# \u5bfc\u5165 TSV, \u5e76\u8ba1\u7b97\u65f6\u95f4\ntime clickhouse-client --query="INSERT INTO trips FORMAT TabSeparated" < trips.tsv\n\ncurl \'http://localhost:8123/?query=SELECT%20NOW()\'\n')),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-sql"}),"COPY(\n  SELECT\n    t.id,\n    t.name\n  FROM\n    t\n) TO '/opt/data/export.tsv';\n\n-- \u4ece PostgreSQL \u5bfc\u5165\nCOPY...TO PROGRAM\n")),(0,n.kt)("h2",s({},{id:"note"}),"Note"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u5217 DEFAULT materializes on merge, MATERIALIZED materializes on INSERT, OPTIMIZE TABLE"),(0,n.kt)("li",{parentName:"ul"},"ENGINE = Null - ETL \u8868, trigger materialized view"),(0,n.kt)("li",{parentName:"ul"},"index_granularity",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"how many rows reps index key and pk"),(0,n.kt)("li",{parentName:"ul"},"lower, point query \u66f4\u5feb"),(0,n.kt)("li",{parentName:"ul"},"\u4f8b\u5982 8196")))),(0,n.kt)("h2",s({},{id:"\u5b89\u88c5"}),"\u5b89\u88c5"),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-bash"}),'# \u8981\u6c42 SSE 4.2\ngrep -q sse4_2 /proc/cpuinfo && echo "SSE 4.2 supported" || echo "SSE 4.2 not supported"\n\n# Docker\n# https://hub.docker.com/r/clickhouse/clickhouse-server/\n# /etc/clickhouse-server/config.xml\ndocker run -it --rm \\\n  --ulimit nofile=262144:262144 \\\n  -v=$HOME/data:/var/lib/clickhouse \\\n  --name clickhouse-server clickhouse/clickhouse-server\n')),(0,n.kt)("h2",s({},{id:"notes"}),"Notes"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"primary keys",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5e76\u4e0d\u8981\u6c42\u552f\u4e00"),(0,n.kt)("li",{parentName:"ul"},"\u5370\u8c61\u78c1\u76d8\u4e0a\u6570\u636e\u6392\u5e8f"))),(0,n.kt)("li",{parentName:"ul"},"index granularity",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"8,192 rows or 10MB of data"))),(0,n.kt)("li",{parentName:"ul"},"sparse index")),(0,n.kt)("h2",s({},{id:"\u6570\u636e\u7c7b\u578b"}),"\u6570\u636e\u7c7b\u578b"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u652f\u6301\u8303\u578b\u7684\u5f3a\u7c7b\u578b Schema")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"UInt8, UInt16, UInt32, UInt64, UInt256, Int8, Int16, Int32, Int64, Int128, Int256",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Int8 \u2014 TINYINT, BOOL, BOOLEAN, INT1."),(0,n.kt)("li",{parentName:"ul"},"Int16 \u2014 SMALLINT, INT2."),(0,n.kt)("li",{parentName:"ul"},"Int32 \u2014 INT, INT4, INTEGER."),(0,n.kt)("li",{parentName:"ul"},"Int64 \u2014 BIGINT"))),(0,n.kt)("li",{parentName:"ul"},"Float32, Float64",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"FLOAT, DOUBLE"))),(0,n.kt)("li",{parentName:"ul"},"Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S), Decimal256(S)",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"P - precision - ","[ 1 : 76 ]"),(0,n.kt)("li",{parentName:"ul"},"S - scale - ","[ 0 : P ]"),(0,n.kt)("li",{parentName:"ul"},"P ","[ 1 : 9 ]"," - Decimal32(S)"),(0,n.kt)("li",{parentName:"ul"},"P ","[ 10 : 18 ]"," - Decimal64(S)"),(0,n.kt)("li",{parentName:"ul"},"P ","[ 19 : 38 ]"," - Decimal128(S)"),(0,n.kt)("li",{parentName:"ul"},"P ","[ 39 : 76 ]"," - Decimal256(S)"))),(0,n.kt)("li",{parentName:"ul"},"Boolean",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"UInt8 - 0,1"))),(0,n.kt)("li",{parentName:"ul"},"String",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5982\u679c\u521b\u5efa VARCHAR(255) \u4f1a\u5ffd\u7565\u957f\u5ea6"))),(0,n.kt)("li",{parentName:"ul"},"FixedString(N) - N bytes"),(0,n.kt)("li",{parentName:"ul"},"UUID"),(0,n.kt)("li",{parentName:"ul"},"Date",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"2byte, days since 1970-01-01"),(0,n.kt)("li",{parentName:"ul"},"\u6700\u5927 2148 \u5e74"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"DateTime([timezone])"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"unix timestamp"),(0,n.kt)("li",{parentName:"ul"},"\u6700\u5927 2105 \u5e74"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"DateTime64(precision, [timezone])"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Int64, epoch"),(0,n.kt)("li",{parentName:"ul"},"precision=3 \u5219\u662f\u6beb\u79d2\u7ea7"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"Enum('k1'=1,'k2'=2)")),(0,n.kt)("li",{parentName:"ul"},"LowCardinality(data_type)",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"change internal to dictionary-encoded"))),(0,n.kt)("li",{parentName:"ul"},"array(T) - ",(0,n.kt)("inlineCode",{parentName:"li"},"[]")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"AggregateFunction(name, types_of_arguments\u2026)")),(0,n.kt)("li",{parentName:"ul"},"Nested - \u5d4c\u5957\u7c7b\u578b - \u7c7b\u4f3c\u5b9a\u4e49\u4e00\u4e2a struct")),(0,n.kt)("h2",s({},{id:"table-engine"}),"Table Engine"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"PostgreSQL"),(0,n.kt)("li",{parentName:"ul"},"Kafka"),(0,n.kt)("li",{parentName:"ul"},"MySQL"),(0,n.kt)("li",{parentName:"ul"},"S3",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Function+Engine")))),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-sql"}),"-- PostgreSQL\n-- =======================\n-- connect table\n-- insert, select\nCREATE TABLE\n  db_in_ch.table1 (id UInt64, column1 String) ENGINE = PostgreSQL(\n    'postgres-host.domain.com:5432',\n    'db_in_psg',\n    'table1',\n    'clickhouse_user',\n    'ClickHouse_123'\n  );\n\n-- materialized\n-- replica of the database\nSET\n  allow_experimental_database_materialized_postgresql = 1;\n\nCREATE DATABASE db1_postgres ENGINE = MaterializedPostgreSQL(\n  'postgres-host.domain.com:5432',\n  'db1',\n  'clickhouse_user',\n  'ClickHouse_123'\n) SETTINGS materialized_postgresql_tables_list = 'table1';\n\n-- S3\n-- =========================\n-- \u5143\u4fe1\u606f _path, _file\nSELECT\n  *\nFROM\n  s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_*.gz',\n    'TabSeparatedWithNames'\n  )\nLIMIT\n  10;\n\n-- \u5199\u5165\nINSERT INTO\n  FUNCTION s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/csv/trips.csv.lz4',\n    's3_key',\n    's3_secret',\n    'CSV'\n  )\nSELECT\n  *\nFROM\n  trips\nLIMIT\n  10000;\n\n-- \u5199\u5165\u591a\u4e2a\u6587\u4ef6\nINSERT INTO\n  FUNCTION s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/csv/trips_{_partition_id}.csv.lz4',\n    's3_key',\n    's3_secret',\n    'CSV'\n  ) PARTITION BY rand() % 10\nSELECT\n  *\nFROM\n  trips\nLIMIT\n  100000;\n\n-- engine\nCREATE TABLE\n  trips_dest (\n    `trip_id` UInt32,\n    `pickup_date` Date,\n    `pickup_datetime` DateTime,\n    `dropoff_datetime` DateTime,\n    `tip_amount` Float32,\n    `total_amount` Float32\n  ) ENGINE = S3('<bucket path>/trips.bin', 'Native');\n")),(0,n.kt)("h2",s({},{id:"mergetree"}),"MergeTree"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"MergeTree \u672c\u8eab\u6bd4\u8f83\u91cd\uff0c\u5efa\u8bae\u7528\u4e8e\u8f83\u5927\u7684\u6570\u636e\u96c6\u3002")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u4e3b\u8981\u7279\u6027",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5217\u5b58\u50a8"),(0,n.kt)("li",{parentName:"ul"},"\u81ea\u5b9a\u4e49\u5206\u7247"),(0,n.kt)("li",{parentName:"ul"},"sparse primary index"),(0,n.kt)("li",{parentName:"ul"},"secondary data-skipping indexes")))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"MergeTree Engine Family")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"MergeTree - \u5efa\u8bae\u7528\u4e8e\u5355\u8282\u70b9",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u57fa\u4e8e PK \u6392\u5e8f"),(0,n.kt)("li",{parentName:"ul"},"\u652f\u6301\u526f\u672c"),(0,n.kt)("li",{parentName:"ul"},"\u652f\u6301\u91c7\u6837"))),(0,n.kt)("li",{parentName:"ul"},"ReplacingMergeTree - \u5efa\u8bae\u7528\u4e8e\u751f\u4ea7\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u652f\u6301\u6570\u636e\u53bb\u91cd"))),(0,n.kt)("li",{parentName:"ul"},"SummingMergeTree"),(0,n.kt)("li",{parentName:"ul"},"AggregatingMergeTree"),(0,n.kt)("li",{parentName:"ul"},"CollapsingMergeTree"),(0,n.kt)("li",{parentName:"ul"},"VersionedCollapsingMergeTree"),(0,n.kt)("li",{parentName:"ul"},"GraphiteMergeTree"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"tuple(T1, T2, ...)")),(0,n.kt)("li",{parentName:"ul"},"\u7279\u6b8a\u7c7b\u578b",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u8868\u8fbe\u5f0f"),(0,n.kt)("li",{parentName:"ul"},"Set"),(0,n.kt)("li",{parentName:"ul"},"Nothing"),(0,n.kt)("li",{parentName:"ul"},"Interval"))),(0,n.kt)("li",{parentName:"ul"},"\u57df\u7c7b\u578b",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"IPv4, IPv6"))),(0,n.kt)("li",{parentName:"ul"},"Geo \u7c7b\u578b",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Point, Ring, Polygon, MultiPolygon"))),(0,n.kt)("li",{parentName:"ul"},"Map(key, value)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"SimpleAggregateFunction(name, types_of_arguments\u2026)"))),(0,n.kt)("h2",s({},{id:"log"}),"Log"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"TinyLog"),(0,n.kt)("li",{parentName:"ul"},"StripeLog"),(0,n.kt)("li",{parentName:"ul"},"Log")),(0,n.kt)("h3",s({},{id:"\u96c6\u6210\u5f15\u64ce"}),"\u96c6\u6210\u5f15\u64ce"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"ODBC,JDBC,MySQL,MongoDB, HDFS, S3, Kafka, RocksDB, RabbitMQ"),(0,n.kt)("li",{parentName:"ul"},"PostgreSQL",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u901a\u8fc7 ",(0,n.kt)("inlineCode",{parentName:"li"},"COPY (SELECT ...) TO STDOUT")," \u5b9e\u73b0"),(0,n.kt)("li",{parentName:"ul"},"\u652f\u6301 Materialized - \u521d\u6b21\u540c\u6b65\u540e\u540e\u7eed\u901a\u8fc7 WAL \u66f4\u65b0")))),(0,n.kt)("h3",s({},{id:"\u7279\u6b8a\u5f15\u64ce"}),"\u7279\u6b8a\u5f15\u64ce"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Distributed"),(0,n.kt)("li",{parentName:"ul"},"MaterializedView"),(0,n.kt)("li",{parentName:"ul"},"Dictionary"),(0,n.kt)("li",{parentName:"ul"},"Merge"),(0,n.kt)("li",{parentName:"ul"},"File"),(0,n.kt)("li",{parentName:"ul"},"Null"),(0,n.kt)("li",{parentName:"ul"},"Set"),(0,n.kt)("li",{parentName:"ul"},"Join"),(0,n.kt)("li",{parentName:"ul"},"URL"),(0,n.kt)("li",{parentName:"ul"},"View"),(0,n.kt)("li",{parentName:"ul"},"Memory"),(0,n.kt)("li",{parentName:"ul"},"Buffer")),(0,n.kt)("h2",s({},{id:"\u8fd0\u7ef4"}),"\u8fd0\u7ef4"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u63a8\u8350 ext4 noatime, nobarrier")),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-bash"}),"# CPU \u4f7f\u7528\u6027\u80fd\u6a21\u5f0f\necho 'performance' | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor\n# \u4e0d\u8981\u7981\u7528 overcommit\necho 0 | sudo tee /proc/sys/vm/overcommit_memory\n\n# \u65e7 Linux Kernel\necho 'madvise' | sudo tee /sys/kernel/mm/transparent_hugepage/enabled\n")),(0,n.kt)("h3",s({},{id:"auth"}),"Auth"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Kerberos"),(0,n.kt)("li",{parentName:"ul"},"LDAP")),(0,n.kt)("h2",s({},{id:"stats"}),"Stats"),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-sql"}),"SELECT\n  tabe,\n  name,\n  sub(data_compressed_bytes) AS compressed,\n  sub(data_uncompressed_bytes) AS uncompressed,\n  floor((compressed / uncompressed) * 100, 4) as percent\nFROM\n  system.columns\nWHERE\n  database = currentDatabase()\nGROUP BY\n  table,\n  name\nORDER BY\n  table ASC,\n  name ASC;\n")),(0,n.kt)("h2",s({},{id:"formats"}),"formats"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://clickhouse.com/docs/en/interfaces/formats/"}),"https://clickhouse.com/docs/en/interfaces/formats/"))),(0,n.kt)("h2",s({},{id:"configxml"}),"config.xml"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",s({parentName:"li"},{href:"https://clickhouse.com/docs/en/operations/configuration-files/"}),"https://clickhouse.com/docs/en/operations/configuration-files/"))),(0,n.kt)("h2",s({},{id:"\u5220\u9664"}),"\u5220\u9664"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"TTL"),(0,n.kt)("li",{parentName:"ol"},"DELETE FROM"),(0,n.kt)("li",{parentName:"ol"},"ALTER DELETE"),(0,n.kt)("li",{parentName:"ol"},"DROP PARTITION"),(0,n.kt)("li",{parentName:"ol"},"TRUNCATE")),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-sql"}),"-- DELETE FROM\nSET allow_experimental_lightweight_delete = true;\n")),(0,n.kt)("h2",s({},{id:"\u5bfc\u51fa\u6570\u636e"}),"\u5bfc\u51fa\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-sql"}),"SELECT * FROM table INTO OUTFILE 'file' FORMAT CSV\n")),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-bash"}),'$ clickhouse-client --query "SELECT * from table" --format FormatName > result.txt\n')),(0,n.kt)("h2",s({},{id:"\u5bfc\u5165\u6570\u636e"}),"\u5bfc\u5165\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",s({parentName:"pre"},{className:"language-bash"}),'# HTTP API\necho \'{"foo":"bar"}\' | curl \'http://localhost:8123/?query=INSERT%20INTO%20test%20FORMAT%20JSONEachRow\' --data-binary @-\n# CLI\necho \'{"foo":"bar"}\' | clickhouse-client --query="INSERT INTO test FORMAT JSONEachRow"\n')))}f.isMDXComponent=!0}}]);