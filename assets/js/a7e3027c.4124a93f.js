/*! For license information please see a7e3027c.4124a93f.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[54350],{92982:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>l,toc:()=>i});var a=r(11527),s=r(47214);const t={id:"app-cookbook",title:"K8S Apps"},o=void 0,l={id:"devops/kubernetes/app/app-cookbook",title:"K8S Apps",description:"debug",source:"@site/../notes/devops/kubernetes/app/app-cookbook.md",sourceDirName:"devops/kubernetes/app",slug:"/devops/kubernetes/app/cookbook",permalink:"/notes/devops/kubernetes/app/cookbook",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/app/app-cookbook.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1609350815,formattedLastUpdatedAt:"Dec 30, 2020",frontMatter:{id:"app-cookbook",title:"K8S Apps"},sidebar:"docs",previous:{title:"Kubernetes",permalink:"/notes/devops/kubernetes/"},next:{title:"Argo",permalink:"/notes/devops/kubernetes/app/argo/"}},c={},i=[{value:"debug",id:"debug",level:2},{value:"helm",id:"helm",level:2},{value:"metallb",id:"metallb",level:2},{value:"cert-manager",id:"cert-manager",level:2},{value:"ingress-nginx",id:"ingress-nginx",level:2},{value:"rancher",id:"rancher",level:2}];function d(e){const n={code:"code",h2:"h2",pre:"pre",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"debug",children:"debug"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get pod -w --all-namespaces\nkubectl get events -w --all-namespaces\n\nsource <(kubectl completion bash)\nsource <(helm completion bash)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"helm",children:"helm"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# alpine 3.12 \u5b89\u88c5 helm\napk add helm -X https://mirrors.aliyun.com/alpine/edge/testing/\n\n# K3S\nexport KUBECONFIG=/etc/rancher/k3s/k3s.yaml\n\nhelm repo add wener https://charts.wener.tech\nhelm search repo wener/\n\n# \u8865\u5168\nsource <(helm completion bash)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"metallb",children:"metallb"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# registry \u9ed8\u8ba4\u5199\u4e86 docker.io\ncat <<YAML > metallb.values.yaml\ncontroller:\n  image:\n    registry: docker.mirrors.ustc.edu.cn\nspeaker:\n  image:\n    registry: docker.mirrors.ustc.edu.cn\nconfigInline:\n  address-pools:\n  - name: default\n    protocol: layer2\n    # default address space\n    addresses:\n    - 10.10.128.0/18\nYAML\n\nhelm upgrade -i metallb wener/metallb -n metallb-system --create-namespace -f metallb.values.yaml\n"})}),"\n",(0,a.jsx)(n.h2,{id:"cert-manager",children:"cert-manager"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# direct install crd\ncat <<YAML > cert-manager.values.yaml\ninstallCRDs: true\nYAML\n\nhelm upgrade -i cert-manager wener/cert-manager -n cert-manager --create-namespace -f cert-manager.values.yaml\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ingress-nginx",children:"ingress-nginx"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# DaemonSet hostPort 80\ncat <<YAML > ingress-nginx.values.yaml\nconfig:\n  hide-headers: "Server"\ncontroller:\n  image:\n    # use mirror\n    # k8s.gcr.io/ingress-nginx/controller\n    repository: registry.cn-hongkong.aliyuncs.com/cmi/ingress-nginx_controller\n    # disable digest\n    digest: ""\n  kind: DaemonSet\n  hostPort:\n    enabled: true\n  metrics:\n    enabled: false\n    # kube-prometheus\n    serviceMonitor:\n      enabled: true\n  prometheusRule:\n    enabled: false\n  admissionWebhooks:\n    patch:\n      image:\n        repository: registry.cn-hongkong.aliyuncs.com/cmi/jettech_kube-webhook-certgen\nYAML\n\nhelm upgrade -i ingress-nginx wener/ingress-nginx -n ingress-nginx --create-namespace -f ingress-nginx.values.yaml\n'})}),"\n",(0,a.jsx)(n.h2,{id:"rancher",children:"rancher"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\n# latest\n# helm repo add rancher https://releases.rancher.com/server-charts/latest\n# stable\nhelm repo add rancher https://releases.rancher.com/server-charts/stable\n\n# https://rancher.com/docs/rancher/v2.x/en/installation/resources/chart-options\ncat <<YAML > rancher.values.yaml\nhostname: rancher.my.corp\n\n# use cert-manager\n# privateCA: true\n# rancher mirror\nsystemDefaultRegistry: registry.cn-hangzhou.aliyuncs.com\n# 1 for test only - default 3\nreplicas: 1\nYAML\n\nhelm upgrade -i rancher rancher/rancher -n cattle-system --create-namespace -f rancher.values.yaml\n\n# \u67e5\u770b\u5b89\u88c5\u72b6\u6001\nkubectl -n cattle-system rollout status deploy/rancher\n# \u9a8c\u8bc1\u5b89\u88c5\nkubectl -n cattle-system get deploy rancher\n\n# \u8f6c\u53d1\u8bbf\u95ee rancher\nkubectl port-forward -n cattle-system svc/rancher --address 0.0.0.0 8080:80\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},3354:(e,n,r)=>{var a=r(50959),s=Symbol.for("react.element"),t=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function i(e,n,r){var a,t={},i=null,d=null;for(a in void 0!==r&&(i=""+r),void 0!==n.key&&(i=""+n.key),void 0!==n.ref&&(d=n.ref),n)o.call(n,a)&&!c.hasOwnProperty(a)&&(t[a]=n[a]);if(e&&e.defaultProps)for(a in n=e.defaultProps)void 0===t[a]&&(t[a]=n[a]);return{$$typeof:s,type:e,key:i,ref:d,props:t,_owner:l.current}}n.Fragment=t,n.jsx=i,n.jsxs=i},11527:(e,n,r)=>{e.exports=r(3354)},47214:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>o});var a=r(50959);const s={},t=a.createContext(s);function o(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);