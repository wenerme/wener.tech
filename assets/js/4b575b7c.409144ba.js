/*! For license information please see 4b575b7c.409144ba.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[79737],{81851:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});var r=s(11527),t=s(47214);const l={title:"Kubernetes \u6807\u7b7e"},d="Kubernetes \u6807\u7b7e",i={id:"devops/kubernetes/internal/k8s-labels",title:"Kubernetes \u6807\u7b7e",description:"- https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints",source:"@site/../notes/devops/kubernetes/internal/k8s-labels.md",sourceDirName:"devops/kubernetes/internal",slug:"/devops/kubernetes/internal/k8s-labels",permalink:"/notes/devops/kubernetes/internal/k8s-labels",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/internal/k8s-labels.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1652772118,formattedLastUpdatedAt:"May 17, 2022",frontMatter:{title:"Kubernetes \u6807\u7b7e"},sidebar:"docs",previous:{title:"HPA",permalink:"/notes/devops/kubernetes/internal/k8s-hpa"},next:{title:"Metrics",permalink:"/notes/devops/kubernetes/internal/k8s-metrics"}},c={},o=[{value:"\u8282\u70b9\u6807\u7b7e",id:"\u8282\u70b9\u6807\u7b7e",level:2},{value:"Deprecated",id:"deprecated",level:3},{value:"\u8d44\u6e90\u6807\u7b7e",id:"\u8d44\u6e90\u6807\u7b7e",level:2},{value:"\u5e94\u7528\u6807\u7b7e",id:"\u5e94\u7528\u6807\u7b7e",level:2},{value:"Helm \u6807\u7b7e",id:"helm-\u6807\u7b7e",level:2},{value:"Helm \u6ce8\u89e3",id:"helm-\u6ce8\u89e3",level:2},{value:"LabelSelector",id:"labelselector",level:2},{value:"region vs zone",id:"region-vs-zone",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"kubernetes-\u6807\u7b7e",children:"Kubernetes \u6807\u7b7e"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints",children:"https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/labels-annotations-taints/",children:"https://kubernetes.io/docs/reference/labels-annotations-taints/"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u8282\u70b9\u6807\u7b7e",children:"\u8282\u70b9\u6807\u7b7e"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"kubernetes.io/ingress.class"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"label"}),(0,r.jsx)(n.th,{children:"demo"}),(0,r.jsx)(n.th,{children:"desc"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"k3s.io/hostname"}),(0,r.jsx)(n.td,{children:"node-3"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"k3s.io/internal-ip"}),(0,r.jsx)(n.td,{children:"10.10.1.1"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"kubernetes.io/arch"}),(0,r.jsx)(n.td,{children:"amd64"}),(0,r.jsx)(n.td,{children:"+v1.14"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"kubernetes.io/hostname"}),(0,r.jsx)(n.td,{children:"node-3"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"kubernetes.io/os"}),(0,r.jsx)(n.td,{children:"linux"}),(0,r.jsx)(n.td,{children:"+v1.14"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["node-role.kubernetes.io/",(0,r.jsx)(n.code,{children:"<role>"})]}),(0,r.jsx)(n.td,{children:"true"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"node-role.kubernetes.io/master"}),(0,r.jsx)(n.td,{children:"true"}),(0,r.jsx)(n.td,{children:"Master node"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"node-role.kubernetes.io/control-plane"}),(0,r.jsx)(n.td,{children:"true"}),(0,r.jsx)(n.td,{children:"cp"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"node.kubernetes.io/instance-type"}),(0,r.jsx)(n.td,{children:"k3s"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"topology.kubernetes.io/region"}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"+v1.17"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"topology.kubernetes.io/zone"}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"+v1.17"})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u8bbe\u7f6e node role \u4e3a worker\n# role \u540d\u5b57\u4efb\u610f\n# value \u4e0d\u91cd\u8981\uff0c\u4e3b\u8981\u662f\u5b58\u5728\u8be5 label\nkubectl label node node-2 node-role.kubernetes.io/worker=true\n# \u89c4\u5212 region \u548c zone\nkubectl label node master-1 topology.kubernetes.io/region=sh\nkubectl label node master-1 topology.kubernetes.io/zone=sh-dc1\n"})}),"\n",(0,r.jsx)(n.h3,{id:"deprecated",children:"Deprecated"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"label"}),(0,r.jsx)(n.th,{children:"demo"}),(0,r.jsx)(n.th,{children:"desc"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"beta.kubernetes.io/arch"}),(0,r.jsx)(n.td,{children:"amd64"}),(0,r.jsx)(n.td,{children:"!v1.14, -v1.18"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"beta.kubernetes.io/instance-type"}),(0,r.jsx)(n.td,{children:"k3s"}),(0,r.jsx)(n.td,{children:"!v1.17"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"beta.kubernetes.io/os"}),(0,r.jsx)(n.td,{children:"linux"}),(0,r.jsx)(n.td,{children:"!v1.14, -v1.18"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"failure-domain.beta.kubernetes.io/region"}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"!v1.17"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"failure-domain.beta.kubernetes.io/zone"}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"!v1.17"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u8d44\u6e90\u6807\u7b7e",children:"\u8d44\u6e90\u6807\u7b7e"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"kind"}),(0,r.jsx)(n.th,{children:"annotation"}),(0,r.jsx)(n.th,{children:"demo"}),(0,r.jsx)(n.th,{children:"desc"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"StorageClass"}),(0,r.jsx)(n.td,{children:"storageclass.kubernetes.io/is-default-class"}),(0,r.jsx)(n.td,{children:"true"}),(0,r.jsx)(n.td,{children:"\u9ed8\u8ba4 StorageClass"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"VolumeSnapshotClass"}),(0,r.jsx)(n.td,{children:"snapshot.storage.kubernetes.io/is-default-class"}),(0,r.jsx)(n.td,{children:"true"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Ingress"}),(0,r.jsx)(n.td,{children:"kubernetes.io/ingress.class"}),(0,r.jsx)(n.td,{children:"nginx"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"\u5e9f\u5f03"}),",spec.ingressClassName"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"IngressClass"}),(0,r.jsx)(n.td,{children:"ingressclass.kubernetes.io/is-default-class"}),(0,r.jsx)(n.td,{children:"true"}),(0,r.jsx)(n.td,{})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"kind"}),(0,r.jsx)(n.th,{children:"label"}),(0,r.jsx)(n.th,{children:"demo"}),(0,r.jsx)(n.th,{children:"desc"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Namespace"}),(0,r.jsx)(n.td,{children:"kubernetes.io/metadata.name"}),(0,r.jsx)(n.td,{children:"kube-system"}),(0,r.jsx)(n.td,{children:"namespace \u7684\u540d\u5b57"})]})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl get storageclass\n\n# \u53d6\u6d88 sc \u7684\u9ed8\u8ba4\u503c\nkubectl patch storageclass local-path -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"false"}}}\'\n# \u8bbe\u7f6e\u9ed8\u8ba4\nkubectl patch storageclass longhorn -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5e94\u7528\u6807\u7b7e",children:"\u5e94\u7528\u6807\u7b7e"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/",children:"Recommanded Lables"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://helm.sh/docs/chart_best_practices/labels/",children:"Helm Labels"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"label"}),(0,r.jsx)(n.th,{children:"example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"app.kubernetes.io/name"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mysql"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"app.kubernetes.io/instance"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mysql-abcd"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"app.kubernetes.io/version"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"5.7"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"app.kubernetes.io/component"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"database"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"app.kubernetes.io/part-of"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ghost"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"app.kubernetes.io/managed-by"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"helm"})})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"podAntiAffinity:\n  preferredDuringSchedulingIgnoredDuringExecution:\n    - weight: 100\n      podAffinityTerm:\n        labelSelector:\n          matchLabels:\n            app.kubernetes.io/component: prometheus\n            app.kubernetes.io/instance: kube-prometheus\n            app.kubernetes.io/name: kube-prometheus\n        topologyKey: kubernetes.io/hostname\n"})}),"\n",(0,r.jsx)(n.h2,{id:"helm-\u6807\u7b7e",children:"Helm \u6807\u7b7e"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"label"}),(0,r.jsx)(n.th,{children:"example"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"app.kubernetes.io/managed-by"}),(0,r.jsx)(n.td,{children:"Helm"})]})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# \u8d44\u6e90 label\nlabels:\n  app.kubernetes.io/component: controller\n  app.kubernetes.io/instance: ingress-nginx\n  app.kubernetes.io/managed-by: Helm\n  app.kubernetes.io/name: ingress-nginx\n  app.kubernetes.io/version: 0.35.0\n  helm.sh/chart: ingress-nginx-2.16.0\n\n# selector label\nmatchLabels:\n  app.kubernetes.io/component: controller\n  app.kubernetes.io/instance: ingress-nginx\n  app.kubernetes.io/name: ingress-nginx\n"})}),"\n",(0,r.jsx)(n.h2,{id:"helm-\u6ce8\u89e3",children:"Helm \u6ce8\u89e3"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"annotation"}),(0,r.jsx)(n.th,{children:"value"}),(0,r.jsx)(n.th,{children:"desc"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"meta.helm.sh/release-name"}),(0,r.jsx)(n.td,{children:"linkerd2"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"meta.helm.sh/release-namespace"}),(0,r.jsx)(n.td,{children:"linkerd"}),(0,r.jsx)(n.td,{})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"labelselector",children:"LabelSelector"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"labelSelector - \u6570\u7ec4\u5185\u4e3a OR \u5173\u7cfb"}),"\n",(0,r.jsxs)(n.li,{children:["matchLabels\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"label: value"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["matchExpressions - \u6570\u7ec4\u5185\u4e3a AND \u5173\u7cfb\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"key"}),"\n",(0,r.jsx)(n.li,{children:"operator: In, NotIn, Exists, DoesNotExist"}),"\n",(0,r.jsx)(n.li,{children:"values: []"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dashboardLabelSelector: # OR\n  - matchExpressions: # AND\n      - { key: app, operator: In, values: [grafana] }\n      - { key: group, operator: In, values: [grafana] }\n"})}),"\n",(0,r.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.h2,{id:"region-vs-zone",children:"region vs zone"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["region - \u533a\u57df\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5730\u533a/zone \u96c6\u5408"}),"\n",(0,r.jsx)(n.li,{children:"\u540c\u533a\u57df \u9ad8\u5e26\u5bbd\u3001\u4f4e\u5ef6\u8fdf"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["zone - \u53ef\u7528\u533a ",(0,r.jsx)(n.code,{children:"<region>-<zone>"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"us-central1"}),"\n",(0,r.jsx)(n.li,{children:"us-central1-a - zone \u5185\u533a\u57df"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://cloud.google.com/compute/docs/regions-zones",children:"https://cloud.google.com/compute/docs/regions-zones"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/setup/best-practices/multiple-zones/",children:"https://kubernetes.io/docs/setup/best-practices/multiple-zones/"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},3354:(e,n,s)=>{var r=s(50959),t=Symbol.for("react.element"),l=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function o(e,n,s){var r,l={},o=null,a=null;for(r in void 0!==s&&(o=""+s),void 0!==n.key&&(o=""+n.key),void 0!==n.ref&&(a=n.ref),n)d.call(n,r)&&!c.hasOwnProperty(r)&&(l[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===l[r]&&(l[r]=n[r]);return{$$typeof:t,type:e,key:o,ref:a,props:l,_owner:i.current}}n.Fragment=l,n.jsx=o,n.jsxs=o},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>i,a:()=>d});var r=s(50959);const t={},l=r.createContext(t);function d(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);