"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[97251],{49613:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(59496);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=l,h=c["".concat(o,".").concat(d)]||c[d]||m[d]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=c;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:l,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},67699:function(e,t,n){n.r(t),n.d(t,{assets:function(){return g},contentTitle:function(){return d},default:function(){return f},frontMatter:function(){return c},metadata:function(){return h},toc:function(){return k}});var a=n(49613),l=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,m=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&u(e,n,t[n]);if(s)for(var n of s(t))p.call(t,n)&&u(e,n,t[n]);return e};const c={title:"NodeJS FAQ",tags:["FAQ"]},d="NodeJS FAQ",h={unversionedId:"web/nodejs/nodejs-faq",id:"web/nodejs/nodejs-faq",title:"NodeJS FAQ",description:"Tool Chain",source:"@site/../notes/web/nodejs/nodejs-faq.md",sourceDirName:"web/nodejs",slug:"/web/nodejs/faq",permalink:"/notes/web/nodejs/faq",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/nodejs/nodejs-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1690351481,formattedLastUpdatedAt:"Jul 26, 2023",frontMatter:{title:"NodeJS FAQ",tags:["FAQ"]},sidebar:"docs",previous:{title:"NodeJS CLS",permalink:"/notes/web/nodejs/cls"},next:{title:"NodeJS \u7248\u672c",permalink:"/notes/web/nodejs/version"}},g={},k=[{value:"Tool Chain",id:"tool-chain",level:2},{value:"arm64/aarch64 musl",id:"arm64aarch64-musl",level:2},{value:"source map",id:"source-map",level:2},{value:"cjs <code>__dirname</code>",id:"cjs-__dirname",level:2},{value:"\u76f4\u63a5\u6267\u884c typescript \u6216 esnext",id:"\u76f4\u63a5\u6267\u884c-typescript-\u6216-esnext",level:2},{value:"Package &#39;OpenEXR&#39;, required by &#39;vips&#39;, not found",id:"package-openexr-required-by-vips-not-found",level:2},{value:"libtool: unrecognized option -static when building",id:"libtool-unrecognized-option--static-when-building",level:2},{value:"require() of ES modules is not supported",id:"require-of-es-modules-is-not-supported",level:2},{value:"NodeJS v18 fetch proxy",id:"nodejs-v18-fetch-proxy",level:2},{value:"RequestInit: duplex option is required when sending a body",id:"requestinit-duplex-option-is-required-when-sending-a-body",level:2},{value:"Critical dependency: require function is used in a way in which dependencies cannot be statically extracted",id:"critical-dependency-require-function-is-used-in-a-way-in-which-dependencies-cannot-be-statically-extracted",level:2},{value:"gyp",id:"gyp",level:2},{value:"Undefined variable module_name in binding.gyp while trying to load binding.gyp",id:"undefined-variable-module_name-in-bindinggyp-while-trying-to-load-bindinggyp",level:2},{value:"Custom ESM Loaders is an experimental feature. This feature could change at any time",id:"custom-esm-loaders-is-an-experimental-feature-this-feature-could-change-at-any-time",level:2},{value:"Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory",id:"ineffective-mark-compacts-near-heap-limit-allocation-failed---javascript-heap-out-of-memory",level:2},{value:"Can&#39;t resolve &#39;pg-native&#39;",id:"cant-resolve-pg-native",level:2},{value:"REPL load",id:"repl-load",level:2},{value:"error:0308010C:digital envelope routines::unsupported",id:"error0308010cdigital-envelope-routinesunsupported",level:2},{value:"snapshot",id:"snapshot",level:2},{value:"fastify vs express",id:"fastify-vs-express",level:2},{value:"import npm global",id:"import-npm-global",level:2}],b={toc:k};function f(e){var t,n=e,{components:l}=n,u=((e,t)=>{var n={};for(var a in e)o.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&s)for(var a of s(e))t.indexOf(a)<0&&p.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=m(m({},b),u),r(t,i({components:l,mdxType:"MDXLayout"}))),(0,a.kt)("h1",m({},{id:"nodejs-faq"}),"NodeJS FAQ"),(0,a.kt)("h2",m({},{id:"tool-chain"}),"Tool Chain"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u9759\u6001\u9879\u76ee - ViteJS"),(0,a.kt)("li",{parentName:"ul"},"\u524d\u7aef\u9879\u76ee - NextJS+trpc+NestJS - \u590d\u6742\u9879\u76ee",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u90e8\u5206 NestJS \u903b\u8f91\u5171\u7528"),(0,a.kt)("li",{parentName:"ul"},"\u8f93\u51fa standalone \u6a21\u5f0f - \u76f4\u63a5\u62f7\u8d1d\u5230\u5bb9\u5668\u5373\u53ef"))),(0,a.kt)("li",{parentName:"ul"},"\u540e\u7aef\u9879\u76ee - NestJS+fastify",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u5f00\u53d1: ts-node --swc --esm --transpileOnly --watch src/main.ts",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"tsx \u4e0d\u652f\u6301 decorator\uff0c\u4e0d\u7136\u53ef\u4ee5\u7528 tsx"))),(0,a.kt)("li",{parentName:"ul"},"\u6784\u5efa: esbuild --bundle --external=sharp src/main.ts",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u8f93\u51fa\u4e00\u4e2a js \u653e\u5230\u5bb9\u5668\u5373\u53ef"),(0,a.kt)("li",{parentName:"ul"},"\u6ce8\u610f\u52a0 tsc \u63d2\u4ef6\u5904\u7406 decorator"))))),(0,a.kt)("li",{parentName:"ul"},"\u57fa\u7840\u4f9d\u8d56",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"zod"),(0,a.kt)("li",{parentName:"ul"},"valtio, zustand"),(0,a.kt)("li",{parentName:"ul"},"daisyui, styled-components"),(0,a.kt)("li",{parentName:"ul"},"dayjs")))),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"pnpm node --loader ts-node/esm --watch ./src/apps/ve-contract-server/main.ts\n")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-json",metastring:'title="tsconfig.json"',title:'"tsconfig.json"'}),'{\n  "ts-node": {\n    "transpileOnly": true,\n    "swc": true,\n    "esm": true,\n    "files": true,\n    "experimentalSpecifierResolution": "node"\n  }\n}\n')),(0,a.kt)("h2",m({},{id:"arm64aarch64-musl"}),"arm64/aarch64 musl"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6682\u65e0"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/nodejs/node/pull/45756"}),"https://github.com/nodejs/node/pull/45756")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/nodejs/unofficial-builds/pull/59"}),"https://github.com/nodejs/unofficial-builds/pull/59"))),(0,a.kt)("h2",m({},{id:"source-map"}),"source map"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"sourcemap \u5927\u4e86\u8fc7\u540e\u975e\u5e38\u6162"),(0,a.kt)("li",{parentName:"ul"},"\u6392\u9664 node_modules ",(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/evanw/esbuild/issues/1685#issuecomment-944916409"}),"https://github.com/evanw/esbuild/issues/1685#issuecomment-944916409")),(0,a.kt)("li",{parentName:"ul"},"\u4f8b\u5982: main.mjs 10mb, main.mjs.map 20mb",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"--enable-source-maps \u542f\u52a8 40s"),(0,a.kt)("li",{parentName:"ul"},"\u65e0 ",(0,a.kt)("inlineCode",{parentName:"li"},"enable-source-maps")," \u542f\u52a8 2s"))),(0,a.kt)("li",{parentName:"ul"},"NodeJS 12.12.0 ",(0,a.kt)("a",m({parentName:"li"},{href:"https://nodejs.org/docs/latest-v16.x/api/cli.html#--enable-source-maps"}),"--enable-source-maps")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/evanw/node-source-map-support"}),"https://github.com/evanw/node-source-map-support"))),(0,a.kt)("h2",m({},{id:"cjs-__dirname"}),"cjs ",(0,a.kt)("inlineCode",{parentName:"h2"},"__dirname")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-js"}),"import * as url from 'url';\nconst __filename = url.fileURLToPath(import.meta.url);\nconst __dirname = url.fileURLToPath(new URL('.', import.meta.url));\n")),(0,a.kt)("h2",m({},{id:"\u76f4\u63a5\u6267\u884c-typescript-\u6216-esnext"}),"\u76f4\u63a5\u6267\u884c typescript \u6216 esnext"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"tsx"),(0,a.kt)("li",{parentName:"ul"},"ts-node"),(0,a.kt)("li",{parentName:"ul"},"babel"),(0,a.kt)("li",{parentName:"ul"},"tsm")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# tsx\n# ==========\nnpx tsx app.ts\nnode --loader tsx app.ts\nnode --loader @esbuild-kit/esm-loader app.ts\n\n# ts-node\n# ==========\nnode -r @ts-node/register app.ts\n# tsconfig \u91cc\u7684 path \u80fd\u751f\u6548\nnode -r @ts-node/register -r tsconfig-paths/register app.ts\n\n# babel\n# ==========\nnode -r @babel/register app.js\n")),(0,a.kt)("h2",m({},{id:"package-openexr-required-by-vips-not-found"}),"Package 'OpenEXR', required by 'vips', not found"),(0,a.kt)("p",null,"\u627e\u4e0d\u5230 brew \u5b89\u88c5\u7684 pkgconfig"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"PKG_CONFIG_PATH=/usr/local/opt/vips/lib/pkgconfig:/usr/local/opt/glib/lib/pkgconfig:/usr/local/opt/openexr/lib/pkgconfig:/usr/local/opt/imath/lib/pkgconfig npm i\n")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{}),"/usr/local/include/vips/vips8:35:10: fatal error: 'glib-object.h' file not found\n")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# export CC\nexport CXX="$(which g++) -I/usr/local/opt/glib/include/glib-2.0/ -I/usr/local/opt/glib/lib/glib-2.0/include/"\n\nexport CXX="$(which g++) $(pkg-config --cflags glib-2.0)"\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"sharp -> libvips version 8.12.2+ is required"),(0,a.kt)("li",{parentName:"ul"},"ubuntu 22.04 jammy",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://packages.ubuntu.com/search?searchon=sourcenames&keywords=vips"}),"https://packages.ubuntu.com/search?searchon=sourcenames&keywords=vips"))))),(0,a.kt)("h2",m({},{id:"libtool-unrecognized-option--static-when-building"}),"libtool: unrecognized option -static when building"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{}),"libtool:   error: unrecognised option: '-static'\n")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"brew unlink libtool\nrm -rf /usr/local/bin/libtool\nwhich libtool\n\n# \u5982\u679c\u6dfb\u52a0\u4e86 /usr/local/opt/libtool/libexec/gnubin\nexport PATH=$(echo $PATH | sed -r 's/:[^:]*?libtool[^:]*:/:/')\n")),(0,a.kt)("h2",m({},{id:"require-of-es-modules-is-not-supported"}),"require() of ES modules is not supported"),(0,a.kt)("p",null,"\u5c1d\u8bd5\u964d\u7ea7\u4f9d\u8d56"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'ts \u53ef\u914d\u7f6e "module": "esnext"'),(0,a.kt)("li",{parentName:"ul"},"\u7136\u540e package.json \u4fee\u6539 type: module",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u5f71\u54cd\u5f88\u5927"))),(0,a.kt)("li",{parentName:"ul"},"\u53c2\u8003",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/node-fetch/node-fetch/issues/1266"}),"node-fetch/node-fetch#1266"))))),(0,a.kt)("h2",m({},{id:"nodejs-v18-fetch-proxy"}),"NodeJS v18 fetch proxy"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301 Agent"),(0,a.kt)("li",{parentName:"ul"},"\u7528 node-fetch \u6216\u8005 undici")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-js"}),"const Undici = requuire('undici');\nconst ProxyAgent = Undici.ProxyAgent;\nconst setGlobalDispatcher = Undici.setGlobalDispatcher;\n\nsetGlobalDispatcher(new ProxyAgent(process.env.HTTP_PROXY));\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/nodejs/node/issues/43187"}),"node#43187")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/gajus/global-agent/issues/52#issuecomment-1134525621"}),"gajus/global-agent#52"))),(0,a.kt)("h2",m({},{id:"requestinit-duplex-option-is-required-when-sending-a-body"}),"RequestInit: duplex option is required when sending a body"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/nodejs/node/issues/46221"}),"https://github.com/nodejs/node/issues/46221"))),(0,a.kt)("h2",m({},{id:"critical-dependency-require-function-is-used-in-a-way-in-which-dependencies-cannot-be-statically-extracted"}),"Critical dependency: require function is used in a way in which dependencies cannot be statically extracted"),(0,a.kt)("p",null,"\u68c0\u67e5\u4e0b\u662f\u4e0d\u662f import \u8def\u5f84\u9519\u8bef\uff0c\u53ef\u80fd\u56e0\u4e3a IDE \u81ea\u52a8\u5bfc\u5165\uff0c\u6307\u5411\u4e86\u9519\u8bef\u8def\u5f84\u3002"),(0,a.kt)("h2",m({},{id:"gyp"}),"gyp"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f9d\u8d56 apk add --no-cache python3 g++ gcc make",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u6700\u597d\u4f7f\u7528 prebuild"),(0,a.kt)("li",{parentName:"ul"},"\u5982\u679c\u51fa\u73b0\u4e86\u4ece\u6e90\u7801\u6784\u5efa\uff0c\u5148\u6392\u67e5\u4e3a\u4ec0\u4e48\u4f1a\u5bfc\u81f4\u6784\u5efa")))),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# \u5f3a\u5236\u4ece\u6e90\u7801\u6784\u5efa\nnpm install sqlite3 --build-from-source=sqlite3\n\n# \u67e5\u770b binary \u5730\u5740\n# \u6ce8\u610f module_name \u53ef\u80fd\u4e0d\u540c\u4e8e npm \u5305\u540d\nnpm view sqlite3@3.1.3 binary             # aws\nnpm view sqlite3@5.1.0 binary.module_name # github\n\n# install \u5305\u542b platform \u548c libc \u6761\u4ef6\nnpm install --platform=linux --libc=libc --registry https://npm.wener.me/\n\nnpm install sqlite3 --node_sqlite3_binary_host_mirror=https://npmmirror.com/mirrors/sqlite3\n\n# \u6839\u636e\u5e73\u53f0 rebuild\nnode-pre-gyp rebuild --target=0.30.2 --arch=x32 --target_platform=win32 --dist-url=https://atom.io/download/atom-shell\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"--{module_name}","_","binary_host_mirror")),(0,a.kt)("h2",m({},{id:"undefined-variable-module_name-in-bindinggyp-while-trying-to-load-bindinggyp"}),"Undefined variable module_name in binding.gyp while trying to load binding.gyp"),(0,a.kt)("p",null,"\u53ef\u80fd npm \u95ee\u9898\uff0c\u4f7f\u7528 pnpm \u6784\u5efa\u6ca1\u95ee\u9898"),(0,a.kt)("h2",m({},{id:"custom-esm-loaders-is-an-experimental-feature-this-feature-could-change-at-any-time"}),"Custom ESM Loaders is an experimental feature. This feature could change at any time"),(0,a.kt)("p",null,"\u76ee\u524d\u65e0\u6cd5 supress \u8b66\u544a, \u53ea\u80fd\u901a\u8fc7 require \u6ce8\u5165\u907f\u514d"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"node --require suppress-experimental.cjs --loader tsx app.ts\n")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-js",metastring:'title="suppress-experimental.cjs"',title:'"suppress-experimental.cjs"'}),"'use strict';\n// When using the ESM loader Node.js prints either of the following warnings\n//\n// - ExperimentalWarning: --experimental-loader is an experimental feature. This feature could change at any time\n// - ExperimentalWarning: Custom ESM Loaders is an experimental feature. This feature could change at any time\n//\n// Having this warning show up once is \"fine\" but it's also printed\n// for each Worker that is created so it ends up spamming stderr.\n// Since that doesn't provide any value we suppress the warning.\nconst originalEmit = process.emit;\n// @ts-expect-error - TS complains about the return type of originalEmit.apply\nprocess.emit = function (name, data, ...args) {\n  if (\n    name === `warning` &&\n    typeof data === `object` &&\n    data.name === `ExperimentalWarning` &&\n    (data.message.includes(`--experimental-loader`) ||\n      data.message.includes(`Custom ESM Loaders is an experimental feature`))\n  )\n    return false;\n\n  // return originalEmit.apply(process, arguments as unknown as Parameters<typeof process.emit>);\n  return originalEmit.apply(process, arguments);\n};\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/nodejs/node/issues/30810"}),"https://github.com/nodejs/node/issues/30810"))),(0,a.kt)("h2",m({},{id:"ineffective-mark-compacts-near-heap-limit-allocation-failed---javascript-heap-out-of-memory"}),"Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u53ef\u589e\u52a0")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"node -e 'console.log(v8.getHeapStatistics().heap_size_limit/(1024*1024))'\nNODE_OPTIONS=\"--max-old-space-size=8192\" node -e 'console.log(v8.getHeapStatistics().heap_size_limit/(1024*1024))'\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"2048"),(0,a.kt)("li",{parentName:"ul"},"4096"),(0,a.kt)("li",{parentName:"ul"},"5120"),(0,a.kt)("li",{parentName:"ul"},"6144"),(0,a.kt)("li",{parentName:"ul"},"7168"),(0,a.kt)("li",{parentName:"ul"},"8192"),(0,a.kt)("li",{parentName:"ul"},"16384")),(0,a.kt)("h2",m({},{id:"cant-resolve-pg-native"}),"Can't resolve 'pg-native'"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7528\u4e2a\u5047\u7684\u6a21\u5757\u66ff\u4ee3\uff0c\u907f\u514d\u7f16\u8bd1"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/brianc/node-postgres/issues/838"}),"https://github.com/brianc/node-postgres/issues/838"),"\nwhen using babel, pg-native is always required")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-js"}),"// webpack\nexport default {\n  resolve: {\n    alias: {\n      'pg-native': path.join(__dirname, 'pg-native'),\n    },\n  },\n};\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"pg-native")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-json"}),'{\n  "name": "pg-native",\n  "private": true,\n  "main": "index.js"\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-json"}),'{\n  "name": "your-module",\n  "private": true,\n  "dependencies": {\n    "pg": "^8.3.3",\n    "pg-native": "file:./modules/pg-native"\n  }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-js"}),"module.exports = null;\n")),(0,a.kt)("h2",m({},{id:"repl-load"}),"REPL load"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'node -i -e "$(< rc.js)"\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},".load"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://nodejs.org/api/repl.html#repl_design_and_features"}),"https://nodejs.org/api/repl.html#repl_design_and_features"))))),(0,a.kt)("h2",m({},{id:"error0308010cdigital-envelope-routinesunsupported"}),"error:0308010C:digital envelope routines::unsupported"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"export NODE_OPTIONS=--openssl-legacy-provider\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://stackoverflow.com/questions/69692842"}),"https://stackoverflow.com/questions/69692842"))),(0,a.kt)("h2",m({},{id:"snapshot"}),"snapshot"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528 snapshot \u52a0\u901f\u542f\u52a8",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u4f8b\u5982: main.mjs 10mb, main.mjs.map 20mb",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"--enable-source-maps \u542f\u52a8 40s"),(0,a.kt)("li",{parentName:"ul"},"\u65e0 ",(0,a.kt)("inlineCode",{parentName:"li"},"enable-source-maps")," \u542f\u52a8 2s")))))),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"echo \"globalThis.foo = 'I am from the snapshot'\" > snapshot.js\nnode --snapshot-blob snapshot.blob --build-snapshot snapshot.js\necho \"console.log(globalThis.foo)\" > index.js\nnode --snapshot-blob snapshot.blob index.js\n\necho \"require('v8').startupSnapshot.setDeserializeMainFunction(() => console.log('I am from the snapshot'))\" > snapshot.js\nnode --snapshot-blob snapshot.blob --build-snapshot snapshot.js\nnode --snapshot-blob snapshot.blob\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301 ESM ",(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/nodejs/help/issues/3981"}),"https://github.com/nodejs/help/issues/3981")),(0,a.kt)("li",{parentName:"ul"},"RFC: speeding up Node.js startup using V8 snapshot ",(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/nodejs/node/issues/17058"}),"#17058")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",m({parentName:"li"},{href:"https://github.com/microsoft/TypeScript/issues/25658"}),"https://github.com/microsoft/TypeScript/issues/25658"))),(0,a.kt)("h2",m({},{id:"fastify-vs-express"}),"fastify vs express"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"fastify",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u66f4\u5feb",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"fast-json-stringify"))),(0,a.kt)("li",{parentName:"ul"},"\u6a21\u5757\u5316"),(0,a.kt)("li",{parentName:"ul"},"\u66f4\u6613\u7528"))),(0,a.kt)("li",{parentName:"ul"},"express",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u66f4\u6210\u719f\uff1f"),(0,a.kt)("li",{parentName:"ul"},"monolithic"),(0,a.kt)("li",{parentName:"ul"},"\u751f\u6001\u66f4\u5927 - \u529f\u80fd\u66f4\u591a")))),(0,a.kt)("h2",m({},{id:"import-npm-global"}),"import npm global"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"export NODE_PATH=$(npm root --quiet -g)\n")))}f.isMDXComponent=!0}}]);