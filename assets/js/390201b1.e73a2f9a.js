/*! For license information please see 390201b1.e73a2f9a.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[89473],{8302:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var n=t(11527),r=t(47214);const s={tags:["FAQ"]},a="FAQ",i={id:"devops/kubernetes/app/argo/workflow/argo-workflow-faq",title:"FAQ",description:"failed to save outputs timed out waiting for the condition",source:"@site/../notes/devops/kubernetes/app/argo/workflow/argo-workflow-faq.md",sourceDirName:"devops/kubernetes/app/argo/workflow",slug:"/devops/kubernetes/app/argo/workflow/faq",permalink:"/notes/devops/kubernetes/app/argo/workflow/faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/app/argo/workflow/argo-workflow-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1693804740,formattedLastUpdatedAt:"Sep 4, 2023",frontMatter:{tags:["FAQ"]},sidebar:"docs",previous:{title:"Executor",permalink:"/notes/devops/kubernetes/app/argo/workflow/executor"},next:{title:"ArgoCD",permalink:"/notes/devops/kubernetes/app/argocd/"}},c={},d=[{value:"failed to save outputs: Failed to establish pod watch: timed out waiting for the condition",id:"failed-to-save-outputs-failed-to-establish-pod-watch-timed-out-waiting-for-the-condition",level:2},{value:"failed to save outputs: unexpected non 200 status code: 403, body: Forbidden (user=system:serviceaccount:argo, verb=get, resource=nodes, subresource=proxy)",id:"failed-to-save-outputs-unexpected-non-200-status-code-403-body-forbidden-usersystemserviceaccountargo-verbget-resourcenodes-subresourceproxy",level:2}];function u(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.h1,{id:"faq",children:"FAQ"}),"\n",(0,n.jsx)(o.h2,{id:"failed-to-save-outputs-failed-to-establish-pod-watch-timed-out-waiting-for-the-condition",children:"failed to save outputs: Failed to establish pod watch: timed out waiting for the condition"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["argo \u4f7f\u7528 ns \u4e0b\u7684 default ServiceAccount\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"\u4e00\u822c\u8be5 sa \u6ca1\u6709 watch pod \u7684\u6743\u9650"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"# namespaced \u5b89\u88c5 - SA \u65e0\u6743\u9650\nkubectl auth can-i get pod --as=system:serviceaccount:argo:default\n"})}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.strong,{children:"\u6700\u5c0f\u6743\u9650"})}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-yaml",children:"apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: workflow-role\nrules:\n  # pod get/watch is used to identify the container IDs of the current pod\n  # pod patch is used to annotate the step's outputs back to controller (e.g. artifact location)\n  - apiGroups:\n      - ''\n    resources:\n      - pods\n    verbs:\n      - get\n      - watch\n      - patch\n  # logs get/watch are used to get the pods logs for script outputs, and for log archival\n  - apiGroups:\n      - ''\n    resources:\n      - pods/log\n    verbs:\n      - get\n      - watch\n"})}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["\u53c2\u8003\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://github.com/argoproj/argo-workflows/issues/2522",children:"https://github.com/argoproj/argo-workflows/issues/2522"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://github.com/argoproj/argo-workflows/blob/master/docs/workflow-rbac.md",children:"https://github.com/argoproj/argo-workflows/blob/master/docs/workflow-rbac.md"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"failed-to-save-outputs-unexpected-non-200-status-code-403-body-forbidden-usersystemserviceaccountargo-verbget-resourcenodes-subresourceproxy",children:"failed to save outputs: unexpected non 200 status code: 403, body: Forbidden (user=system:serviceaccount:argo:default, verb=get, resource=nodes, subresource=proxy)"}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.code,{children:"nodes/proxy"})," \u6743\u9650\u4e0d\u8db3\uff0c\u8be5\u8d44\u6e90\u662f\u96c6\u7fa4\u8d44\u6e90"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-yaml",children:"---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: argo-executor\nrules:\n  # pod get/watch is used to identify the container IDs of the current pod\n  # pod patch is used to annotate the step's outputs back to controller (e.g. artifact location)\n  - apiGroups:\n      - ''\n    resources:\n      - pods\n    verbs:\n      - get\n      - watch\n      - patch\n  # logs get/watch are used to get the pods logs for script outputs, and for log archival\n  - apiGroups:\n      - ''\n    resources:\n      - pods/log\n      - nodes/proxy\n    verbs:\n      - get\n      - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: argo-executor\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: argo-executor\nsubjects:\n  - kind: ServiceAccount\n    name: default\n    namespace: argo\n"})})]})}function l(e={}){const{wrapper:o}={...(0,r.a)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},3354:(e,o,t)=>{var n=t(50959),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,o,t){var n,s={},d=null,u=null;for(n in void 0!==t&&(d=""+t),void 0!==o.key&&(d=""+o.key),void 0!==o.ref&&(u=o.ref),o)a.call(o,n)&&!c.hasOwnProperty(n)&&(s[n]=o[n]);if(e&&e.defaultProps)for(n in o=e.defaultProps)void 0===s[n]&&(s[n]=o[n]);return{$$typeof:r,type:e,key:d,ref:u,props:s,_owner:i.current}}o.Fragment=s,o.jsx=d,o.jsxs=d},11527:(e,o,t)=>{e.exports=t(3354)},47214:(e,o,t)=>{t.d(o,{Z:()=>i,a:()=>a});var n=t(50959);const r={},s=n.createContext(r);function a(e){const o=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);