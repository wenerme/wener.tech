/*! For license information please see f1444a88.de1958ca.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[33474],{97752:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var s=r(11527),t=r(47214);const i={title:"Prometheus K8S",tags:["Kubernetes","Operator"]},o="Prometheus K8S",l={id:"service/observability/metrics/prometheus/prometheus-k8s",title:"Prometheus K8S",description:"- metrics-server",source:"@site/../notes/service/observability/metrics/prometheus/prometheus-k8s.md",sourceDirName:"service/observability/metrics/prometheus",slug:"/service/observability/metrics/prometheus/k8s",permalink:"/notes/service/observability/metrics/prometheus/k8s",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/observability/metrics/prometheus/prometheus-k8s.md",tags:[{label:"Kubernetes",permalink:"/notes/tags/kubernetes"},{label:"Operator",permalink:"/notes/tags/operator"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1705291463,formattedLastUpdatedAt:"Jan 15, 2024",frontMatter:{title:"Prometheus K8S",tags:["Kubernetes","Operator"]},sidebar:"docs",previous:{title:"Prometheus \u8054\u90a6",permalink:"/notes/service/observability/metrics/prometheus/federation"},next:{title:"Prometheus \u5b58\u50a8",permalink:"/notes/service/observability/metrics/prometheus/storage"}},a={},c=[{value:"kubernetes_sd_config",id:"kubernetes_sd_config",level:2},{value:"prometheus-operator",id:"prometheus-operator",level:2},{value:"Charts",id:"charts",level:2},{value:"prometheus-operator/kube-prometheus",id:"prometheus-operatorkube-prometheus",level:2},{value:"kube-prometheus-stack",id:"kube-prometheus-stack",level:2},{value:"bitnami/kube-prometheus",id:"bitnamikube-prometheus",level:2},{value:"<del>stable/prometheus-operator</del>",id:"stableprometheus-operator",level:2},{value:"<del>stable/prometheus</del>",id:"stableprometheus",level:2},{value:"CustomResourceDefinition.apiextensions.k8s.io &quot;prometheuses.monitoring.coreos.com&quot; is invalid: metadata.annotations: Too long: must have at most 262144 bytes",id:"customresourcedefinitionapiextensionsk8sio-prometheusesmonitoringcoreoscom-is-invalid-metadataannotations-too-long-must-have-at-most-262144-bytes",level:2},{value:"spec.scrapeConfigSelector: field not declared in schema",id:"specscrapeconfigselector-field-not-declared-in-schema",level:2}];function h(e){const n={a:"a",code:"code",del:"del",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"prometheus-k8s",children:"Prometheus K8S"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/metrics-server",children:"metrics-server"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/metrics-server/issues/7",children:"https://github.com/kubernetes-sigs/metrics-server/issues/7"})}),"\n",(0,s.jsx)(n.li,{children:"\u4e0d\u662f\u7528\u6765\u5bf9\u5916\u63d0\u4f9b\u6307\u6807\u7684\u670d\u52a1"}),"\n",(0,s.jsx)(n.li,{children:"\u4e3a\u5185\u90e8 HPA VPA \u670d\u52a1\u63d0\u4f9b Pod \u8d44\u6e90\u6307\u6807"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u6781\u5c11\u7684\u8d44\u6e90 - 0.5m CPU, 4 MB \u6bcf\u8282\u70b9"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/kubernetes-monitoring/kubernetes-mixin",children:"kubernetes-monitoring/kubernetes-mixin"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Grafana dashboards and Prometheus alerts for Kubernetes."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/kubernetes/kube-state-metrics",children:"kubernetes/kube-state-metrics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Add-on agent to generate and expose cluster-level metrics."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["cadvisor \u63d0\u4f9b\u4e86\u5bb9\u5668\u6307\u6807\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md",children:"https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://runbooks.prometheus-operator.dev/",children:"https://runbooks.prometheus-operator.dev/"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"kubernetes_sd_config",children:"kubernetes_sd_config"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config",children:"kubernetes_sd_config"})}),"\n",(0,s.jsxs)(n.li,{children:["\u793a\u4f8b\u914d\u7f6e ",(0,s.jsx)(n.a,{href:"https://github.com/prometheus/prometheus/blob/master/documentation/examples/prometheus-kubernetes.yml",children:"prometheus-kubernetes.yml"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u652f\u6301\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"node"}),"\n",(0,s.jsx)(n.li,{children:"service"}),"\n",(0,s.jsx)(n.li,{children:"pod"}),"\n",(0,s.jsx)(n.li,{children:"endpoints"}),"\n",(0,s.jsx)(n.li,{children:"ingres"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prometheus-operator",children:"prometheus-operator"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/prometheus-operator/prometheus-operator",children:"prometheus-operator/prometheus-operator"})}),"\n",(0,s.jsxs)(n.li,{children:["\u529f\u80fd\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u901a\u8fc7 CRD \u6765\u90e8\u7f72\u7ba1\u7406 Prometheus\uff0cAlertmanager \u7b49\u7ec4\u4ef6"}),"\n",(0,s.jsx)(n.li,{children:"\u7b80\u5316\u914d\u7f6e - versions, persistence, retention policies, replicas"}),"\n",(0,s.jsx)(n.li,{children:"Prometheus Target \u914d\u7f6e - \u81ea\u52a8\u76d1\u63a7\u76ee\u6807\u914d\u7f6e - \u901a\u8fc7 annotation \u53d1\u73b0"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u4e4b\u524d\u662f coreos/prometheus-operator\uff0c\u81ea 0.41 \u5f00\u59cb\u53bb coreos\uff0c\u79fb\u5230\u72ec\u7acb\u7ec4\u7ec7 prometheus-operator \u4e0b"}),"\n",(0,s.jsxs)(n.li,{children:["CRD\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Prometheus - \u90e8\u7f72 Prometheus"}),"\n",(0,s.jsx)(n.li,{children:"Alertmanager - \u90e8\u7f72 Alertmanager"}),"\n",(0,s.jsx)(n.li,{children:"ThanosRuler - \u90e8\u7f72 thano rule"}),"\n",(0,s.jsx)(n.li,{children:"ServiceMonitor - \u914d\u7f6e service \u76d1\u63a7"}),"\n",(0,s.jsx)(n.li,{children:"PodMonitor - \u914d\u7f6e pod \u76d1\u63a7"}),"\n",(0,s.jsxs)(n.li,{children:["Probe - \u914d\u7f6e\u9759\u6001\u76d1\u63a7\u76ee\u6807\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"blackbox_exporter"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"PrometheusRule - \u914d\u7f6e \u544a\u8b66/\u8bb0\u5f55 \u89c4\u5219"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u76d1\u63a7\u5916\u90e8\u53ef\u4f7f\u7528 Service/externalName + ServiceMonitor \u6216\u4f7f\u7528 additionalScrapeConfigs \u9759\u6001\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/api.md",children:"API"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl api-resources --api-group monitoring.coreos.com\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="Pod Annotations"',children:"# \u5f00\u542f\u540e\u6293\u53d6\u6240\u6709\u7aef\u53e3\nprometheus.io/scrape: 'true'\nprometheus.io/path: '/metrics'\nprometheus.io/port: '80'\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus",children:"https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"---\n# \u5b9a\u4e49\u90e8\u7f72 Prometheus\nkind: Prometheus\napiVersion: monitoring.coreos.com/v1\nmetadata:\n  name: kube-prometheus-prometheus\n  namespace: monitoring\nspec:\n  # \u989d\u5916\u7684\u6293\u53d6\u914d\u7f6e\n  additionalScrapeConfigs:\n    name: additional-scrape-configs\n    key: prometheus-additional.yaml\n  affinity: {} # \u8282\u70b9\u4eb2\u548c\n  alerting:\n    alertmanagers:\n      - name: kube-prometheus-alertmanager\n        namespace: monitoring\n        pathPrefix: /\n        port: http\n  enableAdminAPI: false\n  # \u6dfb\u52a0\u989d\u5916\u6807\u7b7e - \u591a\u96c6\u7fa4/\u79df\u6237 \u53ef\u7528\u4e8e\u6807\u8bb0\n  externalLabels:\n    cluster: wener\n  externalUrl: 'http://kube-prometheus-prometheus.monitoring:9090/'\n  image: 'docker.io/bitnami/prometheus:2.20.1-debian-10-r12'\n  listenLocal: false\n  logFormat: logfmt\n  logLevel: info\n  paused: false\n  podMetadata:\n    labels:\n      app.kubernetes.io/component: prometheus\n      app.kubernetes.io/instance: kube-prometheus\n      app.kubernetes.io/name: kube-prometheus\n  podMonitorNamespaceSelector: {}\n  podMonitorSelector: {}\n  probeNamespaceSelector: {}\n  probeSelector: {}\n  # \u8fdc\u7a0b\u5199 - \u914d\u7f6e\u7c7b\u4f3c\u4e8e prometheus \u7684 remote_write\n  remoteWrite:\n    - name: my-remote\n      remoteTimeout: 120s\n      url: 'https://receive.example.com/api/v1/receive'\n      # proxyUrl: ''\n      # tlsConfig: {}\n      # writeRelabelConfigs: {}\n\n      # basic auth \u7684 secret\n      basicAuth:\n        password:\n          key: password\n          name: prometheus-basic-auth\n          optional: false\n        username:\n          key: username\n          name: prometheus-basic-auth\n          optional: false\n      # \u961f\u5217\u914d\u7f6e - \u8c03\u4f18\u65f6\u4f7f\u7528\n      queueConfig:\n        # \u9ed8\u8ba4 5s\n        batchSendDeadline: 10s\n        # \u9ed8\u8ba4 500\n        capacity: 2500\n\n        # \u76ee\u524d promethues \u662f\u6ca1\u6709\u5b9e\u73b0\u7684\n        maxRetries: 0\n        # \u9ed8\u8ba4 100\n        maxSamplesPerSend: 5000\n        maxShards: 1000\n        minShards: 1\n\n        minBackoff: 30ms\n        maxBackoff: 100ms\n  remoteRead: []\n  replicas: 1\n  resources: {}\n  retention: 10d\n  retentionSize: 6GB\n  routePrefix: /\n  ruleNamespaceSelector: {}\n  ruleSelector: {}\n  securityContext:\n    fsGroup: 1001\n    runAsUser: 1001\n  serviceAccountName: kube-prometheus-prometheus\n  serviceMonitorNamespaceSelector: {}\n  serviceMonitorSelector: {}\n  # Prometheus \u672c\u5730\u5b58\u50a8\n  storage:\n    volumeClaimTemplate:\n      spec:\n        accessModes:\n          - ReadWriteOnce\n        resources:\n          requests:\n            storage: 8Gi\n        storageClassName: local-path\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"additionalScrapeConfigs"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- job_name: 'prometheus'\n  static_configs:\n    - targets: ['localhost:9090']\n"})}),"\n",(0,s.jsx)(n.h2,{id:"charts",children:"Charts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/prometheus-community/helm-charts/",children:"https://github.com/prometheus-community/helm-charts/"})}),"\n",(0,s.jsx)(n.li,{children:"kube-prometheus-stack"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prometheus-operatorkube-prometheus",children:"prometheus-operator/kube-prometheus"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u901a\u8fc7 jsonet \u5b9a\u5236\u5316\u548c\u5b89\u88c5"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/prometheus-operator/kube-prometheus",children:"prometheus-operator/kube-prometheus"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u7ec4\u4ef6\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Prometheus Operator"}),"\n",(0,s.jsx)(n.li,{children:"HA Prometheus"}),"\n",(0,s.jsx)(n.li,{children:"HA Alertmanager"}),"\n",(0,s.jsx)(n.li,{children:"node-exporter"}),"\n",(0,s.jsx)(n.li,{children:"Kubernetes Metrics APIs Prometheus Adapter"}),"\n",(0,s.jsx)(n.li,{children:"kube-state-metrics"}),"\n",(0,s.jsx)(n.li,{children:"Grafana"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"kube-prometheus-stack",children:"kube-prometheus-stack"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6709 grafana - \u4f46\u4e0d\u63a8\u8350"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"bitnamikube-prometheus",children:"bitnami/kube-prometheus"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/bitnami/charts/tree/master/bitnami/kube-prometheus",children:"https://github.com/bitnami/charts/tree/master/bitnami/kube-prometheus"})}),"\n",(0,s.jsxs)(n.li,{children:["\u5305\u542b\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Prometheus Operator"}),"\n",(0,s.jsxs)(n.li,{children:["Prometheus\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4f1a\u901a\u8fc7 Operator \u90e8\u7f72"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Alertmanager"}),"\n",(0,s.jsx)(n.li,{children:"kube-state-metrics"}),"\n",(0,s.jsx)(n.li,{children:"node-exporter"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u9ed8\u8ba4 scrapeInterval: 30s\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["prometheus \u9ed8\u8ba4 1m ",(0,s.jsx)(n.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/",children:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u56fd\u5185\u65e0\u6cd5\u8bbf\u95ee\u8be5 Repo\uff0c\u53ef\u4f7f\u7528 https://charts.wener.tech \u6216 https://wenerme.github.io/charts\nhelm repo add bitnami https://charts.bitnami.com/bitnami\nhelm install kube-prometheus -n monitoring bitnami/kube-prometheus\n\nkubectl -n monitoring describe svc/kube-prometheus-prometheus\n\n# http://127.0.0.1:9090\nkubectl -n monitoring port-forward svc/kube-prometheus-prometheus 9090\n"})}),"\n",(0,s.jsx)(n.h2,{id:"stableprometheus-operator",children:(0,s.jsx)(n.del,{children:"stable/prometheus-operator"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["helm ",(0,s.jsx)(n.a,{href:"https://github.com/helm/charts/tree/master/stable/prometheus-operator",children:"stable/prometheus-operator"})]}),"\n",(0,s.jsx)(n.li,{children:"\u7c7b\u4f3c\u4e8e kube-prometheus\uff0c\u4f46\u901a\u8fc7 helm \u5b89\u88c5"}),"\n",(0,s.jsxs)(n.li,{children:["\u66f4\u65b0\u7ef4\u62a4\u8f83\u6162\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u76ee\u524d\u8fd8\u662f\u57fa\u4e8e coreos/prometheus-operator 0.38"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5185\u5bb9\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"stable/kube-state-metrics"}),"\n",(0,s.jsx)(n.li,{children:"stable/prometheus-node-exporter"}),"\n",(0,s.jsx)(n.li,{children:"stable/grafana"}),"\n",(0,s.jsx)(n.li,{children:"prometheus-operator"}),"\n",(0,s.jsx)(n.li,{children:"prometheus"}),"\n",(0,s.jsx)(n.li,{children:"alertmanager"}),"\n",(0,s.jsx)(n.li,{children:"node-exporter"}),"\n",(0,s.jsx)(n.li,{children:"kube-state-metrics"}),"\n",(0,s.jsxs)(n.li,{children:["service monitors\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u76d1\u63a7 kube \u7ec4\u4ef6"}),"\n",(0,s.jsx)(n.li,{children:"kube-apiserver\u3001kube-scheduler\u3001kube-controller-manager\u3001etcd\u3001kube-dns/coredns\u3001kube-proxy"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u4f1a\u914d\u7f6e dashboards \u548c alters"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u9ed8\u8ba4\u5bfc\u5165 ",(0,s.jsx)(n.a,{href:"https://github.com/kubernetes-monitoring/kubernetes-mixin",children:"kubernetes-monitoring/kubernetes-mixin"})," \u56fe\u8868"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4e0e stable/prometheus \u76f8\u6bd4\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u591a\u4e86 grafana\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9762\u677f\u914d\u7f6e"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u591a\u4e86 kube \u7ec4\u4ef6\u76d1\u63a7"}),"\n",(0,s.jsxs)(n.li,{children:["\u591a\u4e86 operator \u7528\u4e8e\u90e8\u7f72\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Prometheus"}),"\n",(0,s.jsx)(n.li,{children:"Alertmanager"}),"\n",(0,s.jsx)(n.li,{children:"ThanosRuler"}),"\n",(0,s.jsx)(n.li,{children:"ServiceMonitor"}),"\n",(0,s.jsx)(n.li,{children:"PodMonitor"}),"\n",(0,s.jsx)(n.li,{children:"Probe"}),"\n",(0,s.jsx)(n.li,{children:"PrometheusRule"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"stableprometheus",children:(0,s.jsx)(n.del,{children:"stable/prometheus"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5355\u7eaf\u90e8\u7f72 prometheus"}),"\n",(0,s.jsxs)(n.li,{children:["\u5305\u542b\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"alertmanager"}),"\n",(0,s.jsx)(n.li,{children:"node-exporter"}),"\n",(0,s.jsx)(n.li,{children:"pushgateway"}),"\n",(0,s.jsxs)(n.li,{children:["configmap-reload - ",(0,s.jsx)(n.a,{href:"https://github.com/jimmidyson/configmap-reload",children:"https://github.com/jimmidyson/configmap-reload"})]}),"\n",(0,s.jsx)(n.li,{children:"kube-state-metrics"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Pod \u6ce8\u89e3\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'prometheus.io/scrape: "true"'}),"\n",(0,s.jsx)(n.li,{children:"prometheus.io/path: /metrics"}),"\n",(0,s.jsx)(n.li,{children:'prometheus.io/port: "8080"'}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["prometheus \u9ed8\u8ba4 ",(0,s.jsx)(n.code,{children:"--storage.tsdb.retention.time"})," 15d"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"server:\n  persistentVolume:\n    enabled: false\n  global:\n    scrape_interval: 10s\n\nalertmanager:\n  enabled: false\npushgateway:\n  enabled: false\n"})}),"\n",(0,s.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(n.h2,{id:"customresourcedefinitionapiextensionsk8sio-prometheusesmonitoringcoreoscom-is-invalid-metadataannotations-too-long-must-have-at-most-262144-bytes",children:'CustomResourceDefinition.apiextensions.k8s.io "prometheuses.monitoring.coreos.com" is invalid: metadata.annotations: Too long: must have at most 262144 bytes'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/prometheus-operator/prometheus-operator/issues/4355",children:"https://github.com/prometheus-operator/prometheus-operator/issues/4355"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"syncPolicy:\n  syncOptions:\n  - ServerSideApply=true\n  - CreateNamespace=true\n"})}),"\n",(0,s.jsx)(n.h2,{id:"specscrapeconfigselector-field-not-declared-in-schema",children:"spec.scrapeConfigSelector: field not declared in schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create new CRDs, e.g.:\nkubectl create -f crd-prometheusagents.yaml\nkubectl create -f crd-scrapeconfigs.yaml\n\n# Patch existing CRDs, e.g.:\nkubectl patch crd alertmanagerconfigs.monitoring.coreos.com --patch-file crd-alertmanagerconfigs.yaml\nkubectl patch crd alertmanagers.monitoring.coreos.com       --patch-file crd-alertmanagers.yaml\nkubectl patch crd podmonitors.monitoring.coreos.com         --patch-file crd-podmonitors.yaml\nkubectl patch crd probes.monitoring.coreos.com              --patch-file crd-probes.yaml\nkubectl patch crd prometheuses.monitoring.coreos.com        --patch-file crd-prometheuses.yaml\nkubectl patch crd prometheusrules.monitoring.coreos.com     --patch-file crd-prometheusrules.yaml\nkubectl patch crd servicemonitors.monitoring.coreos.com     --patch-file crd-servicemonitors.yaml\nkubectl patch crd thanosrulers.monitoring.coreos.com        --patch-file crd-thanosrulers.yaml\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/bitnami/charts/issues/17143",children:"https://github.com/bitnami/charts/issues/17143"})}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},3354:(e,n,r)=>{var s=r(50959),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,r){var s,i={},c=null,h=null;for(s in void 0!==r&&(c=""+r),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(h=n.ref),n)o.call(n,s)&&!a.hasOwnProperty(s)&&(i[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===i[s]&&(i[s]=n[s]);return{$$typeof:t,type:e,key:c,ref:h,props:i,_owner:l.current}}n.Fragment=i,n.jsx=c,n.jsxs=c},11527:(e,n,r)=>{e.exports=r(3354)},47214:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>o});var s=r(50959);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);