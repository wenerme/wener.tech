/*! For license information please see 4564e25b.d34b01c8.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[71168],{56308:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var l=i(2488),s=i(62780);const r={title:"Go Build"},d="Go Build",c={id:"languages/go/go-build",title:"Go Build",description:"- Go package guidelines",source:"@site/../notes/languages/go/go-build.md",sourceDirName:"languages/go",slug:"/languages/go/build",permalink:"/notes/languages/go/build",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/languages/go/go-build.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1706956646,formattedLastUpdatedAt:"Feb 3, 2024",frontMatter:{title:"Go Build"},sidebar:"docs",previous:{title:"Go Awesome",permalink:"/notes/languages/go/awesome"},next:{title:"CGO",permalink:"/notes/languages/go/cgo"}},t={},a=[{value:"\u81ea\u5b9a\u4e49\u5e38\u91cf",id:"\u81ea\u5b9a\u4e49\u5e38\u91cf",level:2},{value:"\u9650\u5b9a Build Tag",id:"\u9650\u5b9a-build-tag",level:2},{value:"\u4ea4\u53c9\u7f16\u8bd1",id:"\u4ea4\u53c9\u7f16\u8bd1",level:2},{value:"\u6784\u5efa\u7f13\u5b58",id:"\u6784\u5efa\u7f13\u5b58",level:2},{value:"musl static",id:"musl-static",level:2},{value:"docker builder",id:"docker-builder",level:2},{value:"GOAMD64",id:"goamd64",level:2},{value:"GOARM",id:"goarm",level:2},{value:"unrecognized command-line option &#39;-marm&#39;",id:"unrecognized-command-line-option--marm",level:2},{value:"arm-none-eabi-gcc: error: unrecognized command-line option &#39;-pthread&#39;",id:"arm-none-eabi-gcc-error-unrecognized-command-line-option--pthread",level:2},{value:"loadinternal: cannot find runtime/cgo",id:"loadinternal-cannot-find-runtimecgo",level:2},{value:"FATAL: kernel too old",id:"fatal-kernel-too-old",level:2},{value:"implicit declaration of function &#39;_beginthread&#39;; did you mean &#39;OpenThread&#39;",id:"implicit-declaration-of-function-_beginthread-did-you-mean-openthread",level:2},{value:"c-shared \u5185\u5b58\u6cc4\u6f0f",id:"c-shared-\u5185\u5b58\u6cc4\u6f0f",level:2}];function o(n){const e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",del:"del",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.M)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:"go-build",children:"Go Build"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://wiki.archlinux.org/title/Go_package_guidelines",children:"Go package guidelines"})}),"\n",(0,l.jsxs)(e.li,{children:["\u5e38\u7528 ",(0,l.jsx)(e.code,{children:"-trimpath -ldflags '-s -w -extldflags \"-static\"'"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/golang/go/wiki/GoArm",children:"GoArm"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://gist.github.com/asukakenji/f15ba7e588ac42795f421b48b8aede63",children:"go-os-arch.md"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/golang/go/wiki/PortingPolicy",children:"PortingPolicy"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://go.dev/doc/install/source",children:"Installing Go from source"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["c-shared\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["musl \u73af\u5883\u4e0d\u652f\u6301\u6784\u5efa c-shared ",(0,l.jsx)(e.a,{href:"https://github.com/golang/go/issues/13492",children:"golang/go#13492"}),"\nruntime: c-shared builds fail with musllibc"]}),"\n",(0,l.jsx)(e.li,{children:"windows \u4e0b\u6784\u5efa c-shared \u9700\u8981\u4f7f\u7528 TDM-GCC"}),"\n",(0,l.jsxs)(e.li,{children:["\u65e0\u6cd5 dlclose, offload c-shared ",(0,l.jsx)(e.a,{href:"https://github.com/golang/go/issues/11100",children:"#11100"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6d89\u53ca\u5230 VM"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"env"}),(0,l.jsx)(e.th,{children:"note"}),(0,l.jsx)(e.th,{children:"macOS"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOENV"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"~/Library/Application Support/go/env"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOCACHE"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"~/Library/Caches/go-build"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOMODCACHE"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"~/go/pkg/mod"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOTOOLDIR"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOMOD"}),(0,l.jsx)(e.td,{children:"go.mod \u4f4d\u7f6e"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOWORK"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{})]})]})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u6240\u6709\u4ea4\u53c9\u7f16\u8bd1\u5217\u8868\ngo tool dist list\n# \u5305\u542b cgo \u652f\u6301\u60c5\u51b5\ngo tool dist list -json\n\n# \u79fb\u9664 mod \u7f13\u5b58\ngo clean -modcache\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"buildmode"}),(0,l.jsx)(e.th,{children:"desc"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"archive"}),(0,l.jsxs)(e.td,{children:["build non-main, ",(0,l.jsx)(e.code,{children:".a"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"c-archive"}),(0,l.jsxs)(e.td,{children:["main+imports, cgo ",(0,l.jsx)(e.code,{children:"//export"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"c-shared"}),(0,l.jsxs)(e.td,{children:["main+imports, cgo ",(0,l.jsx)(e.code,{children:"//export"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"default"}),(0,l.jsxs)(e.td,{children:["main+non-main, exec\uff0c ",(0,l.jsx)(e.code,{children:".a"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"exe"}),(0,l.jsx)(e.td,{children:"main+imports,exec, \u5ffd\u7565\u975e main \u5305"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"pie"}),(0,l.jsx)(e.td,{children:"main+imports, exec, pie"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"plugin"}),(0,l.jsx)(e.td,{children:"main+imports, plugin, \u5ffd\u7565\u975e main \u5305"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.del,{children:"shared"})}),(0,l.jsx)(e.td,{children:"non-main, for -linkshared - module \u51fa\u6765\u540e \u5f02\u5e38"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"ldflags"}),(0,l.jsx)(e.th,{children:"desc"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-w"}),(0,l.jsx)(e.td,{children:"disable DWARF generation"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-s"}),(0,l.jsx)(e.td,{children:"disable symbol table"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-X 'wener.me/gou/build.Version=123'"}),(0,l.jsx)(e.td,{children:"add definition"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-linkmode=external"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:'-extldflags "$LDFLAGS"'}),(0,l.jsx)(e.td,{})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"gcflags"}),(0,l.jsx)(e.th,{children:"desc"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-N"}),(0,l.jsx)(e.td,{children:"Disable optimizations"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-l"}),(0,l.jsx)(e.td,{children:"Disable inlining"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"flags"}),(0,l.jsx)(e.th,{children:"desc"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-modcacherw"}),(0,l.jsxs)(e.td,{children:["\u65b0\u7684 mod \u7f13\u5b58 rw - \u53ef\u4ee5 ",(0,l.jsx)(e.code,{children:"rm -rf"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-trimpath"}),(0,l.jsx)(e.td,{children:"\u79fb\u9664\u73af\u5883\u76f8\u5173\u8def\u5f84\uff0creproduceable"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:'-ldflags "$GOLDFLAGS"'}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-mod=readonly"}),(0,l.jsx)(e.td,{children:"\u4e0d\u52a8 go.mod"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"-buildmode=pie"}),(0,l.jsx)(e.td,{})]})]})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# https://pkg.go.dev/cmd/compile\ngo tool compile -help\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"env"}),(0,l.jsx)(e.th,{children:"default"}),(0,l.jsx)(e.th,{children:"desc"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOMAXPROCS"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"Max Thread"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOGC"}),(0,l.jsx)(e.td,{children:"100"}),(0,l.jsx)(e.td,{children:"off \u5173\u95ed GC"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOOS"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GOARCH"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"\u81ea\u5b9a\u4e49\u5e38\u91cf",children:"\u81ea\u5b9a\u4e49\u5e38\u91cf"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'package main\n\nvar Version = "dev"\nvar CommitTime = ""\nvar CommitID = ""\nvar BuildTime = ""\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"DEF_FLAGS=\"\n-X 'wener.me/tools/build.Version=$(git describe --tags --abbrev=0)'\n-X 'wener.me/tools/build.CommitID=$(git rev-parse --short HEAD)'\n-X 'wener.me/tools/build.CommitTime=$(git log -1 --format=%cd --date=iso8601)'\n-X 'wener.me/tools/build.BuildTime=$(date --iso-8601=seconds)'\n\"\ngo build -o bin/cli -ldflags \"$DEF_FLAGS\" ./cmd/cli\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u9650\u5b9a-build-tag",children:"\u9650\u5b9a Build Tag"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5185\u7f6e Tag\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7248\u672c - \u4f8b\u5982 go1.18"}),"\n",(0,l.jsx)(e.li,{children:"cgo"}),"\n",(0,l.jsx)(e.li,{children:"gc, gccgo"}),"\n",(0,l.jsx)(e.li,{children:"GOOS"}),"\n",(0,l.jsx)(e.li,{children:"GOARCH"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"//go:build tag\n//+build tag1,tag2\n\n// \u590d\u6742\u9650\u5b9a\n//go:build (linux && 386) || (darwin && !cgo)\n\npackage main\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'go build -tags "tag1 tag2"\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pkg.go.dev/cmd/go#hdr-Build_constraints",children:"https://pkg.go.dev/cmd/go#hdr-Build_constraints"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u4ea4\u53c9\u7f16\u8bd1",children:"\u4ea4\u53c9\u7f16\u8bd1"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/golang/go/wiki/GoArm",children:"GoArm"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://gist.github.com/asukakenji/f15ba7e588ac42795f421b48b8aede63",children:"GOOS and GOARCH"})}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'CC_FOR_TARGET=/path/to/arm-unknown-linux-gnueabi-gcc CXX_FOR_TARGET=/path/to/arm-unknown-linux-gnueabi-g++ RANLIB_FOR_TARGET=/path/to/arm-unknown-linux-gnueabi-ranlib\n\nCC=i586-mingw32-gcc GOOS=windows GOARCH=386 CGO_ENABLED=1 go build -v -o myprogram.exe -ldflags="-extld=$CC"\nCC=x86_64-pc-linux-gcc GOOS=linux GOARCH=amd64 CGO_ENABLED=1 go build -v -o myprogram -ldflags="-extld=$CC"\nCC=arm-linux-gnueabihf-gcc GOOS=linux GOARCH=arm GOARM=6 CGO_ENABLED=1 go build -v -o myprogram -ldflags="-extld=$CC"\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u6784\u5efa\u7f13\u5b58",children:"\u6784\u5efa\u7f13\u5b58"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# macOS $HOME/Library/Caches/go-build\n# linux $HOME/.cache/go-build\ngo env GOCACHE\n\n# CI \u7684\u65f6\u5019\u53ef\u4fee\u6539 GOPATH \u66f4\u597d\u5229\u7528\u7f13\u5b58\nexport GOPATH="$PWD/.cache"\nexport PATH="$PWD/.cache/bin:$PATH"\nexport GO111MODULE=on\nexport GOPROXY=https://goproxy.io\n\n# \u6e05\u9664\u7f13\u5b58\ngo clean -cache\n'})}),"\n",(0,l.jsx)(e.h2,{id:"musl-static",children:"musl static"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'-linkmode external -extldflags "-static"\n'})}),"\n",(0,l.jsx)(e.h2,{id:"docker-builder",children:"docker builder"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/prometheus/golang-builder",children:"prometheus/golang-builder"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["arm\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"arm-linux-gnueabi"}),"\n",(0,l.jsx)(e.li,{children:"arm64-apple-darwin20.2"}),"\n",(0,l.jsx)(e.li,{children:"arm64e-apple-darwin20.2"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"docker pull quay.io/prometheus/golang-builder:arm\ndocker run --rm -it --entrypoint bash \\\n  --name go-builder quay.io/prometheus/golang-builder:arm\n"})}),"\n",(0,l.jsx)(e.h1,{id:"ports",children:"Ports"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/golang/go/wiki/MinimumRequirements",children:"MinimumRequirements"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"goamd64",children:"GOAMD64"}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"go 1.18 \u65b0\u589e GOAMD64 \u73af\u5883\u53d8\u91cf"}),"\n"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"v1 - \u9ed8\u8ba4"}),"\n",(0,l.jsxs)(e.li,{children:["v2 - CMPXCHG16B, LAHF, SAHF, POPCNT, SSE3, SSE4.1, SSE4.2, SSSE3\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"2009: Nehalem, Jaguar, Intel Atom Silvermont, QEMU"}),"\n",(0,l.jsx)(e.li,{children:"amdv2"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["v3 - AVX, AVX2, BMI1, BMI2, F16C, FMA, LZCNT, MOVBE, OSXSAVE\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"2015 - Haswell, Excavator"}),"\n",(0,l.jsx)(e.li,{children:"amdv3"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["v4 - AVX512F, AVX512BW, AVX512CD, AVX512DQ, AVX512VL\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"2017: Skylake-X, Skylake-SP"}),"\n",(0,l.jsx)(e.li,{children:"2022: Zen 4"}),"\n",(0,l.jsx)(e.li,{children:"amdv4"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://go.dev/wiki/MinimumRequirements#amd64",children:"GOAMD64"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://en.wikipedia.org/wiki/X86-64#Microarchitecture_levels",children:"Microarchitecture levels"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# AMDv3\n# avx \u53ef\u80fd\u6709\uff0c\u4f46\u53ef\u80fd\u6ca1 avx2\ngrep -oE 'avx2|bmi1|bmi2|f16|fma' /proc/cpuinfo  | sort -u\n# AMDv4\ngrep -oE 'avx512' /proc/cpuinfo  | sort -u\n"})}),"\n",(0,l.jsx)(e.h2,{id:"goarm",children:"GOARM"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ARM \u6d6e\u70b9\u6570\u903b\u8f91"}),"\n"]}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"\u9ed8\u8ba4\u57fa\u4e8e\u6784\u5efa\u73af\u5883\u81ea\u52a8\u76d1\u6d4b\uff0c\u76d1\u6d4b\u5931\u8d25\u5219\u4f7f\u7528 6"}),"\n"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"GOARM=5: use software floating point; when CPU doesn't have VFP co-processor"}),"\n",(0,l.jsx)(e.li,{children:"GOARM=6: use VFPv1 only; default if cross compiling; usually ARM11 or better cores (VFPv2 or better is also supported)"}),"\n",(0,l.jsx)(e.li,{children:"GOARM=7: use VFPv3; usually Cortex-A cores"}),"\n"]}),"\n",(0,l.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,l.jsx)(e.h2,{id:"unrecognized-command-line-option--marm",children:"unrecognized command-line option '-marm'"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"CC=arm-linux-gnueabi-gcc\n"})}),"\n",(0,l.jsx)(e.h2,{id:"arm-none-eabi-gcc-error-unrecognized-command-line-option--pthread",children:"arm-none-eabi-gcc: error: unrecognized command-line option '-pthread'"}),"\n",(0,l.jsx)(e.p,{children:"\u9700\u8981 arm-linux-eabi"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# musl \u4e0d\u5305\u542b pthread \u53ef\u521b\u5efa\u7a7a\u5305\u6ee1\u8db3\n# \u7a7a\u5305\n# ar -rc /usr/lib/libpthread.a\n# \u4ea4\u53c9\u7f16\u8bd1\u73af\u5883\narm-none-eabi-ar -rc /usr/arm-none-eabi/lib/libpthread.a\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["gcc-arm-none-eabi\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Cortex-M0/M0+/M3/M4, Cortex-R4/R5/R7, Cortex-A"}),"\n",(0,l.jsx)(e.li,{children:"\u4e0d\u652f\u6301\u7ebf\u7a0b"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"loadinternal-cannot-find-runtimecgo",children:"loadinternal: cannot find runtime/cgo"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"CGO_ENABLED=1\n"})}),"\n",(0,l.jsx)(e.h2,{id:"fatal-kernel-too-old",children:"FATAL: kernel too old"}),"\n",(0,l.jsx)(e.p,{children:"\u6ce8\u610f gcc \u7248\u672c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"CC=arm-linux-gnueabi-gcc\necho 'int main(){}' > test.c\n# ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), statically linked, for GNU/Linux 3.2.0, BuildID[sha1]=a839e1b10daec5d9c348eef8854bb271f8097d34, not stripped\n# \u6ce8\u610f GNU/Linux 3.2.0\n$CC -o test test.c\nfile test\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/prometheus/node_exporter/issues/914",children:"prometheus/node_exporter#914"})}),"\n",(0,l.jsxs)(e.li,{children:["debian ",(0,l.jsx)(e.a,{href:"https://packages.debian.org/unstable/gcc-arm-linux-gnueabi",children:"gcc-arm-linux-gnueabi"})]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"implicit-declaration-of-function-_beginthread-did-you-mean-openthread",children:"implicit declaration of function '_beginthread'; did you mean 'OpenThread'"}),"\n",(0,l.jsxs)(e.p,{children:["\u6362 C \u7f16\u8bd1\u5668, \u5c1d\u8bd5\u7528 ",(0,l.jsx)(e.a,{href:"https://github.com/jmeubank/tdm-gcc",children:"TDM-GCC"})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"export PATH=/c/TDM-GCC-64/bin:$PATH\nLC_ALL=c gcc -v\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/golang/go/wiki/InstallFromSource",children:"https://github.com/golang/go/wiki/InstallFromSource"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/golang/go/issues/12029",children:"https://github.com/golang/go/issues/12029"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"c-shared-\u5185\u5b58\u6cc4\u6f0f",children:"c-shared \u5185\u5b58\u6cc4\u6f0f"}),"\n",(0,l.jsx)(e.p,{children:"\u4f7f\u7528 c-shared \u7684\u65b9\u5f0f\u5f88\u96be\u80fd\u4fdd\u8bc1\u6700\u540e valgrind \u4e0d\u663e\u793a\u6709\u6ea2\u51fa"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/golang/go/issues/30490",children:"https://github.com/golang/go/issues/30490"})}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,s.M)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(o,{...n})}):o(n)}},38088:(n,e,i)=>{var l=i(96651),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,c=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function a(n,e,i){var l,r={},a=null,o=null;for(l in void 0!==i&&(a=""+i),void 0!==e.key&&(a=""+e.key),void 0!==e.ref&&(o=e.ref),e)d.call(e,l)&&!t.hasOwnProperty(l)&&(r[l]=e[l]);if(n&&n.defaultProps)for(l in e=n.defaultProps)void 0===r[l]&&(r[l]=e[l]);return{$$typeof:s,type:n,key:a,ref:o,props:r,_owner:c.current}}e.Fragment=r,e.jsx=a,e.jsxs=a},2488:(n,e,i)=>{n.exports=i(38088)},62780:(n,e,i)=>{i.d(e,{I:()=>c,M:()=>d});var l=i(96651);const s={},r=l.createContext(s);function d(n){const e=l.useContext(r);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:d(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);