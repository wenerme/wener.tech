"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[27133],{49613:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return f}});var a=n(59496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},s=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),s=c(n),f=r,k=s["".concat(p,".").concat(f)]||s[f]||u[f]||l;return n?a.createElement(k,i(i({ref:t},m),{},{components:n})):a.createElement(k,i({ref:t},m))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=s;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var c=2;c<l;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}s.displayName="MDXCreateElement"},55040:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return f},default:function(){return y},frontMatter:function(){return s},metadata:function(){return k},toc:function(){return v}});var a=n(49613),r=Object.defineProperty,l=Object.defineProperties,i=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,m=(e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))p.call(t,n)&&m(e,n,t[n]);if(o)for(var n of o(t))c.call(t,n)&&m(e,n,t[n]);return e};const s={tags:["FAQ"]},f="Platform FAQ",k={unversionedId:"platform/platform-faq",id:"platform/platform-faq",title:"Platform FAQ",description:"\u94fe\u63a5\u8d85\u65f6",source:"@site/../notes/platform/platform-faq.md",sourceDirName:"platform",slug:"/platform/faq",permalink:"/notes/platform/faq",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/platform/platform-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1681042995,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{tags:["FAQ"]},sidebar:"docs",previous:{title:"Platform Awesome",permalink:"/notes/platform/awesome"},next:{title:"\u817e\u8baf\u4e91",permalink:"/notes/platform/qcloud"}},d={},v=[{value:"\u94fe\u63a5\u8d85\u65f6",id:"idle-connections",level:2}],N={toc:v};function y(e){var t,n=e,{components:r}=n,m=((e,t)=>{var n={};for(var a in e)p.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&o)for(var a of o(e))t.indexOf(a)<0&&c.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=u(u({},N),m),l(t,i({components:r,mdxType:"MDXLayout"}))),(0,a.kt)("h1",u({},{id:"platform-faq"}),"Platform FAQ"),(0,a.kt)("h2",u({},{id:"idle-connections"}),"\u94fe\u63a5\u8d85\u65f6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e91\u5e73\u53f0\u4f1a\u4e3b\u52a8\u5207\u65ad idle \u7684\u94fe\u63a5\uff0c\u8fd9\u4e2a\u548c\u5c40\u57df\u7f51\u7684\u94fe\u63a5\u4e0d\u540c - \u4e91\u5e73\u53f0 nat \u8d44\u6e90"),(0,a.kt)("li",{parentName:"ul"},"\u5e94\u7528\u9700\u8981\u4e3b\u52a8 ping/keepalive \u4fdd\u6301\u94fe\u63a5\uff0c\u5426\u5219\u4ece\u94fe\u63a5\u6c60\u91cc\u62ff\u51fa\u6765\u94fe\u63a5\u53ef\u80fd\u5df2\u7ecf timeout"),(0,a.kt)("li",{parentName:"ul"},"\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u53ef\u4ee5\u914d\u7f6e tcp keepalive \u8fdb\u884c\u4fdd\u6d3b"),(0,a.kt)("li",{parentName:"ul"},"\u5927\u591a\u94fe\u63a5\u6c60\u90fd\u652f\u6301",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"IdleTimeout",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u5efa\u8bae\u5c0f\u4e8e 10 \u5206\u949f"),(0,a.kt)("li",{parentName:"ul"},"idle \u65f6\u957f\uff0c\u5982\u679c\u914d\u7f6e\u7684\u6bd4 \u5e73\u53f0/\u7cfb\u7edf \u5c42 idle \u77ed\uff0c\u4e5f\u80fd\u907f\u514d\u53d6\u5230\u65e0\u6548\u94fe\u63a5\u7684\u95ee\u9898"))),(0,a.kt)("li",{parentName:"ul"},"TestOnBorrow - \u6709\u4e00\u5b9a\u6027\u80fd\u5f71\u54cd"),(0,a.kt)("li",{parentName:"ul"},"TestOnReturn"),(0,a.kt)("li",{parentName:"ul"},"TestWhileIdle - \u5f71\u54cd\u5c0f\uff0c\u4f46\u4f1a\u6d6a\u8d39\u4e00\u5b9a\u94fe\u63a5\u6570\u91cf",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u9700\u8981\u614e\u91cd\u8003\u8651\u914d\u7f6e\u7684 idle \u6570\u91cf"))))),(0,a.kt)("li",{parentName:"ul"},"\u94fe\u63a5\u6c60",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"apache commons-pool ",(0,a.kt)("a",u({parentName:"li"},{href:"https://commons.apache.org/proper/commons-pool/apidocs/org/apache/commons/pool2/impl/GenericObjectPool.html"}),"GenericObjectPool"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u652f\u6301 IdleTime, TestWhileIdle, TestOnCreate, TestOnBorrow, TestOnReturn"))),(0,a.kt)("li",{parentName:"ul"},"HikariCP ",(0,a.kt)("a",u({parentName:"li"},{href:"https://javadoc.io/doc/com.zaxxer/HikariCP/latest/com/zaxxer/hikari/HikariConfig.html"}),"HikariConfig"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"IdleTimeout, KeepaliveTime"),(0,a.kt)("li",{parentName:"ul"},"KeepaliveTime \u68c0\u6d4b idle \u7684\u5468\u671f")))))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7cfb\u7edf TCP KeepAlive")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"tcp_keepalive_time",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u4e0a\u6b21\u6570\u636e\u5305\u53d1\u9001\u540e\uff0c\u591a\u4e45\u5f00\u59cb\u53d1\u9001 keepalive"),(0,a.kt)("li",{parentName:"ul"},"\u5f00\u59cb\u53d1\u9001 keepalive \u540e\uff0c\u8be5\u503c\u4e0d\u5728\u91cd\u8981"),(0,a.kt)("li",{parentName:"ul"},"TCP_KEEPIDLE"))),(0,a.kt)("li",{parentName:"ul"},"tcp_keepalive_intvl",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u53d1\u9001 keepalive \u7684\u95f4\u9694"),(0,a.kt)("li",{parentName:"ul"},"TCP_KEEPINTVL"))),(0,a.kt)("li",{parentName:"ul"},"tcp_keepalive_probes",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u591a\u5c11\u6b21 unack \u540e\u8ba4\u4e3a\u94fe\u63a5\u5df2\u7ecf\u65ad\u5f00\uff0c\u901a\u77e5\u5e94\u7528\u5c42"),(0,a.kt)("li",{parentName:"ul"},"TCP_KEEPCNT")))),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"# Linux\n# \u9ed8\u8ba4 7200\uff0c75\uff0c9\n# 2\u5c0f\u65f6, 75s, 9\u6b21\nsysctl net.ipv4.tcp_keepalive_time net.ipv4.tcp_keepalive_intvl net.ipv4.tcp_keepalive_probes\n\n# 1\u5206\u949f, 1\u5206\u949f, 5\u6b21\nsysctl -w \\\n  net.ipv4.tcp_keepalive_time=60 \\\n  net.ipv4.tcp_keepalive_intvl=60 \\\n  net.ipv4.tcp_keepalive_probes=5\n\ncat <<EOF | sudo tee /etc/sysctl.d/99-tcp_keepalive.conf\nnet.ipv4.tcp_keepalive_time = 60\nnet.ipv4.tcp_keepalive_intvl = 60\nnet.ipv4.tcp_keepalive_probes = 5\nEOF\nsudo sysctl -p /etc/sysctl.d/99-tcp_keepalive.conf\n\n# macOS\nsysctl net.inet.tcp.always_keepalive net.inet.tcp.keepidle net.inet.tcp.keepinit net.inet.tcp.keepintvl\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"GCP \u662f 10 \u5206\u949f",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://cloud.google.com/compute/docs/troubleshooting/general-tips?hl=zh-cn#idle-connections"}),"https://cloud.google.com/compute/docs/troubleshooting/general-tips?hl=zh-cn#idle-connections")))),(0,a.kt)("li",{parentName:"ul"},"AWS ELB \u9ed8\u8ba4\u662f 1 \u5206\u949f",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u53ef\u4fee\u6539\u4e3a 1 - 4000"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/config-idle-timeout.html"}),"Configure the idle connection timeout for your Classic Load Balancer")))),(0,a.kt)("li",{parentName:"ul"},"AWS API Gateway \u9ed8\u8ba4 10 \u5206\u949f",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://docs.aws.amazon.com/apigateway/latest/developerguide/limits.html"}),"Amazon API Gateway quotas and important notes")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/"}),"https://tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/"))))}y.isMDXComponent=!0}}]);