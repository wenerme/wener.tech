/*! For license information please see 5f20496a.5b032c4a.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[59174],{68345:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>a,frontMatter:()=>c,metadata:()=>t,toc:()=>h});var r=s(11527),i=s(47214);const c={title:"rsync"},l="rsync",t={id:"service/storage/backup/rsync",title:"rsync",description:"\u6570\u636e\u91cf\u5927\uff0c\u6709\u6761\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u91cf\u7528 rclone\uff0c\u652f\u6301\u5e76\u53d1\u3002",source:"@site/../notes/service/storage/backup/rsync.md",sourceDirName:"service/storage/backup",slug:"/service/storage/backup/rsync",permalink:"/notes/service/storage/backup/rsync",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/storage/backup/rsync.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1692169664,formattedLastUpdatedAt:"Aug 16, 2023",frontMatter:{title:"rsync"},sidebar:"docs",previous:{title:"restic",permalink:"/notes/service/storage/backup/restic"},next:{title:"zsync",permalink:"/notes/service/storage/backup/zsync"}},d={},h=[{value:"\u5e76\u884c",id:"\u5e76\u884c",level:2},{value:"filter by extension",id:"filter-by-extension",level:2},{value:"Filter Rules",id:"filter-rules",level:2},{value:"ssh port",id:"ssh-port",level:2},{value:"rsync: change_dir &quot;/&quot; (in f) failed: Permission denied (13)",id:"rsync-change_dir--in-f-failed-permission-denied-13",level:2},{value:"rsync: receiver mkstemp &quot;/.file.tar.gz.XXXXXX&quot; (in backup) failed: Permission denied (13)",id:"rsync-receiver-mkstemp-filetargzxxxxxx-in-backup-failed-permission-denied-13",level:2},{value:"rsync: generator failed to set permissions on &quot;/file.tar.gz&quot; (in backup): No such file or directory (2)",id:"rsync-generator-failed-to-set-permissions-on-filetargz-in-backup-no-such-file-or-directory-2",level:2}];function o(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"rsync",children:"rsync"}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"\u6570\u636e\u91cf\u5927\uff0c\u6709\u6761\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u91cf\u7528 rclone\uff0c\u652f\u6301\u5e76\u53d1\u3002"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man1/rsync.1.html",children:"rsync.1"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.cheatography.com/richardjh/cheat-sheets/rsync/",children:"https://www.cheatography.com/richardjh/cheat-sheets/rsync/"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://wiki.archlinux.org/index.php/rsync",children:"https://wiki.archlinux.org/index.php/rsync"})}),"\n",(0,r.jsxs)(n.li,{children:["unison\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.cis.upenn.edu/~bcpierce/unison/",children:"https://www.cis.upenn.edu/~bcpierce/unison/"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--info=progress2"})," \u663e\u793a\u901f\u5ea6"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--exclude='/.git' --filter=\"dir-merge,- .gitignore\""}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u540c\u6b65 git \u5185\u5bb9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["rsync \u4e0d\u652f\u6301\u68c0\u6d4b rename, --fuzzy \u80fd\u5bf9\u540d\u5b57\u505a\u6a21\u7cca\u5339\u914d\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"rclone \u652f\u6301\u57fa\u4e8e hash, modtime, leaf \u68c0\u6d4b rename"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"rsync \u4e0d\u652f\u6301\u5e76\u884c - rclone \u652f\u6301\u5e76\u884c"}),"\n",(0,r.jsxs)(n.li,{children:["\u66f4\u590d\u6742\u7684",(0,r.jsx)(n.strong,{children:"\u540c\u6b65"}),"\u573a\u666f\u63a8\u8350 ",(0,r.jsx)(n.a,{href:"/notes/service/storage/backup/rclone",children:"rclone"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u66f4\u590d\u6742\u7684",(0,r.jsx)(n.strong,{children:"\u5907\u4efd"}),"\u573a\u666f\u63a8\u8350 ",(0,r.jsx)(n.a,{href:"/notes/service/storage/backup/restic",children:"restic"})]}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"flags"}),(0,r.jsx)(n.th,{children:"for"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--archive, -a"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-rlptgoD"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--recursive, -r"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--links, -l"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--perms, -p"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--times, -t"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--owner, -o"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--group, -g"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"-D"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--devices --specials"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--verbose, -v"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--progress"}),(0,r.jsx)(n.td,{children:"\u663e\u793a\u4f20\u8f93\u8fdb\u5ea6"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--partial"}),(0,r.jsx)(n.td,{children:"\u4fdd\u7559\u90e8\u5206\u4f20\u8f93\u6587\u4ef6"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"-P"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--partial --progress"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--stats"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--remove-source-files"}),(0,r.jsx)(n.td,{children:"\u540c\u6b65\u540e\u5220\u9664\u6e90\u6587\u4ef6"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--human-readable, -h"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--checksum,-c"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--prune-empty-dirs,-m"}),(0,r.jsx)(n.td,{children:"\u5220\u9664\u7a7a\u76ee\u5f55"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--existing"}),(0,r.jsx)(n.td,{children:"\u53ea\u540c\u6b65\u5df2\u7ecf\u6709\u7684"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--ignore-existing"}),(0,r.jsx)(n.td,{children:"\u53ea\u540c\u6b65\u65b0\u7684"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--update"}),(0,r.jsx)(n.td,{children:"skip files that are newer on the receiver"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--mkpath"}),(0,r.jsx)(n.td,{children:"\u521b\u5efa\u76ee\u5f55"})]})]})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Note"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rsync src dst"})," -> ",(0,r.jsx)(n.code,{children:"rsync src/ dst/src"})," - src \u542b ",(0,r.jsx)(n.code,{children:"/"})," \u8868\u793a\u4e0d\u521b\u5efa\u76ee\u5f55"]}),"\n",(0,r.jsxs)(n.li,{children:["dst \u5982\u679c\u5305\u542b ",(0,r.jsx)(n.code,{children:"/"})," \u5219\u4e0d\u5b58\u5728\u65f6\u4f1a\u521b\u5efa\u76ee\u5f55\uff0c\u5426\u5219\u4f1a\u88ab\u590d\u5236\u4e3a\u6307\u5b9a\u6587\u4ef6"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u4f7f\u7528 SSH \u540c\u6b65\nrsync -avz -e ssh remoteuser@remotehost:/remote/dir /this/dir/\n\n# \u8fdc\u7a0b\u4f7f\u7528 sudo\nrsync --rsync-path="sudo rsync" -avz dnsmasq/ admin@10.1.1.1:/etc/dnsmasq/\n\n# \u5907\u4efd\u6574\u4e2a\u7cfb\u7edf\nrsync -aAXv --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found"} / /path/to/backup/folder\n# \u4f7f\u7528 --info=progress2 \u663e\u793a\u603b\u4f53\u7684\u8fdb\u5ea6, \u800c\u4e0d\u662f\u6bcf\u4e2a\u6587\u4ef6\nrsync -aAX --info=progress2 --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found"} / /path/to/backup/folder\n\n# \u4e0d\u540c\u6b65\u6743\u9650\u7528\u6237\u5206\u7ec4\u4fe1\u606f\nrsync -avz --no-perms --no-owner --no-group mnt/wener abuild/\n\n# \u914d\u5408 fswatch \u4f7f\u7528\n# \u62f7\u8d1d\nfswatch ./ | xargs -I{} cp {} ~/Dropbox/backup/latest/\n# rsync\nalias run_rsync=\'rsync -azP --exclude ".*/" --exclude ".*" --exclude "tmp/" ~/Documents/repos/my_repository username@host:~\'\nrun_rsync\nfswatch -o . | while read f; do run_rsync; done\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5e76\u884c",children:"\u5e76\u884c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"rsync -avzm --stats --safe-links --ignore-existing --dry-run \\\n  --human-readable /data/projects REMOTE-HOST:/data/ > /tmp/transfer.log\n\n# --relative \u8981\u6c42\u5728 /data/projects \u6267\u884c\ncat /tmp/transfer.log \\\n  | parallel --will-cite -j 5 rsync -avzm --relative \\\n    --stats --safe-links --ignore-existing \\\n    --human-readable {} REMOTE-HOST:/data/ > result.log\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://wiki.ncsa.illinois.edu/display/~wglick/2013/11/01/Parallel+Rsync",children:"https://wiki.ncsa.illinois.edu/display/~wglick/2013/11/01/Parallel+Rsync"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://unix.stackexchange.com/questions/189878",children:"https://unix.stackexchange.com/questions/189878"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"filter-by-extension",children:"filter by extension"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["--prune-empty-dirs\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["3.1.2 ",(0,r.jsx)(n.code,{children:"-m"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# 3.0.6+\nrsync -zarv --include="*/" --include="*.sh" --exclude="*" "$from" "$to"\n# < 3.0.6\nrsync -zarv --include="*/" --exclude="*" --include="*.sh" "$from" "$to"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"filter-rules",children:"Filter Rules"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["exclude, ",(0,r.jsx)(n.code,{children:"-"})]}),"\n",(0,r.jsxs)(n.li,{children:["include, ",(0,r.jsx)(n.code,{children:"+"})]}),"\n",(0,r.jsxs)(n.li,{children:["merge, ",(0,r.jsx)(n.code,{children:"."})]}),"\n",(0,r.jsxs)(n.li,{children:["dir-merge, ",(0,r.jsx)(n.code,{children:":"})]}),"\n",(0,r.jsx)(n.li,{children:"hide, H"}),"\n",(0,r.jsx)(n.li,{children:"show, S"}),"\n",(0,r.jsx)(n.li,{children:"protect, P"}),"\n",(0,r.jsx)(n.li,{children:"risk, R"}),"\n",(0,r.jsxs)(n.li,{children:["clear, ",(0,r.jsx)(n.code,{children:"!"})]}),"\n",(0,r.jsxs)(n.li,{children:["Modifier\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/"})," - \u7edd\u5bf9\u8def\u5f84"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"!"})}),"\n",(0,r.jsx)(n.li,{children:"C - CVS-exclude"}),"\n",(0,r.jsx)(n.li,{children:"s - sending side"}),"\n",(0,r.jsx)(n.li,{children:"r - receiving side"}),"\n",(0,r.jsx)(n.li,{children:"p - perishable"}),"\n",(0,r.jsx)(n.li,{children:"x - xattr"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ssh-port",children:"ssh port"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"rsync -e 'ssh -p 2222'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"rsync-change_dir--in-f-failed-permission-denied-13",children:'rsync: change_dir "/" (in f) failed: Permission denied (13)'}),"\n",(0,r.jsx)(n.h2,{id:"rsync-receiver-mkstemp-filetargzxxxxxx-in-backup-failed-permission-denied-13",children:'rsync: receiver mkstemp "/.file.tar.gz.XXXXXX" (in backup) failed: Permission denied (13)'}),"\n",(0,r.jsx)(n.h2,{id:"rsync-generator-failed-to-set-permissions-on-filetargz-in-backup-no-such-file-or-directory-2",children:'rsync: generator failed to set permissions on "/file.tar.gz" (in backup): No such file or directory (2)'})]})}function a(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},3354:(e,n,s)=>{var r=s(50959),i=Symbol.for("react.element"),c=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,t=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function h(e,n,s){var r,c={},h=null,o=null;for(r in void 0!==s&&(h=""+s),void 0!==n.key&&(h=""+n.key),void 0!==n.ref&&(o=n.ref),n)l.call(n,r)&&!d.hasOwnProperty(r)&&(c[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===c[r]&&(c[r]=n[r]);return{$$typeof:i,type:e,key:h,ref:o,props:c,_owner:t.current}}n.Fragment=c,n.jsx=h,n.jsxs=h},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>t,a:()=>l});var r=s(50959);const i={},c=r.createContext(i);function l(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);