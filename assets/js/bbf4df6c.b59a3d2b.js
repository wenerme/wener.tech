/*! For license information please see bbf4df6c.b59a3d2b.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[3905],{29528:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>c,toc:()=>h});var r=s(11527),i=s(47214);const l={tags:["FAQ"]},o="SSH FAQ",c={id:"os/linux/shell/ssh/ssh-faq",title:"SSH FAQ",description:"tunning only user",source:"@site/../notes/os/linux/shell/ssh/ssh-faq.md",sourceDirName:"os/linux/shell/ssh",slug:"/os/linux/shell/ssh/faq",permalink:"/notes/os/linux/shell/ssh/faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/shell/ssh/ssh-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1704307832,formattedLastUpdatedAt:"Jan 3, 2024",frontMatter:{tags:["FAQ"]},sidebar:"docs",previous:{title:"ssh config",permalink:"/notes/os/linux/shell/ssh/config"},next:{title:"sshd",permalink:"/notes/os/linux/shell/ssh/sshd"}},t={},h=[{value:"tunning only user",id:"tunning-only-user",level:2},{value:"sshuttle user",id:"sshuttle-user",level:2},{value:"key_load_public: No such file or directory",id:"key_load_public-no-such-file-or-directory",level:2},{value:"channel 0: open failed: administratively prohibited: open failed - stdio forwarding failed",id:"channel-0-open-failed-administratively-prohibited-open-failed---stdio-forwarding-failed",level:2},{value:"\u7aef\u53e3\u8f6c\u53d1",id:"\u7aef\u53e3\u8f6c\u53d1",level:2},{value:"\u4e0d\u6821\u9a8c\u4e3b\u673a",id:"\u4e0d\u6821\u9a8c\u4e3b\u673a",level:2},{value:"no matching key exchange method found. Their offer: diffie-hellman-group1-sha1",id:"no-matching-key-exchange-method-found-their-offer-diffie-hellman-group1-sha1",level:2},{value:"no matching cipher found. Their offer: aes128-cbc,3des-cbc,aes256-cbc,twofish256-cbc,twofish-cbc,twofish128-cbc,blowfish-cbc",id:"no-matching-cipher-found-their-offer-aes128-cbc3des-cbcaes256-cbctwofish256-cbctwofish-cbctwofish128-cbcblowfish-cbc",level:2},{value:"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301 cipher",id:"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301-cipher",level:3},{value:"\u4fee\u6539\u670d\u52a1\u7aef cipher",id:"\u4fee\u6539\u670d\u52a1\u7aef-cipher",level:3},{value:"\u5f3a\u5236\u5bc6\u7801\u767b\u9646",id:"\u5f3a\u5236\u5bc6\u7801\u767b\u9646",level:2},{value:"\u67e5\u770b pubkey \u7c7b\u578b",id:"\u67e5\u770b-pubkey-\u7c7b\u578b",level:2},{value:"send_pubkey_test: no mutual signature algorithm",id:"send_pubkey_test-no-mutual-signature-algorithm",level:2},{value:"ssh into tmux",id:"ssh-into-tmux",level:2},{value:"\u4e0d\u8bb0\u5f55 localhost \u7684 host key",id:"\u4e0d\u8bb0\u5f55-localhost-\u7684-host-key",level:2},{value:"chmod ssh",id:"chmod-ssh",level:2},{value:"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7",id:"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7",level:2},{value:"scp sudo",id:"scp-sudo",level:2},{value:"ssh root forward agent",id:"ssh-root-forward-agent",level:2},{value:"expecting SSH2_MSG_KEX_ECDH_REPLY",id:"expecting-ssh2_msg_kex_ecdh_reply",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"ssh-faq",children:"SSH FAQ"}),"\n",(0,r.jsx)(n.h2,{id:"tunning-only-user",children:"tunning only user"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u914d\u7f6e\u9650\u5236"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Match User tunning\n  AllowTcpForwarding yes\n  X11Forwarding no\n  AllowAgentForwarding no\n  ForceCommand /bin/false\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u7528\u6237\u9650\u5236"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"useradd sshtunnel -m -d /home/sshtunnel -s /bin/true\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"authorized_keys"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'from="192.168.1.10",command="/usr/bin/ls" ssh-rsa XXX\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://unix.stackexchange.com/a/337445/47774",children:"https://unix.stackexchange.com/a/337445/47774"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"sshuttle-user",children:"sshuttle user"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/sshuttle/sshuttle/issues/703",children:"https://github.com/sshuttle/sshuttle/issues/703"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"key_load_public-no-such-file-or-directory",children:"key_load_public: No such file or directory"}),"\n",(0,r.jsxs)(n.p,{children:["\u627e\u4e0d\u5230 ",(0,r.jsx)(n.code,{children:"~/.ssh/id_rsa.pub"}),"\uff0c\u4e0d\u5f71\u54cd\u4f7f\u7528"]}),"\n",(0,r.jsx)(n.h2,{id:"channel-0-open-failed-administratively-prohibited-open-failed---stdio-forwarding-failed",children:"channel 0: open failed: administratively prohibited: open failed - stdio forwarding failed"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0d\u5141\u8bb8 PortForward\uff0c\u9700\u8981\u5f00\u542f"}),"\n",(0,r.jsx)(n.h2,{id:"\u7aef\u53e3\u8f6c\u53d1",children:"\u7aef\u53e3\u8f6c\u53d1"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"-L/LocalForward \u672c\u5730\u8f6c\u53d1"}),"\n",(0,r.jsx)(n.li,{children:"-R/RemoteForward \u8fdc\u7a0b\u8f6c\u53d1"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u8bbf\u95ee\u672c\u5730 80 \u4f1a\u88ab\u8f6c\u53d1\u5230 SERVER:8080\nssh -L 8080:localhost:80 SERVER -o ExitOnForwardFailure=yes\n\n# \u8bbf\u95ee SERVER:80 \u4f1a\u88ab\u8f6c\u53d1\u5230\u672c\u5730 8080 \u7aef\u53e3\n# -g \u5141\u8bb8\u5916\u90e8\u8bbf\u95ee\nssh -g -R 80:localhost:8080 SERVER -o ExitOnForwardFailure=yes\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5141\u8bb8\u7aef\u53e3\u8f6c\u53d1"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"/etc/ssh/sshd_config"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-conf",children:"AllowAgentForwarding yes\nAllowTcpForwarding yes\n# \u5141\u8bb8 -g\nGatewayPorts yes\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e0d\u6821\u9a8c\u4e3b\u673a",children:"\u4e0d\u6821\u9a8c\u4e3b\u673a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u5ffd\u7565 Host key \u53d8\u5316\nssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@127.0.0.1 -p 2222\n\n# \u5ffd\u7565 SSH Agent\uff0c\u6d4b\u8bd5 key\nssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o IdentityAgent=none -i /tmp/sshkey root@127.0.0.1 -p 2222\n"})}),"\n",(0,r.jsx)(n.h2,{id:"no-matching-key-exchange-method-found-their-offer-diffie-hellman-group1-sha1",children:"no matching key exchange method found. Their offer: diffie-hellman-group1-sha1"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"~/.ssh/config"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"KexAlgorithms +diffie-hellman-group1-sha1\n"})}),"\n",(0,r.jsx)(n.h2,{id:"no-matching-cipher-found-their-offer-aes128-cbc3des-cbcaes256-cbctwofish256-cbctwofish-cbctwofish128-cbcblowfish-cbc",children:"no matching cipher found. Their offer: aes128-cbc,3des-cbc,aes256-cbc,twofish256-cbc,twofish-cbc,twofish128-cbc,blowfish-cbc"}),"\n",(0,r.jsx)(n.p,{children:"\u670d\u52a1\u7aef\u63d0\u4f9b\u7684 cipher \u5ba2\u6237\u7aef\u4e0d\u652f\u6301"}),"\n",(0,r.jsx)(n.h3,{id:"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301-cipher",children:"\u4fee\u6539\u5ba2\u6237\u7aef\u652f\u6301 cipher"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host gitlab.com\n     Ciphers aes256-ctc\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4fee\u6539\u670d\u52a1\u7aef-cipher",children:"\u4fee\u6539\u670d\u52a1\u7aef cipher"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"/etc/ssh/ssh_config"})}),"\n",(0,r.jsx)(n.p,{children:"\u6dfb\u52a0 cipher"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc,aes192-cbc,aes256-cbc\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5f3a\u5236\u5bc6\u7801\u767b\u9646",children:"\u5f3a\u5236\u5bc6\u7801\u767b\u9646"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh user:@example.com\nssh -o PreferredAuthentications=password -o PubkeyAuthentication=no example.com\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u67e5\u770b-pubkey-\u7c7b\u578b",children:"\u67e5\u770b pubkey \u7c7b\u578b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"find ~/.ssh/id_*.pub -exec ssh-keygen -l -f {} \\;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"send_pubkey_test-no-mutual-signature-algorithm",children:"send_pubkey_test: no mutual signature algorithm"}),"\n",(0,r.jsx)(n.p,{children:"openssh \u4e0d\u518d\u9ed8\u8ba4\u652f\u6301 ssh-rsa"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-conf",metastring:'title="sshd_config"',children:"PubkeyAcceptedKeyTypes +ssh-rsa\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u63a8\u8350\u4f7f\u7528 ECDSA,Ed25519"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ssh-keygen -t ed25519 -C "a@b.com" -f $PWD\n'})}),"\n",(0,r.jsx)(n.h2,{id:"ssh-into-tmux",children:"ssh into tmux"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host example.org\n\tRemoteCommand tmux new -A -s default\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e0d\u8bb0\u5f55-localhost-\u7684-host-key",children:"\u4e0d\u8bb0\u5f55 localhost \u7684 host key"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host localhost\n\tUserKnownHostsFile /dev/null\n\tStrictHostKeyChecking no\n"})}),"\n",(0,r.jsx)(n.h2,{id:"chmod-ssh",children:"chmod ssh"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\nchmod 600 ~/.ssh/id_rsa\nchmod 644 ~/.ssh/id_rsa.pub\n\nchmod go-w ~\n\n# restorecon -R -v /root/.ssh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7",children:"\u516c\u7f51\u5bc6\u7801\u63a2\u6d4b\u8d26\u53f7"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"grep 'Failed password' /var/log/messages* | egrep -o 'invalid user \\w+' | egrep -o '\\w+$' | sort -u\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1234\na\nadmin\nansadmin\nansible\napache\napp\nappuser\nark\narkserver\nawsgui\nbigdata\nbitrix\nbot\ncarlos\ncassandra\ncentos\ncustomer\ndata\ndeepspeed\ndemo\ndeploy\ndev\ndeveloper\ndevops\ndocker\ndockeradmin\ndolphinscheduler\nelastic\nelasticsearch\nelk\nelsearch\nemqx\nengineer\nes\nesadmin\nesroot\nesuser\nfa\nftp\nftpuser\ngbase\ngit\ngitlab\ngmod\ngpadmin\nguest\nhadoop\nhalo\nhive\ninspur\njenkins\njumpserver\njupyter\nkubernetes\nlighthouse\nmail\nmapr\nmcserver\nminecraft\nmongodb\nmysql\nnexus\nnginx\nnvidia\nodoo\nodoo15\noracle\noscar\nplex\nposiflex\npostgres\nrancher\nranger\nsatisfactory\nsftp\nsftpuser\nsonar\nsquid\nsteam\nsubbu\nsupport\nteamspeak\ntest\ntester\ntestuser\ntom\ntomcat\nts\nubnt\nubuntu\nuftp\nuser\nuser1\nusername\nuucp\nvagrant\nvpn\nwww\nx\nzjw\n"})}),"\n",(0,r.jsx)(n.h2,{id:"scp-sudo",children:"scp sudo"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'rsync -avz --rsync-path="sudo rsync" /tmp/test.txt svr:/tmp/\n'})}),"\n",(0,r.jsx)(n.h2,{id:"ssh-root-forward-agent",children:"ssh root forward agent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# -E \u4fdd\u7559\u73af\u5883\u53d8\u91cf\nsudo -E -s\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"--preserve-env=SSH_AUTH_SOCK"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"expecting-ssh2_msg_kex_ecdh_reply",children:"expecting SSH2_MSG_KEX_ECDH_REPLY"})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},3354:(e,n,s)=>{var r=s(50959),i=Symbol.for("react.element"),l=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function h(e,n,s){var r,l={},h=null,a=null;for(r in void 0!==s&&(h=""+s),void 0!==n.key&&(h=""+n.key),void 0!==n.ref&&(a=n.ref),n)o.call(n,r)&&!t.hasOwnProperty(r)&&(l[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===l[r]&&(l[r]=n[r]);return{$$typeof:i,type:e,key:h,ref:a,props:l,_owner:c.current}}n.Fragment=l,n.jsx=h,n.jsxs=h},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>o});var r=s(50959);const i={},l=r.createContext(i);function o(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);