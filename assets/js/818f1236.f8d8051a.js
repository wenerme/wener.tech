/*! For license information please see 818f1236.f8d8051a.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[79614],{80184:(n,s,e)=>{e.r(s),e.d(s,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>h,toc:()=>a});var r=e(2488),t=e(62780);const l={title:"SSH"},o="SSH",h={id:"os/linux/shell/ssh/README",title:"SSH",description:"- sshdconfig",source:"@site/../notes/os/linux/shell/ssh/README.md",sourceDirName:"os/linux/shell/ssh",slug:"/os/linux/shell/ssh/",permalink:"/notes/os/linux/shell/ssh/",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/shell/ssh/README.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1696577752,formattedLastUpdatedAt:"Oct 6, 2023",frontMatter:{title:"SSH"},sidebar:"docs",previous:{title:"profile",permalink:"/notes/os/linux/shell/profile"},next:{title:"ssh-agent",permalink:"/notes/os/linux/shell/ssh/agent"}},i={},a=[{value:"Key",id:"key",level:2},{value:"Tunnel",id:"tunnel",level:2},{value:"\u591a\u8def\u590d\u7528",id:"\u591a\u8def\u590d\u7528",level:2},{value:"\u7f51\u5173",id:"\u7f51\u5173",level:2},{value:"\u8df3\u677f\u673a",id:"\u8df3\u677f\u673a",level:2},{value:"HTTP + SSH \u591a\u8def",id:"http--ssh-\u591a\u8def",level:2},{value:"ForwardAgent",id:"forwardagent",level:2}];function c(n){const s={a:"a",code:"code",h1:"h1",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.M)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"ssh",children:"SSH"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"http://man.openbsd.org/cgi-bin/man.cgi/OpenBSD-current/man5/sshd_config.5",children:"sshd_config"})}),"\n",(0,r.jsxs)(s.li,{children:["Host key ",(0,r.jsx)(s.code,{children:"/etc/ssh/ssh_host_*"})]}),"\n",(0,r.jsxs)(s.li,{children:["\u5c06\u6307\u5b9a\u7528\u6237\u7684\u7aef\u53e3\u8f6c\u53d1\u4f7f\u5f97\u5916\u90e8\u90fd\u53ef\u89c1,\u53ef\u5728 ",(0,r.jsx)(s.code,{children:"/etc/ssh/sshd_config"})," \u4e2d\u6dfb\u52a0,\u7136\u540e ",(0,r.jsx)(s.code,{children:"service sshd reload"})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"http://quark.humbug.org.au/publications/ssh/ssh-tricks.html",children:"http://quark.humbug.org.au/publications/ssh/ssh-tricks.html"})}),"\n",(0,r.jsx)(s.li,{children:"Verify that the .pem file has permissions of 0400, not 0777"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ssh -G host # \u67e5\u770b Host \u914d\u7f6e\n\n# \u8c03\u6574\u6743\u9650\nchmod 400 ~/.ssh/id_*\nchmod 644 ~/.ssh/id_*.pub\n\n# \u8f6c\u53d1/\u96a7\u9053\n# ============\n# -g \u5141\u8bb8\u5916\u90e8\u8bbf\u95ee\uff0c\u9700\u8981 GatewayPorts=no\n# -o ExitOnForwardFailure=yes \u8f6c\u53d1\u5931\u8d25\u9000\u51fa\nssh -L 3000:127.0.0.1:8080 # \u672c\u5730 3000 -> \u8fdc\u7a0b 8080\nssh -R 3000:127.0.0.1:8080 # \u8fdc\u7a0b 8080 -> \u672c\u5730 3000\n\nssh -D 1080                # SOCKS5 \u4ee3\u7406\ncurl -x socks5h://localhost:1080 icanhazip.com\n\n# \u8df3\u677f\n# ============\n# \u9700\u8981 PortForward\nssh -J admin@jumphost admin@internal\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"~/.ssh/config"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ssh-config",children:"Include ~/.ssh/*.ssh-config\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u62c6\u5206\u914d\u7f6e"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"ESCAPE"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:" ~.   - terminate connection (and any multiplexed sessions)\n ~B   - send a BREAK to the remote system\n ~C   - open a command line\n ~R   - request rekey\n ~V/v - decrease/increase verbosity (LogLevel)\n ~^Z  - suspend ssh\n ~#   - list forwarded connections\n ~&   - background ssh (when waiting for connections to terminate)\n ~?   - this message\n ~~   - send the escape character by typing it twice\n(Note that escapes are only recognized immediately after newline.)\n\nssh> help\nCommands:\n      -L[bind_address:]port:host:hostport    Request local forward\n      -R[bind_address:]port:host:hostport    Request remote forward\n      -D[bind_address:]port                  Request dynamic forward\n      -KL[bind_address:]port                 Cancel local forward\n      -KR[bind_address:]port                 Cancel remote forward\n      -KD[bind_address:]port                 Cancel dynamic forward\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"flags"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(s.table,{children:(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"flag"}),(0,r.jsx)(s.th,{children:"for"})]})})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"\u5e38\u7528\u914d\u7f6e"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# \u914d\u7f6e\u4f7f\u7528\u7684\u7aef\u53e3\nPort 22\n\n# \u662f\u5426\u8f6c\u53d1\u7f51\u5173\nGatewayPorts no\n# \u662f\u5426\u5141\u8bb8\u4f7f\u7528 root \u767b\u9646\nPermitRootLogin yes\n# \u662f\u5426\u5141\u8bb8\u4f7f\u7528\u5bc6\u7801\u767b\u9646\nPasswordAuthentication yes\nChallengeResponseAuthentication yes\n\n# \u8f6c\u53d1\u7684\u7aef\u53e3\u5141\u8bb8\u5916\u90e8\u8bbf\u95ee\nMatch User dev\nGatewayPorts yes\n\n# \u53ef\u53ea\u5bf9\u6307\u5b9a\u7684\u63a5\u53e3\u5bf9\u5916\u66b4\u9732\n# -R :8000:localhost:80\n# GatewayPorts clientspecified\n\n# \u7981\u6b62\u90e8\u5206\u7528\u6237\u4f7f\u7528 TTY\nMatch User player\nPermitTTY no\n"})}),"\n",(0,r.jsx)(s.h2,{id:"key",children:"Key"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'# \u751f\u6210 key\nssh-keygen -t rsa -b 2048 -C "email@example.com"\n\n# \u65e0\u5bc6\u7801\u4e0d\u8be2\u95ee\nssh-keygen -t rsa -b 2048 -f /tmp/sshkey -q -N ""\n# \u65b0\u7684\u63a8\u8350 ed25519\nssh-keygen -t ed25519 -C "" -f sshkey -q -N ""\n\n# \u67e5\u770b key \u4fe1\u606f\nssh-keygen -l -f key\nopenssl pkey -in key -noout -text\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["ssh-rsa\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://www.rfc-editor.org/rfc/rfc4253#section-6.6",children:"https://www.rfc-editor.org/rfc/rfc4253#section-6.6"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:"rsa-sha2-256, rsa-sha2-512"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"https://github.com/golang/go/issues/49952",children:"golang/go#49952"}),"\nx/crypto/ssh \u4e0d\u652f\u6301 rsa-sha2-256, rsa-sha2-512"]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://superuser.com/a/1444343/242730",children:"https://superuser.com/a/1444343/242730"})}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"tunnel",children:"Tunnel"}),"\n",(0,r.jsxs)(s.p,{children:["\u5728\u5de5\u4f5c\u4e2d\u5e38\u5e38\u9700\u8981\u8f83\u591a\u7684\u4ee3\u7406\u548c\u8f6c\u53d1,\u4e3a\u6bcf\u4e2a\u4ee3\u7406\u548c\u8f6c\u53d1\u90fd\u8fdb\u884c\u4e00\u6b21 SSH \u672a\u514d\u592a\u8fc7\u9ebb\u70e6,\u4f7f\u7528 ",(0,r.jsx)(s.code,{children:"~/.ssh/config"})," \u53ef\u4ee5\u5c06\u5e38\u7528\u7684\u8f6c\u53d1\u4e00\u6b21\u914d\u7f6e"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"Host tunnel\nHostname my.host.com\nUser myUser\nCompression yes\nExitOnForwardFailure yes\nForwardAgent yes\nDynamicForward 8888\nRemoteForward 2222 127.0.0.1:22\nLocalForward 16379 myInternalRedis:6379\nLocalForward 13306 myInternalMySQL:3306\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u518d\u914d\u5408 autossh \u53ef\u5927\u5927\u51cf\u5c11\u5de5\u4f5c\u91cf"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"autossh -M 8889 -vNg tunnel > ssh.log 2>&1 &\n"})}),"\n",(0,r.jsx)(s.h2,{id:"\u591a\u8def\u590d\u7528",children:"\u591a\u8def\u590d\u7528"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Multiplexing",children:"https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Multiplexing"})}),"\n",(0,r.jsxs)(s.li,{children:["\u597d\u5904\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u51cf\u5c11\u8fde\u63a5\u65f6\u95f4 - \u7279\u522b\u662f\u673a\u5668\u591a\u3001ssh \u547d\u4ee4\u591a\u3001ack \u5ef6\u65f6\u9ad8\u7684\u65f6\u5019"}),"\n",(0,r.jsx)(s.li,{children:"\u8fde\u63a5\u590d\u7528"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\u6ce8\u610f\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u8fde\u63a5\u8fc7\u591a\u53ef\u80fd\u6709\u95ee\u9898"}),"\n",(0,r.jsx)(s.li,{children:"\u4e0d\u8981\u7528\u6765\u4f20\u5927\u6587\u4ef6 - \u76f4\u63a5\u8fde\u63a5\u4f1a\u66f4\u5feb"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Host *\nControlPath ~/.ssh/controlmasters/%r@%h:%p\nControlMaster auto\nControlPersist 10m\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# \u5fc5\u987b\u8981\u624b\u52a8\u521b\u5efa\u76ee\u5f55\nmkdir ~/.ssh/controlmasters\n\n# \u68c0\u6d4b\nssh -O check myhost\n# \u81ea\u52a8\u542f\u52a8 master\nssh myhost pwd\n# \u505c\u6b62 master\nssh -O stop myhost\n\n# \u624b\u52a8\u542f\u52a8 master\nssh -MNn user@server\n"})}),"\n",(0,r.jsx)(s.h2,{id:"\u7f51\u5173",children:"\u7f51\u5173"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ssh -t gateway ssh internal\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Host internal\n  ProxyCommand ssh gw nc -w 1 internal 22\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ssh internal\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ssh -f -nNT -R 1100:localhost:22 somehost\n\nssh localhost -p 1100\n"})}),"\n",(0,r.jsx)(s.h2,{id:"\u8df3\u677f\u673a",children:"\u8df3\u677f\u673a"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'# \u9ed8\u8ba4\u652f\u6301 -J \u7528\u4e8e\u8df3\u677f\u573a\u666f\n# \u9700\u8981 PortForward\nssh -J admin@jumphost admin@internal\n\n# \u591a\u6b21\u8df3\u8f6c\nssh -J user1@host1:port1,user2@host2:port2 user3@host3\n\n# \u4f7f\u7528 ProxyCommand\n# -W host:port\n# \u8bf7\u6c42\u8f6c\u53d1 IO \u5230\u6307\u5b9a\u673a\u5668\u7684\u7aef\u53e3\uff0c\u9690\u542b\u4e86 -N, -T, ExitOnForwardFailure, ClearAllForwardings\nssh -o ProxyCommand="ssh -W %h:%p -q admin@jumphost" admin@internal\n\n# nc \u8f6c\u53d1 - \u4e0d\u9700\u8981 PortForward\n# \u53ef\u4ee5\u6dfb\u52a0 -o StrictHostKeyChecking=no \u907f\u514d\u8be2\u95ee\u6307\u7eb9\nssh -o ProxyCommand="ssh -q admin@jumphost nc %h %p" admin@internal\n\n# \u76f4\u63a5\u4e24\u6b21 ssh \u4e5f\u884c\nssh -At admin@jumphost ssh admin@internal\n'})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Host behindbeta\n  HostName behindbeta.example.org\n  ProxyJump betajump\n"})}),"\n",(0,r.jsx)(s.h2,{id:"http--ssh-\u591a\u8def",children:"HTTP + SSH \u591a\u8def"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://github.com/yrutschle/sslh",children:"https://github.com/yrutschle/sslh"})}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"forwardagent",children:"ForwardAgent"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://www.ssh.com/ssh/agent/",children:"https://www.ssh.com/ssh/agent/"})}),"\n",(0,r.jsx)(s.li,{children:"\u8f6c\u53d1 agent \u540e\u53ef\u4ee5\u76f4\u63a5\u5728\u8fdc\u7a0b\u8282\u70b9\u4f7f\u7528\u672c\u5730\u6dfb\u52a0\u7684 ssh \u5bc6\u94a5"}),"\n",(0,r.jsxs)(s.li,{children:["\u6ce8\u610f\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"root \u80fd\u8bbf\u95ee\u5176\u4ed6\u7528\u6237\u7684 auth sock"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# \u4f1a\u66b4\u9732 SSH_AUTH_SOCK - \u4f8b\u5982 /tmp/ssh-abcd/agent.6379\n# \u53ef\u4ee5\u5728\u6ca1\u6709\u7684\u4f1a\u8bdd\u8bbe\u7f6e\u53d8\u91cf\u4e5f\u80fd\u76f4\u63a5\u4f7f\u7528\nssh -A user@myhost.com\n"})})]})}function d(n={}){const{wrapper:s}={...(0,t.M)(),...n.components};return s?(0,r.jsx)(s,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},38088:(n,s,e)=>{var r=e(96651),t=Symbol.for("react.element"),l=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,h=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(n,s,e){var r,l={},a=null,c=null;for(r in void 0!==e&&(a=""+e),void 0!==s.key&&(a=""+s.key),void 0!==s.ref&&(c=s.ref),s)o.call(s,r)&&!i.hasOwnProperty(r)&&(l[r]=s[r]);if(n&&n.defaultProps)for(r in s=n.defaultProps)void 0===l[r]&&(l[r]=s[r]);return{$$typeof:t,type:n,key:a,ref:c,props:l,_owner:h.current}}s.Fragment=l,s.jsx=a,s.jsxs=a},2488:(n,s,e)=>{n.exports=e(38088)},62780:(n,s,e)=>{e.d(s,{I:()=>h,M:()=>o});var r=e(96651);const t={},l=r.createContext(t);function o(n){const s=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(s):{...s,...n}}),[s,n])}function h(n){let s;return s=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),r.createElement(l.Provider,{value:s},n.children)}}}]);