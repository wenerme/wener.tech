/*! For license information please see 8277ac28.4c4cdd54.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[32875],{76696:(n,e,d)=>{d.r(e),d.d(e,{assets:()=>t,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>a});var s=d(11527),l=d(47214);const r={title:"Android Build",tags:["Build"]},i="Android Build",o={id:"os/android/android-build",title:"Android Build",description:"- AGP",source:"@site/../notes/os/android/android-build.md",sourceDirName:"os/android",slug:"/os/android/build",permalink:"/notes/os/android/build",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/os/android/android-build.md",tags:[{label:"Build",permalink:"/notes/tags/build"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1702882608,formattedLastUpdatedAt:"Dec 18, 2023",frontMatter:{title:"Android Build",tags:["Build"]},sidebar:"docs",previous:{title:"Android Awesome",permalink:"/notes/os/android/awesome"},next:{title:"Android Version",permalink:"/notes/os/android/version"}},t={},a=[{value:"env",id:"env",level:2},{value:"SDK",id:"sdk",level:2},{value:"NDK",id:"ndk",level:2},{value:"Build",id:"build",level:2},{value:"Dependant package with key emulator not found",id:"dependant-package-with-key-emulator-not-found",level:2},{value:"Installed Build Tools revision 33.0.0 is corrupted. Remove and install again using the SDK Manager.",id:"installed-build-tools-revision-3300-is-corrupted-remove-and-install-again-using-the-sdk-manager",level:2},{value:"Failed to install the following Android SDK packages as some licences have not been accepted",id:"failed-to-install-the-following-android-sdk-packages-as-some-licences-have-not-been-accepted",level:2},{value:"optimize",id:"optimize",level:2}];function c(n){const e={a:"a",code:"code",del:"del",h1:"h1",h2:"h2",li:"li",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"android-build",children:"Android Build"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["AGP\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"com.android.tools.build:gradle"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://developer.android.com/studio/command-line",children:"https://developer.android.com/studio/command-line"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/alvr/alpine-android",children:"https://github.com/alvr/alpine-android"})}),"\n",(0,s.jsx)(e.li,{children:"ANDROID_SDK_ROOT"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"env",children:"env"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"env"}),(0,s.jsx)(e.th,{children:"for"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Android SDK"})}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_HOME"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.del,{children:"ANDROID_SDK_ROOT"})}),(0,s.jsx)(e.td,{children:"\u4f7f\u7528 ANDROID_HOME"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_USER_HOME"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"REPO_OS_OVERRIDE"}),(0,s.jsx)(e.td,{children:"windows\u3001macosx\u3001linux"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_NDK_HOME"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Emulator"})}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_EMULATOR_HOME"}),(0,s.jsx)(e.td,{children:"=$ANDROID_USER_HOME"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_AVD_HOME"}),(0,s.jsx)(e.td,{children:"=$ANDROID_EMULATOR_HOME/avd/"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_LOG_TAGS"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"HTTP_PROXY"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_VERBOSE"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_HOME"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ANDROID_EMULATOR_USE_SYSTEM_LIBS"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"CMDLINE_VERSION"}),(0,s.jsx)(e.td,{})]})]})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["ANDROID_EMULATOR_HOME=ANDROID_USER_HOME\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"$ANDROID_SDK_HOME/.android"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["ANDROID_HOME\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"C:\\Users\\<\u7528\u6237\u540d>\\AppData\\Local\\Android\\Sdk"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"/Users/<\u7528\u6237\u540d>/Library/Android/sdk"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"/home/<\u7528\u6237\u540d>/Android/Sdk"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"$ANDROID_HOME"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"add-ons/"}),"\n",(0,s.jsx)(e.li,{children:"build-tools/ - aapt\u3001dx"}),"\n",(0,s.jsx)(e.li,{children:"emulator/"}),"\n",(0,s.jsx)(e.li,{children:"extras/ - \u9644\u52a0\u7684\u5e93\u548c\u652f\u6301\u6587\u4ef6"}),"\n",(0,s.jsx)(e.li,{children:"licenses/"}),"\n",(0,s.jsx)(e.li,{children:"platform-tools/ - Android \u5e73\u53f0\u4ea4\u4e92\u6240\u9700\u7684\u57fa\u672c\u5de5\u5177 - adb\u3001fastboot"}),"\n",(0,s.jsx)(e.li,{children:"platforms/ - \u6bcf\u4e2a Android \u7248\u672c\u7684 SDK \u5e73\u53f0\u6587\u4ef6 - \u6838\u5fc3\u5e93\u3001API"}),"\n",(0,s.jsx)(e.li,{children:"skins/ - \u6a21\u62df\u5668\u7684\u76ae\u80a4\u6587\u4ef6"}),"\n",(0,s.jsx)(e.li,{children:"sources/ - \u7cfb\u7edf\u6e90\u7801"}),"\n",(0,s.jsx)(e.li,{children:"system-images/ - \u6a21\u62df\u5668\u4e0d\u540c\u67b6\u6784\u7684\u7cfb\u7edf\u955c\u50cf"}),"\n",(0,s.jsx)(e.li,{children:"tools/"}),"\n",(0,s.jsxs)(e.li,{children:["cmdline-tools/ - \u4e0d\u540c\u7248\u672c\u7684\u5de5\u5177\u96c6\uff0c\u66ff\u4ee3 tools/\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"sdkmanager"}),"\n",(0,s.jsx)(e.li,{children:"avdmanager"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"aapt - Android Asset Packaging Tool"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://developer.android.com/tools/variables",children:"https://developer.android.com/tools/variables"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"export ANDROID_HOME=~/Library/Android/sdk # macOS\n\nexport PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/tools/bin:$ANDROID_HOME/platform-tools\n"})}),"\n",(0,s.jsx)(e.h2,{id:"sdk",children:"SDK"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'# JDK 8\nCMDLINE_VERSION="8.0"\nSDK_TOOLS_VERSION="9123335"\n#\nCMDLINE_VERSION="9.0"\nSDK_TOOLS_VERSION="9477386"\n\nexport ANDROID_SDK_ROOT=$PWD\nexport PATH=$PATH:${ANDROID_SDK_ROOT}/cmdline-tools/${CMDLINE_VERSION}/bin:${ANDROID_SDK_ROOT}/platform-tools:${ANDROID_SDK_ROOT}/extras/google/instantapps\n\ncurl -Lo /tmp/tools.zip https://dl.google.com/android/repository/commandlinetools-linux-${SDK_TOOLS_VERSION}_latest.zip\n\nunzip -qq /tmp/tools.zip -d cmdline-tools\nmv cmdline-tools/cmdline-tools ${ANDROID_SDK_ROOT}/cmdline-tools/${CMDLINE_VERSION}\nrm /tmp/tools.zip\n\nmkdir -p ~/.android/ && touch ~/.android/repositories.cfg\n\nexport JAVA_HOME=/usr/lib/jvm/java-11-openjdk/\nsdkmanager --version\nyes | sdkmanager --sdk_root=${ANDROID_SDK_ROOT} --licenses\nsdkmanager --sdk_root=${ANDROID_SDK_ROOT} --install "platform-tools" "extras;google;instantapps"\n\n# 28.0.3, 29.0.3, 30.0.3, 31.0.0, 32.0.0, 33.0.2\n# 34.0.0-rc1\nBUILD_TOOLS="30.0.3"\nTARGET_SDK=$BUILD_TOOLS\n\nBUILD_TOOLS="30.0.2"\nTARGET_SDK=32\n\nexport PATH=$PATH:${ANDROID_SDK_ROOT}/build-tools/${BUILD_TOOLS}\n\nsdkmanager --sdk_root="${ANDROID_SDK_ROOT}" --install "build-tools;${BUILD_TOOLS}" "platforms;android-${TARGET_SDK}"\n\nsdkmanager --sdk_root="${ANDROID_SDK_ROOT}" --uninstall emulator\n\nsdkmanager "build-tools;29.0.2" # \u65e0 arm64, 30.0.2 \u4e5f \u65e0\nsdkmanager "build-tools;31.0.0" # \u6709 arm 64\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-groovy",children:'android {\n    buildToolsVersion "33.0.1"\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"ndk",children:"NDK"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://developer.android.com/ndk/downloads",children:"https://developer.android.com/ndk/downloads"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"build",children:"Build"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'export ANDROID_SDK_ROOT=/cache/opt/android/\nexport CMDLINE_VERSION="9.0"\nexport PATH=$PATH:${ANDROID_SDK_ROOT}/cmdline-tools/${CMDLINE_VERSION}/bin:${ANDROID_SDK_ROOT}/platform-tools:${ANDROID_SDK_ROOT}/extras/google/instantapps\nexport JAVA_HOME=/usr/lib/jvm/java-11-openjdk/\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"./gradlew assembleRelease\n./gradlew assembleDebug\n"})}),"\n",(0,s.jsx)(e.h2,{id:"dependant-package-with-key-emulator-not-found",children:"Dependant package with key emulator not found"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"build-tools 29 emulator \u65e0 arm64"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/google/android-emulator-container-scripts/issues/192",children:"https://github.com/google/android-emulator-container-scripts/issues/192"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://developer.android.com/studio/releases/emulator#emulator_for_arm64_hosts",children:"https://developer.android.com/studio/releases/emulator#emulator_for_arm64_hosts"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"installed-build-tools-revision-3300-is-corrupted-remove-and-install-again-using-the-sdk-manager",children:"Installed Build Tools revision 33.0.0 is corrupted. Remove and install again using the SDK Manager."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'sdkmanager "build-tools;33.0.0"\nsdkmanager "build-tools;31.0.0"\n\n# \u5347\u7ea7 AGP to 7.x \u6216 d8 -> dx\ncd $ANDROID_SDK_ROOT/build-tools/33.0.0\ncp d8 dx\ncd lib\ncp d8.jar dx.jar\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://stackoverflow.com/questions/68387270",children:"https://stackoverflow.com/questions/68387270"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"failed-to-install-the-following-android-sdk-packages-as-some-licences-have-not-been-accepted",children:"Failed to install the following Android SDK packages as some licences have not been accepted"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"yes | sdkmanager --licenses\n"})}),"\n",(0,s.jsx)(e.h2,{id:"optimize",children:"optimize"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"org.gradle.daemon=true\norg.gradle.parallel=true\norg.gradle.caching=true\n\norg.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"--configuration-cache"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},3354:(n,e,d)=>{var s=d(50959),l=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function a(n,e,d){var s,r={},a=null,c=null;for(s in void 0!==d&&(a=""+d),void 0!==e.key&&(a=""+e.key),void 0!==e.ref&&(c=e.ref),e)i.call(e,s)&&!t.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===r[s]&&(r[s]=e[s]);return{$$typeof:l,type:n,key:a,ref:c,props:r,_owner:o.current}}e.Fragment=r,e.jsx=a,e.jsxs=a},11527:(n,e,d)=>{n.exports=d(3354)},47214:(n,e,d)=>{d.d(e,{Z:()=>o,a:()=>i});var s=d(50959);const l={},r=s.createContext(l);function i(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:i(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);