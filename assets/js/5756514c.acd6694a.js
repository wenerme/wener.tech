/*! For license information please see 5756514c.acd6694a.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[64417],{95439:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var t=s(11527),r=s(47214);const o={title:"NextJS Cookbook",tags:["Cookbook"]},l="NextJS Cookbook",a={id:"web/framework/nextjs/nextjs-cookbook",title:"NextJS Cookbook",description:"- \u5b98\u65b9\u4f8b\u5b50 https://github.com/zeit/next.js/tree/canary/examples",source:"@site/../notes/web/framework/nextjs/nextjs-cookbook.md",sourceDirName:"web/framework/nextjs",slug:"/web/framework/nextjs/cookbook",permalink:"/notes/web/framework/nextjs/cookbook",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/framework/nextjs/nextjs-cookbook.md",tags:[{label:"Cookbook",permalink:"/notes/tags/cookbook"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1702440128,formattedLastUpdatedAt:"Dec 13, 2023",frontMatter:{title:"NextJS Cookbook",tags:["Cookbook"]},sidebar:"docs",previous:{title:"NextJS Conf",permalink:"/notes/web/framework/nextjs/conf"},next:{title:"NextJS Edge Runtime",permalink:"/notes/web/framework/nextjs/edge"}},i={},c=[{value:"\u914d\u7f6e\u95ee\u9898\u6392\u67e5",id:"\u914d\u7f6e\u95ee\u9898\u6392\u67e5",level:2},{value:"\u9875\u9762\u57fa\u7840\u4ee3\u7801",id:"\u9875\u9762\u57fa\u7840\u4ee3\u7801",level:2},{value:"API \u57fa\u7840\u4ee3\u7801",id:"api-\u57fa\u7840\u4ee3\u7801",level:2},{value:"\u9875\u9762\u8df3\u8f6c",id:"\u9875\u9762\u8df3\u8f6c",level:2},{value:"SSE - Servr-Send Event",id:"sse---servr-send-event",level:2},{value:"CSS \u5bfc\u5165\u5b57\u4f53",id:"css-\u5bfc\u5165\u5b57\u4f53",level:2},{value:"\u5bfc\u5165 SVG",id:"\u5bfc\u5165-svg",level:2},{value:"\u4f7f\u7528 @svgr/webpack",id:"\u4f7f\u7528-svgrwebpack",level:3},{value:"\u4f7f\u7528 inline-react-svg",id:"\u4f7f\u7528-inline-react-svg",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"nextjs-cookbook",children:"NextJS Cookbook"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5b98\u65b9\u4f8b\u5b50 ",(0,t.jsx)(n.a,{href:"https://github.com/zeit/next.js/tree/canary/examples",children:"https://github.com/zeit/next.js/tree/canary/examples"})]}),"\n",(0,t.jsxs)(n.li,{children:["compose ",(0,t.jsx)(n.a,{href:"https://github.com/JerryCauser/next-compose/blob/master/index.js",children:"https://github.com/JerryCauser/next-compose/blob/master/index.js"})]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.to/toomuchdesign/next-js-react-router-2kl8",children:"https://dev.to/toomuchdesign/next-js-react-router-2kl8"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// \u5224\u65ad\u670d\u52a1\u7aef\nconst isServer = typeof window === 'undefined';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u914d\u7f6e\u95ee\u9898\u6392\u67e5",children:"\u914d\u7f6e\u95ee\u9898\u6392\u67e5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// \u8f93\u51fa Webpack \u7684\u5339\u914d\u89c4\u5219\nconfig.module.rules.forEach((rule) => console.log(`Rule Test ${rule.test} Use`, rule.use));\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u9875\u9762\u57fa\u7840\u4ee3\u7801",children:"\u9875\u9762\u57fa\u7840\u4ee3\u7801"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import React from 'react';\nimport { NextPage } from 'next';\n\nconst Page: NextPage = () => {\n  return <div></div>;\n};\n\nexport default Page;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"api-\u57fa\u7840\u4ee3\u7801",children:"API \u57fa\u7840\u4ee3\u7801"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { NextApiRequest, NextApiResponse } from 'next';\n\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.status(200).json({ version: process.env.APP_VERSION || '1.0.0' });\n};\n\nexport default handler;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u9875\u9762\u8df3\u8f6c",children:"\u9875\u9762\u8df3\u8f6c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// \u521d\u59cb\u9636\u6bb5\u8df3\u8f6c\nPage.getInitialProps = async ({ res }) => {\n  // \u76ee\u6807\u5730\u5740\n  let targetUrl = '...';\n  if (!res) {\n    window.location.href = targetUrl;\n  } else {\n    res.writeHead(302, { Location: targetUrl });\n    res.end();\n  }\n  return {};\n};\n\n// \u9875\u9762\u5185\u8df3\u8f6c\nfunction MyPage() {\n  const router = useRouter();\n  useEffect(() => {\n    if (!auth) {\n      router.push('...');\n    }\n  }, []);\n}\n\n// API \u8df3\u8f6c\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.clearCookie('authenticated');\n  res.writeHead(302, { Location: '/login' });\n  res.end();\n};\n"})}),"\n",(0,t.jsx)(n.h2,{id:"sse---servr-send-event",children:"SSE - Servr-Send Event"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { NextApiRequest, NextApiResponse } from 'next';\n\nexport const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n\n// curl -Nv localhost:3000/test/see\n// https://zeit.co/pricing#limits Zeit free only allowed 10s/req\n// NOTE Zeit deploy not works - because the request will be buffered\n// https://github.com/zeit/next.js/issues/9965\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Content-Type', 'text/event-stream;charset=utf-8');\n  res.setHeader('Cache-Control', 'no-cache, no-transform');\n  res.setHeader('X-Accel-Buffering', 'no');\n\n  for (let i = 0; i < 5; i++) {\n    res.write(`data: Hello seq ${i}\\n\\n`);\n    await sleep(1000);\n  }\n  res.end('done\\n');\n};\n\nexport default handler;\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:"<!DOCTYPE html>\n<html>\n  <head>\n    <meta http-equiv=\"Content-type\" content=\"text/html; charset=utf-8\" />\n    <title>EventSource test</title>\n  </head>\n  <body>\n    <h1>EventSource test</h1>\n    <ul></ul>\n\n    <script type=\"text/javascript\">\n      var logger = document.getElementsByTagName('ul')[0],\n        socket = new EventSource('/');\n\n      var log = function (text) {\n        logger.innerHTML += '<li>' + text + '</li>';\n      };\n\n      socket.onopen = function () {\n        log('OPEN');\n      };\n\n      socket.onmessage = function (event) {\n        log('MESSAGE: ' + event.data);\n      };\n\n      socket.addEventListener('update', function (event) {\n        log('UPDATE(' + event.lastEventId + '): ' + event.data);\n      });\n\n      socket.onerror = function (event) {\n        log('ERROR: ' + event.message);\n      };\n    <\/script>\n  </body>\n</html>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"css-\u5bfc\u5165\u5b57\u4f53",children:"CSS \u5bfc\u5165\u5b57\u4f53"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"config.module.rules.push({\n  test: /\\.(eot|woff|woff2|ttf)$/,\n  use: {\n    loader: 'url-loader',\n    options: {\n      limit: 100000,\n      name: '[name].[ext]',\n    },\n  },\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5bfc\u5165-svg",children:"\u5bfc\u5165 SVG"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"url-loader inline \u4f1a\u751f\u6210 dataurl - react \u53ef\u80fd\u5bfc\u81f4\u5f02\u5e38"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/twopluszero/next-images",children:"next-images"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Typescript \u786e\u4fdd\u4e0d\u4f1a\u51fa\u73b0\u7c7b\u578b\u9519\u8bef\ndeclare module '*.svg';\n\ndeclare module '*.png';\ndeclare module '*.jpg';\ndeclare module '*.jpeg';\ndeclare module '*.gif';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u4f7f\u7528-svgrwebpack",children:"\u4f7f\u7528 @svgr/webpack"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53ef\u4ee5\u4f7f\u7528 tsconfig \u4e2d\u7684 path"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://react-svgr.com/docs/webpack/",children:"https://react-svgr.com/docs/webpack/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/webpack-contrib/url-loader/issues/86",children:"https://github.com/webpack-contrib/url-loader/issues/86"})}),"\n",(0,t.jsxs)(n.li,{children:["Base64 \u95ee\u9898\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/gregberge/svgr/issues/361",children:"https://github.com/gregberge/svgr/issues/361"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/gregberge/svgr/issues/404",children:"https://github.com/gregberge/svgr/issues/404"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn add --dev @svgr/webpack babel-loader\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"config.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  use: [\n    {\n      loader: 'babel-loader',\n    },\n    {\n      loader: '@svgr/webpack',\n      options: {\n        babel: false,\n        icon: true,\n      },\n    },\n  ],\n});\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// \u533a\u5206 js \u6216 css \u5bfc\u5165\nconfig.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  issuer: {\n    test: /\\.[tj]sx?$/,\n  },\n  use: ['babel-loader', '@svgr/webpack', 'file-loader'],\n});\n\nconfig.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  loader: 'url-loader',\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u4f7f\u7528-inline-react-svg",children:"\u4f7f\u7528 inline-react-svg"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u4e0d\u53ef\u4ee5"})," \u4f7f\u7528 tsconfig \u4e2d\u7684 path"]}),"\n",(0,t.jsx)(n.li,{children:"\u4f1a\u7528 SVGO \u4f18\u5316"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn add --dev babel-plugin-inline-react-svg\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "presets": ["next/babel"],\n  "plugins": ["inline-react-svg"]\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},3354:(e,n,s)=>{var t=s(50959),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,s){var t,o={},c=null,d=null;for(t in void 0!==s&&(c=""+s),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(d=n.ref),n)l.call(n,t)&&!i.hasOwnProperty(t)&&(o[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===o[t]&&(o[t]=n[t]);return{$$typeof:r,type:e,key:c,ref:d,props:o,_owner:a.current}}n.Fragment=o,n.jsx=c,n.jsxs=c},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>l});var t=s(50959);const r={},o=t.createContext(r);function l(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);