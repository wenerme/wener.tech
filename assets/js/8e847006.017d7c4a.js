/*! For license information please see 8e847006.017d7c4a.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[60486],{6180:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var s=r(2488),t=r(62780);const l={title:"PostGraphile"},i="PostGraphile",o={id:"db/relational/postgresql/postgraphile",title:"PostGraphile",description:"- graphile/crystal",source:"@site/../notes/db/relational/postgresql/postgraphile.md",sourceDirName:"db/relational/postgresql",slug:"/db/relational/postgresql/postgraphile",permalink:"/notes/db/relational/postgresql/postgraphile",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/postgraphile.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1709694572,formattedLastUpdatedAt:"Mar 6, 2024",frontMatter:{title:"PostGraphile"},sidebar:"docs",previous:{title:"plv8",permalink:"/notes/db/relational/postgresql/plv8"},next:{title:"Supabase PostgreSQL Image",permalink:"/notes/db/relational/postgresql/postgres-supabase"}},a={},p=[{value:"embded",id:"embded",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"Schema",id:"schema",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,t.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"postgraphile",children:"PostGraphile"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/graphile/crystal",children:"graphile/crystal"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Crystal Monorepo for Grafast, PostGraphile, pg-introspection, pg-sql2"}),"\n",(0,s.jsx)(n.li,{children:"postgraphile"}),"\n",(0,s.jsx)(n.li,{children:"GraphQL over PostgreSQL"}),"\n",(0,s.jsx)(n.li,{children:"\u5f3a\u8c03 DB \u8bbe\u8ba1 - \u5148 DB \u540e GraphQL"}),"\n",(0,s.jsx)(n.li,{children:"TypeScript+NodeJS \u5b9e\u73b0"}),"\n",(0,s.jsxs)(n.li,{children:["\u53ef\u4ee5\u72ec\u7acb\u4f7f\u7528\u4e5f\u53ef\u4ee5\u5d4c\u5165\u5230 NodeJS \u4f7f\u7528\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5b98\u65b9\u63a8\u8350\u4f5c\u4e3a\u5e93\u4f7f\u7528\uff0c\u56e0\u4e3a\u65b9\u4fbf\u81ea\u5b9a\u4e49\u548c\u52a0\u63d2\u4ef6"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# https://www.graphile.org/postgraphile/usage-cli/\n\n# \u5f00\u53d1\u73af\u5883\u53c2\u6570\npostgraphile \\\n  --subscriptions \\\n  --watch \\\n  --dynamic-json \\\n  --no-setof-functions-contain-nulls \\\n  --no-ignore-rbac \\\n  --no-ignore-indexes \\\n  --show-error-stack=json \\\n  --extended-errors hint,detail,errcode \\\n  --append-plugins @graphile-contrib/pg-simplify-inflector \\\n  --export-schema-graphql schema.graphql \\\n  --graphiql "/" \\\n  --enhance-graphiql \\\n  --allow-explain \\\n  --enable-query-batching \\\n  --legacy-relations omit \\\n  --connection $DATABASE_URL \\\n  --schema app_public\n\n# \u751f\u4ea7\u73af\u5883\npostgraphile \\\n  --subscriptions \\\n  --retry-on-init-fail \\\n  --dynamic-json \\\n  --no-setof-functions-contain-nulls \\\n  --no-ignore-rbac \\\n  --no-ignore-indexes \\\n  --extended-errors errcode \\\n  --append-plugins @graphile-contrib/pg-simplify-inflector \\\n  --disable-graphiql \\\n  --enable-query-batching \\\n  --disable-query-log \\ # our default logging has performance issues, but do make sure you have a logging system in place!\n  --legacy-relations omit \\\n  --connection $DATABASE_URL \\\n  --schema app_public\n'})}),"\n",(0,s.jsx)(n.h2,{id:"embded",children:"embded"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const express = require('express');\nconst { postgraphile } = require('postgraphile');\n\nconst app = express();\n\n/* Example middleware you might want to put in front of PostGraphile */\n// app.use(require('morgan')(...));\n// app.use(require('compression')({...}));\n// app.use(require('helmet')({...}));\n\napp.use(\n  postgraphile(process.env.DATABASE_URL || 'postgres:///', 'public', {\n    // ...\n    pgSettings: {\n      statement_timeout: '3000',\n    },\n  }),\n);\n\napp.listen(process.env.PORT || 3000);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5916\u952e\u6dfb\u52a0\u7d22\u5f15"}),"\n",(0,s.jsx)(n.li,{children:"RLS (Row Level Security) \u5982\u679c\u8981\u7528\u5efa\u8bae\u6bcf\u4e2a\u8868\u90fd\u542f\u7528"}),"\n",(0,s.jsxs)(n.li,{children:["\u8868\u6388\u6743 SELECT/DELETE\uff0c\u5217\u6388\u6743 INSERT/UPDATE\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5217\u6388\u6743 SELECT \u4f1a\u5bfc\u81f4\u65e0\u6cd5\u4f18\u5316\uff0c\u4e0d\u80fd ",(0,s.jsx)(n.code,{children:"SELECT *"}),", ",(0,s.jsx)(n.code,{children:"RETURNING *"}),", \u4e0d\u80fd\u5c06\u884c\u4f5c\u4e3a\u51fd\u6570\u53c2\u6570"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5c3d\u91cf ",(0,s.jsx)(n.code,{children:"LANGUAGE sql"}),"\uff0c \u907f\u514d ",(0,s.jsx)(n.code,{children:"LANGUAGE plpgsql"})]}),"\n",(0,s.jsxs)(n.li,{children:["Trigger \u6dfb\u52a0\u6570\u5b57\u524d\u7f00\uff0c\u56e0\u4e3a\u662f\u6309\u5e8f\u6267\u884c\u7684\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"_200_do_a_thing"})," / ",(0,s.jsx)(n.code,{children:"_800_do_something_else"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"schema",children:"Schema"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.graphile.org/postgraphile/postgresql-schema-design/",children:"https://www.graphile.org/postgraphile/postgresql-schema-design/"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},38088:(e,n,r)=>{var s=r(96651),t=Symbol.for("react.element"),l=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function p(e,n,r){var s,l={},p=null,c=null;for(s in void 0!==r&&(p=""+r),void 0!==n.key&&(p=""+n.key),void 0!==n.ref&&(c=n.ref),n)i.call(n,s)&&!a.hasOwnProperty(s)&&(l[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===l[s]&&(l[s]=n[s]);return{$$typeof:t,type:e,key:p,ref:c,props:l,_owner:o.current}}n.Fragment=l,n.jsx=p,n.jsxs=p},2488:(e,n,r)=>{e.exports=r(38088)},62780:(e,n,r)=>{r.d(n,{I:()=>o,M:()=>i});var s=r(96651);const t={},l=s.createContext(t);function i(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);