/*! For license information please see accd3f3b.66a94a0c.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[27133],{58940:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>a});var t=l(11527),i=l(47214);const s={tags:["FAQ"]},r="Platform FAQ",o={id:"platform/platform-faq",title:"Platform FAQ",description:"\u94fe\u63a5\u8d85\u65f6",source:"@site/../notes/platform/platform-faq.md",sourceDirName:"platform",slug:"/platform/faq",permalink:"/notes/platform/faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/platform/platform-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1681042995,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{tags:["FAQ"]},sidebar:"docs",previous:{title:"Platform Awesome",permalink:"/notes/platform/awesome"},next:{title:"\u817e\u8baf\u4e91",permalink:"/notes/platform/qcloud"}},c={},a=[{value:"\u94fe\u63a5\u8d85\u65f6",id:"idle-connections",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"platform-faq",children:"Platform FAQ"}),"\n",(0,t.jsx)(n.h2,{id:"idle-connections",children:"\u94fe\u63a5\u8d85\u65f6"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4e91\u5e73\u53f0\u4f1a\u4e3b\u52a8\u5207\u65ad idle \u7684\u94fe\u63a5\uff0c\u8fd9\u4e2a\u548c\u5c40\u57df\u7f51\u7684\u94fe\u63a5\u4e0d\u540c - \u4e91\u5e73\u53f0 nat \u8d44\u6e90"}),"\n",(0,t.jsx)(n.li,{children:"\u5e94\u7528\u9700\u8981\u4e3b\u52a8 ping/keepalive \u4fdd\u6301\u94fe\u63a5\uff0c\u5426\u5219\u4ece\u94fe\u63a5\u6c60\u91cc\u62ff\u51fa\u6765\u94fe\u63a5\u53ef\u80fd\u5df2\u7ecf timeout"}),"\n",(0,t.jsx)(n.li,{children:"\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u53ef\u4ee5\u914d\u7f6e tcp keepalive \u8fdb\u884c\u4fdd\u6d3b"}),"\n",(0,t.jsxs)(n.li,{children:["\u5927\u591a\u94fe\u63a5\u6c60\u90fd\u652f\u6301\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["IdleTimeout\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5efa\u8bae\u5c0f\u4e8e 10 \u5206\u949f"}),"\n",(0,t.jsx)(n.li,{children:"idle \u65f6\u957f\uff0c\u5982\u679c\u914d\u7f6e\u7684\u6bd4 \u5e73\u53f0/\u7cfb\u7edf \u5c42 idle \u77ed\uff0c\u4e5f\u80fd\u907f\u514d\u53d6\u5230\u65e0\u6548\u94fe\u63a5\u7684\u95ee\u9898"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"TestOnBorrow - \u6709\u4e00\u5b9a\u6027\u80fd\u5f71\u54cd"}),"\n",(0,t.jsx)(n.li,{children:"TestOnReturn"}),"\n",(0,t.jsxs)(n.li,{children:["TestWhileIdle - \u5f71\u54cd\u5c0f\uff0c\u4f46\u4f1a\u6d6a\u8d39\u4e00\u5b9a\u94fe\u63a5\u6570\u91cf\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u9700\u8981\u614e\u91cd\u8003\u8651\u914d\u7f6e\u7684 idle \u6570\u91cf"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u94fe\u63a5\u6c60\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["apache commons-pool ",(0,t.jsx)(n.a,{href:"https://commons.apache.org/proper/commons-pool/apidocs/org/apache/commons/pool2/impl/GenericObjectPool.html",children:"GenericObjectPool"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u652f\u6301 IdleTime, TestWhileIdle, TestOnCreate, TestOnBorrow, TestOnReturn"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["HikariCP ",(0,t.jsx)(n.a,{href:"https://javadoc.io/doc/com.zaxxer/HikariCP/latest/com/zaxxer/hikari/HikariConfig.html",children:"HikariConfig"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"IdleTimeout, KeepaliveTime"}),"\n",(0,t.jsx)(n.li,{children:"KeepaliveTime \u68c0\u6d4b idle \u7684\u5468\u671f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u7cfb\u7edf TCP KeepAlive"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["tcp_keepalive_time\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4e0a\u6b21\u6570\u636e\u5305\u53d1\u9001\u540e\uff0c\u591a\u4e45\u5f00\u59cb\u53d1\u9001 keepalive"}),"\n",(0,t.jsx)(n.li,{children:"\u5f00\u59cb\u53d1\u9001 keepalive \u540e\uff0c\u8be5\u503c\u4e0d\u5728\u91cd\u8981"}),"\n",(0,t.jsx)(n.li,{children:"TCP_KEEPIDLE"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["tcp_keepalive_intvl\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53d1\u9001 keepalive \u7684\u95f4\u9694"}),"\n",(0,t.jsx)(n.li,{children:"TCP_KEEPINTVL"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["tcp_keepalive_probes\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u591a\u5c11\u6b21 unack \u540e\u8ba4\u4e3a\u94fe\u63a5\u5df2\u7ecf\u65ad\u5f00\uff0c\u901a\u77e5\u5e94\u7528\u5c42"}),"\n",(0,t.jsx)(n.li,{children:"TCP_KEEPCNT"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Linux\n# \u9ed8\u8ba4 7200\uff0c75\uff0c9\n# 2\u5c0f\u65f6, 75s, 9\u6b21\nsysctl net.ipv4.tcp_keepalive_time net.ipv4.tcp_keepalive_intvl net.ipv4.tcp_keepalive_probes\n\n# 1\u5206\u949f, 1\u5206\u949f, 5\u6b21\nsysctl -w \\\n  net.ipv4.tcp_keepalive_time=60 \\\n  net.ipv4.tcp_keepalive_intvl=60 \\\n  net.ipv4.tcp_keepalive_probes=5\n\ncat <<EOF | sudo tee /etc/sysctl.d/99-tcp_keepalive.conf\nnet.ipv4.tcp_keepalive_time = 60\nnet.ipv4.tcp_keepalive_intvl = 60\nnet.ipv4.tcp_keepalive_probes = 5\nEOF\nsudo sysctl -p /etc/sysctl.d/99-tcp_keepalive.conf\n\n# macOS\nsysctl net.inet.tcp.always_keepalive net.inet.tcp.keepidle net.inet.tcp.keepinit net.inet.tcp.keepintvl\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["GCP \u662f 10 \u5206\u949f\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://cloud.google.com/compute/docs/troubleshooting/general-tips?hl=zh-cn#idle-connections",children:"https://cloud.google.com/compute/docs/troubleshooting/general-tips?hl=zh-cn#idle-connections"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["AWS ELB \u9ed8\u8ba4\u662f 1 \u5206\u949f\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53ef\u4fee\u6539\u4e3a 1 - 4000"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/config-idle-timeout.html",children:"Configure the idle connection timeout for your Classic Load Balancer"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["AWS API Gateway \u9ed8\u8ba4 10 \u5206\u949f\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/apigateway/latest/developerguide/limits.html",children:"Amazon API Gateway quotas and important notes"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/",children:"https://tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},3354:(e,n,l)=>{var t=l(50959),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function a(e,n,l){var t,s={},a=null,p=null;for(t in void 0!==l&&(a=""+l),void 0!==n.key&&(a=""+n.key),void 0!==n.ref&&(p=n.ref),n)r.call(n,t)&&!c.hasOwnProperty(t)&&(s[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===s[t]&&(s[t]=n[t]);return{$$typeof:i,type:e,key:a,ref:p,props:s,_owner:o.current}}n.Fragment=s,n.jsx=a,n.jsxs=a},11527:(e,n,l)=>{e.exports=l(3354)},47214:(e,n,l)=>{l.d(n,{Z:()=>o,a:()=>r});var t=l(50959);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);