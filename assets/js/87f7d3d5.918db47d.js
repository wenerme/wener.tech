/*! For license information please see 87f7d3d5.918db47d.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[78720],{96660:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>i});var r=d(2488),s=d(62780);const t={title:"Caddy"},c="Caddy",l={id:"devops/web/caddy/README",title:"Caddy",description:"- mholt/caddy",source:"@site/../notes/devops/web/caddy/README.md",sourceDirName:"devops/web/caddy",slug:"/devops/web/caddy/",permalink:"/notes/devops/web/caddy/",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/web/caddy/README.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1708697175,formattedLastUpdatedAt:"Feb 23, 2024",frontMatter:{title:"Caddy"},sidebar:"docs",previous:{title:"Apache APISIX",permalink:"/notes/devops/web/apisix"},next:{title:"Caddy V1",permalink:"/notes/devops/web/caddy/v1"}},a={},i=[{value:"Caddyfile",id:"caddyfile",level:2},{value:"Docker reload",id:"docker-reload",level:2},{value:"file_server",id:"file_server",level:2},{value:"templates",id:"templates",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"caddy",children:"Caddy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/mholt/caddy",children:"mholt/caddy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Apache-2.0, Golang"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"brew install caddy # macOS - /usr/local/etc/Caddyfile\n\n# \u542f\u52a8 \u5e76\u76d1\u542c\u914d\u7f6e\u53d8\u5316\ncaddy run --watch --config Caddyfile --adapter caddyfile\n# caddy start # \u540e\u53f0\u542f\u52a8\n\ncaddy build-info\ncaddy list-modules\n\ncaddy reload\n\n# Caddyfile -> JSON\n# --validate --pretty\ncaddy adapt --config Caddyfile | jq\ncaddy validate Caddyfile\ncaddy fmt --overwrite Caddyfile\n\ncaddy trust # \u5b89\u88c5\u8bc1\u4e66\ncaddy untrust\n\n# \u5feb\u901f\u542f\u52a8\u670d\u52a1\n# ==========\n# --root $PWD --listen :80 --templates\ncaddy file-server --access-log # \u6587\u4ef6\u670d\u52a1\ncaddy respond --status 401     # \u8fd4\u56de\u76f8\u540c\u54cd\u5e94 - \u7528\u4e8e\u6d4b\u8bd5\n\ncaddy reverse-proxy --to https://wener.me --internal-certs --from :8081 --change-host-header # \u53cd\u5411\u4ee3\u7406 http://127.0.0.1:8081/\n\n# \u5305\u7ba1\u7406\n# ==========\ncaddy add-package github.com/caddy-dns/cloudflare\n# caddy remove-package\n"})}),"\n",(0,r.jsx)(n.h2,{id:"caddyfile",children:"Caddyfile"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u73af\u5883\u53d8\u91cf ",(0,r.jsx)(n.code,{children:"{$SITE_ADDRESS}"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"{env.HOME}"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u9ed8\u8ba4\u503c ",(0,r.jsx)(n.code,{children:"{$DOMAIN:localhost}"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u5360\u4f4d/\u53d8\u91cf - ",(0,r.jsx)(n.code,{children:"{}"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"env."}),"\n",(0,r.jsx)(n.li,{children:"system.{hostname,slash,os,arch,wd}"}),"\n",(0,r.jsx)(n.li,{children:"time.now, time.now.{unix,unix_ms,common_log,year}"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"\u5b58\u50a8\u4f4d\u7f6e $XDG_DATA_HOME/caddy"}),"\n",(0,r.jsxs)(n.li,{children:["Named matchers - ",(0,r.jsx)(n.code,{children:"@name"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u8868\u8fbe\u5f0f \u5339\u914d\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/google/cel-spec",children:"https://github.com/google/cel-spec"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'@mutable `{method}.startsWith("P")`\nexpression {method}.startsWith("P")\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-caddyfile",children:"example.com {\n  gzip\n  reverse_proxy / 127.0.0.1:9000 {\n    transport fastcgi\n\t}\n}\n\nexample.com {\n\troot * /var/www\n\tfile_server\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-caddyfile",children:'# \u5b9a\u4e49\u7247\u6bb5\n(redirect) {\n\t@http {\n\t\tprotocol http\n\t}\n\tredir @http https://{host}{uri}\n}\n(snippet) {\n  respond "Yahaha! You found {args.0}!"\n}\n\n# \u5f15\u7528\u7247\u6bb5\nimport redirect\na.example.com {\n\timport snippet "Example A"\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rewrite * {path}?{query}&host={host}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u91cd\u5199 header \u5230 path"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"abc-dev.domain.co"})," -> ",(0,r.jsx)(n.code,{children:"abc/def/{uri}"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"@parseHost header_regexp parsedHost Host ^([a-z0-9]+)-([a-z0-9]+)\\.domain\\.co$\nroot @parseHost /opt/serve/{re.parsedHost.2}/stages/{re.parsedHost.1}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"abc.builds.wener.me"})," -> ",(0,r.jsx)(n.code,{children:"abc/{uri}"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"http.request.host.labels"})," \u4ece 0 \u5f00\u59cb"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"*.builds.wener.me {\n  root * /opt/serve/builds/{http.request.host.labels.3}\n  try_files {path} /index.html\n  file_server\n}\n\n\n"})}),"\n",(0,r.jsx)(n.h2,{id:"docker-reload",children:"Docker reload"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker exec -w /etc/caddy caddy caddy reload\n"})}),"\n",(0,r.jsx)(n.h2,{id:"file_server",children:"file_server"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"caddy file-server export-template\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/caddyserver/caddy/blob/master/modules/caddyhttp/fileserver/browse.html",children:"https://github.com/caddyserver/caddy/blob/master/modules/caddyhttp/fileserver/browse.html"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://caddyserver.com/docs/caddyfile/directives/file_server",children:"https://caddyserver.com/docs/caddyfile/directives/file_server"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"templates",children:"templates"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/caddyserver/website/blob/master/src/docs/index.html",children:"https://github.com/caddyserver/website/blob/master/src/docs/index.html"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://caddyserver.com/docs/caddyfile/directives/templates",children:"https://caddyserver.com/docs/caddyfile/directives/templates"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},38088:(e,n,d)=>{var r=d(96651),s=Symbol.for("react.element"),t=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(e,n,d){var r,t={},i=null,o=null;for(r in void 0!==d&&(i=""+d),void 0!==n.key&&(i=""+n.key),void 0!==n.ref&&(o=n.ref),n)c.call(n,r)&&!a.hasOwnProperty(r)&&(t[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===t[r]&&(t[r]=n[r]);return{$$typeof:s,type:e,key:i,ref:o,props:t,_owner:l.current}}n.Fragment=t,n.jsx=i,n.jsxs=i},2488:(e,n,d)=>{e.exports=d(38088)},62780:(e,n,d)=>{d.d(n,{I:()=>l,M:()=>c});var r=d(96651);const s={},t=r.createContext(s);function c(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);