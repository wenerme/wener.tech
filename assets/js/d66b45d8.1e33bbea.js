/*! For license information please see d66b45d8.1e33bbea.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[27980],{51860:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var l=o(2488),r=o(62780);const t={title:"ko"},s="ko",a={id:"languages/go/lib/ko",title:"ko",description:"- google/ko",source:"@site/../notes/languages/go/lib/ko.md",sourceDirName:"languages/go/lib",slug:"/languages/go/lib/ko",permalink:"/notes/languages/go/lib/ko",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/languages/go/lib/ko.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1647984068,formattedLastUpdatedAt:"Mar 22, 2022",frontMatter:{title:"ko"},sidebar:"docs",previous:{title:"graphql",permalink:"/notes/languages/go/lib/graphql"},next:{title:"kratos",permalink:"/notes/languages/go/lib/kratos"}},i={},c=[];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",li:"li",pre:"pre",ul:"ul",...(0,r.M)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"ko",children:"ko"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/google/ko",children:"google/ko"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Go source to Kubernetes"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["KO_DOCKER_REPO\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"KO_DOCKER_REPO=ko.local, -L, --local - \u672c\u5730\uff0c\u4e0d push"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"KO_CONFIG_PATH=.ko.yaml"}),"\n",(0,l.jsx)(n.li,{children:"KIND_CLUSTER_NAME"}),"\n",(0,l.jsx)(n.li,{children:"--platform=linux/amd64,linux/arm64 - \u591a\u5e73\u53f0\u6784\u5efa"}),"\n",(0,l.jsx)(n.li,{children:"KO_DATA_PATH=kodata - \u9759\u6001\u8d44\u6e90\u8def\u5f84"}),"\n",(0,l.jsx)(n.li,{children:"GOFLAGS"}),"\n",(0,l.jsx)(n.li,{children:"\u9ed8\u8ba4\u5305\u542b -trimpath"}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u80fd\u7528 CGO"}),"\n"]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# macOS\nbrew install ko\n# Go install\ngo install github.com/google/ko@latest\n\nko build ./cmd/app\n\nko resolve -f config/ > release.yaml\n# ko resolve -f config/ | kubectl apply -f -\nko apply -f config/\nko delete -f config/\n\nkustomize build config | ko resolve -f -\n\n# bash completion\nko completion\n# go.mod\nko publish -L --bare --platform=linux/amd64 --push=false -t $(git rev-parse HEAD) .\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'# \u9ed8\u8ba4\u57fa\u7840\u955c\u50cf\ndefaultBaseImage: gcr.io/distroless/static:nonroot\n\n# \u4fee\u6539\u57fa\u7840\u955c\u50cf\nbaseImageOverrides:\n  github.com/my-user/my-repo/cmd/app: registry.example.com/base/for/app\n  github.com/my-user/my-repo/cmd/foo: registry.example.com/base/for/foo\n\n# \u81ea\u5b9a\u4e49\u6784\u5efa\nbuilds:\n  - id: foo\n    main: ./foobar/foo\n    env:\n      - GOPRIVATE=git.internal.example.com,source.developers.google.com\n    flags:\n      - -tags\n      - netgo\n    ldflags:\n      - -s -w\n      - -extldflags "-static"\n      - -X main.version={{.Env.VERSION}}\n  - id: bar\n    main: ./foobar/bar/main.go\n    env:\n      - GOCACHE=/workspace/.gocache\n    ldflags:\n      - -s\n      - -w\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"template \u652f\u6301\u6a21\u677f - \u4f46\u53ea\u652f\u6301 \u73af\u5883\u53d8\u91cf"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ko build ./cmd/app"})," \u9ed8\u8ba4\u955c\u50cf\u540d\u5b57 ",(0,l.jsx)(n.code,{children:"${KO_DOCKER_REPO}/app-<md5>"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"--base-import-paths,-B - \u5ffd\u7565 md5"}),"\n",(0,l.jsx)(n.li,{children:"--bare - \u53ea\u7528 repo \u90e8\u5206"}),"\n",(0,l.jsx)(n.li,{children:"--preserve-import-path,-P - repo \u540e\u518d\u52a0\u4e0a \u6a21\u5757 \u8def\u5f84"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-deployment\nspec:\n  replicas: 3\n  template:\n    spec:\n      containers:\n        - name: my-app\n          # Import Path\n          image: ko://github.com/my-user/my-repo/cmd/app\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},38088:(e,n,o)=>{var l=o(96651),r=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,o){var l,t={},c=null,d=null;for(l in void 0!==o&&(c=""+o),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(d=n.ref),n)s.call(n,l)&&!i.hasOwnProperty(l)&&(t[l]=n[l]);if(e&&e.defaultProps)for(l in n=e.defaultProps)void 0===t[l]&&(t[l]=n[l]);return{$$typeof:r,type:e,key:c,ref:d,props:t,_owner:a.current}}n.Fragment=t,n.jsx=c,n.jsxs=c},2488:(e,n,o)=>{e.exports=o(38088)},62780:(e,n,o)=>{o.d(n,{I:()=>a,M:()=>s});var l=o(96651);const r={},t=l.createContext(r);function s(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);