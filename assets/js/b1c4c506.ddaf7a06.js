/*! For license information please see b1c4c506.ddaf7a06.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[63294],{28186:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>o,frontMatter:()=>r,metadata:()=>d,toc:()=>h});var l=i(11527),s=i(47214);const r={title:"Cadence"},c="Cadence",d={id:"service/workflow/cadence",title:"Cadence",description:"- uber/cadence \u662f\u4ec0\u4e48\uff1f",source:"@site/../notes/service/workflow/cadence.md",sourceDirName:"service/workflow",slug:"/service/workflow/cadence",permalink:"/notes/service/workflow/cadence",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/workflow/cadence.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1642767775,formattedLastUpdatedAt:"Jan 21, 2022",frontMatter:{title:"Cadence"},sidebar:"docs",previous:{title:"Camunda",permalink:"/notes/service/workflow/bpms/camunda"},next:{title:"flogo",permalink:"/notes/service/workflow/flogo"}},t={},h=[{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"Golang",id:"golang",level:2},{value:"Java",id:"java",level:2},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef",level:2},{value:"Domain",id:"domain",level:2},{value:"Activity",id:"activity",level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",level:3},{value:"Workflow",id:"workflow",level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0-1",level:3},{value:"\u6ce8\u610f",id:"\u6ce8\u610f",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"\u5b58\u50a8\u7ed3\u6784",id:"\u5b58\u50a8\u7ed3\u6784",level:2},{value:"schema",id:"schema",level:2},{value:"Helm",id:"helm",level:2},{value:"Cannot register global domain when not enabled",id:"cannot-register-global-domain-when-not-enabled",level:2},{value:"Persistence Max QPS Reached",id:"persistence-max-qps-reached",level:2},{value:"Persistence Max QPS Reached for List Operations",id:"persistence-max-qps-reached-for-list-operations",level:2}];function a(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:"cadence",children:"Cadence"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence",children:"uber/cadence"})," \u662f\u4ec0\u4e48\uff1f\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"MIT, Golang"}),"\n",(0,l.jsx)(e.li,{children:"\u5206\u5e03\u5f0f\uff0c\u5927\u89c4\u6a21\uff0c\u6301\u4e45\u5316\uff0c\u9ad8\u53ef\u7528\u7684\u5f02\u6784\u8c03\u5ea6\u5f15\u64ce"}),"\n",(0,l.jsx)(e.li,{children:"\u7528\u4e8e\u5f02\u6b65\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4e1a\u52a1\u903b\u8f91"}),"\n",(0,l.jsx)(e.li,{children:"Fault Tolerant Actor Framework"}),"\n",(0,l.jsx)(e.li,{children:"fault-oblivious stateful workflow"}),"\n",(0,l.jsx)(e.li,{children:"\u63d0\u4f9b Java SDK\u3001Go SDK"}),"\n",(0,l.jsx)(e.li,{children:"Cadence \u66f4\u50cf\u662f\u4e00\u4e2a\u6267\u884c\u5e73\u53f0 - \u4f8b\u5982 BNMP\u3001Airflow DAG \u53ef\u4ee5\u5728\u5176\u4e4b\u4e0a\u8fd0\u884c"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview",children:"durable function"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u4f7f\u7528\u573a\u666f\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5468\u671f\u6267\u884c / \u5206\u5e03\u5f0f CRON"}),"\n",(0,l.jsx)(e.li,{children:"\u5fae\u670d\u52a1\u7f16\u6392"}),"\n",(0,l.jsx)(e.li,{children:"Polling - \u4f8b\u5982 \u6587\u4ef6\u4e0a\u4f20\u4e0b\u8f7d\u3001\u7f51\u7edc\u670d\u52a1\u5065\u5eb7\u3001\u7b49\u5f85\u5916\u90e8\u670d\u52a1\u751f\u6548"}),"\n",(0,l.jsx)(e.li,{children:"\u4e8b\u4ef6\u9a71\u52a8\u7f16\u7a0b"}),"\n",(0,l.jsx)(e.li,{children:"\u5b58\u50a8\u626b\u63cf - \u4f8b\u5982 \u89c4\u6574 OSS \u4e2d\u6587\u4ef6\u5143\u6570\u636e"}),"\n",(0,l.jsx)(e.li,{children:"\u6279\u5904\u7406 - \u4f8b\u5982 \u62a5\u8868"}),"\n",(0,l.jsx)(e.li,{children:"\u57fa\u7840\u8bbe\u65bd\u5f00\u901a / Infrastructure provisioning - \u4f8b\u5982 \u5f00\u901a\u963f\u91cc\u4e91 ECS"}),"\n",(0,l.jsx)(e.li,{children:"CI/CD \u548c \u90e8\u7f72"}),"\n",(0,l.jsx)(e.li,{children:"\u8fd0\u7ef4\u7ba1\u7406 - \u4f8b\u5982 DB \u7ef4\u62a4\u3001\u5f00\u901a\u8d26\u53f7"}),"\n",(0,l.jsx)(e.li,{children:"\u4ea4\u4e92\u5e94\u7528 - \u4f8b\u5982 \u5728\u7528\u6237\u4e0b\u5355\u7684\u540c\u65f6\u540e\u53f0\u8fdb\u884c\u6b3a\u8bc8\u68c0\u6d4b"}),"\n",(0,l.jsx)(e.li,{children:"DSL \u5de5\u4f5c\u6d41 - BPMN, Apache Airflow, AWS Step Functions"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u6570\u636e \u548c \u673a\u5668\u5b66\u4e60"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u7ec4\u4ef6\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8bf7\u6c42\u5904\u7406\uff1a Microservices\u3001Serverless\u3001Actors"}),"\n",(0,l.jsxs)(e.li,{children:["\u5b58\u50a8\uff1a \u6570\u636e\u3001\u7f13\u5b58\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Cassandra / MySQL / Postgres"}),"\n",(0,l.jsx)(e.li,{children:"metric - Prometheus - \u53ef\u9009"}),"\n",(0,l.jsxs)(e.li,{children:["ElastiCache+Kafka - \u652f\u6301\u9ad8\u7ea7\u641c\u7d22\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4f8b\u5982 scanWorkflowExecutions"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"S3 - archival"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Queues"}),"\n",(0,l.jsx)(e.li,{children:"Job Schedulers"}),"\n",(0,l.jsx)(e.li,{children:"Consensus\uff1a Leader Election\u3001Sharding\u3001Distributed Locks"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u9ad8\u7ea7\u7279\u6027\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9ad8\u7ea7\u53ef\u89c6\u5316"}),"\n",(0,l.jsx)(e.li,{children:"\u5de5\u4f5c\u6d41\u5f52\u6863"}),"\n",(0,l.jsx)(e.li,{children:"\u8de8\u6570\u636e\u4e2d\u5fc3\u590d\u5236"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/temporalio/temporal",children:"temporalio/temporal"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"cadence fork, \u5f00\u53d1\u8005\u7684\u521b\u4e1a\u9879\u76ee"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence-web",children:"uber/cadence-web"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u67e5\u770b\u8fd0\u884c\u7684\u6d41\u7a0b"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/uber-go/cadence-client",children:"uber-go/cadence-client"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Go \u5ba2\u6237\u7aef"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence-idl",children:"uber/cadence-idl"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"proto,thrift"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence-idl/tree/master/proto/uber/cadence/api/v1",children:"uber/cadence/api/v1"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/yarpc/yarpc-go",children:"yarpc/yarpc-go"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"RPC - JSON, Thrift, and Protobuf"}),"\n",(0,l.jsx)(e.li,{children:"HTTP/1.1, gRPC, and TChannel"}),"\n",(0,l.jsx)(e.li,{children:"cadence \u6b63\u5728\u4ece thrift \u8fc1\u79fb\u4e3a grpc"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["helm banzai-charts ",(0,l.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/tree/master/cadence",children:"cadence"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["go thrift \u7248\u672c\u51b2\u7a81 ",(0,l.jsx)(e.a,{href:"https://github.com/uber-go/cadence-client/issues/1107",children:"#1107"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7528\u7684\u5f88\u8001\u7684\u7248\u672c 0.9.3, 2016 \u5e74 - cadence \u6b63\u5728\u8fc1\u79fb\u4e3a grpc"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u914d\u7f6e\u4e00\u5b9a ",(0,l.jsx)(e.strong,{children:"\u4e0d\u8981\u4fee\u6539"})," numOfShards - \u53ea\u6709\u8fc1\u79fb\u5230\u65b0\u96c6\u7fa4"]}),"\n"]})}),"\n",(0,l.jsx)(e.admonition,{type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5355\u4e2a Workflow \u9650\u5236\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"50k \u4e8b\u4ef6\u4f1a\u544a\u8b66"}),"\n",(0,l.jsx)(e.li,{children:"200k \u4e8b\u4ef6\u4f1a\u88ab\u76f4\u63a5\u7ec8\u6b62"}),"\n",(0,l.jsx)(e.li,{children:"\u6700\u591a\u6267\u884c 100k \u6d3b\u52a8"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u63a8\u8350\u63a7\u5236\u5728 \u51e0\u5343 signal - \u901a\u8fc7 ContinueAsNew \u907f\u514d\u5355\u4e2a workflow \u81a8\u80c0"}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"port"}),(0,l.jsx)(e.th,{children:"proto"}),(0,l.jsx)(e.th,{children:"service"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"7833"}),(0,l.jsx)(e.td,{children:"grpc"}),(0,l.jsx)(e.td,{children:"frontend"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"7933"}),(0,l.jsx)(e.td,{children:"Thrift TChannel"}),(0,l.jsx)(e.td,{children:"frontend"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"7834"}),(0,l.jsx)(e.td,{children:"grpc"}),(0,l.jsx)(e.td,{children:"history"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"7934"}),(0,l.jsx)(e.td,{children:"Thrift TChannel"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"7835"}),(0,l.jsx)(e.td,{children:"grpc"}),(0,l.jsx)(e.td,{children:"matching"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"7935"}),(0,l.jsx)(e.td,{children:"Thrift TChannel"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"7939"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"worker"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"9090"}),(0,l.jsx)(e.td,{children:"http/metrics"}),(0,l.jsx)(e.td,{})]})]})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# macOS\nbrew install cadence-workflow\n# Docker\ndocker run --rm ubercadence/cli:master\n\n# CADENCE_CLI_ADDRESS --address\n# CADENCE_CLI_DOMAIN --domain\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u5feb\u901f\u5f00\u59cb",children:"\u5feb\u901f\u5f00\u59cb"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u4f7f\u7528 postgres\ncurl -o docker-compose.yml https://raw.githubusercontent.com/uber/cadence/master/docker/docker-compose-postgres.yml\ncurl -O https://raw.githubusercontent.com/uber/cadence/master/docker/prometheus_config.yml\n# UI http://localhost:8088\n# Grafana http://localhost:3000\n# postgres :5432,prometheus :9090,grafana :3000,cadence 8000-8003,7933-3935,7939,cadence-web :8088\ndocker-compose up\n\n# \u6ce8\u518c domain\n# --address=host.docker.internal:7932\ndocker run --network=host --rm ubercadence/cli:master --do test-domain domain register -rd 1 --global_domain=false\n# domian \u4fe1\u606f\ndocker run --network=host --rm ubercadence/cli:master --do test-domain domain describe\n"})}),"\n",(0,l.jsx)(e.h2,{id:"golang",children:"Golang"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/uber-common/cadence-samples/blob/master/cmd/samples/recipes/helloworld/main.go",children:"helloworld/main.go"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"java",children:"Java"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6d41\u7a0b\u63a5\u53e3\npublic interface TransferWorkflow {\n  @WorkflowMethod(executionStartToCloseTimeoutSeconds = WEEK_SECOND)\n  void execute(String fromAccountId, String toAccountId, Money amount);\n\n  @SignalMethod // \u4fe1\u53f7\u65b9\u6cd5\n  void doCount(int n);\n  @QueryMethod // \u67e5\u8be2\u65b9\u6cd5\n  int void getCount();\n}\n// \u4e8b\u4ef6\u63a5\u53e3\npublic interface Account {\n  @ActivityMethod(scheduleToCloseTimeoutSeconds = 300)\n  void debit(String fromAccountId, Money amount);\n  @ActivityMethod(scheduleToCloseTimeoutSeconds = 300)\n  void credit(String toAccountId, Money amount);\n}\npublic interface TransferWorkflowImpl implements TransferWorkflow {\n  // \u652f\u6301\u914d\u7f6e\u81ea\u52a8\u91cd\u8bd5\n  private final Account account = Workflow.newActivityStub(Account.class);\n  @Override\n  public void execute(String fromAccountId, String toAccountId, Money amount){\n    // \u89e6\u53d1\u4e8b\u4ef6 - \u963b\u585e\u8be5\u6d41\u7a0b\n    // \u4e8b\u4ef6\u53ef\u80fd\u6267\u884c\u975e\u5e38\u4e45 - \u4f8b\u5982\u51e0\u5929\n    account.debit(fromAccountId,amount);\n    try {\n      account.credit(toAccountId,amount);\n    } catch (IllegalArgumentException e){\n      // \u4e1a\u52a1\u8865\u507f\u903b\u8f91\n      account.credit(fromAccountId,amount);\n    }\n\n    // \u53ef\u624b\u52a8\u963b\u585e\n    Workflow.sleep(Duration.ofDays(7));\n  }\n\n  // \u672c\u5730\u72b6\u6001 - \u6301\u4e45\u5316\u7684\n  private int counter;\n  @Override\n  public void doCount(int n){\n    counter += n;\n  }\n  @QueryMethod\n  public int void getCount(){\n    return counter;\n  }\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u670d\u52a1\u7aef",children:"\u670d\u52a1\u7aef"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["SERVICES - \u8fd0\u884c\u7684\u670d\u52a1\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"frontend, history, matching, worker"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"CADENCE_STORE_PASSWORD"}),"\n",(0,l.jsx)(e.li,{children:"CADENCE_VISIBILITY_STORE_PASSWORD"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/blob/master/cadence/templates/server-configmap.yaml",children:"https://github.com/banzaicloud/banzai-charts/blob/master/cadence/templates/server-configmap.yaml"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"env"}),(0,l.jsx)(e.th,{children:"desc"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SQL_PLUGIN"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SQL_HOST"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SQL_PORT"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SQL_DATABASE"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SQL_USER"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SQL_PASSWORD"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SQL_CONNECT_ATTRIBUTES"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"CASSANDRA_HOST"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"CASSANDRA_DB_PORT"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"CASSANDRA_KEYSPACE"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"CASSANDRA_USER"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"CASSANDRA_PASSWORD"}),(0,l.jsx)(e.td,{})]})]})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"curl -LO https://raw.githubusercontent.com/uber/cadence/master/docker/config_template.yaml\ndocker run --rm -it \\\n  -v $PWD/config_template.yaml:/etc/cadence/config/config_template.yaml \\\n  -e DB=postgres -e POSTGRES_SEEDS=127.0.0.1 -e POSTGRES_USER=cadence -e POSTGRES_PWD=cadence \\\n  --name cadence ubercadence/server\n"})}),"\n",(0,l.jsx)(e.h1,{id:"\u6982\u5ff5",children:"\u6982\u5ff5"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Domain - \u57df\u5212\u5206 - \u591a\u79df\u6237\u7684\u79df\u6237\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4f5c\u4e3a TaskList \u548c Workflow \u7684\u547d\u540d\u7a7a\u95f4"}),"\n",(0,l.jsx)(e.li,{children:"\u652f\u6301 SecurityToken"}),"\n",(0,l.jsx)(e.li,{children:"\u914d\u7f6e\u6570\u636e\u7559\u5b58\u65f6\u95f4"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["TaskList\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4efb\u52a1\u5217\u8868\u3001\u5e94\u7528\u5206\u7ec4"}),"\n",(0,l.jsx)(e.li,{children:"\u542f\u52a8\u7684 worker \u4f1a pull \u7ed9\u5b9a\u7684 TaskList"}),"\n",(0,l.jsx)(e.li,{children:"\u610f\u5473\u7740\u5fc5\u987b\u8981\u5148\u786e\u5b9a TaskList \u7684\u540d\u5b57"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Worker\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5b88\u62a4\u8fdb\u7a0b"}),"\n",(0,l.jsxs)(e.li,{children:["\u672c\u5730\u6ce8\u518c Workflow\u3001Activity\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9ed8\u8ba4\u4f7f\u7528 \u51fd\u6570\u540d \u4f5c\u4e3a\u540d\u5b57"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u79d2\u7ea7 \u65f6\u95f4\u7cbe\u786e\u5ea6"}),"\n",(0,l.jsx)(e.li,{children:"WorkflowWorker"}),"\n",(0,l.jsx)(e.li,{children:"ActivityWorker"}),"\n",(0,l.jsx)(e.li,{children:"SessionWorker"}),"\n",(0,l.jsx)(e.li,{children:"ShadowWorker"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Workflow - \u903b\u8f91\u6d41\u7a0b\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u786e\u5b9a\u6027\u3001\u5e42\u7b49\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u53ea\u80fd\u901a\u8fc7\u7528 activity \u4e0e\u5916\u754c\u4ea4\u4e92"}),"\n",(0,l.jsx)(e.li,{children:"go - workflow.Go"}),"\n",(0,l.jsx)(e.li,{children:"chan - workflow.Channel"}),"\n",(0,l.jsx)(e.li,{children:"select - workflow.Selector"}),"\n",(0,l.jsx)(e.li,{children:"time.Now - workflow.Now"}),"\n",(0,l.jsx)(e.li,{children:"time.Sleep - workflow.Sleep"}),"\n",(0,l.jsx)(e.li,{children:"log - workflow.GetLogger"}),"\n",(0,l.jsxs)(e.li,{children:["Future\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"cadence \u7279\u6709\u6982\u5ff5 - \u5f02\u6b65\u64cd\u4f5c\u3001timer"}),"\n",(0,l.jsxs)(e.li,{children:["\u5355\u4e2a Selector AddFuture \u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u56de\u8c03\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Future \u5b8c\u6210\u540e\u4e0d\u4f1a\u518d\u89e6\u53d1\uff0c\u9664\u975e\u91cd\u65b0\u6784\u5efa Selector \u6216 \u518d\u6b21 Add"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["NewContinueAsNewError\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e3a\u907f\u514d history \u8fc7\u5927\uff0c\u5efa\u8bae\u91cd\u542f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Activity - \u5355\u4e2a\u6b65\u9aa4\u6d3b\u52a8\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8fd4\u56de\u5fc5\u9700\u5305\u542b error"}),"\n",(0,l.jsx)(e.li,{children:"TaskToken - \u552f\u4e00\u6807\u8bc6 -> DomainName, WorkflowID, ActivityID"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Session\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8c03\u5ea6\u591a\u4e2a Activity \u5230\u76f8\u540c\u8282\u70b9"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Replayer\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u91cd\u653e\u68c0\u6d4b workflow \u662f\u5426\u53d8\u5316"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Shadower\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4ece\u670d\u52a1\u7aef\u62c9\u53d6\u5386\u53f2\u8fdb\u884c\u91cd\u653e"}),"\n",(0,l.jsx)(e.li,{children:"\u4f9d\u8d56\u9ad8\u7ea7\u641c\u7d22 - Elastic \u5b58\u50a8"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Archiver\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8d1f\u8d23\u5f52\u6863\u548c\u53d6\u56de\u5386\u53f2"}),"\n",(0,l.jsx)(e.li,{children:"workflowID + runID \u5b9a\u4f4d"}),"\n",(0,l.jsx)(e.li,{children:"\u5b58\u50a8: local, S3, Kafka"}),"\n",(0,l.jsx)(e.li,{children:"history archival"}),"\n",(0,l.jsx)(e.li,{children:"visibility archival"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Advanced visibility\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u57fa\u4e8e SearchAttributes \u8fdb\u884c\u641c\u7d22 - \u53ea\u652f\u6301\u57fa\u7840\u7c7b\u578b"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981 Elastic"}),"\n",(0,l.jsx)(e.li,{children:"Memo \u5217\u8868\u53ef\u89c1\uff0c\u4f46\u4e0d\u4f1a\u7d22\u5f15 - \u652f\u6301\u4efb\u610f\u7c7b\u578b"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["ActivityTask\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7531 activity worker \u5904\u7406"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["DecisionTask\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7531 workflow worker \u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u5904\u7406\u5916\u90e8\u4e8b\u4ef6 - signal\u3001timer"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u670d\u52a1\u89d2\u8272\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"FE - Front End - \u524d\u7aef API \u670d\u52a1"}),"\n",(0,l.jsxs)(e.li,{children:["HS - History Service - \u6838\u5fc3\u5de5\u4f5c\u6d41\u7f16\u6392\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Cross DC replication"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"MS - Matching Service - workflow/activity <-> worker"}),"\n",(0,l.jsx)(e.li,{children:"WS - Worker Service - \u5185\u90e8\u670d\u52a1\uff0c\u4f8b\u5982 archiving"}),"\n",(0,l.jsx)(e.li,{children:"Worker - \u7528\u6237\u7f16\u5199"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["query - \u67e5\u8be2\u6d41\u7a0b\u72b6\u6001\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"__stack_trace"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Event\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Signal - \u5916\u90e8\u4e8b\u4ef6"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"domain",children:"Domain"}),"\n",(0,l.jsx)(e.h2,{id:"activity",children:"Activity"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5e94\u7528\u4ee3\u7801"}),"\n",(0,l.jsx)(e.li,{children:"\u957f\u65f6\u95f4\u8fd0\u884c\u7684 - \u5fc3\u8df3"}),"\n",(0,l.jsx)(e.li,{children:"\u5f02\u6b65"}),"\n",(0,l.jsx)(e.li,{children:"\u57fa\u4e8e\u7b56\u7565\u91cd\u8bd5"}),"\n",(0,l.jsx)(e.li,{children:"\u8def\u7531\u5230\u4e3b\u673a\u548c\u8fdb\u7a0b"}),"\n",(0,l.jsx)(e.li,{children:"\u901a\u8fc7\u961f\u5217\u5206\u53d1"}),"\n",(0,l.jsx)(e.li,{children:"Worker \u901f\u7387\u548c\u5e76\u53d1\u9650\u5236"}),"\n",(0,l.jsx)(e.li,{children:"\u961f\u5217\u901f\u7387\u9650\u5236"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u6982\u5ff5\u7c7b\u4f3c\u4e8e Queue"}),"\n",(0,l.jsx)(e.h3,{id:"\u5b9e\u73b0",children:"\u5b9e\u73b0"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u8d85\u65f6\u7b56\u7565\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ScheduleToStart"}),"\n",(0,l.jsx)(e.li,{children:"StartToClose"}),"\n",(0,l.jsx)(e.li,{children:"ScheduleToClose"}),"\n",(0,l.jsx)(e.li,{children:"Heartbeat"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u91cd\u8bd5\u7b56\u7565\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"InitialInterval"}),"\n",(0,l.jsx)(e.li,{children:"BackoffCoefficient"}),"\n",(0,l.jsx)(e.li,{children:"MaximumInterval"}),"\n",(0,l.jsx)(e.li,{children:"MaximumAttempts"}),"\n",(0,l.jsx)(e.li,{children:"ExpirationInterval"}),"\n",(0,l.jsx)(e.li,{children:"NonRetryableErrorReasons"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"workflow",children:"Workflow"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u865a\u62df\u5bf9\u8c61 - Java\u3001Go\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4f8b\u5982 \u7528\u6237\u3001\u64cd\u4f5c\u76ee\u6807 - \u652f\u6301\u67e5\u8be2\u548c\u76f8\u5173\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.li,{children:"\u6bcf\u4e2a\u865a\u62df\u5bf9\u8c61\u90fd\u6709\u81ea\u5df1\u7684\u72b6\u6001 - \u56e0\u6b64\u7cfb\u7edf\u4e2d\u7684 Entity \u90fd\u4f1a\u6620\u5c04\u5230 Workflow"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u4e8b\u52a1\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u7f16\u6392 Activities"}),"\n",(0,l.jsx)(e.li,{children:"\u54cd\u5e94\u5916\u90e8\u4e8b\u4ef6"}),"\n",(0,l.jsx)(e.li,{children:"\u6709\u72b6\u6001 - \u672c\u5730\u53d8\u91cf\u548c\u6808"}),"\n",(0,l.jsx)(e.li,{children:"\u53ef\u67e5\u8be2"}),"\n",(0,l.jsx)(e.li,{children:"\u957f\u65f6\u95f4\u5b58\u5728"}),"\n",(0,l.jsx)(e.li,{children:"\u6301\u4e45\u5316\u8ba1\u65f6\u5668"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u5b9e\u73b0-1",children:"\u5b9e\u73b0"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u6bcf\u4e2a\u57df\u4e0b \u6bcf\u4e2a Workflow \u6709\u4e00\u4e2a\u552f\u4e00 ID - \u901a\u5e38\u662f\u4e1a\u52a1\u5bf9\u8c61 ID - \u4f8b\u5982\u8ba2\u5355\u3001\u5ba2\u6237\u7684 ID\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Domain Name, Workflow ID, Run ID"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u6bcf\u6b21\u6267\u884c\u6709 Run ID"}),"\n",(0,l.jsxs)(e.li,{children:["\u590d\u7528\u7b56\u7565\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"AllowDuplicateFailedOnly - \u9ed8\u8ba4 - \u5141\u8bb8\u5931\u8d25\u7684\u6d41\u7a0b\u91cd\u590d\u6267\u884c"}),"\n",(0,l.jsx)(e.li,{children:"AllowDuplicate - \u5982\u679c\u6d41\u7a0b\u5f53\u524d\u672a\u8fd0\u884c"}),"\n",(0,l.jsx)(e.li,{children:"RejectDuplicate - \u4e0d\u5141\u8bb8\u91cd\u590d\u6267\u884c"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u6ce8\u610f",children:"\u6ce8\u610f"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6ca1\u6709\u76f4\u63a5\u7684 API \u64cd\u4f5c\uff0c\u901a\u8fc7 Activity \u8fdb\u884c\u54cd\u5e94"}),"\n",(0,l.jsx)(e.li,{children:"\u6838\u5fc3\u662f\u7f16\u6392 Activity"}),"\n",(0,l.jsx)(e.li,{children:"\u53ef\u4ee5\u7406\u89e3\u4e3a\u5355\u7ebf\u7a0b\u7684\u5e94\u7528\u903b\u8f91 - \u4f46\u5b9e\u9645\u4f1a\u8fc1\u79fb\u5230\u4e0d\u540c\u4e3b\u673a\u8fd0\u884c"}),"\n",(0,l.jsxs)(e.li,{children:["\u4e0e\u4f20\u7edf\u610f\u4e49 Workflow \u4e0d\u540c - orchestrator\u3001",(0,l.jsx)(e.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview",children:"durable function"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4f20\u7edf\u610f\u4e49 Workflow\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4ece\u67d0\u4e2a\u5730\u65b9\u5f00\u59cb\uff0c\u5230\u67d0\u4e2a\u5730\u65b9\u7ed3\u675f"}),"\n",(0,l.jsx)(e.li,{children:"LCDP / \u4f4e\u4ee3\u7801\u5f00\u53d1\u5e73\u53f0 - \u56fe\u5f62\u5316\u66ff\u4ee3\u7f16\u7801"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u65b9\u6cd5"}),"\n",(0,l.jsxs)(e.li,{children:["UI \u7684\u6d41\u7a0b\u6784\u5efa\u6700\u7ec8\u4e5f\u662f\u6620\u5c04\u4e3a\u4ee3\u7801\u5c42\u9762\u7684\u6267\u884c - workflow \u662f code first\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Workflow \u518d\u53bb\u652f\u6301 UI \u7684 graph"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53ef\u4ee5\u5c06\u591a\u4e2a Task \u6620\u5c04\u4e3a\u5355\u4e2a Workflow - \u53ef\u901a\u8fc7\u53d8\u91cf\u63a7\u5236\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u903b\u8f91\u5904\u7406\u66f4\u52a0\u6e05\u6670"}),"\n",(0,l.jsx)(e.li,{children:"\u51cf\u5c11 DB Load"}),"\n",(0,l.jsx)(e.li,{children:"\u601d\u8003\u65b9\u5f0f\u4f1a\u6709\u6240\u4e0d\u540c"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5f02\u6784\u548c LongRun \u7684\u7279\u6027\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u53ef\u4ee5\u7528\u4e8e\u7ba1\u7406\u5176\u4ed6\u5e73\u53f0\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7ba1\u7406 CI\u3001CD \u6267\u884c"}),"\n",(0,l.jsx)(e.li,{children:"\u7ba1\u7406 Flink\u3001Spark \u4efb\u52a1"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53ef\u7528\u4e8e\u6267\u884c\u5468\u671f\u6027\u4efb\u52a1\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6bcf\u6708\u62a5\u8868"}),"\n",(0,l.jsx)(e.li,{children:"\u5404\u79cd\u957f\u77ed\u5468\u671f\u4efb\u52a1"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["/etc/cadence/config/config_template.yaml\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence/blob/master/docker/config_template.yaml",children:"docker/config_template.yaml"})}),"\n",(0,l.jsx)(e.li,{children:"\u914d\u7f6e\u6a21\u677f"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"/etc/cadence/config/dynamicconfig/config.yaml"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence/blob/master/common/config/config.go",children:"https://github.com/uber/cadence/blob/master/common/config/config.go"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence/blob/master/common/service/config.go",children:"https://github.com/uber/cadence/blob/master/common/service/config.go"})}),"\n",(0,l.jsxs)(e.li,{children:["domain\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Retention"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'history:\n  # 2K -> SQL\n  # 8K -> Cassandra\n  numHistoryShards: 4\n\n  # \u5b58\u50a8\u5f15\u7528\n  defaultStore: default\n  visibilityStore: visibility\n  advancedVisibilityStore: es-visibility\n  # \u5b58\u50a8\u914d\u7f6e\n  datastores:\n    default:\n      nosql:\n        pluginName: "cassandra"\n      sql:\n        pluginName: "postgres"\n        encodingType: "thriftrw"\n        decodingTypes: ["thriftrw"]\n        databaseName: {{ default .Env.DBNAME "cadence" }}\n        connectAddr: "{{ default .Env.POSTGRES_SEEDS "" }}:{{ default .Env.DB_PORT "5432" }}"\n        connectProtocol: "tcp"\n        user: {{ default .Env.POSTGRES_USER "" }}\n        password: {{ default .Env.POSTGRES_PWD "" }}\n        maxConns: 20\n        maxIdleConns: 20\n        maxConnLifetime: "1h"\n        tls:\n          enabled: true\n          sslmode: require\n      elasticsearch:\n        version: {{ default .Env.ES_VERSION "" }}\n        username: {{ default .Env.ES_USER "" }}\n        password: {{ default .Env.ES_PWD "" }}\n        url:\n          scheme: "http"\n          host: "{{ default .Env.ES_SEEDS "" }}:{{ default .Env.ES_PORT "9200" }}"\n        indices:\n          visibility: {{ default .Env.VISIBILITY_NAME "cadence-visibility-dev" }}\n    visibility:\n      sql:\n        # \u4e00\u822c\u4f1a\u7528\u4e0d\u540c\u7684\u5e93\n        databaseName: {{ default .Env.VISIBILITY_DBNAME "cadence_visibility" }}\n    es-visibility:\ndynamicConfigClient:\n  filepath: /etc/cadence/config/dynamicconfig/config.yaml\n  pollInterval: 10s\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# \u52a8\u6001\u914d\u7f6e\nfrontend.visibilityListMaxQPS:\n  - value: 1000\n    constraints:\n      domainName: 'domainA'\n  - value: 2000\n    constraints:\n      domainName: 'domainB'\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"\n# \u5355\u8282\u70b9\nfrontend.persistenceMaxQPS: 2000\n# \u5168\u5c40\nfrontend.persistenceGlobalMaxQPS: 2000\n# visibility db\nfrontend.visibilityListMaxQPS: 10\nfrontend.esVisibilityListMaxQPS: 30\n\nmatching.persistenceMaxQPS: 3000\nmatching.persistenceGlobalMaxQPS: 3000\nmatching.persistenceGlobalMaxQPS: 2000\n\nhistory.persistenceMaxQPS: 9000\nhistory.persistenceGlobalMaxQPS: 9000\nhistory.historyVisibilityOpenMaxQPS:\nhistory.historyVisibilityClosedMaxQPS:\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u5b58\u50a8\u7ed3\u6784",children:"\u5b58\u50a8\u7ed3\u6784"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence/tree/master/schema/postgres",children:"schema/postgres"})}),"\n",(0,l.jsx)(e.li,{children:"domains"}),"\n",(0,l.jsx)(e.li,{children:"domain_metadata"}),"\n",(0,l.jsx)(e.li,{children:"shards"}),"\n",(0,l.jsx)(e.li,{children:"transfer_tasks"}),"\n",(0,l.jsx)(e.li,{children:"cross_cluster_tasks"}),"\n",(0,l.jsx)(e.li,{children:"executions"}),"\n",(0,l.jsx)(e.li,{children:"current_executions"}),"\n",(0,l.jsx)(e.li,{children:"buffered_events"}),"\n",(0,l.jsx)(e.li,{children:"tasks"}),"\n",(0,l.jsx)(e.li,{children:"task_lists"}),"\n",(0,l.jsx)(e.li,{children:"replication_tasks"}),"\n",(0,l.jsx)(e.li,{children:"replication_tasks_dlq"}),"\n",(0,l.jsx)(e.li,{children:"timer_tasks"}),"\n",(0,l.jsx)(e.li,{children:"activity_info_maps"}),"\n",(0,l.jsx)(e.li,{children:"timer_info_maps"}),"\n",(0,l.jsx)(e.li,{children:"child_execution_info_maps"}),"\n",(0,l.jsx)(e.li,{children:"request_cancel_info_maps"}),"\n",(0,l.jsx)(e.li,{children:"signal_info_maps"}),"\n",(0,l.jsx)(e.li,{children:"buffered_replication_task_maps"}),"\n",(0,l.jsx)(e.li,{children:"signals_requested_sets"}),"\n",(0,l.jsx)(e.li,{children:"history_node"}),"\n",(0,l.jsx)(e.li,{children:"history_tree"}),"\n",(0,l.jsx)(e.li,{children:"queue"}),"\n",(0,l.jsx)(e.li,{children:"queue_metadata"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"schema",children:"schema"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"go build -o cadence-sql-tool github.com/uber/cadence/cmd/tools/sql\n# \u9ed8\u8ba4\u5b58\u50a8 \u548c visibility \u90fd\u9700\u8981\nenv $(cat .env | xargs) ./cadence-sql-tool setup-schema -v 0.0\nenv $(cat .vis | xargs) ./cadence-sql-tool setup-schema -v 0.0\n# update - \u6ce8\u610f \u9ed8\u8ba4 \u548c visibility \u8def\u5f84\u4e0d\u540c\nenv $(cat .env | xargs) go run ./cmd/tools/sql/ update-schema -d schema/postgres/cadence/versioned/\nenv $(cat .vis | xargs) go run ./cmd/tools/sql/ update-schema -d schema/postgres/visibility/versioned/\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",metastring:'title=".env"',children:"SQL_PLUGIN=postgres\nSQL_HOST=192.168.1.1\nSQL_PORT=5432\nSQL_DATABASE=cadence\nSQL_USER=cadence\nSQL_PASSWORD=\nSQL_CONNECT_ATTRIBUTES=sslmode=require\n"})}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["postgres \u5f00\u542f --tls \u8981\u6c42\u63d0\u4f9b ca - \u5b9e\u9645\u4e0d\u9700\u8981\uff0c\u76ee\u524d\u8981\u6539\u68c0\u6d4b\u4ee3\u7801\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/uber/cadence/pull/4639",children:"#4639"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,l.jsx)(e.h2,{id:"helm",children:"Helm"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/wenerme/charts/tree/master/banzai/charts/cadence",children:"https://github.com/wenerme/charts/tree/master/banzai/charts/cadence"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u540c\u6b65\u81ea banzai charts"}),"\n",(0,l.jsx)(e.li,{children:"banzai \u56fd\u5185\u65e0\u6cd5\u8bbf\u95ee"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"existingSecret \u5305\u542b password \u5b57\u6bb5"}),"\n"]}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["helm schema job \u4e0d\u652f\u6301 postgres\uff0c\u4e0d\u652f\u6301\u4f7f\u7528 existingSecret\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5efa\u8bae\u672c\u5730\u8fc1\u79fb"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/issues/1301",children:"banzaicloud/banzai-charts#1301"}),"\nSetup Job doesn't pull value from secret"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["service \u672a\u66b4\u9732 grpc \u7aef\u53e3\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/issues/1305",children:"banzaicloud/banzai-charts#1305"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,l.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,l.jsx)(e.h2,{id:"cannot-register-global-domain-when-not-enabled",children:"Cannot register global domain when not enabled"}),"\n",(0,l.jsxs)(e.p,{children:["cli \u6ce8\u518c\u6dfb\u52a0 ",(0,l.jsx)(e.code,{children:"--global_domain=false"})]}),"\n",(0,l.jsx)(e.h2,{id:"persistence-max-qps-reached",children:"Persistence Max QPS Reached"}),"\n",(0,l.jsx)(e.p,{children:"\u6570\u636e\u5e93\u9650\u5236"}),"\n",(0,l.jsx)(e.h2,{id:"persistence-max-qps-reached-for-list-operations",children:"Persistence Max QPS Reached for List Operations"}),"\n",(0,l.jsx)(e.p,{children:"visibility \u6570\u636e\u5e93\u9650\u5236"})]})}function o(n={}){const{wrapper:e}={...(0,s.a)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},3354:(n,e,i)=>{var l=i(50959),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,d=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function h(n,e,i){var l,r={},h=null,a=null;for(l in void 0!==i&&(h=""+i),void 0!==e.key&&(h=""+e.key),void 0!==e.ref&&(a=e.ref),e)c.call(e,l)&&!t.hasOwnProperty(l)&&(r[l]=e[l]);if(n&&n.defaultProps)for(l in e=n.defaultProps)void 0===r[l]&&(r[l]=e[l]);return{$$typeof:s,type:n,key:h,ref:a,props:r,_owner:d.current}}e.Fragment=r,e.jsx=h,e.jsxs=h},11527:(n,e,i)=>{n.exports=i(3354)},47214:(n,e,i)=>{i.d(e,{Z:()=>d,a:()=>c});var l=i(50959);const s={},r=l.createContext(s);function c(n){const e=l.useContext(r);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);