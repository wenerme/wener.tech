/*! For license information please see fe38e288.92e77dad.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[9707],{95362:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>c});var t=r(11527),s=r(47214);const l={title:"IO"},i="JavaScript IO",a={id:"web/script/js/js-io",title:"IO",description:"- BigInt - Chrome 67, Firefox 68, Safari 14",source:"@site/../notes/web/script/js/js-io.md",sourceDirName:"web/script/js",slug:"/web/script/js/io",permalink:"/notes/web/script/js/io",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/script/js/js-io.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1693463269,formattedLastUpdatedAt:"Aug 31, 2023",frontMatter:{title:"IO"},sidebar:"docs",previous:{title:"Decorator",permalink:"/notes/web/script/js/decorator"},next:{title:"Pattern",permalink:"/notes/web/script/js/pattern"}},d={},c=[{value:"ReadableStream to Buffer",id:"readablestream-to-buffer",level:2},{value:"ReadableStream to String",id:"readablestream-to-string",level:2},{value:"multipart/form-data \u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32",id:"multipartform-data-\u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32",level:2},{value:"data url to Blob",id:"data-url-to-blob",level:2},{value:"application/x-www-form-urlencoded",id:"applicationx-www-form-urlencoded",level:2},{value:"TextEncoder byteOffset",id:"textencoder-byteoffset",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"javascript-io",children:"JavaScript IO"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"BigInt - Chrome 67, Firefox 68, Safari 14"}),"\n",(0,t.jsx)(n.li,{children:"Buffer - NodeJS - \u4e3a Uint8Array"}),"\n",(0,t.jsx)(n.li,{children:"ArrayBuffer"}),"\n",(0,t.jsxs)(n.li,{children:["SharedArrayBuffer\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7528\u4e8e\u5171\u4eab\u5185\u5b58\uff0c\u4f46\u4e0d\u662f transferable"}),"\n",(0,t.jsx)(n.li,{children:"WebAssembly.Memory"}),"\n",(0,t.jsx)(n.li,{children:"WebGLRenderingContext.bufferData()"}),"\n",(0,t.jsx)(n.li,{children:"WebGLRenderingContext.bufferSubData()"}),"\n",(0,t.jsx)(n.li,{children:"WebGL2RenderingContext.getBufferSubData()"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Blob - \u4e0d\u53ef\u53d8\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7c7b\u4f3c\u6587\u4ef6 - \u53ef\u7528\u4e8e\u5904\u7406"}),"\n",(0,t.jsx)(n.li,{children:"\u53ef\u8f6c\u4e3a ReadableStream"}),"\n",(0,t.jsx)(n.li,{children:"File \u57fa\u4e8e Blob"}),"\n",(0,t.jsx)(n.li,{children:"arrayBuffer() -> ArrayBuffer"}),"\n",(0,t.jsx)(n.li,{children:"stream() -> ReadableStream"}),"\n",(0,t.jsx)(n.li,{children:"text() -> string"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"URL.createObjectURL(blob)"})}),"\n",(0,t.jsx)(n.li,{children:"FileReader \u53ef\u8bfb\u53d6 Blob"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"new Response(blob)"})," - \u53ef\u7528\u4e8e\u6784\u9020 Response"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u64cd\u4f5c\u5904\u7406\u76f8\u5173"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Atomics\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u539f\u5b50\u5316\u64cd\u4f5c SharedArrayBuffer, ArrayBuffer"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["ArrayBufferView - ",(0,t.jsx)(n.code,{children:"ArrayBuffer.isView"})," - \u5e38\u89c1\u7684\u63a5\u53e3\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"buffer"}),"\n",(0,t.jsx)(n.li,{children:"byteLength"}),"\n",(0,t.jsx)(n.li,{children:"byteOffset"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["DataView\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u63d0\u4f9b\u64cd\u4f5c ",(0,t.jsx)(n.code,{children:"{get,set}{BigInt,BigUint,Float,Int,Uint}{32,64,8}"})]}),"\n",(0,t.jsx)(n.li,{children:"\u652f\u6301 endian \u8bbe\u7f6e"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["TypedArray\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Uint8Array"}),"\n",(0,t.jsx)(n.li,{children:"Uint8ClampedArray"}),"\n",(0,t.jsx)(n.li,{children:"Uint16Array"}),"\n",(0,t.jsx)(n.li,{children:"Uint32Array"}),"\n",(0,t.jsx)(n.li,{children:"Int8Array"}),"\n",(0,t.jsx)(n.li,{children:"Int16Array"}),"\n",(0,t.jsx)(n.li,{children:"Int32Array"}),"\n",(0,t.jsx)(n.li,{children:"BigUint64Array"}),"\n",(0,t.jsx)(n.li,{children:"BigInt64Array"}),"\n",(0,t.jsx)(n.li,{children:"Float32Array"}),"\n",(0,t.jsx)(n.li,{children:"Float64Array"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Glossary/Transferable_objects",children:"TransferableObject"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53ef\u5728 Worker \u4e4b\u95f4\u4f20\u9012 - \u5185\u5b58\u5171\u4eab"}),"\n",(0,t.jsx)(n.li,{children:"ArrayBuffer"}),"\n",(0,t.jsx)(n.li,{children:"MessagePort"}),"\n",(0,t.jsx)(n.li,{children:"ReadableStream"}),"\n",(0,t.jsx)(n.li,{children:"WritableStream"}),"\n",(0,t.jsx)(n.li,{children:"TransformStream"}),"\n",(0,t.jsx)(n.li,{children:"AudioData"}),"\n",(0,t.jsx)(n.li,{children:"ImageBitmap"}),"\n",(0,t.jsx)(n.li,{children:"VideoFrame"}),"\n",(0,t.jsx)(n.li,{children:"OffscreenCanvas"}),"\n",(0,t.jsx)(n.li,{children:"RTCDataChannel"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["TextDecoder, TextEncoder, TextDecoderStream, TextEncoderStream\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"UTF8 \u7f16\u7801\u89e3\u7801"}),"\n",(0,t.jsx)(n.li,{children:"Encoder \u53ea\u652f\u6301 UTF-8"}),"\n",(0,t.jsx)(n.li,{children:"\u89e3\u7801\u652f\u6301 UTF-8, ISO-8859-2, KOI8-R, GBK"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"new TextDecoder('windows-1251')"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Streams\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"ReadableStream"}),"\n",(0,t.jsx)(n.li,{children:"WritableStream"}),"\n",(0,t.jsx)(n.li,{children:"TransformStream"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nodejs.org/api/webstreams.html",children:"https://nodejs.org/api/webstreams.html"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nodejs.org/api/stream.html",children:"https://nodejs.org/api/stream.html"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://w3c.github.io/FileAPI/",children:"https://w3c.github.io/FileAPI/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://encoding.spec.whatwg.org/",children:"https://encoding.spec.whatwg.org/"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/sindresorhus/file-type",children:"sindresorhus/file-type"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Detect the file type of a Buffer/Uint8Array/ArrayBuffer"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"readablestream-to-buffer",children:"ReadableStream to Buffer"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function readStreamToBuffer(rs) {\n  const reader = rs.getReader();\n  const chunks = [];\n  while (true) {\n    const { done, value } = await reader.read();\n    if (done) break;\n    chunks.push(value);\n  }\n  return Buffer.concat(chunks);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"readablestream-to-string",children:"ReadableStream to String"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function readStreamToString(rs) {\n  const reader = rs.getReader();\n  const decoder = new TextDecoder();\n  const chunks = [];\n  while (true) {\n    const { done, value } = await reader.read();\n    if (done) break;\n    chunks.push(decoder.decode(value));\n  }\n  return chunks.join('');\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"multipartform-data-\u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32",children:"multipart/form-data \u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function formDataToString(formData) {\n  const r = new Request('http://127.0.0.1', { method: 'POST', body: formData });\n  return readStreamToString(r.body);\n}\n\nconst data = new FormData();\ndata.append('a', '1');\ndata.append('file', new Blob([new Uint8Array([97, 98, 99, 100])], { type: 'application/octet-stream' }), 'c.bin');\nconsole.log(await formDataToString(data));\n\n// FormData \u4f5c\u4e3a Response\nconst fd = await new Response(data).formData();\nconsole.log(Object.fromEntries(fd.entries()));\n"})}),"\n",(0,t.jsx)(n.h2,{id:"data-url-to-blob",children:"data url to Blob"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const blob = await fetch(\n  'data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQACgABACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkEAAoAAgAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkEAAoAAwAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkEAAoABAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQACgAFACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQACgAGACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAAKAAcALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==',\n).then((r) => r.blob());\n\nconst url = URL.createObjectURL(blob);\nwindow.open(url);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"applicationx-www-form-urlencoded",children:"application/x-www-form-urlencoded"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const p = new URLSearchParams({ b: 2, a: 1 });\np.sort();\np.toString();\n"})}),"\n",(0,t.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(n.h2,{id:"textencoder-byteoffset",children:"TextEncoder byteOffset"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"NodeJS \u5ffd\u7565 byteOffset"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"var buf = new Uint8Array(new TextEncoder().encode('wrong hello').buffer, 6);\nconsole.assert(new TextDecoder().decode(buf) === 'hello', 'should be hello');\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/anonyco/FastestSmallestTextEncoderDecoder/issues/17",children:"https://github.com/anonyco/FastestSmallestTextEncoderDecoder/issues/17"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},3354:(e,n,r)=>{var t=r(50959),s=Symbol.for("react.element"),l=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,r){var t,l={},c=null,o=null;for(t in void 0!==r&&(c=""+r),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(o=n.ref),n)i.call(n,t)&&!d.hasOwnProperty(t)&&(l[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===l[t]&&(l[t]=n[t]);return{$$typeof:s,type:e,key:c,ref:o,props:l,_owner:a.current}}n.Fragment=l,n.jsx=c,n.jsxs=c},11527:(e,n,r)=>{e.exports=r(3354)},47214:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>i});var t=r(50959);const s={},l=t.createContext(s);function i(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);