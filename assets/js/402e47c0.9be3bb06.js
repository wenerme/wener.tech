/*! For license information please see 402e47c0.9be3bb06.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[63929],{99098:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>l,default:()=>x,frontMatter:()=>d,metadata:()=>c,toc:()=>o});var s=t(11527),r=t(47214);const d={title:"NextCloud"},l="NextCloud",c={id:"service/file/nextcloud/README",title:"NextCloud",description:"- Primary Storage",source:"@site/../notes/service/file/nextcloud/README.md",sourceDirName:"service/file/nextcloud",slug:"/service/file/nextcloud/",permalink:"/notes/service/file/nextcloud/",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/file/nextcloud/README.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1682624699,formattedLastUpdatedAt:"Apr 27, 2023",frontMatter:{title:"NextCloud"},sidebar:"docs",previous:{title:"netatalk",permalink:"/notes/service/file/netatalk"},next:{title:"Nextcloud \u914d\u7f6e",permalink:"/notes/service/file/nextcloud/conf"}},i={},o=[{value:"Docker",id:"docker",level:2},{value:"ldap",id:"ldap",level:2},{value:"Notes",id:"notes",level:2},{value:"Docker All in One",id:"docker-all-in-one",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"nextcloud",children:"NextCloud"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://docs.nextcloud.com/server/11/admin_manual/configuration_files/primary_storage.html",children:"Primary Storage"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u53ef\u4ee5\u4f7f\u7528 S3 \u6216 Swift \u4f5c\u4e3a\u4e3b\u8981\u5b58\u50a8"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/nextcloud/server/tree/master/lib/private/Files/ObjectStore",children:"lib/Files/ObjectStore"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://docs.nextcloud.com/server/11/admin_manual/configuration_user/user_auth_ldap.html",children:"User Authentication with LDAP"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"The LDAP app is not compatible with the User backend using remote HTTP servers app. You cannot use both of them at the same time."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u6570\u636e\u5e93\u53ef\u4ee5\u4f7f\u7528 SQLite, MySQL, PostGreSQL"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://docs.nextcloud.com/server/12/admin_manual/configuration_server/config_sample_php_parameters.html",children:"Config.php"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/nextcloud/server/blob/master/config/config.sample.php",children:"config.sample.php"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u9ed8\u8ba4\u63a8\u8350\u5e94\u7528 - calendar,contacts,talk,mail,collaborative editing"}),"\n",(0,s.jsxs)(e.li,{children:["\u53d1\u5e03\u53d8\u66f4\u5185\u5bb9 ",(0,s.jsx)(e.a,{href:"https://nextcloud.com/changelog/",children:"https://nextcloud.com/changelog/"})]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"docker",children:"Docker"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["/var/www/html - \u4e3b\u76ee\u5f55\uff0c\u9700\u8981\u66f4\u65b0\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"/custom_apps"})," - \u5e94\u7528\u76ee\u5f55 - \u5b89\u88c5\u6216\u66f4\u65b0\u7684\u5e94\u7528"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"/config"})," - \u672c\u5730\u914d\u7f6e"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"/data"})," \u5b9e\u9645\u6570\u636e"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"/themes/<THEME>"})," \u4e3b\u9898"]}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Env"}),(0,s.jsx)(e.th,{children:"Default"}),(0,s.jsx)(e.th,{children:"Description"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQLITE_DATABASE"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"MYSQL_DATABASE"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"MYSQL_USER"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"MYSQL_PASSWORD"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"MYSQL_HOST"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"POSTGRES_DB"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"POSTGRES_USER"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"POSTGRES_PASSWORD"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"POSTGRES_HOST"}),(0,s.jsx)(e.td,{}),(0,s.jsxs)(e.td,{children:["\u53ef\u4ee5\u5305\u542b\u7aef\u53e3\uff0c\u4f8b\u5982 ",(0,s.jsx)(e.code,{children:"postgres:5432"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"NEXTCLOUD_ADMIN_USER"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"NEXTCLOUD_ADMIN_PASSWORD"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"NEXTCLOUD_DATA_DIR"}),(0,s.jsx)(e.td,{children:"/var/www/html/data"}),(0,s.jsx)(e.td,{children:"\u5b58\u50a8\u7528\u6237\u6570\u636e\u7684\u76ee\u5f55"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"NEXTCLOUD_TRUSTED_DOMAINS"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u7a7a\u683c\u5206\u5272\u53ef\u4fe1\u57df\u540d"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"NEXTCLOUD_UPDATE"}),(0,s.jsx)(e.td,{children:"0"}),(0,s.jsx)(e.td,{children:"\u5982\u679c\u81ea\u5b9a\u4e49\u547d\u4ee4\u542f\u52a8\u9700\u8981\u5f00\u542f\u624d\u4f1a\u66f4\u65b0\uff0c\u4f7f\u7528\u9ed8\u8ba4 (apache-foreground, php-fpm) \u542f\u52a8\u7684\u65f6\u5019\u4f1a\u89e6\u53d1\u66f4\u65b0"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"REDIS_HOST"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"Redis \u7528\u4e8e\u6587\u4ef6\u9501"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"REDIS_HOST_PORT"}),(0,s.jsx)(e.td,{children:"6379"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SMTP_HOST"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SMTP_SECURE"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u53ef\u8bbe\u7f6e\u4e3a ssl"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SMTP_PORT"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"25 \u6216 SSL 456"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SMTP_AUTHTYPE"}),(0,s.jsx)(e.td,{children:"LOGIN"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SMTP_NAME"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SMTP_PASSWORD"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"MAIL_FROM_ADDRESS"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u53d1\u4fe1\u5730\u5740"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"MAIL_DOMAIN"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u4e0d\u8bbe\u7f6e\u5219\u4e3a nextcloud \u7684\u57df\u540d"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"APACHE_DISABLE_REWRITE_IP"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u8bbe\u7f6e\u4e3a 1 \u7981\u7528 IP \u91cd\u5199"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"TRUSTED_PROXIES"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u7a7a\u683c\u5206\u5272\u7684\u53ef\u4fe1\u4ee3\u7406\uff0c\u652f\u6301 CIDR"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"OVERWRITEHOST"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u6307\u5b9a host\uff0c\u7528\u4e8e TRUSTED_PROXIES \u672a\u751f\u6548\u7684\u65f6\u5019"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"OVERWRITEPROTOCOL"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"http https"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"OVERWRITEWEBROOT"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"OVERWRITECONDADDR"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"\u590d\u5199\u751f\u6548\u7684\u6765\u6e90\u5730\u5740"})]})]})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# \u6307\u5b9a\u6570\u636e\u5e93\u548c\u8d26\u53f7\u5bc6\u7801\u5219\u4e0d\u9700\u8981\u8fdb\u5165\u5230\u5b89\u88c5\u9875\u9762\n# SQLite \u6587\u4ef6\u5728 /var/www/html/data/nextcloud.db\n# \u542f\u52a8\u811a\u672c https://github.com/nextcloud/docker/blob/master/docker-entrypoint.sh\n# \u542f\u52a8\u4f1a\u68c0\u6d4b /var/www/html/version.php \u7248\u672c\u53f7 - \u5982\u679c\u6ca1\u6709\u5219\u8ba4\u4e3a\u662f\u65b0\u5b89\u88c5\n\n# \u5355\u72ec\u76ee\u5f55\u6620\u5c04\ndocker run -it --rm \\\n  -v $PWD/nextcloud/config:/var/www/html/config \\\n  -v $PWD/nextcloud/data:/var/www/html/data \\\n  -v $PWD/nextcloud/themes:/var/www/html/themes \\\n  -v $PWD/nextcloud/custom_apps:/var/www/html/custom_apps \\\n  -v $PWD/nextcloud/html:/var/www/html \\\n  -p 80:80 \\\n  -e SQLITE_DATABASE=nextcloud \\\n  -e NEXTCLOUD_ADMIN_USER=nextcloud \\\n  -e NEXTCLOUD_ADMIN_PASSWORD=nextcloud \\\n  --name nextcloud nextcloud:18\n\n# \u5355\u4e2a\u76ee\u5f55\u6620\u5c04 - \u4f1a\u5b89\u88c5 300M \u5de6\u53f3 - macos \u8f83\u6162\uff0c\u8bbf\u95ee\u4e5f\u4f1a\u6162\ndocker run -it --rm \\\n  -v $PWD/nextcloud:/var/www/html \\\n  -p 80:80 \\\n  -e SQLITE_DATABASE=nextcloud \\\n  -e NEXTCLOUD_ADMIN_USER=nextcloud \\\n  -e NEXTCLOUD_ADMIN_PASSWORD=nextcloud \\\n  --name nextcloud nextcloud:18\n\n# \u4f7f\u7528 www-data \u8d26\u53f7\u8fdb\u884c\u64cd\u4f5c\ndocker exec -it -u www-data nextcloud bash\n\n# \u7981\u7528\u610f\u4e49\u4e0d\u5927\u7684\u5e94\u7528\n./occ app:disable firstrunwizard federation nextcloud_announcements support survey_client updatenotification\n# \u7cbe\u9009\u5e38\u7528\u5e94\u7528\nfor i in announcementcenter external impersonate limit_login_to_ip files_automatedtagging files_accesscontrol groupfolders notes user_ldap user_saml; do\n  ./occ app:enable $i\ndone\n\n# \u5b89\u88c5\u5e38\u7528\u5e94\u7528\nfor i in admin_audit extract files_external files_texteditor group_everyone metadata user_ldap user_saml; do\n  ./occ app:enable $i\ndone\n\n# \u5b98\u65b9\u63a8\u8350\u5e94\u7528 - calendar,contacts,talk,mail,collaborative editing\n\n# \u793e\u4ea4\u5e94\u7528\nfor i in circles talk social; do\n  ./occ app:enable $i\ndone\n\n# \u4e8b\u52a1\u5e94\u7528\nfor i in calendar contacts mail deck tasks; do\n  ./occ app:enable $i\ndone\n\n# \u529e\u516c\u5e94\u7528 - \u529f\u80fd\u91cd\u590d\nfor i in onlyoffice richdocuments; do\n  ./occ app:enable $i\ndone\n\n# \u7ba1\u7406\u5e94\u7528\nfor i in occweb; do\n  ./occ app:enable $i\ndone\n\n# \u5de5\u5177\nfor i in files_rightclick checksum; do\n  ./occ app:enable $i\ndone\n"})}),"\n",(0,s.jsx)(e.h2,{id:"ldap",children:"ldap"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"ldap:set-config <configID> <configKey> <configValue>"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"./occ ldap:set-config s01 ldapUserDisplayName2 displayName\n"})}),"\n",(0,s.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://docs.nextcloud.com/server/latest/admin_manual/index.html",children:"admin manual"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"docker-all-in-one",children:"Docker All in One"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Note"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u662f\u901a\u8fc7\u5c06 docker \u6620\u5c04\u5230\u5bb9\u5668\u5185\uff0c\u542f\u52a8 composer \u5b8c\u6210"}),"\n",(0,s.jsx)(e.li,{children:"\u53ef\u4ee5\u53c2\u8003\u903b\u8f91"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Nextcloud + Office + Backend + ",(0,s.jsx)(e.a,{href:"https://github.com/borgbackup/borg",children:"borg"})," Backup + Imaginary + ClamAV + Full text search"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"docker run \\\n  --sig-proxy=false \\\n  --name nextcloud-aio-mastercontainer \\\n  --restart always \\\n  --publish 80:80 \\\n  --publish 8080:8080 \\\n  --publish 8443:8443 \\\n  --volume nextcloud_aio_mastercontainer:/mnt/docker-aio-config \\\n  --volume /var/run/docker.sock:/var/run/docker.sock:ro \\\n  nextcloud/all-in-one:latest\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"3478 Turnserver for talk"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/nextcloud/all-in-one",children:"https://github.com/nextcloud/all-in-one"})}),"\n"]})]})}function x(n={}){const{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},3354:(n,e,t)=>{var s=t(50959),r=Symbol.for("react.element"),d=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,c=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(n,e,t){var s,d={},o=null,a=null;for(s in void 0!==t&&(o=""+t),void 0!==e.key&&(o=""+e.key),void 0!==e.ref&&(a=e.ref),e)l.call(e,s)&&!i.hasOwnProperty(s)&&(d[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===d[s]&&(d[s]=e[s]);return{$$typeof:r,type:n,key:o,ref:a,props:d,_owner:c.current}}e.Fragment=d,e.jsx=o,e.jsxs=o},11527:(n,e,t)=>{n.exports=t(3354)},47214:(n,e,t)=>{t.d(e,{Z:()=>c,a:()=>l});var s=t(50959);const r={},d=s.createContext(r);function l(n){const e=s.useContext(d);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),s.createElement(d.Provider,{value:e},n.children)}}}]);