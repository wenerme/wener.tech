/*! For license information please see bfdaa444.f9f7cae8.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[21244],{30052:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var s=t(2488),i=t(62780);const o={title:"TinaCMS"},l="TinaCMS",a={id:"web/editor/tinacms",title:"TinaCMS",description:"\u5728 Web \u4e0a\u6dfb\u52a0\u5c5e\u6027\u7f16\u8f91\u529f\u80fd\u3002",source:"@site/../notes/web/editor/tinacms.md",sourceDirName:"web/editor",slug:"/web/editor/tinacms",permalink:"/notes/web/editor/tinacms",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/editor/tinacms.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1653992153,formattedLastUpdatedAt:"May 31, 2022",frontMatter:{title:"TinaCMS"},sidebar:"docs",previous:{title:"Slate",permalink:"/notes/web/editor/slate"},next:{title:"tiptap",permalink:"/notes/web/editor/tiptap/"}},r={},c=[{value:"schema",id:"schema",level:2},{value:"next-tinacms-json",id:"next-tinacms-json",level:2}];function m(n){const e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.M)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"tinacms",children:"TinaCMS"}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Web \u4e0a\u6dfb\u52a0\u5c5e\u6027\u7f16\u8f91\u529f\u80fd\u3002"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/tinacms/tinacms",children:"tinacms/tinacms"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u76ee\u524d\u4e3b\u8981\u96c6\u6210 next \u548c gatsby"}),"\n",(0,s.jsx)(e.li,{children:"\u540e\u7aef\u4ea4\u4e92\u76ee\u524d\u4ee5 git \u4e3a\u4e3b"}),"\n",(0,s.jsx)(e.li,{children:"\u5b9e\u73b0\u81ea\u5b9a\u4e49\u540e\u7aef\u53ef\u53c2\u7167 next \u7684 local json \u65b9\u5f0f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u867d\u7136\u540d\u5b57\u662f tinacms \u4f46\u66f4\u504f\u5411\u7f16\u8f91\u5668 - Contextual Editing\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6a21\u578b -formify->\u8868\u5355<->API"}),"\n",(0,s.jsx)(e.li,{children:"\u57fa\u4e8e Git \u7684 CMS - \u4f46\u4e2a\u4eba\u8ba4\u4e3a\u5176\u7f16\u8f91\u529f\u80fd\u66f4\u6709\u610f\u601d"}),"\n",(0,s.jsx)(e.li,{children:"Git \u540e\u7aef\u751f\u6210 GraphQL API"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u4f7f\u7528 final-form \u6784\u5efa form"}),"\n"]})}),"\n",(0,s.jsx)(e.h2,{id:"schema",children:"schema"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Tina Content API"}),"\n",(0,s.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/blob/37ee94fb30bcbcc38c2ebf84ccbd3eb7e7485016/packages/tinacms/src/index.ts#L47-L50",children:"defineSchema"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/blob/37ee94fb30bcbcc38c2ebf84ccbd3eb7e7485016/packages/@tinacms/schema-tools/src/types/SchemaTypes.ts",children:"@tinacms/schema-tools/src/types/SchemaTypes.ts"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/blob/37ee94fb30bcbcc38c2ebf84ccbd3eb7e7485016/packages/@tinacms/schema-tools/src/schema/TinaSchema.ts",children:"@tinacms/schema-tools/src/schema/TinaSchema.ts"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",metastring:'title=".tina/schema.ts"',children:"import { defineSchema } from 'tinacms';\n\nconst schema = defineSchema({\n  // entity\n  collections: [\n    {\n      label: 'Blog Posts',\n      name: 'post',\n      path: 'content/posts',\n      fields: [\n        {\n          // scalar - string, datetime, boolean, image, number\n          // nonscalar - object, reference, rich-text, image\n          type: 'string',\n\n          // string\n          isBody: false,\n          isTitle: true,\n\n          // datetime\n          dateFormat: '',\n          timeFormat: '',\n\n          // reference\n          reverseLookup: { label: '', name: '' },\n          collections: [],\n\n          // object\n          visualSelector: false,\n          templates: '',\n          fields: [],\n\n          // \u57fa\u7840\u5b57\u6bb5\n          label: 'Title',\n          name: 'title',\n          required: true,\n          description: '',\n          list: false,\n\n          ui: {\n            defaultValue: 'A new title', // \u5b9a\u4e49\u9ed8\u8ba4\u503c\n            component: 'textarea', // \u5b9a\u4e49 UI \u7ec4\u4ef6\n          },\n        },\n        {\n          type: 'string',\n          label: 'Post Body',\n          name: 'body',\n          // markdown body\n          isBody: true,\n        },\n        {\n          label: 'Tags',\n          name: 'tags',\n          type: 'string',\n          // array\n          list: true,\n        },\n        {\n          label: 'Categories',\n          name: 'categories',\n          type: 'string',\n          list: true,\n          // \u9650\u5b9a\u503c\n          options: [\n            {\n              value: 'movies',\n              label: 'Movies',\n            },\n            {\n              value: 'music',\n              label: 'Music',\n            },\n          ],\n        },\n        // \u5d4c\u5957\u5bf9\u8c61\n        {\n          label: 'Testimonial',\n          name: 'testimonial',\n          type: 'object',\n          fields: [\n            {\n              label: 'Quote',\n              name: 'quote',\n              type: 'string',\n              ui: {\n                component: 'textarea',\n              },\n            },\n          ],\n        },\n        {\n          label: 'Author',\n          name: 'author',\n          type: 'reference',\n          collections: ['author'], // \u5f15\u7528\u5df2\u6709 entity\n        },\n      ],\n    },\n  ],\n});\n\nexport default schema;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"next-tinacms-json",children:"next-tinacms-json"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u57fa\u4e8e \u672c\u5730 JSON \u63d0\u4f9b\u7f16\u8f91\u6570\u636e\uff0c\u5df2\u5e9f\u5f03\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/tree/master/packages/next-tinacms-json",children:"next-tinacms-json"})}),"\n",(0,s.jsx)(e.li,{children:"useJsonForm"}),"\n",(0,s.jsx)(e.li,{children:"useLocalJsonForm"}),"\n",(0,s.jsx)(e.li,{children:"useGlobalJsonForm"}),"\n",(0,s.jsx)(e.li,{children:"InlineJsonForm: A render-children component"}),"\n",(0,s.jsx)(e.li,{children:"inlineJsonForm: A higher-order component"}),"\n",(0,s.jsxs)(e.li,{children:["\u5b9e\u73b0\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u83b7\u53d6 json \u6587\u4ef6\u6570\u636e"}),"\n",(0,s.jsxs)(e.li,{children:["next \u5168\u5c40\u521d\u59cb\u5316\u65f6\u5019\u914d\u7f6e json \u6620\u5c04\u5173\u7cfb ",(0,s.jsx)(e.code,{children:"{fileRelativePath:string,data:any}"})]}),"\n",(0,s.jsxs)(e.li,{children:["\u901a\u8fc7 ",(0,s.jsx)(e.code,{children:"useLocalJsonForm"})," \u83b7\u53d6\u6620\u5c04\u7684\u6587\u4ef6\u6570\u636e"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"export function useLocalJsonForm<T = any>(\n  // \u6587\u4ef6\u6620\u5c04\u5b9a\u4e49\n  jsonFile: JsonFile<T>,\n  options?: Options,\n) {\n  const [values, form] = useJsonForm(jsonFile, options);\n\n  usePlugins(form);\n\n  return [values, form];\n}\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"import { useCallback } from 'react';\nimport { useWatchFormValues, useForm, useCMS, FormOptions, Field } from 'tinacms';\nimport { generateFields } from './generate-fields';\n\n/**\n * \u8868\u793a git \u5b58\u50a8\u7684\u6587\u4ef6\n */\nexport interface JsonFile<T = any> {\n  fileRelativePath: string;\n  data: T;\n}\n\nexport interface Options {\n  id?: string;\n  label?: string;\n  fields?: Field[];\n  actions?: FormOptions<any>['actions'];\n}\n/**\n * \u521b\u5efa\u4e00\u4e2a\u7f16\u8f91 GIT \u91cc JSON \u7684\u8868\u5355\n */\nexport function useJsonForm<T = any>(jsonFile: JsonFile<T>, options: Options = {}) {\n  const cms = useCMS();\n\n  const id = options.id || jsonFile.fileRelativePath;\n  const label = options.label || jsonFile.fileRelativePath;\n  const fields = options.fields || generateFields(jsonFile);\n  const actions = options.actions || [];\n  // \u521b\u5efa\u8868\u5355\n  const [values, form] = useForm(\n    {\n      id,\n      label,\n      fields,\n      actions,\n      loadInitialValues() {\n        // \u901a\u8fc7 git \u63a5\u53e3\u521d\u59cb\u5316\u6570\u636e\n        return cms.api.git.show(jsonFile.fileRelativePath).then((git: { content: string }) => {\n          const jsonFileInGit = JSON.parse(git.content);\n\n          return jsonFileInGit;\n        });\n      },\n      onSubmit() {\n        // \u901a\u8fc7 git \u63a5\u53e3\u63d0\u4ea4\u6570\u636e - \u7248\u672c\u6982\u5ff5\n        return cms.api.git.commit({\n          files: [jsonFile.fileRelativePath],\n          message: `Commit from Tina: Update ${jsonFile.fileRelativePath}`,\n        });\n      },\n      reset() {\n        // \u91cd\u7f6e\u4fee\u6539\n        return cms.api.git.reset({ files: [id] });\n      },\n    },\n    //\n    { values: jsonFile.data, label },\n  );\n\n  const writeToDisk = useCallback(\n    (formState) => {\n      // \u53d8\u5316\u4fee\u6539\u5230\u6587\u4ef6\n      cms.api.git.writeToDisk({\n        fileRelativePath: jsonFile.fileRelativePath,\n        content: JSON.stringify(formState.values, null, 2),\n      });\n    },\n    [jsonFile.fileRelativePath],\n  );\n  // \u76d1\u542c\u8868\u5355\u53d8\u5316\n  useWatchFormValues(form, writeToDisk);\n\n  return [values || jsonFile.data, form];\n}\n"})})]})}function d(n={}){const{wrapper:e}={...(0,i.M)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(m,{...n})}):m(n)}},38088:(n,e,t)=>{var s=t(96651),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,a=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function c(n,e,t){var s,o={},c=null,m=null;for(s in void 0!==t&&(c=""+t),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(m=e.ref),e)l.call(e,s)&&!r.hasOwnProperty(s)&&(o[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===o[s]&&(o[s]=e[s]);return{$$typeof:i,type:n,key:c,ref:m,props:o,_owner:a.current}}e.Fragment=o,e.jsx=c,e.jsxs=c},2488:(n,e,t)=>{n.exports=t(38088)},62780:(n,e,t)=>{t.d(e,{I:()=>a,M:()=>l});var s=t(96651);const i={},o=s.createContext(i);function l(n){const e=s.useContext(o);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);