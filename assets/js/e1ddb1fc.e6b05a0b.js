/*! For license information please see e1ddb1fc.e6b05a0b.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[74160],{62032:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>t,default:()=>a,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var s=i(2488),c=i(62780);const r={title:"Coding"},t="coding",l={id:"service/forge/coding",title:"Coding",description:"- https://coding.net",source:"@site/../notes/service/forge/coding.md",sourceDirName:"service/forge",slug:"/service/forge/coding",permalink:"/notes/service/forge/coding",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/forge/coding.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1702882608,formattedLastUpdatedAt:"Dec 18, 2023",frontMatter:{title:"Coding"},sidebar:"docs",previous:{title:"CI FAQ",permalink:"/notes/service/forge/ci-faq"},next:{title:"ConcourseCI",permalink:"/notes/service/forge/concourse/"}},o={},d=[{value:"Worker",id:"worker",level:2},{value:"CI Env",id:"ci-env",level:2},{value:"\u5236\u54c1",id:"\u5236\u54c1",level:2},{value:"Shadow Clone Depths",id:"shadow-clone-depths",level:2}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.M)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"coding",children:"coding"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://coding.net",children:"https://coding.net"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u529f\u80fd\u975e\u5e38\u591a\u975e\u5e38\u5168"}),"\n",(0,s.jsx)(e.li,{children:"\u56e2\u961f -> \u9879\u76ee -> \u4ed3\u5e93"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u514d\u8d39\u7248 - ",(0,s.jsx)(e.a,{href:"https://coding.net/pricing",children:"https://coding.net/pricing"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4ed3\u5e93 10G"}),"\n",(0,s.jsx)(e.li,{children:"Docker \u5236\u54c1 1000 \u4e2a"}),"\n",(0,s.jsx)(e.li,{children:"\u975e Docker \u5236\u54c1 5G"}),"\n",(0,s.jsx)(e.li,{children:"\u9879\u76ee\u7ba1\u7406 5000 \u6761\u8bb0\u5f55"}),"\n",(0,s.jsx)(e.li,{children:"\u6d4b\u8bd5\u7528\u4f8b 3000 \u6761\u8bb0\u5f55"}),"\n",(0,s.jsx)(e.li,{children:"\u7f51\u76d8 20G"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"worker",children:"Worker"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["CI/CD \u57fa\u4e8e Jenkins\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Jenkinsfile"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"/etc/qci.conf"}),"\n",(0,s.jsx)(e.li,{children:"/etc/cci_daemon.conf"}),"\n",(0,s.jsx)(e.li,{children:"/root/codingci - CI_HOME"}),"\n",(0,s.jsx)(e.li,{children:"/root/codingci/tools/jenkins_home/workspace/"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"/root/codingci/msg/msg_<TIMESTAMP>.json"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"/root/codingci/cci_daemon.log"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"/root/codingci/jenkins.log"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"/root/codingci/ci_log_YYYY-MM-DD.log"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'apk add git make java python\n\nmkdir -p /root/codingci/tools\ncd /root/codingci/tools\ncurl -fL "https://coding-public-generic.pkg.coding.net/cci/release/cci-agent/jenkins.war?version=2.293-cci" -o jenkins.war\ncurl -fL "https://coding-public-generic.pkg.coding.net/cci/release/jenkinsHome.zip?version=latest" -o jenkins_home.zip\nunzip jenkins_home.zip\n\n# py \u811a\u672c\nqci_worker version\n\n# \u5b98\u65b9\u5b89\u88c5\u547d\u4ee4\n# VERSION=2023.04.06-98504ecfdfc8699d3b557059c3fe79b8ebc2c668\ncurl -fL "https://public-files.coding.net/public-files/coding-ci/install/linux/install.sh?version=2023.04.06-98504ecfdfc8699d3b557059c3fe79b8ebc2c668" | CODING_SERVER=wss://$PROJECT.coding.net PACKAGE_URL=https://public-files.coding.net JENKINS_VERSION=2.293-cci-v2.5 JENKINS_HOME_VERSION=v65 PYPI_HOST=https://$PROJECT.coding.net/ci/pypi/simple PYPI_EXTRA_INDEX_URL= LOG_REPORT=http://worker-beat.coding.net CI_HOME=/root/codingci bash -s $TOKEN false default\n# \u91cd\u65b0\u542f\u52a8\nqci_worker up -d\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",metastring:"title=/etc/qci.conf",children:"[default]\nPYPI_PACKAGE_URL = https://PROJECT.coding.net/ci/pypi/simple/qci-worker/\nPYPI_INDEX_URL = https://PROJECT.coding.net/ci/pypi/simple\nNODE_LOG_REPORT_HOST = http://worker-beat.coding.net\nCI_HOME = /root/codingci\nAPI_HOST = https://PROJECT.coding.net\nNODE_CLIENT_ID =\nNODE_CLIENT_FINGERPRINT =\nNODE_TOKEN =\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://coding.net/help/docs/ci/node/customize.html",children:"https://coding.net/help/docs/ci/node/customize.html"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u5305\u7ba1\u7406\u5de5\u5177"}),(0,s.jsx)(e.th,{children:"\u7f13\u5b58\u76ee\u5f55"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Maven"}),(0,s.jsx)(e.td,{children:"/root/.m2/"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Gradle"}),(0,s.jsx)(e.td,{children:"/root/.gradle/"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"npm"}),(0,s.jsx)(e.td,{children:"/root/.npm/"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"composer"}),(0,s.jsx)(e.td,{children:"/root/.cache/composer/"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"pip3"}),(0,s.jsx)(e.td,{children:"/root/.cache/pip/"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"yarn"}),(0,s.jsx)(e.td,{children:"/usr/local/share/.cache/yarn/"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"ci-env",children:"CI Env"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"env"}),(0,s.jsx)(e.th,{children:"for"})]})}),(0,s.jsx)(e.tbody,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"DEPOT_NAME"}),(0,s.jsx)(e.td,{children:"\u4ed3\u5e93\u540d"})]})})]}),"\n",(0,s.jsx)(e.h2,{id:"\u5236\u54c1",children:"\u5236\u54c1"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Composer"}),"\n",(0,s.jsx)(e.li,{children:"Maven"}),"\n",(0,s.jsx)(e.li,{children:"Docker"}),"\n",(0,s.jsx)(e.li,{children:"Generic"}),"\n",(0,s.jsx)(e.li,{children:"Npm"}),"\n"]}),"\n",(0,s.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"CI \u8fd0\u884c\u53ef\u80fd\u6ca1\u6709 HOME \u53d8\u91cf"}),"\n",(0,s.jsxs)(e.li,{children:["\u5065\u5eb7\u68c0\u67e5\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"ps -ef | grep jenkins.war | grep -v grep"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"pgrep -f jenkins.war"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"java -Dsun.java2d.debugfonts=warning -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-8 -jar /root/codingci/tools/jenkins.war --httpPort=15740 --httpListenAddress=127.0.0.1\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-groovy",children:"stage('\u68c0\u51fa') {\n  when {\n    branch 'env/*'\n    expression {\n      env.BRANCH_NAME=='123'\n      env.BRANCH_NAME ==~ /feature\\/[0-9]+\\.[0-9]+\\.[0-9]+/\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"shadow-clone-depths",children:"Shadow Clone Depths"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-groovy",children:"checkout(\n  [$class: 'GitSCM',\n  // branches: [[name: '*/master']],\n  branches: [[name: GIT_BUILD_REF]],\n  // extensions: [[$class: 'CloneOption', noTags: false, shallow: true, depth: 1, /*timeout: 30*/]],\n  userRemoteConfigs: [[ url: GIT_REPO_URL, credentialsId: CREDENTIALS_ID ]]]\n)\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://javadoc.jenkins.io/plugin/git/hudson/plugins/git/extensions/impl/CloneOption.html",children:"https://javadoc.jenkins.io/plugin/git/hudson/plugins/git/extensions/impl/CloneOption.html"})}),"\n"]})]})}function a(n={}){const{wrapper:e}={...(0,c.M)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(h,{...n})}):h(n)}},38088:(n,e,i)=>{var s=i(96651),c=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,l=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function d(n,e,i){var s,r={},d=null,h=null;for(s in void 0!==i&&(d=""+i),void 0!==e.key&&(d=""+e.key),void 0!==e.ref&&(h=e.ref),e)t.call(e,s)&&!o.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===r[s]&&(r[s]=e[s]);return{$$typeof:c,type:n,key:d,ref:h,props:r,_owner:l.current}}e.Fragment=r,e.jsx=d,e.jsxs=d},2488:(n,e,i)=>{n.exports=i(38088)},62780:(n,e,i)=>{i.d(e,{I:()=>l,M:()=>t});var s=i(96651);const c={},r=s.createContext(c);function t(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:t(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);