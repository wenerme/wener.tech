/*! For license information please see 308c71b9.96ed062f.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[47453],{15149:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>a,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var t=o(11527),r=o(47214);const i={slug:"hello-cgo",title:"Hello CGO",tags:["\u5f00\u53d1","Golang"]},l="Hello CGO",s={permalink:"/story/hello-cgo",editUrl:"https://github.com/wenerme/wener/edit/master/story/../story/2020/2020-05-28-hello-cgo.md",source:"@site/../story/2020/2020-05-28-hello-cgo.md",title:"Hello CGO",description:"Tips",date:"2020-05-28T00:00:00.000Z",formattedDate:"May 28, 2020",tags:[{label:"\u5f00\u53d1",permalink:"/story/tags/\u5f00\u53d1"},{label:"Golang",permalink:"/story/tags/golang"}],readingTime:1.445,hasTruncateMarker:!1,authors:[],frontMatter:{slug:"hello-cgo",title:"Hello CGO",tags:["\u5f00\u53d1","Golang"]},unlisted:!1,prevItem:{title:"\u4e00\u5468 K3S \u5b66\u4e60\u5fc3\u5f97",permalink:"/story/k3s-one-week"},nextItem:{title:"Wener's APIs",permalink:"/story/wener-apis"}},a={authorsImageUrls:[]},c=[{value:"Tips",id:"tips",level:2},{value:"\u521d\u8bd5",id:"\u521d\u8bd5",level:2}];function d(n){const e={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"tips",children:"Tips"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://gist.github.com/zchee/b9c99695463d8902cd33",children:"\u7c7b\u578b\u8f6c\u6362"})}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\u521d\u8bd5",children:"\u521d\u8bd5"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# \u751f\u6210 libdemo.so libdemo.h\ngo build -buildmode=c-shared -o libdemo.so ./demo.go\n# \u7f16\u8bd1 main\ngo build main.go\n./main\n\n# macos - \u67e5\u770b\u5185\u5bb9\nnm libdemo.so | grep hello -i\n# linux\nnm libdemo.so\n# windows\ndumpbin /EXPORTS libdemo.dll\n\n# windows \u4ea4\u53c9\u7f16\u8bd1 - \u9700\u8981\u5b89\u88c5 mingw\nbrew install mingw-w64\n\n# 32 \u4f4d \u4ea4\u53c9\u7f16\u8bd1\nGOOS=windows GOARCH=386 CGO_ENABLED=1 CC=i686-w64-mingw32-gcc go build -buildmode=c-shared -o libdemo.dll ./demo.go\nGOOS=windows GOARCH=386 CGO_ENABLED=1 CC=i686-w64-mingw32-gcc go build main.go\n\n# macos wine \u4e0d\u652f\u6301 32 \u4f4d - mingw \u7248\u672c\u4f4e\u4e0d\u652f\u6301 64 \u4f4d\n# mac \u4f1a\u51fa\u73b0\u5f02\u5e38 cc1: sorry, unimplemented: 64-bit mode not compiled in\n# \u901a\u8fc7 docker \u7f16\u8bd1\ndocker run --rm -v $HOME/go:/root/go -v $PWD:/host -w /host wener/go:win sh\n\nGOOS=windows GOARCH=amd64 CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc go build -buildmode=c-shared -o libdemo.dll ./demo.go\nGOOS=windows GOARCH=amd64 CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc go build main.go\n\n# \u56de\u5230 mac \u4f7f\u7528 wine \u6267\u884c\n# wine \u65e0\u6cd5\u5728 macos \u4e0a\u7f16\u8bd1\u5b89\u88c5 - \u7cfb\u7edf\u7248\u672c\u95ee\u9898 - \u9700\u8981\u4f7f\u7528 cask \u5b89\u88c5\nbrew cask install wine-stable\nwine64 main.exe\n\n# wine 4.0 \u521d\u59cb\u5316 dll \u5931\u8d25\n# 0010:fixme:winsock:set_dont_fragment IP_DONTFRAGMENT for IPv4 not supported in this platform\n# 0009:err:module:attach_dlls "libdemo.dll" failed to initialize, aborting\n# 0009:err:module:attach_dlls Initializing dlls for L"Z:\\\\Users\\\\wener\\\\demo\\\\main.exe" failed, status c0000005\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"demo.go"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'package main\n\nimport "C"\n\n//export Version\nfunc Version() int32 {\n\treturn 123\n}\n\n//export Hello\nfunc Hello(name *C.char) *C.char {\n\treturn C.CString("Hello "+C.GoString(name)+"!")\n}\n\nfunc main() {}\n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"main.go"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-go",children:'package main\n\nimport "fmt"\n\n/*\n#cgo CFLAGS: -I.\n#cgo LDFLAGS: -L. -ldemo\n#include "libdemo.h"\n*/\nimport "C"\n\nfunc main() {\n\tfmt.Printf("Int %v String %v\\n",C.Version(), C.GoString(C.Hello(C.CString("Wener"))))\n}\n'})})]})}function m(n={}){const{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},3354:(n,e,o)=>{var t=o(50959),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,s=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(n,e,o){var t,i={},c=null,d=null;for(t in void 0!==o&&(c=""+o),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(d=e.ref),e)l.call(e,t)&&!a.hasOwnProperty(t)&&(i[t]=e[t]);if(n&&n.defaultProps)for(t in e=n.defaultProps)void 0===i[t]&&(i[t]=e[t]);return{$$typeof:r,type:n,key:c,ref:d,props:i,_owner:s.current}}e.Fragment=i,e.jsx=c,e.jsxs=c},11527:(n,e,o)=>{n.exports=o(3354)},47214:(n,e,o)=>{o.d(e,{Z:()=>s,a:()=>l});var t=o(50959);const r={},i=t.createContext(r);function l(n){const e=t.useContext(i);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);