"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[87852],{49613:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return h}});var r=a(59496);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),p=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=p(a),h=n,d=m["".concat(s,".").concat(h)]||m[h]||c[h]||l;return a?r.createElement(d,o(o({ref:t},u),{},{components:a})):r.createElement(d,o({ref:t},u))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,o=new Array(l);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:n,o[1]=i;for(var p=2;p<l;p++)o[p]=a[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},20531:function(e,t,a){a.r(t),a.d(t,{assets:function(){return g},contentTitle:function(){return h},default:function(){return k},frontMatter:function(){return m},metadata:function(){return d},toc:function(){return b}});var r=a(49613),n=Object.defineProperty,l=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,c=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&u(e,a,t[a]);if(i)for(var a of i(t))p.call(t,a)&&u(e,a,t[a]);return e};const m={title:"arthas"},h="arthas",d={unversionedId:"java/lib/arthas",id:"java/lib/arthas",title:"arthas",description:"- alibaba/arthas",source:"@site/../notes/java/lib/arthas.md",sourceDirName:"java/lib",slug:"/java/lib/arthas",permalink:"/notes/java/lib/arthas",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/java/lib/arthas.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1690946986,formattedLastUpdatedAt:"Aug 2, 2023",frontMatter:{title:"arthas"},sidebar:"docs",previous:{title:"JDWP",permalink:"/notes/java/jdwp"},next:{title:"CHANGELOG",permalink:"/notes/java/lib/changes"}},g={},b=[{value:"\u5e38\u7528",id:"\u5e38\u7528",level:2},{value:"Commands",id:"commands",level:2},{value:"redefine",id:"redefine",level:3},{value:"Arthas Tunnel",id:"arthas-tunnel",level:2},{value:"Spring Boot Starter",id:"spring-boot-starter",level:2},{value:"Unable to get pid of LinuxThreads manager thread",id:"unable-to-get-pid-of-linuxthreads-manager-thread",level:2}],f={toc:b};function k(e){var t,a=e,{components:n}=a,u=((e,t)=>{var a={};for(var r in e)s.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&i)for(var r of i(e))t.indexOf(r)<0&&p.call(e,r)&&(a[r]=e[r]);return a})(a,["components"]);return(0,r.kt)("wrapper",(t=c(c({},f),u),l(t,o({components:n,mdxType:"MDXLayout"}))),(0,r.kt)("h1",c({},{id:"arthas"}),"arthas"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://github.com/alibaba/arthas"}),"alibaba/arthas")),(0,r.kt)("li",{parentName:"ul"},"IDEA \u63d2\u4ef6",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://plugins.jetbrains.com/plugin/13581-arthas-idea"}),"https://plugins.jetbrains.com/plugin/13581-arthas-idea")))),(0,r.kt)("li",{parentName:"ul"},"OGNL \u8bed\u6cd5")),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"curl -O https://arthas.aliyun.com/arthas-boot.jar\n\n# web console http://127.0.0.1:8563\n# --tunnel-server 'ws://127.0.0.1:7777/ws'\njava -jar arthas-boot.jar -h # \u5e2e\u52a9\njava -jar arthas-boot.jar 1  # \u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c - Docker \u91cc pid \u4e3a 1\n\n# Alpine\ncurl -O https://arthas.aliyun.com/arthas-boot.jar\ntouch /proc/1/cwd/.attach_pid1 && kill -SIGQUIT 1 && sleep 2 && ls /proc/1/root/tmp/.java_pid$1\njava -jar arthas-boot.jar 1\n")),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"sc -d com.wener.Application\nvmtool --action getInstances --className java.lang.String --limit 10\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://arthas.aliyun.com/doc/dashboard.html"}),"https://arthas.aliyun.com/doc/dashboard.html")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://github.com/alibaba/arthas/issues/71"}),"https://github.com/alibaba/arthas/issues/71")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://github.com/younggungun/Arthas-Learning/issues/1"}),"https://github.com/younggungun/Arthas-Learning/issues/1"))),(0,r.kt)("h2",c({},{id:"\u5e38\u7528"}),"\u5e38\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"# \u89c2\u5bdf Spring HTTP \u8bf7\u6c42\u7684\u54cd\u5e94\u65f6\u95f4\nwatch org.springframework.web.servlet.DispatcherServlet doService '{params[0].getRequestURI()+\" \"+ #cost}' -n 5 -x 3 '#cost>1'\n\n# \u89c2\u5bdf Spring \u54cd\u5e94\u5934\u4fe1\u606f\nwatch org.springframework.web.servlet.DispatcherServlet doService '{params[0].getRequestURI()+\"  header=\"+params[1].getHeaders(\"trace-id\")}' -n 10 -x 3 -f\n\n# \u89c2\u5bdf MyBatis SQL\nwatch org.apache.ibatis.mapping.BoundSql getSql '{params,returnObj,target.parameterObject,throwExp}' -n 5 -x 3\n\n# JDBC\nwatch java.sql.Connection prepareStatement '{params,throwExp}' -n 5 -x 3 'clazz.getName().startsWith(\"com.mysql\") and params.length==1' and #cost>1\n\nwatch java.sql.Connection prepareStatement '{params,throwExp}' -n 5 -x 3\n\ntt -t org.springframework.data.redis.connection.jedis.JedisConnectionFactory getConnection\ntt -t org.springframework.data.redis.cache.DefaultRedisCacheWriter get\n\n# Controller \u65b9\u6cd5\u5185\u4e0d\u6162\uff0c\u4f46\u6574\u4f53\u6162\u65f6\uff0c\u6392\u67e5\u8bf7\u6c42\u65b9\u6cd5\u524d\u7684\u903b\u8f91\n# getMethodArgumentValues \u6162\u8bf4\u660e\u6ce8\u89e3\u6821\u9a8c\u95ee\u9898\n# doInvoke \u6162\u8bf4\u660e\u662f\u65b9\u6cd5\u6162\ntrace org.springframework.web.method.support.InvocableHandlerMethod invokeForRequest\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://github.com/WangJi92/arthas-idea-plugin/issues/80"}),"https://github.com/WangJi92/arthas-idea-plugin/issues/80"))),(0,r.kt)("h2",c({},{id:"commands"}),"Commands"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"tt - TimeTunnel - \u8bb0\u5f55\u73b0\u573a\uff0c\u901a\u8fc7 index \u56de\u67e5",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-l")," list"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-s")," search, Advice \u5bf9\u8c61"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-i INDEX")," \u56de\u67e5"))),(0,r.kt)("li",{parentName:"ul"},"trace - \u8ddf\u8e2a\u5411\u4e0b\u8c03\u7528\u65b9\u6cd5\u65f6\u95f4\u6d88\u8017"),(0,r.kt)("li",{parentName:"ul"},"stack - \u83b7\u53d6\u8c03\u7528\u94fe - \u5c1d\u8bd5\u5f80\u4e0a\u6392\u67e5\u6162\u7684\u8282\u70b9")),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"trace demo.MathGame run\n")),(0,r.kt)("h3",c({},{id:"redefine"}),"redefine"),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"# \u751f\u6210\u6e90\u7801\njad --source-only com.example.demo.arthas.user.UserController > /tmp/UserController.java\n# \u7f16\u8bd1\nmc /tmp/UserController.java -d /tmp\n# \u52a0\u8f7d\nredefine /tmp/com/example/demo/arthas/user/UserController.class\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301\u65b0\u65b9\u6cd5\u65b0\u5b57\u6bb5")),(0,r.kt)("h2",c({},{id:"arthas-tunnel"}),"Arthas Tunnel"),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"java -jar arthas-tunnel-server.jar\n")),(0,r.kt)("h2",c({},{id:"spring-boot-starter"}),"Spring Boot Starter"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"http://localhost:8080/actuator/arthas")),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-xml"}),"<dependency>\n    <groupId>com.taobao.arthas</groupId>\n    <artifactId>arthas-spring-boot-starter</artifactId>\n    <version>${arthas.version}</version>\n</dependency>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-ini"}),"arthas.agent-id=XXX\narthas.tunnel-server=ws://127.0.0.1:7777/ws\n")),(0,r.kt)("h1",c({},{id:"faq"}),"FAQ"),(0,r.kt)("h2",c({},{id:"unable-to-get-pid-of-linuxthreads-manager-thread"}),"Unable to get pid of LinuxThreads manager thread"),(0,r.kt)("p",null,"alpine docker \u91cc java 8 \u4e3a pid 1 \u65f6\u51fa\u73b0\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"curl -O https://arthas.aliyun.com/arthas-boot.jar\npid=1\ntouch /proc/${pid}/cwd/.attach_pid${pid} && kill -SIGQUIT ${pid} && sleep 2 && ls /proc/${pid}/root/tmp/.java_pid${pid}\njava -jar arthas-boot.jar 1\n")),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"# musl \u65e0\u6cd5\u5224\u65ad\u7ebf\u7a0b\u6a21\u578b\ngetconf GNU_LIBPTHREAD_VERSION\n\n# https://github.com/jattach/jattach\napk add jattach\njattach 1 properties\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"OpenJDK 11+ \u4fee\u590d"),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7 -XX:+StartAttachListener \u53ef\u907f\u514d\u95ee\u9898"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://github.com/alibaba/arthas/issues/362#issuecomment-1336190202"}),"https://github.com/alibaba/arthas/issues/362#issuecomment-1336190202")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"https://github.com/docker-library/openjdk/issues/76"}),"https://github.com/docker-library/openjdk/issues/76"))))}k.isMDXComponent=!0}}]);