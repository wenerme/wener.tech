"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[91953],{49613:function(e,a,t){t.d(a,{Zo:function(){return p},kt:function(){return d}});var n=t(59496);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function c(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=n.createContext({}),s=function(e){var a=n.useContext(o),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},p=function(e){var a=s(e.components);return n.createElement(o.Provider,{value:a},e.children)},m="mdxType",h={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),m=s(t),u=r,d=m["".concat(o,".").concat(u)]||m[u]||h[u]||l;return t?n.createElement(d,i(i({ref:a},p),{},{components:t})):n.createElement(d,i({ref:a},p))}));function d(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=u;var c={};for(var o in a)hasOwnProperty.call(a,o)&&(c[o]=a[o]);c.originalType=e,c[m]="string"==typeof e?e:r,i[1]=c;for(var s=2;s<l;s++)i[s]=t[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},54212:function(e,a,t){t.r(a),t.d(a,{assets:function(){return N},contentTitle:function(){return g},default:function(){return v},frontMatter:function(){return d},metadata:function(){return k},toc:function(){return b}});var n=t(49613),r=Object.defineProperty,l=Object.defineProperties,i=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,p=(e,a,t)=>a in e?r(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,m=(e,a)=>{for(var t in a||(a={}))o.call(a,t)&&p(e,t,a[t]);if(c)for(var t of c(a))s.call(a,t)&&p(e,t,a[t]);return e},h=(e,a)=>l(e,i(a)),u=(e,a)=>{var t={};for(var n in e)o.call(e,n)&&a.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&c)for(var n of c(e))a.indexOf(n)<0&&s.call(e,n)&&(t[n]=e[n]);return t};const d={title:"clash"},g="clash",k={unversionedId:"service/network/proxy/clash/README",id:"service/network/proxy/clash/README",title:"clash",description:"- Dreamacro/clash",source:"@site/../notes/service/network/proxy/clash/README.md",sourceDirName:"service/network/proxy/clash",slug:"/service/network/proxy/clash/",permalink:"/notes/service/network/proxy/clash/",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/network/proxy/clash/README.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1699268951,formattedLastUpdatedAt:"Nov 6, 2023",frontMatter:{title:"clash"},sidebar:"docs",previous:{title:"\u4ee3\u7406",permalink:"/notes/service/network/proxy/"},next:{title:"Clash \u914d\u7f6e",permalink:"/notes/service/network/proxy/clash/conf"}},N={},b=[{value:"Awesome",id:"awesome",level:2},{value:"API",id:"api",level:2},{value:"TProxy",id:"tproxy",level:2},{value:"openrc",id:"openrc",level:2},{value:"Premium",id:"premium",level:2},{value:"Start TProxy server error: operation not permitted",id:"start-tproxy-server-error-operation-not-permitted",level:2}],f={toc:b},y="wrapper";function v(e){var a=e,{components:t}=a,r=u(a,["components"]);return(0,n.kt)(y,h(m(m({},f),r),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",m({},{id:"clash"}),"clash"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("del",{parentName:"li"},(0,n.kt)("a",m({parentName:"del"},{href:"https://github.com/Dreamacro/clash"}),"Dreamacro/clash")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"GPLv3, Golang"),(0,n.kt)("li",{parentName:"ul"},"rule-based tunnel"),(0,n.kt)("li",{parentName:"ul"},"\u4e8e 2023-11-02 \u5220\u5e93, ",(0,n.kt)("a",m({parentName:"li"},{href:"/notes/service/network/proxy/clash/meta"}),"Clash.Meta")," \u53ea\u662f Archive",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/net4people/bbs/issues/303"}),"https://github.com/net4people/bbs/issues/303")))))),(0,n.kt)("li",{parentName:"ul"},"\u53c2\u8003",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/juewuy/ShellClash"}),"juewuy/ShellClash")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://clash.gitbook.io/doc/"}),"https://clash.gitbook.io/doc/")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/vernesong/OpenClash"}),"vernesong/OpenClash")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Loyalsoldier"}),"https://github.com/Loyalsoldier"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Loyalsoldier/geoip"}),"Loyalsoldier/geoip")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/eycorsican/leaf"}),"eycorsican/leaf")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/eycorsican/go-tun2socks"}),"eycorsican/go-tun2socks")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/EAimTY/tuic"}),"EAimTY/tuic")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/HyNetwork/hysteria"}),"HyNetwork/hysteria")))),(0,n.kt)("li",{parentName:"ul"},"Premium - \u95ed\u6e90",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash/releases/tag/premium"}),"\u53d1\u5e03\u5386\u53f2")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash/wiki/Premium-Core-Features"}),"Premium-Core-Features")),(0,n.kt)("li",{parentName:"ul"},"tun,script,tracing"),(0,n.kt)("li",{parentName:"ul"},"rule-providers",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"type: http,file - \u6307\u5411 yaml"),(0,n.kt)("li",{parentName:"ul"},"yaml \u5305\u542b ",(0,n.kt)("inlineCode",{parentName:"li"},"{payload:[]}")))),(0,n.kt)("li",{parentName:"ul"},"ebpf - redirect-to-tun"),(0,n.kt)("li",{parentName:"ul"},"auto-redir - \u914d\u5408 tun \u66ff\u4ee3 redir-port")))),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# golang build from source\ngo install github.com/Dreamacro/clash@latest\n# macOS\nbrew install clash\n\n# Docker\n# https://hub.docker.com/r/dreamacro/clash\n# https://github.com/Dreamacro/clash/blob/master/Dockerfile\ndocker run --rm -it --name clash dreamacro/clash\n\n# Linux\n# ==========\ncurl -LO https://github.com/Dreamacro/clash/releases/download/v1.14.0/clash-linux-amd64-v3-v1.14.0.gz\ngzip -d clash-linux-amd64-v3-v1.14.0.gz\nchmod +x clash-linux-amd64-v3-v1.14.0\nmv clash-linux-amd64-v3-v1.14.0 clash\ncp clash /usr/local/bin/clash\nmkdir -p /var/lib/clash/ /etc/clash/\n\n# https://ghproxy.com/github.com/Dreamacro/maxmind-geoip/releases/download/20230312/Country.mmdb\ncurl -o /var/lib/clash/Country.mmdb https://cdn.jsdelivr.net/gh/Dreamacro/maxmind-geoip@release/Country.mmdb\n\nclash -t -d /var/lib/clash/ -f /etc/clash/config.yaml\n\n# \u540c\u6b65\u672c\u5730\u5230\u670d\u52a1\u5668\nscp ~/.config/clash/config.yaml admin@server:/etc/clash/config.yaml\nrsync -avP --exclude config.yaml ~/.config/clash/ admin@server:/var/lib/clash/\n")),(0,n.kt)("h2",m({},{id:"awesome"}),"Awesome"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash"}),"Dreamacro/clash")),(0,n.kt)("li",{parentName:"ul"},"Client",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/vernesong/OpenClash"}),"vernesong/OpenClash"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"OpenWRT Client"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Fndroid/clash_for_windows_pkg"}),"Fndroid/clash_for_windows_pkg")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/ClashDotNetframework/ClashDotNetframework"}),"ClashDotNetframework"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"DotNet, Windows"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/yichengchen/clashX"}),"yichengchen/clashX"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"macOS"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/WhoJave/clashX/tree/master"}),"WhoJave/clashX")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Kr328/ClashForAndroid"}),"Kr328/ClashForAndroid")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/WhoJave/ClashA"}),"WhoJave/ClashA")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/ccg2018/ClashA"}),"ccg2018/ClashA")),(0,n.kt)("li",{parentName:"ul"},"iOS",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://apps.apple.com/app/choc/id1582542227"}),"https://apps.apple.com/app/choc/id1582542227"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u6536\u8d39\uff0c\u4e0d\u4e00\u5b9a\u53ef\u7528"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/SpongeNobody/Clashy"}),"SpongeNobody/Clashy")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://sites.google.com/view/honven/%E9%A6%96%E9%A1%B5/%E6%9C%BA%E5%9C%BA%E9%93%BE%E6%8E%A5%E8%BD%AC%E6%8D%A2"}),"\u94fe\u63a5\u8f6c\u6362")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash-tracing"}),"Dreamacro/clash-tracing")),(0,n.kt)("li",{parentName:"ul"},"Dashboard",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/haishanh/yacd"}),"haishanh/yacd"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"MIT, Typescript"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"http://yacd.haishan.me/"}),"http://yacd.haishan.me/")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash-dashboard"}),"Dreamacro/clash-dashboard"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"MIT, Typescript"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://clash.razord.top/"}),"https://clash.razord.top/")),(0,n.kt)("li",{parentName:"ul"},"Docker \u5185\u7f6e")))))),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# Dreamacro/clash-dashboard\ncurl -LO https://github.com/Dreamacro/clash-dashboard/archive/gh-pages.zip\nunzip gh-pages.zip\nmv clash-dashboard-gh-pages/ ~/.config/clash/\n\n# haishanh/yacd\ncurl -LO https://github.com/haishanh/yacd/archive/gh-pages.zip\nunzip gh-pages.zip\nmv yacd-gh-pages/ ~/.config/clash/\n")),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-yaml"}),"external-controller: 0.0.0.0:9090\nsecret: external-controller-secret\n# \u9ed8\u8ba4\u76ee\u5f55 \uff5e/.config/clash\n# http://{{external-controller}}/ui\n# yacd-gh-pages\nexternal-ui: clash-dashboard-gh-pages\n")),(0,n.kt)("h2",m({},{id:"api"}),"API"),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# reload \u91cd\u8f7d\u914d\u7f6e\ncurl -X PUT 127.0.0.1:9090/configs --json "{}"\n# \u914d\u7f6e Secret \u540e\ncurl -X PUT -H "Authorization: Bearer secret" 127.0.0.1:9090/configs --json "{}"\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash/wiki/external-controller-API-reference"}),"https://github.com/Dreamacro/clash/wiki/external-controller-API-reference"))),(0,n.kt)("h2",m({},{id:"tproxy"}),"TProxy"),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'sysctl -w net.ipv4.ip_forward=1\n\n# \u65b0\u7684\u8def\u7531\u8868\nip rule add fwmark 666 lookup 666\nip route add local 0.0.0.0/0 dev lo table 666\n\n# clash\n# ==================\n# clash \u94fe\u8d1f\u8d23\u5904\u7406\u8f6c\u53d1\u6d41\u91cf\niptables -t mangle -N clash\n\n# DIRECT Private\niptables -t mangle -A clash -d 0.0.0.0/8 -j RETURN\niptables -t mangle -A clash -d 127.0.0.0/8 -j RETURN\niptables -t mangle -A clash -d 10.0.0.0/8 -j RETURN\niptables -t mangle -A clash -d 172.16.0.0/12 -j RETURN\niptables -t mangle -A clash -d 192.168.0.0/16 -j RETURN\niptables -t mangle -A clash -d 169.254.0.0/16 -j RETURN\niptables -t mangle -A clash -d 224.0.0.0/4 -j RETURN\niptables -t mangle -A clash -d 240.0.0.0/4 -j RETURN\n\n# Proxy\niptables -t mangle -A clash -p tcp -j TPROXY --on-port 7893 --tproxy-mark 666\niptables -t mangle -A clash -p udp -j TPROXY --on-port 7893 --tproxy-mark 666\n\n# \u8f6c\u53d1\u6240\u6709 DNS \u67e5\u8be2\u5230 1053 \u7aef\u53e3\n# \u6b64\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u6240\u6709 DNS \u8bf7\u6c42\u5168\u90e8\u8fd4\u56de\u865a\u5047 IP(fake ip 198.18.0.1/16)\niptables -t nat -I PREROUTING -p udp --dport 53 -j REDIRECT --to 1053\n\n# \u5982\u679c\u60f3\u8981 dig \u7b49\u547d\u4ee4\u53ef\u7528, \u53ef\u4ee5\u53ea\u5904\u7406 DNS SERVER \u8bbe\u7f6e\u4e3a\u5f53\u524d\u5185\u7f51\u7684 DNS \u8bf7\u6c42\n#iptables -t nat -I PREROUTING -p udp --dport 53 -d 192.168.0.0/16 -j REDIRECT --to 1053\n\n# \u6700\u540e\u8ba9\u6240\u6709\u6d41\u91cf\u901a\u8fc7 clash \u94fe\u8fdb\u884c\u5904\u7406\niptables -t mangle -A PREROUTING -j clash\n\n# clash_local\n# ==================\n# clash_local \u94fe\u8d1f\u8d23\u5904\u7406\u7f51\u5173\u672c\u8eab\u53d1\u51fa\u7684\u6d41\u91cf\niptables -t mangle -N clash_local\n# nerdctl \u5bb9\u5668\u6d41\u91cf\u91cd\u65b0\u8def\u7531\n#iptables -t mangle -A clash_local -i nerdctl2 -p udp -j MARK --set-mark 666\n#iptables -t mangle -A clash_local -i nerdctl2 -p tcp -j MARK --set-mark 666\n\n# \u8df3\u8fc7\u5185\u7f51\u6d41\u91cf\niptables -t mangle -A clash_local -d 0.0.0.0/8 -j RETURN\niptables -t mangle -A clash_local -d 127.0.0.0/8 -j RETURN\niptables -t mangle -A clash_local -d 10.0.0.0/8 -j RETURN\niptables -t mangle -A clash_local -d 172.16.0.0/12 -j RETURN\niptables -t mangle -A clash_local -d 192.168.0.0/16 -j RETURN\niptables -t mangle -A clash_local -d 169.254.0.0/16 -j RETURN\n\niptables -t mangle -A clash_local -d 224.0.0.0/4 -j RETURN\niptables -t mangle -A clash_local -d 240.0.0.0/4 -j RETURN\n\n# \u4e3a\u672c\u673a\u53d1\u51fa\u7684\u6d41\u91cf\u6253 mark\niptables -t mangle -A clash_local -p tcp -j MARK --set-mark 666\niptables -t mangle -A clash_local -p udp -j MARK --set-mark 666\n\n# \u8df3\u8fc7 clash \u7a0b\u5e8f\u672c\u8eab\u53d1\u51fa\u7684\u6d41\u91cf, \u9632\u6b62\u6b7b\u5faa\u73af(clash \u7a0b\u5e8f\u9700\u8981\u4f7f\u7528 "clash" \u7528\u6237\u542f\u52a8)\niptables -t mangle -A OUTPUT -p tcp -m owner --uid-owner clash -j RETURN\niptables -t mangle -A OUTPUT -p udp -m owner --uid-owner clash -j RETURN\n\n# \u8ba9\u672c\u673a\u53d1\u51fa\u7684\u6d41\u91cf\u8df3\u8f6c\u5230 clash_local\n# clash_local \u94fe\u4f1a\u4e3a\u672c\u673a\u6d41\u91cf\u6253 mark, \u6253\u8fc7 mark \u7684\u6d41\u91cf\u4f1a\u91cd\u65b0\u56de\u5230 PREROUTING \u4e0a\niptables -t mangle -A OUTPUT -j clash_local\n\n# \u4fee\u590d ICMP(ping)\n# \u8fd9\u5e76\u4e0d\u80fd\u4fdd\u8bc1 ping \u7ed3\u679c\u6709\u6548(clash \u7b49\u4e0d\u652f\u6301\u8f6c\u53d1 ICMP), \u53ea\u662f\u8ba9\u5b83\u6709\u8fd4\u56de\u7ed3\u679c\u800c\u5df2\n# --to-destination \u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u53ef\u8fbe\u7684\u5730\u5740\u5373\u53ef\nsysctl -w net.ipv4.conf.all.route_localnet=1\niptables -t nat -A PREROUTING -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u53c2\u8003\u914d\u7f6e",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://gist.github.com/phlinhng/38a141862de775b10c613f7f2c6ade99"}),"https://gist.github.com/phlinhng/38a141862de775b10c613f7f2c6ade99")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/springzfx/cgproxy/blob/aaa628a76b2911018fc93b2e3276c177e85e0861/readme.md#known-issues"}),"https://github.com/springzfx/cgproxy/blob/aaa628a76b2911018fc93b2e3276c177e85e0861/readme.md#known-issues"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"docker \u4e0d\u53ef\u4ee5 tproxy")))))),(0,n.kt)("h2",m({},{id:"openrc"}),"openrc"),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"nano /etc/init.d/clash\nchmod +x /etc/init.d/clash\nservice clash checkconfig\n")),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'#!/sbin/openrc-run\nsupervisor=supervise-daemon\n\nname="Clash"\ndescription="A rule-based tunnel in Go."\ndescription_reload="Reload configuration without exiting"\n\nclash_config="${clash_config:-/etc/clash/config.yaml}"\ncommand=/usr/local/bin/clash\ncommand_args="-d /var/lib/clash/ -f ${clash_config}"\nextra_commands="checkconfig"\nextra_started_commands="reload"\n\nclash_log="${clash_log:-/var/log/${RC_SVCNAME}.log}"\noutput_log="${clash_log}"\nerror_log="${clash_log}"\n\ndepend() {\n  use logger dns\n  need net\n}\n\ncheckconfig() {\n  ebegin "Checking ${clash_config}"\n  if [ ! -f "${clash_config}" ]; then\n    eerror "No clash config.yaml"\n    return 1\n  fi\n  ${command} -d /var/lib/clash/ -f ${clash_config} -t\n  return 0\n}\n\nreload() {\n  ebegin "Reloading configuration"\n  curl -X PUT -H "Authorization: Bearer $(yq .secret $clash_config)" -sf $(yq .external-controller $clash_config)/configs --json "{}"\n  eend $?\n}\n')),(0,n.kt)("h2",m({},{id:"premium"}),"Premium"),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"curl -OL https://release.dreamacro.workers.dev/latest/clash-linux-amd64-latest.gz\ngzip -d clash-linux-amd64-latest.gz\nmv clash-linux-amd64-latest clash\nchmod +x clash\n")),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-yaml"}),"# \u51fa\u53e3\ninterface-name: eth0\n\ntun:\n  enable: true\n  stack: system # gvisor\n  # dns-hijack:\n  #   - 8.8.8.8:53\n  #   - tcp://8.8.8.8:53\n  #   - any:53\n  #   - tcp://any:53\n  auto-route: true # \u8bbe\u7f6e\u5168\u5c40\u4ee3\u7406\n  # auto-detect-interface: true # \u81ea\u52a8\u68c0\u6d4b interface-name\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash/wiki/Clash-Premium-Features"}),"https://github.com/Dreamacro/clash/wiki/Clash-Premium-Features")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://github.com/Dreamacro/clash/releases/tag/premium"}),"https://github.com/Dreamacro/clash/releases/tag/premium")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",m({parentName:"li"},{href:"https://www.wintun.net/"}),"https://www.wintun.net/"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"wintun.dll")))),(0,n.kt)("h1",m({},{id:"faq"}),"FAQ"),(0,n.kt)("h2",m({},{id:"start-tproxy-server-error-operation-not-permitted"}),"Start TProxy server error: operation not permitted"),(0,n.kt)("pre",null,(0,n.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"sudo setcap cap_net_bind_service,cap_net_admin+ep $(which clash)\n")))}v.isMDXComponent=!0}}]);