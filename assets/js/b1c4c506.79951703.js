"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[63294],{49613:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return s}});var n=a(59496);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var u=n.createContext({}),m=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=m(e.components);return n.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,r=e.originalType,u=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),k=m(a),s=l,N=k["".concat(u,".").concat(s)]||k[s]||c[s]||r;return a?n.createElement(N,i(i({ref:t},p),{},{components:a})):n.createElement(N,i({ref:t},p))}));function s(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=a.length,i=new Array(r);i[0]=k;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:l,i[1]=o;for(var m=2;m<r;m++)i[m]=a[m];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},43582:function(e,t,a){a.r(t),a.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return k},metadata:function(){return N},toc:function(){return f}});var n=a(49613),l=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,p=(e,t,a)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,c=(e,t)=>{for(var a in t||(t={}))u.call(t,a)&&p(e,a,t[a]);if(o)for(var a of o(t))m.call(t,a)&&p(e,a,t[a]);return e};const k={title:"Cadence"},s="Cadence",N={unversionedId:"service/workflow/cadence",id:"service/workflow/cadence",title:"Cadence",description:"- uber/cadence \u662f\u4ec0\u4e48\uff1f",source:"@site/../notes/service/workflow/cadence.md",sourceDirName:"service/workflow",slug:"/service/workflow/cadence",permalink:"/notes/service/workflow/cadence",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/workflow/cadence.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1642767775,formattedLastUpdatedAt:"Jan 21, 2022",frontMatter:{title:"Cadence"},sidebar:"docs",previous:{title:"Camunda",permalink:"/notes/service/workflow/bpms/camunda"},next:{title:"flogo",permalink:"/notes/service/workflow/flogo"}},d={},f=[{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"Golang",id:"golang",level:2},{value:"Java",id:"java",level:2},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef",level:2},{value:"Domain",id:"domain",level:2},{value:"Activity",id:"activity",level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",level:3},{value:"Workflow",id:"workflow",level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0-1",level:3},{value:"\u6ce8\u610f",id:"\u6ce8\u610f",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"\u5b58\u50a8\u7ed3\u6784",id:"\u5b58\u50a8\u7ed3\u6784",level:2},{value:"schema",id:"schema",level:2},{value:"Helm",id:"helm",level:2},{value:"Cannot register global domain when not enabled",id:"cannot-register-global-domain-when-not-enabled",level:2},{value:"Persistence Max QPS Reached",id:"persistence-max-qps-reached",level:2},{value:"Persistence Max QPS Reached for List Operations",id:"persistence-max-qps-reached-for-list-operations",level:2}],h={toc:f};function g(e){var t,a=e,{components:l}=a,p=((e,t)=>{var a={};for(var n in e)u.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&o)for(var n of o(e))t.indexOf(n)<0&&m.call(e,n)&&(a[n]=e[n]);return a})(a,["components"]);return(0,n.kt)("wrapper",(t=c(c({},h),p),r(t,i({components:l,mdxType:"MDXLayout"}))),(0,n.kt)("h1",c({},{id:"cadence"}),"Cadence"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence"}),"uber/cadence")," \u662f\u4ec0\u4e48\uff1f",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"MIT, Golang"),(0,n.kt)("li",{parentName:"ul"},"\u5206\u5e03\u5f0f\uff0c\u5927\u89c4\u6a21\uff0c\u6301\u4e45\u5316\uff0c\u9ad8\u53ef\u7528\u7684\u5f02\u6784\u8c03\u5ea6\u5f15\u64ce"),(0,n.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u5f02\u6b65\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4e1a\u52a1\u903b\u8f91"),(0,n.kt)("li",{parentName:"ul"},"Fault Tolerant Actor Framework"),(0,n.kt)("li",{parentName:"ul"},"fault-oblivious stateful workflow"),(0,n.kt)("li",{parentName:"ul"},"\u63d0\u4f9b Java SDK\u3001Go SDK"),(0,n.kt)("li",{parentName:"ul"},"Cadence \u66f4\u50cf\u662f\u4e00\u4e2a\u6267\u884c\u5e73\u53f0 - \u4f8b\u5982 BNMP\u3001Airflow DAG \u53ef\u4ee5\u5728\u5176\u4e4b\u4e0a\u8fd0\u884c"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview"}),"durable function")))),(0,n.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u573a\u666f",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5468\u671f\u6267\u884c / \u5206\u5e03\u5f0f CRON"),(0,n.kt)("li",{parentName:"ul"},"\u5fae\u670d\u52a1\u7f16\u6392"),(0,n.kt)("li",{parentName:"ul"},"Polling - \u4f8b\u5982 \u6587\u4ef6\u4e0a\u4f20\u4e0b\u8f7d\u3001\u7f51\u7edc\u670d\u52a1\u5065\u5eb7\u3001\u7b49\u5f85\u5916\u90e8\u670d\u52a1\u751f\u6548"),(0,n.kt)("li",{parentName:"ul"},"\u4e8b\u4ef6\u9a71\u52a8\u7f16\u7a0b"),(0,n.kt)("li",{parentName:"ul"},"\u5b58\u50a8\u626b\u63cf - \u4f8b\u5982 \u89c4\u6574 OSS \u4e2d\u6587\u4ef6\u5143\u6570\u636e"),(0,n.kt)("li",{parentName:"ul"},"\u6279\u5904\u7406 - \u4f8b\u5982 \u62a5\u8868"),(0,n.kt)("li",{parentName:"ul"},"\u57fa\u7840\u8bbe\u65bd\u5f00\u901a / Infrastructure provisioning - \u4f8b\u5982 \u5f00\u901a\u963f\u91cc\u4e91 ECS"),(0,n.kt)("li",{parentName:"ul"},"CI/CD \u548c \u90e8\u7f72"),(0,n.kt)("li",{parentName:"ul"},"\u8fd0\u7ef4\u7ba1\u7406 - \u4f8b\u5982 DB \u7ef4\u62a4\u3001\u5f00\u901a\u8d26\u53f7"),(0,n.kt)("li",{parentName:"ul"},"\u4ea4\u4e92\u5e94\u7528 - \u4f8b\u5982 \u5728\u7528\u6237\u4e0b\u5355\u7684\u540c\u65f6\u540e\u53f0\u8fdb\u884c\u6b3a\u8bc8\u68c0\u6d4b"),(0,n.kt)("li",{parentName:"ul"},"DSL \u5de5\u4f5c\u6d41 - BPMN, Apache Airflow, AWS Step Functions"),(0,n.kt)("li",{parentName:"ul"},"\u5927\u6570\u636e \u548c \u673a\u5668\u5b66\u4e60"))),(0,n.kt)("li",{parentName:"ul"},"\u7ec4\u4ef6",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u8bf7\u6c42\u5904\u7406\uff1a Microservices\u3001Serverless\u3001Actors"),(0,n.kt)("li",{parentName:"ul"},"\u5b58\u50a8\uff1a \u6570\u636e\u3001\u7f13\u5b58",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Cassandra / MySQL / Postgres"),(0,n.kt)("li",{parentName:"ul"},"metric - Prometheus - \u53ef\u9009"),(0,n.kt)("li",{parentName:"ul"},"ElastiCache+Kafka - \u652f\u6301\u9ad8\u7ea7\u641c\u7d22",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4f8b\u5982 scanWorkflowExecutions"))),(0,n.kt)("li",{parentName:"ul"},"S3 - archival"))),(0,n.kt)("li",{parentName:"ul"},"Queues"),(0,n.kt)("li",{parentName:"ul"},"Job Schedulers"),(0,n.kt)("li",{parentName:"ul"},"Consensus\uff1a Leader Election\u3001Sharding\u3001Distributed Locks"))),(0,n.kt)("li",{parentName:"ul"},"\u9ad8\u7ea7\u7279\u6027",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u9ad8\u7ea7\u53ef\u89c6\u5316"),(0,n.kt)("li",{parentName:"ul"},"\u5de5\u4f5c\u6d41\u5f52\u6863"),(0,n.kt)("li",{parentName:"ul"},"\u8de8\u6570\u636e\u4e2d\u5fc3\u590d\u5236"))),(0,n.kt)("li",{parentName:"ul"},"\u53c2\u8003",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/temporalio/temporal"}),"temporalio/temporal"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"cadence fork, \u5f00\u53d1\u8005\u7684\u521b\u4e1a\u9879\u76ee"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence-web"}),"uber/cadence-web"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u67e5\u770b\u8fd0\u884c\u7684\u6d41\u7a0b"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber-go/cadence-client"}),"uber-go/cadence-client"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Go \u5ba2\u6237\u7aef"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence-idl"}),"uber/cadence-idl"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"proto,thrift"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence-idl/tree/master/proto/uber/cadence/api/v1"}),"uber/cadence/api/v1")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/yarpc/yarpc-go"}),"yarpc/yarpc-go"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"RPC - JSON, Thrift, and Protobuf"),(0,n.kt)("li",{parentName:"ul"},"HTTP/1.1, gRPC, and TChannel"),(0,n.kt)("li",{parentName:"ul"},"cadence \u6b63\u5728\u4ece thrift \u8fc1\u79fb\u4e3a grpc"))),(0,n.kt)("li",{parentName:"ul"},"helm banzai-charts ",(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/banzaicloud/banzai-charts/tree/master/cadence"}),"cadence"))))),(0,n.kt)("admonition",c({},{type:"caution"}),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"go thrift \u7248\u672c\u51b2\u7a81 ",(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber-go/cadence-client/issues/1107"}),"#1107"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u7528\u7684\u5f88\u8001\u7684\u7248\u672c 0.9.3, 2016 \u5e74 - cadence \u6b63\u5728\u8fc1\u79fb\u4e3a grpc"))),(0,n.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u4e00\u5b9a ",(0,n.kt)("strong",{parentName:"li"},"\u4e0d\u8981\u4fee\u6539")," numOfShards - \u53ea\u6709\u8fc1\u79fb\u5230\u65b0\u96c6\u7fa4"))),(0,n.kt)("admonition",c({},{type:"tip"}),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"\u5355\u4e2a Workflow \u9650\u5236",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"50k \u4e8b\u4ef6\u4f1a\u544a\u8b66"),(0,n.kt)("li",{parentName:"ul"},"200k \u4e8b\u4ef6\u4f1a\u88ab\u76f4\u63a5\u7ec8\u6b62"),(0,n.kt)("li",{parentName:"ul"},"\u6700\u591a\u6267\u884c 100k \u6d3b\u52a8"))),(0,n.kt)("li",{parentName:"ul"},"\u63a8\u8350\u63a7\u5236\u5728 \u51e0\u5343 signal - \u901a\u8fc7 ContinueAsNew \u907f\u514d\u5355\u4e2a workflow \u81a8\u80c0"))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",c({parentName:"tr"},{align:null}),"port"),(0,n.kt)("th",c({parentName:"tr"},{align:null}),"proto"),(0,n.kt)("th",c({parentName:"tr"},{align:null}),"service"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"7833"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"grpc"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"frontend")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"7933"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"Thrift TChannel"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"frontend")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"7834"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"grpc"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"history")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"7934"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"Thrift TChannel"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"7835"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"grpc"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"matching")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"7935"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"Thrift TChannel"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"7939"),(0,n.kt)("td",c({parentName:"tr"},{align:null})),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"worker")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"9090"),(0,n.kt)("td",c({parentName:"tr"},{align:null}),"http/metrics"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))))),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"# macOS\nbrew install cadence-workflow\n# Docker\ndocker run --rm ubercadence/cli:master\n\n# CADENCE_CLI_ADDRESS --address\n# CADENCE_CLI_DOMAIN --domain\n")),(0,n.kt)("h2",c({},{id:"\u5feb\u901f\u5f00\u59cb"}),"\u5feb\u901f\u5f00\u59cb"),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"# \u4f7f\u7528 postgres\ncurl -o docker-compose.yml https://raw.githubusercontent.com/uber/cadence/master/docker/docker-compose-postgres.yml\ncurl -O https://raw.githubusercontent.com/uber/cadence/master/docker/prometheus_config.yml\n# UI http://localhost:8088\n# Grafana http://localhost:3000\n# postgres :5432,prometheus :9090,grafana :3000,cadence 8000-8003,7933-3935,7939,cadence-web :8088\ndocker-compose up\n\n# \u6ce8\u518c domain\n# --address=host.docker.internal:7932\ndocker run --network=host --rm ubercadence/cli:master --do test-domain domain register -rd 1 --global_domain=false\n# domian \u4fe1\u606f\ndocker run --network=host --rm ubercadence/cli:master --do test-domain domain describe\n")),(0,n.kt)("h2",c({},{id:"golang"}),"Golang"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber-common/cadence-samples/blob/master/cmd/samples/recipes/helloworld/main.go"}),"helloworld/main.go"))),(0,n.kt)("h2",c({},{id:"java"}),"Java"),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-java"}),"// \u6d41\u7a0b\u63a5\u53e3\npublic interface TransferWorkflow {\n  @WorkflowMethod(executionStartToCloseTimeoutSeconds = WEEK_SECOND)\n  void execute(String fromAccountId, String toAccountId, Money amount);\n\n  @SignalMethod // \u4fe1\u53f7\u65b9\u6cd5\n  void doCount(int n);\n  @QueryMethod // \u67e5\u8be2\u65b9\u6cd5\n  int void getCount();\n}\n// \u4e8b\u4ef6\u63a5\u53e3\npublic interface Account {\n  @ActivityMethod(scheduleToCloseTimeoutSeconds = 300)\n  void debit(String fromAccountId, Money amount);\n  @ActivityMethod(scheduleToCloseTimeoutSeconds = 300)\n  void credit(String toAccountId, Money amount);\n}\npublic interface TransferWorkflowImpl implements TransferWorkflow {\n  // \u652f\u6301\u914d\u7f6e\u81ea\u52a8\u91cd\u8bd5\n  private final Account account = Workflow.newActivityStub(Account.class);\n  @Override\n  public void execute(String fromAccountId, String toAccountId, Money amount){\n    // \u89e6\u53d1\u4e8b\u4ef6 - \u963b\u585e\u8be5\u6d41\u7a0b\n    // \u4e8b\u4ef6\u53ef\u80fd\u6267\u884c\u975e\u5e38\u4e45 - \u4f8b\u5982\u51e0\u5929\n    account.debit(fromAccountId,amount);\n    try {\n      account.credit(toAccountId,amount);\n    } catch (IllegalArgumentException e){\n      // \u4e1a\u52a1\u8865\u507f\u903b\u8f91\n      account.credit(fromAccountId,amount);\n    }\n\n    // \u53ef\u624b\u52a8\u963b\u585e\n    Workflow.sleep(Duration.ofDays(7));\n  }\n\n  // \u672c\u5730\u72b6\u6001 - \u6301\u4e45\u5316\u7684\n  private int counter;\n  @Override\n  public void doCount(int n){\n    counter += n;\n  }\n  @QueryMethod\n  public int void getCount(){\n    return counter;\n  }\n}\n")),(0,n.kt)("h2",c({},{id:"\u670d\u52a1\u7aef"}),"\u670d\u52a1\u7aef"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"SERVICES - \u8fd0\u884c\u7684\u670d\u52a1",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"frontend, history, matching, worker"))),(0,n.kt)("li",{parentName:"ul"},"CADENCE_STORE_PASSWORD"),(0,n.kt)("li",{parentName:"ul"},"CADENCE_VISIBILITY_STORE_PASSWORD"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/banzaicloud/banzai-charts/blob/master/cadence/templates/server-configmap.yaml"}),"https://github.com/banzaicloud/banzai-charts/blob/master/cadence/templates/server-configmap.yaml"))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",c({parentName:"tr"},{align:null}),"env"),(0,n.kt)("th",c({parentName:"tr"},{align:null}),"desc"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"SQL_PLUGIN"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"SQL_HOST"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"SQL_PORT"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"SQL_DATABASE"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"SQL_USER"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"SQL_PASSWORD"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"SQL_CONNECT_ATTRIBUTES"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"CASSANDRA_HOST"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"CASSANDRA_DB_PORT"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"CASSANDRA_KEYSPACE"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"CASSANDRA_USER"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",c({parentName:"tr"},{align:null}),"CASSANDRA_PASSWORD"),(0,n.kt)("td",c({parentName:"tr"},{align:null}))))),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"curl -LO https://raw.githubusercontent.com/uber/cadence/master/docker/config_template.yaml\ndocker run --rm -it \\\n  -v $PWD/config_template.yaml:/etc/cadence/config/config_template.yaml \\\n  -e DB=postgres -e POSTGRES_SEEDS=127.0.0.1 -e POSTGRES_USER=cadence -e POSTGRES_PWD=cadence \\\n  --name cadence ubercadence/server\n")),(0,n.kt)("h1",c({},{id:"\u6982\u5ff5"}),"\u6982\u5ff5"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Domain - \u57df\u5212\u5206 - \u591a\u79df\u6237\u7684\u79df\u6237",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4f5c\u4e3a TaskList \u548c Workflow \u7684\u547d\u540d\u7a7a\u95f4"),(0,n.kt)("li",{parentName:"ul"},"\u652f\u6301 SecurityToken"),(0,n.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u6570\u636e\u7559\u5b58\u65f6\u95f4"))),(0,n.kt)("li",{parentName:"ul"},"TaskList",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4efb\u52a1\u5217\u8868\u3001\u5e94\u7528\u5206\u7ec4"),(0,n.kt)("li",{parentName:"ul"},"\u542f\u52a8\u7684 worker \u4f1a pull \u7ed9\u5b9a\u7684 TaskList"),(0,n.kt)("li",{parentName:"ul"},"\u610f\u5473\u7740\u5fc5\u987b\u8981\u5148\u786e\u5b9a TaskList \u7684\u540d\u5b57"))),(0,n.kt)("li",{parentName:"ul"},"Worker",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5b88\u62a4\u8fdb\u7a0b"),(0,n.kt)("li",{parentName:"ul"},"\u672c\u5730\u6ce8\u518c Workflow\u3001Activity",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u4f7f\u7528 \u51fd\u6570\u540d \u4f5c\u4e3a\u540d\u5b57"))),(0,n.kt)("li",{parentName:"ul"},"\u79d2\u7ea7 \u65f6\u95f4\u7cbe\u786e\u5ea6"),(0,n.kt)("li",{parentName:"ul"},"WorkflowWorker"),(0,n.kt)("li",{parentName:"ul"},"ActivityWorker"),(0,n.kt)("li",{parentName:"ul"},"SessionWorker"),(0,n.kt)("li",{parentName:"ul"},"ShadowWorker"))),(0,n.kt)("li",{parentName:"ul"},"Workflow - \u903b\u8f91\u6d41\u7a0b",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u786e\u5b9a\u6027\u3001\u5e42\u7b49\u6027"),(0,n.kt)("li",{parentName:"ul"},"\u53ea\u80fd\u901a\u8fc7\u7528 activity \u4e0e\u5916\u754c\u4ea4\u4e92"),(0,n.kt)("li",{parentName:"ul"},"go - workflow.Go"),(0,n.kt)("li",{parentName:"ul"},"chan - workflow.Channel"),(0,n.kt)("li",{parentName:"ul"},"select - workflow.Selector"),(0,n.kt)("li",{parentName:"ul"},"time.Now - workflow.Now"),(0,n.kt)("li",{parentName:"ul"},"time.Sleep - workflow.Sleep"),(0,n.kt)("li",{parentName:"ul"},"log - workflow.GetLogger"),(0,n.kt)("li",{parentName:"ul"},"Future",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"cadence \u7279\u6709\u6982\u5ff5 - \u5f02\u6b65\u64cd\u4f5c\u3001timer"),(0,n.kt)("li",{parentName:"ul"},"\u5355\u4e2a Selector AddFuture \u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u56de\u8c03",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Future \u5b8c\u6210\u540e\u4e0d\u4f1a\u518d\u89e6\u53d1\uff0c\u9664\u975e\u91cd\u65b0\u6784\u5efa Selector \u6216 \u518d\u6b21 Add"))))),(0,n.kt)("li",{parentName:"ul"},"NewContinueAsNewError",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4e3a\u907f\u514d history \u8fc7\u5927\uff0c\u5efa\u8bae\u91cd\u542f"))))),(0,n.kt)("li",{parentName:"ul"},"Activity - \u5355\u4e2a\u6b65\u9aa4\u6d3b\u52a8",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u5fc5\u9700\u5305\u542b error"),(0,n.kt)("li",{parentName:"ul"},"TaskToken - \u552f\u4e00\u6807\u8bc6 -> DomainName, WorkflowID, ActivityID"))),(0,n.kt)("li",{parentName:"ul"},"Session",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u8c03\u5ea6\u591a\u4e2a Activity \u5230\u76f8\u540c\u8282\u70b9"))),(0,n.kt)("li",{parentName:"ul"},"Replayer",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u91cd\u653e\u68c0\u6d4b workflow \u662f\u5426\u53d8\u5316"))),(0,n.kt)("li",{parentName:"ul"},"Shadower",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4ece\u670d\u52a1\u7aef\u62c9\u53d6\u5386\u53f2\u8fdb\u884c\u91cd\u653e"),(0,n.kt)("li",{parentName:"ul"},"\u4f9d\u8d56\u9ad8\u7ea7\u641c\u7d22 - Elastic \u5b58\u50a8"))),(0,n.kt)("li",{parentName:"ul"},"Archiver",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u8d1f\u8d23\u5f52\u6863\u548c\u53d6\u56de\u5386\u53f2"),(0,n.kt)("li",{parentName:"ul"},"workflowID + runID \u5b9a\u4f4d"),(0,n.kt)("li",{parentName:"ul"},"\u5b58\u50a8: local, S3, Kafka"),(0,n.kt)("li",{parentName:"ul"},"history archival"),(0,n.kt)("li",{parentName:"ul"},"visibility archival"))),(0,n.kt)("li",{parentName:"ul"},"Advanced visibility",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u57fa\u4e8e SearchAttributes \u8fdb\u884c\u641c\u7d22 - \u53ea\u652f\u6301\u57fa\u7840\u7c7b\u578b"),(0,n.kt)("li",{parentName:"ul"},"\u9700\u8981 Elastic"),(0,n.kt)("li",{parentName:"ul"},"Memo \u5217\u8868\u53ef\u89c1\uff0c\u4f46\u4e0d\u4f1a\u7d22\u5f15 - \u652f\u6301\u4efb\u610f\u7c7b\u578b"))),(0,n.kt)("li",{parentName:"ul"},"ActivityTask",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u7531 activity worker \u5904\u7406"))),(0,n.kt)("li",{parentName:"ul"},"DecisionTask",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u7531 workflow worker \u5904\u7406"),(0,n.kt)("li",{parentName:"ul"},"\u5904\u7406\u5916\u90e8\u4e8b\u4ef6 - signal\u3001timer"))),(0,n.kt)("li",{parentName:"ul"},"\u670d\u52a1\u89d2\u8272",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"FE - Front End - \u524d\u7aef API \u670d\u52a1"),(0,n.kt)("li",{parentName:"ul"},"HS - History Service - \u6838\u5fc3\u5de5\u4f5c\u6d41\u7f16\u6392",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Cross DC replication"))),(0,n.kt)("li",{parentName:"ul"},"MS - Matching Service - workflow/activity <-> worker"),(0,n.kt)("li",{parentName:"ul"},"WS - Worker Service - \u5185\u90e8\u670d\u52a1\uff0c\u4f8b\u5982 archiving"),(0,n.kt)("li",{parentName:"ul"},"Worker - \u7528\u6237\u7f16\u5199"))),(0,n.kt)("li",{parentName:"ul"},"query - \u67e5\u8be2\u6d41\u7a0b\u72b6\u6001",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"__stack_trace")))),(0,n.kt)("li",{parentName:"ul"},"Event",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Signal - \u5916\u90e8\u4e8b\u4ef6")))),(0,n.kt)("h2",c({},{id:"domain"}),"Domain"),(0,n.kt)("h2",c({},{id:"activity"}),"Activity"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u5e94\u7528\u4ee3\u7801"),(0,n.kt)("li",{parentName:"ul"},"\u957f\u65f6\u95f4\u8fd0\u884c\u7684 - \u5fc3\u8df3"),(0,n.kt)("li",{parentName:"ul"},"\u5f02\u6b65"),(0,n.kt)("li",{parentName:"ul"},"\u57fa\u4e8e\u7b56\u7565\u91cd\u8bd5"),(0,n.kt)("li",{parentName:"ul"},"\u8def\u7531\u5230\u4e3b\u673a\u548c\u8fdb\u7a0b"),(0,n.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u961f\u5217\u5206\u53d1"),(0,n.kt)("li",{parentName:"ul"},"Worker \u901f\u7387\u548c\u5e76\u53d1\u9650\u5236"),(0,n.kt)("li",{parentName:"ul"},"\u961f\u5217\u901f\u7387\u9650\u5236")),(0,n.kt)("p",null,"\u6982\u5ff5\u7c7b\u4f3c\u4e8e Queue"),(0,n.kt)("h3",c({},{id:"\u5b9e\u73b0"}),"\u5b9e\u73b0"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u8d85\u65f6\u7b56\u7565",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"ScheduleToStart"),(0,n.kt)("li",{parentName:"ul"},"StartToClose"),(0,n.kt)("li",{parentName:"ul"},"ScheduleToClose"),(0,n.kt)("li",{parentName:"ul"},"Heartbeat"))),(0,n.kt)("li",{parentName:"ul"},"\u91cd\u8bd5\u7b56\u7565",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"InitialInterval"),(0,n.kt)("li",{parentName:"ul"},"BackoffCoefficient"),(0,n.kt)("li",{parentName:"ul"},"MaximumInterval"),(0,n.kt)("li",{parentName:"ul"},"MaximumAttempts"),(0,n.kt)("li",{parentName:"ul"},"ExpirationInterval"),(0,n.kt)("li",{parentName:"ul"},"NonRetryableErrorReasons")))),(0,n.kt)("h2",c({},{id:"workflow"}),"Workflow"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u865a\u62df\u5bf9\u8c61 - Java\u3001Go",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4f8b\u5982 \u7528\u6237\u3001\u64cd\u4f5c\u76ee\u6807 - \u652f\u6301\u67e5\u8be2\u548c\u76f8\u5173\u64cd\u4f5c"),(0,n.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a\u865a\u62df\u5bf9\u8c61\u90fd\u6709\u81ea\u5df1\u7684\u72b6\u6001 - \u56e0\u6b64\u7cfb\u7edf\u4e2d\u7684 Entity \u90fd\u4f1a\u6620\u5c04\u5230 Workflow"))),(0,n.kt)("li",{parentName:"ul"},"\u4e8b\u52a1\u6027"),(0,n.kt)("li",{parentName:"ul"},"\u7f16\u6392 Activities"),(0,n.kt)("li",{parentName:"ul"},"\u54cd\u5e94\u5916\u90e8\u4e8b\u4ef6"),(0,n.kt)("li",{parentName:"ul"},"\u6709\u72b6\u6001 - \u672c\u5730\u53d8\u91cf\u548c\u6808"),(0,n.kt)("li",{parentName:"ul"},"\u53ef\u67e5\u8be2"),(0,n.kt)("li",{parentName:"ul"},"\u957f\u65f6\u95f4\u5b58\u5728"),(0,n.kt)("li",{parentName:"ul"},"\u6301\u4e45\u5316\u8ba1\u65f6\u5668")),(0,n.kt)("h3",c({},{id:"\u5b9e\u73b0-1"}),"\u5b9e\u73b0"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a\u57df\u4e0b \u6bcf\u4e2a Workflow \u6709\u4e00\u4e2a\u552f\u4e00 ID - \u901a\u5e38\u662f\u4e1a\u52a1\u5bf9\u8c61 ID - \u4f8b\u5982\u8ba2\u5355\u3001\u5ba2\u6237\u7684 ID",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Domain Name, Workflow ID, Run ID"))),(0,n.kt)("li",{parentName:"ul"},"\u6bcf\u6b21\u6267\u884c\u6709 Run ID"),(0,n.kt)("li",{parentName:"ul"},"\u590d\u7528\u7b56\u7565",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"AllowDuplicateFailedOnly - \u9ed8\u8ba4 - \u5141\u8bb8\u5931\u8d25\u7684\u6d41\u7a0b\u91cd\u590d\u6267\u884c"),(0,n.kt)("li",{parentName:"ul"},"AllowDuplicate - \u5982\u679c\u6d41\u7a0b\u5f53\u524d\u672a\u8fd0\u884c"),(0,n.kt)("li",{parentName:"ul"},"RejectDuplicate - \u4e0d\u5141\u8bb8\u91cd\u590d\u6267\u884c")))),(0,n.kt)("h3",c({},{id:"\u6ce8\u610f"}),"\u6ce8\u610f"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u6ca1\u6709\u76f4\u63a5\u7684 API \u64cd\u4f5c\uff0c\u901a\u8fc7 Activity \u8fdb\u884c\u54cd\u5e94"),(0,n.kt)("li",{parentName:"ul"},"\u6838\u5fc3\u662f\u7f16\u6392 Activity"),(0,n.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u7406\u89e3\u4e3a\u5355\u7ebf\u7a0b\u7684\u5e94\u7528\u903b\u8f91 - \u4f46\u5b9e\u9645\u4f1a\u8fc1\u79fb\u5230\u4e0d\u540c\u4e3b\u673a\u8fd0\u884c"),(0,n.kt)("li",{parentName:"ul"},"\u4e0e\u4f20\u7edf\u610f\u4e49 Workflow \u4e0d\u540c - orchestrator\u3001",(0,n.kt)("a",c({parentName:"li"},{href:"https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview"}),"durable function"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4f20\u7edf\u610f\u4e49 Workflow",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4ece\u67d0\u4e2a\u5730\u65b9\u5f00\u59cb\uff0c\u5230\u67d0\u4e2a\u5730\u65b9\u7ed3\u675f"),(0,n.kt)("li",{parentName:"ul"},"LCDP / \u4f4e\u4ee3\u7801\u5f00\u53d1\u5e73\u53f0 - \u56fe\u5f62\u5316\u66ff\u4ee3\u7f16\u7801"))))),(0,n.kt)("li",{parentName:"ul"},"\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u65b9\u6cd5"),(0,n.kt)("li",{parentName:"ul"},"UI \u7684\u6d41\u7a0b\u6784\u5efa\u6700\u7ec8\u4e5f\u662f\u6620\u5c04\u4e3a\u4ee3\u7801\u5c42\u9762\u7684\u6267\u884c - workflow \u662f code first",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Workflow \u518d\u53bb\u652f\u6301 UI \u7684 graph"))),(0,n.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u5c06\u591a\u4e2a Task \u6620\u5c04\u4e3a\u5355\u4e2a Workflow - \u53ef\u901a\u8fc7\u53d8\u91cf\u63a7\u5236",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u903b\u8f91\u5904\u7406\u66f4\u52a0\u6e05\u6670"),(0,n.kt)("li",{parentName:"ul"},"\u51cf\u5c11 DB Load"),(0,n.kt)("li",{parentName:"ul"},"\u601d\u8003\u65b9\u5f0f\u4f1a\u6709\u6240\u4e0d\u540c"))),(0,n.kt)("li",{parentName:"ul"},"\u5f02\u6784\u548c LongRun \u7684\u7279\u6027",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u7528\u4e8e\u7ba1\u7406\u5176\u4ed6\u5e73\u53f0",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u7ba1\u7406 CI\u3001CD \u6267\u884c"),(0,n.kt)("li",{parentName:"ul"},"\u7ba1\u7406 Flink\u3001Spark \u4efb\u52a1"))),(0,n.kt)("li",{parentName:"ul"},"\u53ef\u7528\u4e8e\u6267\u884c\u5468\u671f\u6027\u4efb\u52a1",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u6bcf\u6708\u62a5\u8868"),(0,n.kt)("li",{parentName:"ul"},"\u5404\u79cd\u957f\u77ed\u5468\u671f\u4efb\u52a1")))))),(0,n.kt)("h2",c({},{id:"\u914d\u7f6e"}),"\u914d\u7f6e"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"/etc/cadence/config/config_template.yaml",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence/blob/master/docker/config_template.yaml"}),"docker/config_template.yaml")),(0,n.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u6a21\u677f"))),(0,n.kt)("li",{parentName:"ul"},"/etc/cadence/config/dynamicconfig/config.yaml"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence/blob/master/common/config/config.go"}),"https://github.com/uber/cadence/blob/master/common/config/config.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence/blob/master/common/service/config.go"}),"https://github.com/uber/cadence/blob/master/common/service/config.go")),(0,n.kt)("li",{parentName:"ul"},"domain",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Retention")))),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),'history:\n  # 2K -> SQL\n  # 8K -> Cassandra\n  numHistoryShards: 4\n\n  # \u5b58\u50a8\u5f15\u7528\n  defaultStore: default\n  visibilityStore: visibility\n  advancedVisibilityStore: es-visibility\n  # \u5b58\u50a8\u914d\u7f6e\n  datastores:\n    default:\n      nosql:\n        pluginName: "cassandra"\n      sql:\n        pluginName: "postgres"\n        encodingType: "thriftrw"\n        decodingTypes: ["thriftrw"]\n        databaseName: {{ default .Env.DBNAME "cadence" }}\n        connectAddr: "{{ default .Env.POSTGRES_SEEDS "" }}:{{ default .Env.DB_PORT "5432" }}"\n        connectProtocol: "tcp"\n        user: {{ default .Env.POSTGRES_USER "" }}\n        password: {{ default .Env.POSTGRES_PWD "" }}\n        maxConns: 20\n        maxIdleConns: 20\n        maxConnLifetime: "1h"\n        tls:\n          enabled: true\n          sslmode: require\n      elasticsearch:\n        version: {{ default .Env.ES_VERSION "" }}\n        username: {{ default .Env.ES_USER "" }}\n        password: {{ default .Env.ES_PWD "" }}\n        url:\n          scheme: "http"\n          host: "{{ default .Env.ES_SEEDS "" }}:{{ default .Env.ES_PORT "9200" }}"\n        indices:\n          visibility: {{ default .Env.VISIBILITY_NAME "cadence-visibility-dev" }}\n    visibility:\n      sql:\n        # \u4e00\u822c\u4f1a\u7528\u4e0d\u540c\u7684\u5e93\n        databaseName: {{ default .Env.VISIBILITY_DBNAME "cadence_visibility" }}\n    es-visibility:\ndynamicConfigClient:\n  filepath: /etc/cadence/config/dynamicconfig/config.yaml\n  pollInterval: 10s\n')),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"# \u52a8\u6001\u914d\u7f6e\nfrontend.visibilityListMaxQPS:\n  - value: 1000\n    constraints:\n      domainName: 'domainA'\n  - value: 2000\n    constraints:\n      domainName: 'domainB'\n")),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"\n# \u5355\u8282\u70b9\nfrontend.persistenceMaxQPS: 2000\n# \u5168\u5c40\nfrontend.persistenceGlobalMaxQPS: 2000\n# visibility db\nfrontend.visibilityListMaxQPS: 10\nfrontend.esVisibilityListMaxQPS: 30\n\nmatching.persistenceMaxQPS: 3000\nmatching.persistenceGlobalMaxQPS: 3000\nmatching.persistenceGlobalMaxQPS: 2000\n\nhistory.persistenceMaxQPS: 9000\nhistory.persistenceGlobalMaxQPS: 9000\nhistory.historyVisibilityOpenMaxQPS:\nhistory.historyVisibilityClosedMaxQPS:\n")),(0,n.kt)("h2",c({},{id:"\u5b58\u50a8\u7ed3\u6784"}),"\u5b58\u50a8\u7ed3\u6784"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence/tree/master/schema/postgres"}),"schema/postgres")),(0,n.kt)("li",{parentName:"ul"},"domains"),(0,n.kt)("li",{parentName:"ul"},"domain_metadata"),(0,n.kt)("li",{parentName:"ul"},"shards"),(0,n.kt)("li",{parentName:"ul"},"transfer_tasks"),(0,n.kt)("li",{parentName:"ul"},"cross_cluster_tasks"),(0,n.kt)("li",{parentName:"ul"},"executions"),(0,n.kt)("li",{parentName:"ul"},"current_executions"),(0,n.kt)("li",{parentName:"ul"},"buffered_events"),(0,n.kt)("li",{parentName:"ul"},"tasks"),(0,n.kt)("li",{parentName:"ul"},"task_lists"),(0,n.kt)("li",{parentName:"ul"},"replication_tasks"),(0,n.kt)("li",{parentName:"ul"},"replication_tasks_dlq"),(0,n.kt)("li",{parentName:"ul"},"timer_tasks"),(0,n.kt)("li",{parentName:"ul"},"activity_info_maps"),(0,n.kt)("li",{parentName:"ul"},"timer_info_maps"),(0,n.kt)("li",{parentName:"ul"},"child_execution_info_maps"),(0,n.kt)("li",{parentName:"ul"},"request_cancel_info_maps"),(0,n.kt)("li",{parentName:"ul"},"signal_info_maps"),(0,n.kt)("li",{parentName:"ul"},"buffered_replication_task_maps"),(0,n.kt)("li",{parentName:"ul"},"signals_requested_sets"),(0,n.kt)("li",{parentName:"ul"},"history_node"),(0,n.kt)("li",{parentName:"ul"},"history_tree"),(0,n.kt)("li",{parentName:"ul"},"queue"),(0,n.kt)("li",{parentName:"ul"},"queue_metadata")),(0,n.kt)("h2",c({},{id:"schema"}),"schema"),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"go build -o cadence-sql-tool github.com/uber/cadence/cmd/tools/sql\n# \u9ed8\u8ba4\u5b58\u50a8 \u548c visibility \u90fd\u9700\u8981\nenv $(cat .env | xargs) ./cadence-sql-tool setup-schema -v 0.0\nenv $(cat .vis | xargs) ./cadence-sql-tool setup-schema -v 0.0\n# update - \u6ce8\u610f \u9ed8\u8ba4 \u548c visibility \u8def\u5f84\u4e0d\u540c\nenv $(cat .env | xargs) go run ./cmd/tools/sql/ update-schema -d schema/postgres/cadence/versioned/\nenv $(cat .vis | xargs) go run ./cmd/tools/sql/ update-schema -d schema/postgres/visibility/versioned/\n")),(0,n.kt)("pre",null,(0,n.kt)("code",c({parentName:"pre"},{className:"language-ini",metastring:'title=".env"',title:'".env"'}),"SQL_PLUGIN=postgres\nSQL_HOST=192.168.1.1\nSQL_PORT=5432\nSQL_DATABASE=cadence\nSQL_USER=cadence\nSQL_PASSWORD=\nSQL_CONNECT_ATTRIBUTES=sslmode=require\n")),(0,n.kt)("admonition",c({},{type:"caution"}),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"postgres \u5f00\u542f --tls \u8981\u6c42\u63d0\u4f9b ca - \u5b9e\u9645\u4e0d\u9700\u8981\uff0c\u76ee\u524d\u8981\u6539\u68c0\u6d4b\u4ee3\u7801",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/uber/cadence/pull/4639"}),"#4639")))))),(0,n.kt)("h2",c({},{id:"helm"}),"Helm"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/wenerme/charts/tree/master/banzai/charts/cadence"}),"https://github.com/wenerme/charts/tree/master/banzai/charts/cadence"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u540c\u6b65\u81ea banzai charts"),(0,n.kt)("li",{parentName:"ul"},"banzai \u56fd\u5185\u65e0\u6cd5\u8bbf\u95ee"))),(0,n.kt)("li",{parentName:"ul"},"existingSecret \u5305\u542b password \u5b57\u6bb5")),(0,n.kt)("admonition",c({},{type:"caution"}),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"helm schema job \u4e0d\u652f\u6301 postgres\uff0c\u4e0d\u652f\u6301\u4f7f\u7528 existingSecret",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5efa\u8bae\u672c\u5730\u8fc1\u79fb"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/banzaicloud/banzai-charts/issues/1301"}),"banzaicloud/banzai-charts#1301"),"\nSetup Job doesn't pull value from secret"))),(0,n.kt)("li",{parentName:"ul"},"service \u672a\u66b4\u9732 grpc \u7aef\u53e3",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",c({parentName:"li"},{href:"https://github.com/banzaicloud/banzai-charts/issues/1305"}),"banzaicloud/banzai-charts#1305")))))),(0,n.kt)("h1",c({},{id:"faq"}),"FAQ"),(0,n.kt)("h2",c({},{id:"cannot-register-global-domain-when-not-enabled"}),"Cannot register global domain when not enabled"),(0,n.kt)("p",null,"cli \u6ce8\u518c\u6dfb\u52a0 ",(0,n.kt)("inlineCode",{parentName:"p"},"--global_domain=false")),(0,n.kt)("h2",c({},{id:"persistence-max-qps-reached"}),"Persistence Max QPS Reached"),(0,n.kt)("p",null,"\u6570\u636e\u5e93\u9650\u5236"),(0,n.kt)("h2",c({},{id:"persistence-max-qps-reached-for-list-operations"}),"Persistence Max QPS Reached for List Operations"),(0,n.kt)("p",null,"visibility \u6570\u636e\u5e93\u9650\u5236"))}g.isMDXComponent=!0}}]);