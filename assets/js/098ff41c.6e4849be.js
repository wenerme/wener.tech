/*! For license information please see 098ff41c.6e4849be.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[55491],{85567:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>a,frontMatter:()=>l,metadata:()=>d,toc:()=>o});var r=s(11527),i=s(47214);const l={title:"Packer"},c="Packer",d={id:"devops/infra/packer",title:"Packer",description:"- \u662f\u4ec0\u4e48\uff1f",source:"@site/../notes/devops/infra/packer.md",sourceDirName:"devops/infra",slug:"/devops/infra/packer",permalink:"/notes/devops/infra/packer",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/infra/packer.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1693463269,formattedLastUpdatedAt:"Aug 31, 2023",frontMatter:{title:"Packer"},sidebar:"docs",previous:{title:"Nomad",permalink:"/notes/devops/infra/nomad"},next:{title:"Pulumi",permalink:"/notes/devops/infra/pulumi"}},t={},o=[{value:"HCL2",id:"hcl2",level:2},{value:"Template",id:"template",level:2},{value:"\u6a21\u7248\u8bed\u6cd5",id:"\u6a21\u7248\u8bed\u6cd5",level:3},{value:"\u6761\u4ef6\u53d8\u91cf",id:"\u6761\u4ef6\u53d8\u91cf",level:3},{value:"HOME",id:"home",level:3},{value:"communicator",id:"communicator",level:3},{value:"docker",id:"docker",level:3},{value:"qemu",id:"qemu",level:3}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"packer",children:"Packer"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u662f\u4ec0\u4e48\uff1f\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u81ea\u52a8\u5316\u591a\u5e73\u53f0\u955c\u50cf\u6784\u5efa\u5de5\u5177"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u4f7f\u7528\u573a\u666f\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"CD"}),"\n",(0,r.jsx)(e.li,{children:"Dev/Prod Parity"}),"\n",(0,r.jsx)(e.li,{children:"Appliance/Demo Creation"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6838\u5fc3\u6d41\u7a0b\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u542f\u52a8 builder\uff0c\u63d0\u4f9b\u4e00\u81f4\u7684\u73af\u5883\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"vm\u3001docker"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6267\u884c provisioners - \u670d\u52a1\u5f00\u901a\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6784\u5efa artifact"}),"\n",(0,r.jsx)(e.li,{children:"file provisioner \u4e0b\u8f7d artifact \u5230\u672c\u5730"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6267\u884c post-processor\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"artifice \u9a8c\u8bc1 \u4ea7\u51fa\u7269 \u5b58\u5728"}),"\n",(0,r.jsx)(e.li,{children:"\u4e0a\u4f20\u5230 docker hub\u3001oss \u7b49\u5176\u4ed6\u5730\u65b9"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6ce8\u610f\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Builder \u4e0d\u652f\u6301\u4f9d\u8d56"}),"\n",(0,r.jsxs)(e.li,{children:["\u81ea\u52a8\u52a0\u8f7d",(0,r.jsx)(e.a,{href:"https://www.packer.io/guides/hcl/variables",children:"\u53d8\u91cf"})," ",(0,r.jsx)(e.code,{children:"*.auto.pkrvars.hcl"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"PACKER_LOG=1"})," \u5f00\u542f\u65e5\u5fd7"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/geerlingguy/packer-boxes",children:"geerlingguy/packer-boxes"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# macOS\nbrew install packer\n\npacker version\n# timestamp,target,type,data\npacker -machine-readable version\n\npacker -autocomplete-install\n\npacker build template.json\n\n# console\n# \u5b9e\u9a8c\u53d8\u91cf\u66ff\u6362\n# help exit variables\npacker console my_template.json\necho {{timestamp}} | packer console\n\n# hcl2 console - 1.6+\npacker console folder/\npacker console file.pkr.hcl\necho "1 + 5" | packer console --config-type=hcl2\npacker console --config-type=hcl2\n\npacker fix old.json > new.json\npacker inspect template.json\npacker validate my-template.json\n\n# \u4f7f\u7528 JQ \u5220\u9664\u8bc4\u8bba\njq \'walk(if type == "object" then del(._comment) else . end)\' commented_template.json > uncommented_template.json\n\n# \u624b\u52a8\u5b89\u88c5\n# https://packer.io/downloads.html\nver=$(curl -sfL https://api.github.com/repos/hashicorp/packer/releases/latest | jq .tag_name -r)\nver=${ver##v}\ncurl -LOC- https://releases.hashicorp.com/packer/${ver}/packer_${ver}_linux_amd64.zip\n'})}),"\n",(0,r.jsx)(e.h2,{id:"hcl2",children:"HCL2"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"packer build folder"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"variables.pkr.hcl"}),"\n",(0,r.jsx)(e.li,{children:"locals.pkr.hcl"}),"\n",(0,r.jsx)(e.li,{children:"sources.pkr.hcl"}),"\n",(0,r.jsx)(e.li,{children:"build.pkr.hcl"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u5f15\u53f7\u548c heredoc \u91cc\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"${"})," ",(0,r.jsx)(e.code,{children:"%{"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://github.com/hashicorp/packer/issues/9176",children:"#9176"})," - HCL2: implementation list"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-hcl",children:'# \u5168\u5c40\u5b9a\u4e49\u53ef\u590d\u7528\u7684 builder\nsource "docker" "base" {\n  image = "wener/base"\n  discard = true\n  pull = false\n}\n\n# \u672c\u5730\u53d8\u91cf\nlocals {\n    # \u76f4\u63a5\u5f15\u7528\n    wee = local.baz\n    # \u5b57\u7b26\u4e32\u4e2d\u66ff\u6362\n    baz = "Foo is \'${var.foo}\' but not \'${local.wee}\'"\n}\n\n# \u53d8\u91cf\u5b9a\u4e49\nvariable "foo" {\n    type = string\n    default = "the default value of the `foo` variable"\n    description = "description of the `foo` variable"\n}\n\n# \u6784\u5efa\nbuild {\n  name = "test-build"\n  # \u5f15\u7528\n  source "docker.base" {}\n  # \u591a\u4e2a\n  # source = [ "source.docker.first", "source.docker.second" ]\n\n  provisioner "shell" {\n    # \u6307\u5b9a source \u6267\u884c\n    only = ["source.docker.base"]\n    # \u7b49\u5f85\u6307\u5b9a\u65f6\u95f4\n    pause_before = "10s"\n    max_retries = 5\n    timeout = "5m"\n\n    inline = [ "echo Tesing" ]\n  }\n\n  post-processor "shell-local" {\n    inline = ["echo Down working"]\n  }\n\n  post-processor "checksum" {\n    checksum_types = [ "md5", "sha512" ]\n    keep_input_artifact = true\n    only = ["source.amazon-ebs.example"]\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"template",children:"Template"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/builders",children:"builders"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"alicloud-ecs - \u963f\u91cc\u4e91 ECS \u8fd0\u884c"}),"\n",(0,r.jsx)(e.li,{children:"docker - Docker \u91cc\u8fd0\u884c"}),"\n",(0,r.jsx)(e.li,{children:"qemu - \u901a\u8fc7 QEMU \u8fd0\u884c"}),"\n",(0,r.jsx)(e.li,{children:"libvirt - \u901a\u8fc7 libvirt \u8fd0\u884c"}),"\n",(0,r.jsx)(e.li,{children:"tencentcloud-cvm - \u817e\u8baf\u4e91 CVM \u8fd0\u884c"}),"\n",(0,r.jsx)(e.li,{children:"file - \u57fa\u4e8e\u6587\u4ef6\u6784\u5efa artifact \u7136\u540e\u8fd0\u884c post-processors"}),"\n",(0,r.jsx)(e.li,{children:"null - \u8bbe\u7f6e SSH\uff0c\u8fd0\u884c provisioners"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/communicators",children:"communicator"})," - \u901a\u4fe1\u673a\u5236"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/post-processors",children:"post-processors"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"alicloud-import"}),"\n",(0,r.jsx)(e.li,{children:"artifice - \u6307\u5b9a\u4ea7\u51fa\u7269\uff0c\u4e4b\u540e\u7684 post-processors \u80fd\u8bbf\u95ee\u5230"}),"\n",(0,r.jsx)(e.li,{children:"compress"}),"\n",(0,r.jsx)(e.li,{children:"checksum"}),"\n",(0,r.jsx)(e.li,{children:"docker-import"}),"\n",(0,r.jsx)(e.li,{children:"docker-push"}),"\n",(0,r.jsx)(e.li,{children:"docker-save"}),"\n",(0,r.jsx)(e.li,{children:"docker-tag"}),"\n",(0,r.jsx)(e.li,{children:"manifest"}),"\n",(0,r.jsx)(e.li,{children:"shell - \u672c\u5730\u6267\u884c"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/provisioners",children:"provisioners"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ansible-local - \u672c\u5730\u6267\u884c"}),"\n",(0,r.jsx)(e.li,{children:"ansible - \u8fdc\u7a0b\u6267\u884c"}),"\n",(0,r.jsx)(e.li,{children:"breakpoint - \u7b49\u5f85\u7528\u6237\u786e\u8ba4"}),"\n",(0,r.jsx)(e.li,{children:"file - \u6587\u4ef6\u4e0a\u4f20"}),"\n",(0,r.jsx)(e.li,{children:"powershell"}),"\n",(0,r.jsx)(e.li,{children:"shell"}),"\n",(0,r.jsx)(e.li,{children:"shell-local"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["variables\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{user 'aws_access_key'}}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{env 'MY_SECRET'}}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{ consul_key 'my_image/softs_versions/next' }}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{ vault '/secret/data/hello' 'foo'}}"})}),"\n",(0,r.jsx)(e.li,{children:"\u6570\u7ec4\u53d8\u91cf\u53ef\u4f7f\u7528\u9017\u53f7\u62fc\u63a5\u7684\u5b57\u7b26\u4e32"}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"-var=name=value"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"-var-file=vars.json"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "_comment": "This is a comment",\n  // \u5fc5\u987b - \u5b9a\u4e49\u4e00\u4e2a\u6216\u591a\u4e2a builder\n  "builders": [{}],\n  "description": "",\n  // packer \u6700\u5c0f\u7248\u672c\n  "min_packer_version": "",\n  // \u540e\u5904\u7406\u6b65\u9aa4\n  "post-processors": [{}],\n  // \u5b89\u88c5\u914d\u7f6e\u548c\u5305\u7684\u6b65\u9aa4\n  "provisioners": [{}],\n  // \u9519\u8bef\u65f6\u6267\u884c\n  "error-cleanup-provisioner": {\n    "type": "shell-local",\n    "inline": ["echo \'rubber ducky\'> ducky.txt"]\n  },\n  // \u53d8\u91cf\u5b9a\u4e49\n  "variables": {\n    "my_secret": "{{env `MY_SECRET`}}",\n    "not_a_secret": "plaintext",\n    "foo": "bar"\n  },\n  // \u5b9a\u4e49\u654f\u611f\u53d8\u91cf\n  "sensitive-variables": ["my_secret", "foo"]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6a21\u7248\u8bed\u6cd5",children:"\u6a21\u7248\u8bed\u6cd5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/templates/engine",children:"\u6a21\u677f\u8bed\u6cd5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{ }}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{timestamp}}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{.Variable}}"})}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"func"}),(0,r.jsx)(e.th,{children:"desc"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"build_name"}),(0,r.jsx)(e.td,{children:"\u6784\u5efa\u540d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"build_type"}),(0,r.jsx)(e.td,{children:"\u6784\u5efa\u7c7b\u578b"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"clean_resource_name"}),(0,r.jsxs)(e.td,{children:["\u5e72\u51c0\u7684\u8d44\u6e90\u540d\u5b57\uff0c\u7a7a\u683c\u8f6c",(0,r.jsx)(e.code,{children:"-"}),"\uff0c\u5c0f\u5199\uff0c\u622a\u53d6\u957f\u5ea6\uff08GCE 63\uff0cAzure 80\uff09"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"env"}),(0,r.jsx)(e.td,{children:"\u73af\u5883\u53d8\u91cf"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"build"}),(0,r.jsx)(e.td,{children:"\u6784\u5efa\u65f6\u7684\u72b6\u6001\u548c\u8fde\u63a5\u4fe1\u606f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"isotime [FORMAT]"})}),(0,r.jsx)(e.td,{children:"\u65f6\u95f4"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"lower"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"packer_version"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"pwd"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"replace"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"( old, new string, n int, s )"})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"replace_all"}),(0,r.jsx)(e.td,{children:"\u5168\u66ff\u6362"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"split"}),(0,r.jsx)(e.td,{children:"\u5206\u5272\u5b57\u7b26\u4e32"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"template_dir"}),(0,r.jsx)(e.td,{children:"\u6a21\u677f\u76ee\u5f55"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"timestamp"}),(0,r.jsx)(e.td,{children:"UNIX \u65f6\u95f4\u6233\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u53d8\u91cf\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u53d8"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"uuid"}),(0,r.jsx)(e.td,{children:"UUID"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"upper"}),(0,r.jsx)(e.td,{children:"\u5927\u5199"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"user"}),(0,r.jsx)(e.td,{children:"\u7528\u6237\u53d8\u91cf"})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["build\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ID - \u6784\u5efa VM \u7684 ID - \u4f8b\u5982 EC2 \u7684 instance id"}),"\n",(0,r.jsx)(e.li,{children:"Host, Port, User, Password - \u8bbf\u95ee\u673a\u5668\u7684\u4fe1\u606f\uff0c\u7528\u4e8e Ansible \u6216 Inspec"}),"\n",(0,r.jsx)(e.li,{children:"ConnType - \u901a\u4fe1\u7c7b\u578b"}),"\n",(0,r.jsx)(e.li,{children:"PackerRunUUID - \u6784\u5efa ID"}),"\n",(0,r.jsx)(e.li,{children:"PackerHTTPIP, PackerHTTPPort, PackerHTTPAddr - packer \u63d0\u4f9b\u7684 http \u6587\u4ef6\u670d\u52a1 - vm \u4e2d\u7684 http \u76ee\u5f55"}),"\n",(0,r.jsx)(e.li,{children:"SSHPublicKey, SSHPrivateKey - packer \u94fe\u63a5\u7684\u5bc6\u94a5"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6761\u4ef6\u53d8\u91cf",children:"\u6761\u4ef6\u53d8\u91cf"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "type": "shell-local",\n  "command": "if [ ! -z \\"{{user `do_nexpose_scan`}}\\" ]; then python -u trigger_nexpose_scan.py; fi"\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"home",children:"HOME"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "variables": {\n    "home": "{{env `HOME`}}"\n  },\n  "builders": [\n    {\n      "type": "google",\n      "account_file": "{{ user `home` }}/.secrets/gcp-{{ user `env` }}.json"\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"communicator",children:"communicator"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/communicators",children:"communicator"})," - \u901a\u4fe1\u673a\u5236\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"none - \u4e0d\u8bbe\u7f6e\uff0c\u4e0d\u80fd\u4f7f\u7528 provisioners"}),"\n",(0,r.jsxs)(e.li,{children:["ssh\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ssh_host"}),"\n",(0,r.jsx)(e.li,{children:"ssh_port"}),"\n",(0,r.jsx)(e.li,{children:"ssh_username"}),"\n",(0,r.jsx)(e.li,{children:"ssh_password"}),"\n",(0,r.jsx)(e.li,{children:"ssh_keypair_name"}),"\n",(0,r.jsx)(e.li,{children:"temporary_key_pair_name"}),"\n",(0,r.jsx)(e.li,{children:"ssh_clear_authorized_keys"}),"\n",(0,r.jsx)(e.li,{children:"ssh_private_key_file"}),"\n",(0,r.jsx)(e.li,{children:"ssh_pty"}),"\n",(0,r.jsx)(e.li,{children:"ssh_timeout"}),"\n",(0,r.jsx)(e.li,{children:"ssh_agent_auth"}),"\n",(0,r.jsx)(e.li,{children:"ssh_disable_agent_forwarding"}),"\n",(0,r.jsx)(e.li,{children:"ssh_handshake_attempts"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_host"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_port"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_agent_auth"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_username"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_password"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_interactive"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_private_key_file"}),"\n",(0,r.jsx)(e.li,{children:"ssh_file_transfer_method"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_host"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_port"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_username"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_password"}),"\n",(0,r.jsx)(e.li,{children:"ssh_keep_alive_interval"}),"\n",(0,r.jsx)(e.li,{children:"ssh_read_write_timeout"}),"\n",(0,r.jsx)(e.li,{children:"ssh_remote_tunnels"}),"\n",(0,r.jsx)(e.li,{children:"ssh_local_tunnels"}),"\n",(0,r.jsx)(e.li,{children:"ssh_public_key"}),"\n",(0,r.jsx)(e.li,{children:"ssh_private_key"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["winrm\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"winrm_username"}),"\n",(0,r.jsx)(e.li,{children:"winrm_password"}),"\n",(0,r.jsx)(e.li,{children:"winrm_host"}),"\n",(0,r.jsx)(e.li,{children:"winrm_port"}),"\n",(0,r.jsx)(e.li,{children:"winrm_timeout"}),"\n",(0,r.jsx)(e.li,{children:"winrm_use_ssl"}),"\n",(0,r.jsx)(e.li,{children:"winrm_insecure"}),"\n",(0,r.jsx)(e.li,{children:"winrm_use_ntlm"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["docker\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Docker Builder"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "communicator": "ssh",\n  "ssh_username": "myuser",\n  "pause_before_connecting": "10m"\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"docker",children:"docker"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "builders": [\n    {\n      "type": "docker",\n      // \u57fa\u7840\u955c\u50cf\n      "image": "ubuntu",\n      // \u4e09\u9009\u4e00 commit, discard, export_path\n      // \u63d0\u4ea4\n      "commit": true,\n      // \u4e22\u5f03\n      "discard": true,\n      // \u5bfc\u51fa\u5230\u6587\u4ef6\n      "export_path": "image.tar"\n    }\n  ],\n  "post-processors": [\n    [\n      {\n        "type": "docker-import",\n        "repository": "hashicorp/packer",\n        "tag": "0.7"\n      },\n      "docker-push"\n    ]\n  ]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"qemu",children:"qemu"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u542f\u52a8\u53c2\u6570"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:"-cdrom /xxx/packer_cache/xxx.iso\n-name packer-alpine\n-vnc 127.0.0.1:92\n-boot once=d\n-netdev user,id=user.0,hostfwd=tcp::4287-:22\n-device virtio-net,netdev=user.0\n# \u6302\u8f7d\u4e3a /dev/vda\n-drive file=output-alpine/packer-alpine,if=virtio,cache=writeback,discard=ignore,format=qcow2\n-m 512M\n-machine type=pc,accel=hvf\n"})})]})}function a(n={}){const{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},3354:(n,e,s)=>{var r=s(50959),i=Symbol.for("react.element"),l=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,d=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function o(n,e,s){var r,l={},o=null,h=null;for(r in void 0!==s&&(o=""+s),void 0!==e.key&&(o=""+e.key),void 0!==e.ref&&(h=e.ref),e)c.call(e,r)&&!t.hasOwnProperty(r)&&(l[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps)void 0===l[r]&&(l[r]=e[r]);return{$$typeof:i,type:n,key:o,ref:h,props:l,_owner:d.current}}e.Fragment=l,e.jsx=o,e.jsxs=o},11527:(n,e,s)=>{n.exports=s(3354)},47214:(n,e,s)=>{s.d(e,{Z:()=>d,a:()=>c});var r=s(50959);const i={},l=r.createContext(i);function c(n){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);