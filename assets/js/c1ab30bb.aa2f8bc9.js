"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[49554],{49613:function(t,e,a){a.d(e,{Zo:function(){return N},kt:function(){return g}});var n=a(59496);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function p(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},l=Object.keys(t);for(n=0;n<l.length;n++)a=l[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)a=l[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var m=n.createContext({}),u=function(t){var e=n.useContext(m),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},N=function(t){var e=u(t.components);return n.createElement(m.Provider,{value:e},t.children)},k={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},d=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,l=t.originalType,m=t.parentName,N=p(t,["components","mdxType","originalType","parentName"]),d=u(a),g=r,o=d["".concat(m,".").concat(g)]||d[g]||k[g]||l;return a?n.createElement(o,i(i({ref:e},N),{},{components:a})):n.createElement(o,i({ref:e},N))}));function g(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=a.length,i=new Array(l);i[0]=d;var p={};for(var m in e)hasOwnProperty.call(e,m)&&(p[m]=e[m]);p.originalType=t,p.mdxType="string"==typeof t?t:r,i[1]=p;for(var u=2;u<l;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},89150:function(t,e,a){a.r(e),a.d(e,{assets:function(){return _},contentTitle:function(){return g},default:function(){return c},frontMatter:function(){return d},metadata:function(){return o},toc:function(){return s}});var n=a(49613),r=Object.defineProperty,l=Object.defineProperties,i=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,N=(t,e,a)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,k=(t,e)=>{for(var a in e||(e={}))m.call(e,a)&&N(t,a,e[a]);if(p)for(var a of p(e))u.call(e,a)&&N(t,a,e[a]);return t};const d={title:"imgproxy"},g="imgproxy",o={unversionedId:"service/media/server/imgproxy",id:"service/media/server/imgproxy",title:"imgproxy",description:"- imgproxy/imgproxy",source:"@site/../notes/service/media/server/imgproxy.md",sourceDirName:"service/media/server",slug:"/service/media/server/imgproxy",permalink:"/notes/service/media/server/imgproxy",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/media/server/imgproxy.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1657531736,formattedLastUpdatedAt:"Jul 11, 2022",frontMatter:{title:"imgproxy"},sidebar:"docs",previous:{title:"\u8d44\u6e90\u7ad9",permalink:"/notes/service/media/resource-awesome"},next:{title:"Jellyfin",permalink:"/notes/service/media/server/jellyfin"}},_={},s=[{value:"next.js",id:"nextjs",level:2}],O={toc:s};function c(t){var e,a=t,{components:r}=a,N=((t,e)=>{var a={};for(var n in t)m.call(t,n)&&e.indexOf(n)<0&&(a[n]=t[n]);if(null!=t&&p)for(var n of p(t))e.indexOf(n)<0&&u.call(t,n)&&(a[n]=t[n]);return a})(a,["components"]);return(0,n.kt)("wrapper",(e=k(k({},O),N),l(e,i({components:r,mdxType:"MDXLayout"}))),(0,n.kt)("h1",k({},{id:"imgproxy"}),"imgproxy"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",k({parentName:"li"},{href:"https://github.com/imgproxy/imgproxy"}),"imgproxy/imgproxy"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"MIT, Go"),(0,n.kt)("li",{parentName:"ul"},"JPEG, PNG, WebP, AVIF, GIF, SVG, ICO, HEIC, BMP, TIFF, and animated GIF and WebP"),(0,n.kt)("li",{parentName:"ul"},"Pro",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"PDF, MP4, GIF -> MP4, Video thumbnail"),(0,n.kt)("li",{parentName:"ul"},"\u6307\u5b9a resize \u7b97\u6cd5 linear, cubic, Lanczos3"),(0,n.kt)("li",{parentName:"ul"},"\u586b\u5145\u534a\u900f\u660e\u80cc\u666f"),(0,n.kt)("li",{parentName:"ul"},"\u56fe\u50cf\u8c03\u6574 - brightness, contrast, saturation"),(0,n.kt)("li",{parentName:"ul"},"resize \u53bb\u9510\u5316"),(0,n.kt)("li",{parentName:"ul"},"SVG \u6ce8\u5165 CSS"),(0,n.kt)("li",{parentName:"ul"},"pipeline \u5904\u7406"),(0,n.kt)("li",{parentName:"ul"},"\u81ea\u5b9a\u4e49\u6c34\u5370"),(0,n.kt)("li",{parentName:"ul"},"\u9ad8\u7ea7 JPEG \u4f18\u5316"),(0,n.kt)("li",{parentName:"ul"},"SVG \u6700\u5c0f\u5316"),(0,n.kt)("li",{parentName:"ul"},"URL \u4f20\u9012\u4f18\u5316\u53c2\u6570"),(0,n.kt)("li",{parentName:"ul"},"\u5bf9\u8c61\u68c0\u6d4b - \u66f4\u667a\u80fd\u7684\u88c1\u526a"),(0,n.kt)("li",{parentName:"ul"},"SSIM \u8d28\u91cf\u8bc4\u6d4b"),(0,n.kt)("li",{parentName:"ul"},"\u83b7\u53d6\u56fe\u50cf\u4fe1\u606f"))))),(0,n.kt)("li",{parentName:"ul"},"\u53c2\u8003",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"HELM ",(0,n.kt)("a",k({parentName:"li"},{href:"https://helm.imgproxy.net/"}),"https://helm.imgproxy.net/"))))),(0,n.kt)("admonition",k({},{type:"caution"}),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"imgproxy \u4e0d\u652f\u6301\u7f13\u5b58 - \u4f7f\u7528\u7f51\u5173\u7f13\u5b58",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"next/image \u9ed8\u8ba4\u4f1a\u7f13\u5b58"),(0,n.kt)("li",{parentName:"ul"},"\u63a8\u8350 varnish"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",k({parentName:"li"},{href:"https://www.nginx.com/blog/nginx-caching-guide/"}),"NGINX Caching")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",k({parentName:"li"},{href:"https://www.haproxy.com/blog/accelerate-your-apis-by-using-the-haproxy-cache/"}),"HAProxy Caching"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u63a8\u8350"))))))),(0,n.kt)("pre",null,(0,n.kt)("code",k({parentName:"pre"},{className:"language-bash"}),"docker run --rm -it \\\n  -e IMGPROXY_ENABLE_WEBP_DETECTION=true \\\n  -e IMGPROXY_ENABLE_AVIF_DETECTION=true \\\n  -e IMGPROXY_USE_ETAG=true \\\n  -e IMGPROXY_CACHE_CONTROL_PASSTHROUGH=true \\\n  -e IMGPROXY_ENABLE_CLIENT_HINTS=true \\\n  -p 8080:8080 \\\n  --name imgproxy darthsim/imgproxy\n")),(0,n.kt)("pre",null,(0,n.kt)("code",k({parentName:"pre"},{}),"/{signature}/{processing_options}/plain/{source_url}@{extension}\n/{signature}/{processing_options}/{encoded_source_url}.{extension}\n\n/insecure/pr:sharp/w:500/plain/http://example.com/images/curiosity.jpg\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"signature - \u7528\u4e8e\u907f\u514d\u5916\u90e8\u4fee\u6539\u53c2\u6570",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"base64(hmac(key,salt+path))"),(0,n.kt)("li",{parentName:"ul"},"\u5982\u679c\u6ca1\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u7528 insecure"))),(0,n.kt)("li",{parentName:"ul"},"processing_options",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"%option_name:%argument1:%argument2:...:argumentN"))),(0,n.kt)("li",{parentName:"ul"},"encoded_source_url=base64(url)",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u5206 segment")))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",k({parentName:"tr"},{align:null}),"option"),(0,n.kt)("th",k({parentName:"tr"},{align:null})),(0,n.kt)("th",k({parentName:"tr"},{align:null}),"default"),(0,n.kt)("th",k({parentName:"tr"},{align:null})))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"resize,rs"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"%resizing_type:%width:%height:%enlarge:%extend"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"size,s"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"%width:%height:%enlarge:%extend"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"resizing_type,rt"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"%resizing_type"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"fit"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"fit,fill,fill-down,force,auto")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"resizing_algorithm,ra"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"%algorithm"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"lanczos3"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"nearest, linear, cubic, lanczos2, lanczos3")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"zoom,z"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"dpr"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"enlarge,el"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"extend,ex"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"%extend:%gravity"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))))),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"{min}-{width,height}"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",k({parentName:"li"},{href:"https://docs.imgproxy.net/generating_the_url"}),"https://docs.imgproxy.net/generating_the_url"))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",k({parentName:"tr"},{align:null}),"env"),(0,n.kt)("th",k({parentName:"tr"},{align:null})),(0,n.kt)("th",k({parentName:"tr"},{align:null})))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_KEY"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"hex(key)"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_SALT"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"hex(salt)"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_SIGNATURE_SIZE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"32"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_READ_TIMEOUT"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"10"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_WRITE_TIMEOUT"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"10"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_KEEP_ALIVE_TIMEOUT"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"10"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_DOWNLOAD_TIMEOUT"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"5"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_CONCURRENCY"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"nprc","*","2"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_MAX_CLIENTS"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_CONCURRENCY","*","10"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_TTL"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"3600"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_CACHE_CONTROL_PASSTHROUGH"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_USE_ETAG"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ENABLE_DEBUG_HEADERS"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_MAX_SRC_RESOLUTION"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"16.8"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_MAX_SRC_FILE_SIZE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"0"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_MAX_ANIMATION_FRAMES"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"1"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_MAX_SVG_CHECK_BYTES"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"32768"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_MAX_REDIRECTS"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_SECRET"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ALLOW_ORIGIN"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ALLOWED_SOURCES"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_SANITIZE_SVG"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"true"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_IGNORE_SSL_VERIFICATION"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_DEVELOPMENT_ERRORS_MODE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_COOKIE_PASSTHROUGH"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_COOKIE_BASE_URL"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_QUALITY"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"80"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_FORMAT_QUALITY"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"avif=50"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_JPEG_PROGRESSIVE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_PNG_INTERLACED"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_PNG_QUANTIZE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_PNG_QUANTIZATION_COLORS"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"256"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"2-256")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_AVIF_SPEED"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"5"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"0-6")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ENABLE_WEBP_DETECTION"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ENFORCE_WEBP"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ENABLE_AVIF_DETECTION"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ENFORCE_AVIF"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ENABLE_CLIENT_HINTS"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),(0,n.kt)("inlineCode",{parentName:"td"},"IMGPROXY_WATERMARK_{DATA,PATH,URL}")),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_WATERMARK_OPACITY"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),(0,n.kt)("inlineCode",{parentName:"td"},"IMGPROXY_FALLBACK_IMAGE_{DATA,PATH,URL}")),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_FALLBACK_IMAGE_HTTP_CODE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"200"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_FALLBACK_IMAGE_TTL"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_TTL"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_SKIP_PROCESSING_FORMATS"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_PRESETS"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_ONLY_PRESETS"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_LOCAL_FILESYSTEM_ROOT"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_USE_S3"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_S3_ENDPOINT"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_PROMETHEUS_BIND"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_PROMETHEUS_NAMESPACE"),(0,n.kt)("td",k({parentName:"tr"},{align:null})),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_RETURN_ATTACHMENT"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"false"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_AUTO_ROTATE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"true"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_STRIP_COLOR_PROFILE"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"true"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_KEEP_COPYRIGHT"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"true"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",k({parentName:"tr"},{align:null}),"IMGPROXY_STRIP_METADATA"),(0,n.kt)("td",k({parentName:"tr"},{align:null}),"true"),(0,n.kt)("td",k({parentName:"tr"},{align:null}))))),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u63a8\u8350",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_ENABLE_WEBP_DETECTION=true"),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_ENABLE_AVIF_DETECTION=true"),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_USE_ETAG=true"),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_CACHE_CONTROL_PASSTHROUGH=true",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u6e90\u56fe\u7247\u7684\u7f13\u5b58\u5934\u4fe1\u606f"))),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_ENABLE_CLIENT_HINTS"))),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_ENABLE_CLIENT_HINTS",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u4f7f\u7528 Width, Viewport-Width, DPR \u5934\u68c0\u6d4b\u5bbd\u5ea6"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",k({parentName:"li"},{href:"https://developer.chrome.com/blog/automating-resource-selection-with-client-hints/"}),"Automating resource selection with client hints")),(0,n.kt)("li",{parentName:"ul"},"DPR -> device pixel ratio"),(0,n.kt)("li",{parentName:"ul"},"CH -> Client Hints"),(0,n.kt)("li",{parentName:"ul"},"mdn ",(0,n.kt)("a",k({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-CH"}),"Accept-CH"))))),(0,n.kt)("pre",null,(0,n.kt)("code",k({parentName:"pre"},{className:"language-html"}),'\x3c!-- Chrome 46+ --\x3e\n<meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width" />\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_ETAG_BUSTER - \u4fee\u6539\u540e\u6240\u6709 ETag \u53d1\u751f\u53d8\u5316"),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_ENABLE_DEBUG_HEADERS=true",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"X-Origin-Content-Length"),(0,n.kt)("li",{parentName:"ul"},"X-Origin-Width"),(0,n.kt)("li",{parentName:"ul"},"X-Origin-Height"),(0,n.kt)("li",{parentName:"ul"},"X-Result-Width"),(0,n.kt)("li",{parentName:"ul"},"X-Result-Height"))),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_MAX_SRC_RESOLUTION - \u6700\u5927\u50cf\u7d20 - \u5355\u4f4d\u767e\u4e07"),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_MAX_SRC_FILE_SIZE - \u6700\u5927\u6e90\u6587\u4ef6 - \u5355\u4f4d \u5b57\u8282"),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_MAX_ANIMATION_FRAMES - \u5904\u7406\u7684\u52a8\u753b\u5e27\u6570"),(0,n.kt)("li",{parentName:"ul"},"IMGPROXY_SECRET - \u8981\u6c42\u5ba2\u6237\u7aef\u5e26 Authorization")),(0,n.kt)("h2",k({},{id:"nextjs"}),"next.js"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",k({parentName:"li"},{href:"https://github.com/BitPatty/next-image-s3-imgproxy-loader"}),"https://github.com/BitPatty/next-image-s3-imgproxy-loader")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",k({parentName:"li"},{href:"https://jamesku.cc/blog/imgproxy"}),"https://jamesku.cc/blog/imgproxy"))))}c.isMDXComponent=!0}}]);