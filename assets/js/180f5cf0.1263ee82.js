"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[48853],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),o=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=o(e.components);return a.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=o(n),d=r,k=m["".concat(u,".").concat(d)]||m[d]||p[d]||l;return n?a.createElement(k,i(i({ref:t},c),{},{components:n})):a.createElement(k,i({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var o=2;o<l;o++)i[o]=n[o];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},76525:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return u},metadata:function(){return o},toc:function(){return c},default:function(){return m}});var a=n(87462),r=n(63366),l=(n(67294),n(3905)),i=["components"],s={title:"CubeJS"},u=void 0,o={unversionedId:"service/bi/cubejs",id:"service/bi/cubejs",title:"CubeJS",description:"- cube-js/cube.js",source:"@site/notes/service/bi/cubejs.md",sourceDirName:"service/bi",slug:"/service/bi/cubejs",permalink:"/notes/service/bi/cubejs",editUrl:"https://github.com/wenerme/wener/edit/master/notes/service/bi/cubejs.md",tags:[],version:"current",frontMatter:{title:"CubeJS"},sidebar:"docs",previous:{title:"Apache Superset",permalink:"/notes/service/bi/apache-superset"},next:{title:"CubeJS \u914d\u7f6e",permalink:"/notes/service/bi/cubejs-conf"}},c=[{value:"API",id:"api",children:[],level:2},{value:"Notes",id:"notes",children:[],level:2},{value:"cubestore",id:"cubestore",children:[],level:2},{value:"Helm",id:"helm",children:[],level:2},{value:"container",id:"container",children:[],level:2},{value:"\u8f6c\u8bd1\u903b\u8f91",id:"\u8f6c\u8bd1\u903b\u8f91",children:[],level:2}],p={toc:c};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/cube-js/cube.js"},"cube-js/cube.js"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"MIT+Apache-2.0,"),(0,l.kt)("li",{parentName:"ul"},"Analytics API for Building Data Apps"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\uff0c\u4e5f\u53ef\u4ee5 Node \u96c6\u6210"),(0,l.kt)("li",{parentName:"ul"},"\u6570\u636e\u5e93\u652f\u6301: Postgres,MySQL,ClickHouse,PrestoDB,Druid,Elasticsearch,SQLite"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u591a\u79df\u6237"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u751f\u6210\u524d\u7aef\u7ec4\u4ef6",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"React UI \u57fa\u4e8e AntD"))),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301 JWT Auth"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301 Redis \u7f13\u5b58"),(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4f9b REST API"),(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4f9b SQL API",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u5bf9\u63a5\u5916\u90e8\u7cfb\u7edf - \u4f8b\u5982 exporter \u76f4\u63a5\u6293\u53d6\u4f5c\u4e3a metrics"))),(0,l.kt)("li",{parentName:"ul"},"Request JSON Object + Schema => SQL")))),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"port"),(0,l.kt)("th",{parentName:"tr",align:null},"for"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4000/http"),(0,l.kt)("td",{parentName:"tr",align:null},"frontend")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3031/http"),(0,l.kt)("td",{parentName:"tr",align:null},"Serving status probes")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"13306/mysql"),(0,l.kt)("td",{parentName:"tr",align:null},"cubestore")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3030/http"),(0,l.kt)("td",{parentName:"tr",align:null},"cubestore")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u5efa\u8bae\u5185\u5d4c Cube.js \u5230\u73b0\u6709 Express \u5e94\u7528\uff0c\u5efa\u8bae\u901a\u8fc7 \u5305 \u6269\u5c55"),(0,l.kt)("li",{parentName:"ul"},"web \u4e0d\u652f\u6301\u914d\u7f6e postgresql ssl")))),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"Postgres can not work with table names that longer than 64 symbols",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 sqlAlias \u89e3\u51b3 schema+table \u540d\u5b57\u8fc7\u957f\u7684\u95ee\u9898")))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# http://localhost:4000\ndocker run -p 4000:4000 \\\n  -v ${PWD}:/cube/conf \\\n  -e CUBEJS_DEV_MODE=true \\\n  cubejs/cube:alpine\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini",metastring:'title=".env"',title:'".env"'},"CUBEJS_DB_TYPE=postgres\nCUBEJS_DB_HOST=192.168.1.2\nCUBEJS_DB_PORT=5432\nCUBEJS_DB_NAME=demo\nCUBEJS_DB_USER=demo\nCUBEJS_DB_PASS=\nCUBEJS_DB_SSL=false\n")),(0,l.kt)("h2",{id:"api"},"API"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Query \u652f\u6301 JSON \u4e5f\u652f\u6301 SQL \u67e5\u8be2 - MySQL \u517c\u5bb9\u534f\u8bae")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-http"},'### Load data\nPOST http://localhost:4000/cubejs-api/v1/load\nContent-Type: application/json\n\n{"query": {"measures":["Users.count"]}}\n\n### SQL\nGET http://localhost:4000/cubejs-api/v1/sql?query={"measures":["Users.count"]}\n\n### Meta\nGET http://localhost:4000/cubejs-api/v1/meta\n\n### Trigger refresh\nGET http://localhost:4000/cubejs-api/v1/run-scheduled-refresh?queryingOptions={"timezone":"UTC"}\n\n### ready\nGET http://localhost:4000/readyz\n\n### live\nGET http://localhost:4000/livez\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="query"',title:'"query"'},'{\n  "measures": ["Stories.count"],\n  "dimensions": ["Stories.category"],\n  "filters": [\n    {\n      // dimension or measure\n      "member": "Stories.isDraft",\n      // \u652f\u6301\u7684\u64cd\u4f5c - \u7c7b\u578b\u4e5f\u4f1a\u5f71\u54cd\n      // equals, notEquals, contains, notContains\n      // gt, gte, lt, lte\n      // set, notSet\n      // inDateRange, notInDateRange, beforeDate, afterDate\n      "operator": "equals",\n      // date YYYY-MM-DD\n      "values": ["No"]\n    },\n    // \u903b\u8f91\n    {\n      "or": [{ "and": [] }]\n    }\n  ],\n  "timeDimensions": [\n    {\n      "dimension": "Stories.time",\n      // \u652f\u6301\u76f8\u5bf9\u503c\n      // today, yesterday, tomorrow, last year, next month, last 6 months, last week\n      // \u652f\u6301\u7279\u6b8a\u8303\u56f4\n      // from N days ago to now or from now to N days from now\n      "dateRange": ["2015-01-01", "2015-12-31"],\n      "granularity": "month",\n      // \u6bd4\u8f83\n      "compareDateRange": ["this week", ["2020-05-21", "2020-05-28"]]\n    }\n  ],\n  "limit": 100,\n  "offset": 50,\n  // order: {"Stories.time": "asc"}\n  "order": [\n    ["Stories.time", "asc"],\n    ["Stories.count", "asc"]\n  ],\n  "timezone": "Asia/Shanghai"\n}\n')),(0,l.kt)("h2",{id:"notes"},"Notes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"@cubejs-backend/server",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u72ec\u7acb\u670d\u52a1\uff0c\u5305\u542b\u6240\u6709 driver"))),(0,l.kt)("li",{parentName:"ul"},"@cubejs-backend/server-core",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6838\u5fc3\u5305\uff0c\u7528\u4e8e\u81ea\u5b9a\u4e49\u6269\u5c55"))),(0,l.kt)("li",{parentName:"ul"},"@cubejs-client/{core,react,ngx,vue,ws-transport}",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"react",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"dashboard \u57fa\u4e8e antd"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/cube-js/cube.js/tree/master/examples/real-time-dashboard"},"real-time-dashboard")),(0,l.kt)("li",{parentName:"ul"},"\u7f13\u5b58 redis, memory"),(0,l.kt)("li",{parentName:"ul"},"\u6269\u5c55\u65b9\u5f0f",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u914d\u7f6e\uff0c\u52a8\u6001 fetch schema"),(0,l.kt)("li",{parentName:"ul"},"\u57fa\u4e8e @cubejs-backend")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# -d postgres, mysql, athena, mongobi, bigquery, redshift, mssql, clickhouse, snowflake, presto, druid\n# -t docker, express, serverless, serverless-aws\nnpx -y cubejs-cli create demo-cube -d postgres\ncd demo-cube\nnpx cubejs-cli server --debug\n\ncubejs generate -t users,user_profiles\n# Geneate JWT\n# -e 1 day, 30 days\n# -s CUBEJS_API_SECRET\n# -u USER_CONTEXT\n# CUBEJS_DEV_MODE\n# token -e "30 days" -p appId=1 -p userId=2 -u tenantId=12\n')),(0,l.kt)("h2",{id:"cubestore"},"cubestore"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Apache 2.0, Rust"),(0,l.kt)("li",{parentName:"ul"},"\u9884\u805a\u5408"),(0,l.kt)("li",{parentName:"ul"},"distributed"),(0,l.kt)("li",{parentName:"ul"},"WIP: \u5916\u90e8\u5b58\u50a8 MySQL & Postgres"),(0,l.kt)("li",{parentName:"ul"},"RocksDB, Apache Parquet, Apache Arrow, datafusion"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/apache/arrow-datafusion"},"https://github.com/apache/arrow-datafusion")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/cube-js/cube.js/tree/master/rust"},"https://github.com/cube-js/cube.js/tree/master/rust")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://cube.dev/blog/introducing-cubestore/"},"https://cube.dev/blog/introducing-cubestore/"))),(0,l.kt)("h2",{id:"helm"},"Helm"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u793e\u533a\u7ef4\u62a4\uff0c\u8d28\u91cf\u4e00\u822c"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/cube-js/cube.js/tree/master/examples/helm-charts"},"https://github.com/cube-js/cube.js/tree/master/examples/helm-charts"))),(0,l.kt)("h2",{id:"container"},"container"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/cube-js/cube.js/tree/master/packages/cubejs-docker"},"packages/cubejs-docker")),(0,l.kt)("li",{parentName:"ul"},"cubejs/cube:v0.28.59-alpine",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u76ee\u524d\u6ca1\u6709\u5220\u9664 yarn cache \u6bd4\u8f83\u5927"))),(0,l.kt)("li",{parentName:"ul"},"workdir /cube/conf"),(0,l.kt)("li",{parentName:"ul"},"\u5305\u542b\u6240\u6709\u9a71\u52a8+@cubejs-backend/server+typescript"),(0,l.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u6267\u884c cubejs server")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --rm -it \\\n  -p 4000:4000 \\\n  -v $PWD:/cube/conf \\\n  cubejs/cube:v0.28.59-alpine\n")),(0,l.kt)("h1",{id:"faq"},"FAQ"),(0,l.kt)("h2",{id:"\u8f6c\u8bd1\u903b\u8f91"},"\u8f6c\u8bd1\u903b\u8f91"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"cube(`Users`, {\n  measures: {\n    count: {\n      type: `count`,\n    },\n    // before\n    ratio: {\n      sql: `sum(${CUBE}.amount) / ${count}`,\n      type: `number`,\n    },\n    // after\n    // \u56e0\u6b64\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5199\u51fd\u6570\n    ratio: {\n      sql: (CUBE, count) => `sum(${CUBE}.amount) / ${count}`,\n      type: `number`,\n    },\n  },\n});\n")))}m.isMDXComponent=!0}}]);