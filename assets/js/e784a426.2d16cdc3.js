"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[33675],{49613:function(n,e,t){t.d(e,{Zo:function(){return p},kt:function(){return d}});var r=t(59496);function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function o(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function i(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){a(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,r,a=function(n,e){if(null==n)return{};var t,r,a={},o=Object.keys(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||(a[t]=n[t]);return a}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(a[t]=n[t])}return a}var c=r.createContext({}),l=function(n){var e=r.useContext(c),t=e;return n&&(t="function"==typeof n?n(e):i(i({},e),n)),t},p=function(n){var e=l(n.components);return r.createElement(c.Provider,{value:e},n.children)},u={inlineCode:"code",wrapper:function(n){var e=n.children;return r.createElement(r.Fragment,{},e)}},f=r.forwardRef((function(n,e){var t=n.components,a=n.mdxType,o=n.originalType,c=n.parentName,p=s(n,["components","mdxType","originalType","parentName"]),f=l(t),d=a,g=f["".concat(c,".").concat(d)]||f[d]||u[d]||o;return t?r.createElement(g,i(i({ref:e},p),{},{components:t})):r.createElement(g,i({ref:e},p))}));function d(n,e){var t=arguments,a=e&&e.mdxType;if("string"==typeof n||a){var o=t.length,i=new Array(o);i[0]=f;var s={};for(var c in e)hasOwnProperty.call(e,c)&&(s[c]=e[c]);s.originalType=n,s.mdxType="string"==typeof n?n:a,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},48337:function(n,e,t){t.r(e),t.d(e,{assets:function(){return m},contentTitle:function(){return d},default:function(){return w},frontMatter:function(){return f},metadata:function(){return g},toc:function(){return k}});var r=t(49613),a=Object.defineProperty,o=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,p=(n,e,t)=>e in n?a(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,u=(n,e)=>{for(var t in e||(e={}))c.call(e,t)&&p(n,t,e[t]);if(s)for(var t of s(e))l.call(e,t)&&p(n,t,e[t]);return n};const f={title:"strongSwan \u914d\u7f6e",tags:["Configuration"]},d="strongSwan \u914d\u7f6e",g={unversionedId:"service/network/strongswan-conf",id:"service/network/strongswan-conf",title:"strongSwan \u914d\u7f6e",description:"- ConfigurationFiles",source:"@site/../notes/service/network/strongswan-conf.md",sourceDirName:"service/network",slug:"/service/network/strongswan-conf",permalink:"/notes/service/network/strongswan-conf",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/network/strongswan-conf.md",tags:[{label:"Configuration",permalink:"/notes/tags/configuration"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1646989992,formattedLastUpdatedAt:"Mar 11, 2022",frontMatter:{title:"strongSwan \u914d\u7f6e",tags:["Configuration"]},sidebar:"docs",previous:{title:"sshuttle",permalink:"/notes/service/network/sshuttle"},next:{title:"strongSwan Cookbook",permalink:"/notes/service/network/strongswan-cookbook"}},m={},k=[{value:"strongswan.conf",id:"strongswanconf",level:2},{value:"strongswan.d",id:"strongswand",level:3},{value:"swanctl.conf",id:"swanctlconf",level:2},{value:"ipsec.conf",id:"ipsecconf",level:2},{value:"\u81ea\u52a8\u91cd\u8fde",id:"\u81ea\u52a8\u91cd\u8fde",level:2},{value:"ipsec.conf to swanctl.conf",id:"ipsecconf-to-swanctlconf",level:2}],h={toc:k};function w(n){var e,t=n,{components:a}=t,p=((n,e)=>{var t={};for(var r in n)c.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&s)for(var r of s(n))e.indexOf(r)<0&&l.call(n,r)&&(t[r]=n[r]);return t})(t,["components"]);return(0,r.kt)("wrapper",(e=u(u({},h),p),o(e,i({components:a,mdxType:"MDXLayout"}))),(0,r.kt)("h1",u({},{id:"strongswan-\u914d\u7f6e"}),"strongSwan \u914d\u7f6e"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://wiki.strongswan.org/projects/strongswan/wiki/ConfigurationFiles"}),"ConfigurationFiles"))),(0,r.kt)("h2",u({},{id:"strongswanconf"}),"strongswan.conf"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://wiki.strongswan.org/projects/strongswan/wiki/StrongswanConf"}),"strongswan.conf"))),(0,r.kt)("p",null,"Daemon \u914d\u7f6e, \u9ed8\u8ba4\u662f stroke \u63d2\u4ef6, starter \u542f\u52a8 ipsec.conf"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"${sysconfdir} - ${prefix}/etc"),(0,r.kt)("li",{parentName:"ul"},"${piddir} - /var/run")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u57fa\u7840\u914d\u7f6e")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{}),"charon {\n    load_modular = yes\n    plugins {\n        include strongswan.d/charon/*.conf\n    }\n}\n\ninclude strongswan.d/*.conf\n")),(0,r.kt)("h3",u({},{id:"strongswand"}),"strongswan.d"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"charon/ - \u63d2\u4ef6\u914d\u7f6e\u76ee\u5f55"),(0,r.kt)("li",{parentName:"ul"},"charon-logging.conf"),(0,r.kt)("li",{parentName:"ul"},"charon.conf"),(0,r.kt)("li",{parentName:"ul"},"pki.conf"),(0,r.kt)("li",{parentName:"ul"},"pool.conf"),(0,r.kt)("li",{parentName:"ul"},"scepclient.conf"),(0,r.kt)("li",{parentName:"ul"},"starter.conf"),(0,r.kt)("li",{parentName:"ul"},"swanctl.conf")),(0,r.kt)("h2",u({},{id:"swanctlconf"}),"swanctl.conf"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://wiki.strongswan.org/projects/strongswan/wiki/Swanctlconf"}),"swanctl.conf")),(0,r.kt)("li",{parentName:"ul"},"/etc/swanctl/swanctl.conf")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{}),"connections {\n  connection-name {\n    # 0 - \u54cd\u5e94 IKEv1, IKEv2; \u4f7f\u7528 IKEv2\n    # 1 - IKEv1/ISAKMP\n    # 2 - IKEv2\n    version=0\n\n    # XFRM\n    if_id_in=0\n    if_id_out=0\n\n    # ipsec left\n    # \u6dfb\u52a0\u540e\u7f00\u6307\u5b9a\u591a\u4e2a local-2, local-3\n    local {\n    }\n    # ipsec right\n    remote {\n    }\n    children {\n      child-name {\n      }\n    }\n  }\n}\n# \u865a\u62df\u5730\u5740\n# ipsec rightsourceip, rightdns\npools {\n}\n# \u7c7b\u4f3c ipsec.secrets\nsecrets {\n}\n# ipsec.conf ca\nauthorities {\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"connections.<conn>.remote<suffix>.auth")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"connections.<conn>.children.<child>.local_ts"))),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"# connections\nswanctl --load-conns\n# pools\nswanctl --load-pools\n# secrets\nswanctl --load-creds\n# authorities\nswanctl --load-authorities\n")),(0,r.kt)("h2",u({},{id:"ipsecconf"}),"ipsec.conf"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://wiki.strongswan.org/projects/strongswan/wiki/IKEv2CipherSuites"}),"IKEv2 Cipher Suites")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://wiki.strongswan.org/projects/strongswan/wiki/IpsecConf"}),"ipsec.conf")),(0,r.kt)("li",{parentName:"ul"},"/etc/ipsec.conf")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ini"}),"# \u901a\u7528\u914d\u7f6e\nconfig setup\n# \u53ef\u5305\u542b\u5916\u90e8\u914d\u7f6e\n# include ipsec.*.conf\n\n  cachecrls=no\n  # dmn, mgr, ike, chd, job, cfg, knl, net, asn, enc, lib, esp, tls, tnc, imc, imv, pts\n  # -1,0,1,2,3,4\n  # charondebug=dmn 3, ike 1, net -1\n  # IKE charon daemon\n  charonstart=yes\n  # yes | ifuri | no\n  strictcrlpolicy=no\n  # yes | no | never | replace | keep\n  uniqueids = yes\n\n  # 5.0.0 \u4e4b\u524d IKEv1 pluto daemon \u6709\u5176\u4ed6\u914d\u7f6e\u9879\u76ee\n\n# \u5b9a\u4e49\u8fde\u63a5\n# conn <name>\n# \u9ed8\u8ba4\u8fde\u63a5\u914d\u7f6e\nconn %default\n\n# \u5b9a\u4e49 CA\n# ca <name>\n# \u9ed8\u8ba4 CA \u914d\u7f6e\nca %default\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"conn")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ini"}),"# IKEv2 EAP auth \u65f6 AAA \u540e\u7aef\u6807\u8bc6\u7b26\n# aaa_identity = <id>\n\n# \u4e0e esp \u914d\u7f6e\u4e92\u65a5 - \u9ed8\u8ba4 esp\n# ah = <cipher suites>\n\n# IKEv1 Aggressive or Main Mode\naggressive=no\n\n# \u5305\u542b\u5176\u4ed6 section \u914d\u7f6e\n# also = <name>\n\n# pubkey | rsasig | ecdsasig | psk | secret | xauthrsasig | xauthpsk | never\nauthby = pubkey\n\n# ignore | add | route | start\n# add - \u52a0\u8f7d\u4e0d\u542f\u52a8, route - \u52a0\u8f7d\u5b89\u88c5 trap \u5982\u679c\u5339\u914d leftsubnet rightsubnet \u5219\u542f\u52a8, start - \u52a0\u8f7d\u542f\u52a8,\nauto = ignore\n\n# \u8fdc\u7a0b\u610f\u5916\u5173\u95ed\u8fde\u63a5\u65f6\u89e6\u53d1\u52a8\u4f5c\n# none | clear | hold | restart\ncloseaction = none\n\n# IPComp \u5185\u5bb9\u538b\u7f29 - \u5728\u52a0\u5bc6\u524d\ncompress = no\n\n# Dead Peer Detection\n# none | clear | hold | restart\n# hold - \u5b89\u88c5 trap \u5339\u914d\u7684\u65f6\u5019\u518d\u91cd\u65b0\u534f\u5546\u8fde\u63a5\ndpdaction = none\ndpddelay = 30s\ndpdtimeout = 150s\n\n# \u4e0d\u6d3b\u8dc3\u8d85\u65f6\u540e\u5173\u95ed\u8fde\u63a5\n# inactivity = <time>\n\n# %identity - EAP Identity method\n# eap_identity = <id>\nesp = aes128-sha256\n\n# \u5f3a\u5236 udp \u5c01\u88c5 esp \u5305 - \u5373\u4fbf\u6ca1\u6709\u68c0\u6d4b\u5230 NAT\nforceencaps = no\n# yes | accept | force | no\nfragmentation = yes\n\nike = aes128-sha256-modp3072\nikedscp = 000000\n# keying channel \u8fde\u63a5 (ISAKMP , IKE SA) \u751f\u547d\u5468\u671f - \u5230\u671f\u4ece\u65b0\u534f\u5546\nikelifetime = 3h\ninstallpolicy = yes\n# ike | ikev1 | ikev2\n# ike \u53d1\u8d77 ikev2 \u4f46\u4e5f\u63a5\u53d7 ikev1\nkeyexchange = ike\n# \u534f\u5546\u91cd\u8bd5\u6b21\u6570\nkeyingtries = 3 # %forever\n\n# lifebytes = <number>\n# lifepackets = <number>\nlifetime = 1h\n\n# marginbytes = <number>\n# marginpackets = <number>\nmargintime = 9m\n\n# xfrm \u8fde\u63a5 mark\n# mark = <value>[/<mask>]\n# mark_in = <value>[/<mask>]\n# mark_our = <value>[/<mask>]\n\nmobike = yes\n\n# push | pull\nmodeconfig = pull\n\nreauth = yes\nrekey = yes\nrekeyfuzz = 100%\nreplay_window = -1\n\n# reqid = <number>\nsha256_96 = no\n# tfc = <value>\n\n# tunnel | transport | transport_proxy | passthrough | drop\n# tunnel - host-to-host, host-to-subnet, subnet-to-subnet\n# transport - host-to-host\n# transport_proxy - Mobile IPv6 transport proxy\n# passthrough - \u65e0 ipsec \u5904\u7406\ntype = tunnel\n\n# client | server\nxauth = client\n# xauth_identity = <id>\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"left|right")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4 left \u4e3a\u672c\u5730")),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ini"}),"# <ip address> | <fqdn> | %any | %any4 | %any6 | range | subnet\n# %any - \u534f\u5546\u65f6\u81ea\u52a8\u586b\u5145\n# %defaultroute - 5.0 \u4e4b\u524d\u7684 %any\n# % \u524d\u7f00\u9690\u542b rightallowany=yes\nright=%any\nrightallowany=no\n\n# rightauth = <auth method>\n# rightauth2 = <auth method>\n# rightca = <issuer dn> | %same\n# rightca2 = <issuer dn> | %same\n# rightcert = <path>\n# rightcert2 = <path>\n# rightcertpolicy = <OIDs>\n# rightdns = <servers>\nrightfirewall = no\n# rightgroups = <group list>\n# rightgroups2 = <group list>\nrighthostaccess = no\n# rightid = <id>\n# rightid2 = <id>\nrightikeport = <port>\nrightprotoport = <protocol>/<port>\nrightrsasigkey = <raw rsa public key> | <path to public key>\nrightsigkey = <raw public key> | <path to public key>\n# never | no | ifasked | always | yes\nrightsendcert = ifasked\n\n# \u865a\u62df IP\n# 5.0.1 \u4e4b\u540e\u652f\u6301 \u9017\u53f7 \u5206\u5272\u591a\u4e2a\u503c - \u591a\u4e2a IP\n# %config, %cfg, %modeconfig, %modecfg\n# leftsourceip = %config4 | %config6 | <ip address>\n\n# rightsourceip = %config | <network>/<netmask> | <from>-<to> | %poolname\n\n# \u9ed8\u8ba4 left/32|128\n# \u9650\u5b9a\u534f\u8bae\u548c\u7aef\u53e3 - 10.0.0.1[tcp/http],fec1::1[udp],10.0.0.0/16[/53]\n# 5.1.0 - \u5ffd\u7565\u7684\u503c\u53ef\u4f7f\u7528 %any - fec1::1[udp/%any],10.0.0.0/16[%any/53]\n# %opaque RFC 4301 OPAQUE \u534f\u8bae\u9009\u62e9\n# %dynamic \u7b49\u540c\u4e8e\u5ffd\u7565\u8be5\u914d\u7f6e\n# rightsubnet = <ip subnet>[[<proto/port>]][,...]\n# \u811a\u672c\u76ee\u5f55\n# rightupdown = <path>\n\n# Mediation Extension\nmediation = no\n# mediated_by = <name>\n# me_peerid = <id>\n")),(0,r.kt)("h1",u({},{id:"faq"}),"FAQ"),(0,r.kt)("h2",u({},{id:"\u81ea\u52a8\u91cd\u8fde"}),"\u81ea\u52a8\u91cd\u8fde"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ini"}),"# \u5982\u679c\u6ca1\u7528\u5230 virtual ip\nauto=route\n\n# vip - \u91cd\u5efa SAs\ndpdaction=restart\ncloseaction=restart\nkeyingtries=%forever\nauto=start\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u53c2\u8003 ",(0,r.kt)("a",u({parentName:"p"},{href:"https://serverfault.com/a/970035/190601"}),"https://serverfault.com/a/970035/190601"))),(0,r.kt)("h2",u({},{id:"ipsecconf-to-swanctlconf"}),"ipsec.conf to swanctl.conf"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://wiki.strongswan.org/projects/strongswan/wiki/Fromipsecconf"}),"Migration from ipsec.conf to swanctl.conf"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",u({parentName:"li"},{href:"https://gitlab.com/Thermi/ipsec2swanctl"}),"Thermi/ipsec2swanctl"))))),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"curl -LO https://gitlab.com/Thermi/ipsec2swanctl/-/raw/master/ipsec2swanctl.py\n\npython3 ipsec2swanctl.py --ipsecconf /etc/ipsec.conf -o swanctl.conf -d -w\n\nswanctl --load-conns --file swanctl.conf\n")))}w.isMDXComponent=!0}}]);