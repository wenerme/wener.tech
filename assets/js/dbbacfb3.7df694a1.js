/*! For license information please see dbbacfb3.7df694a1.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[98562],{89060:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var t=s(11527),a=s(47214);const r={title:"Messaging"},o="Messaging",l={id:"web/spec/messaging",title:"Messaging",description:"- MessagePort extends EventTarget",source:"@site/../notes/web/spec/messaging.md",sourceDirName:"web/spec",slug:"/web/spec/messaging",permalink:"/notes/web/spec/messaging",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/spec/messaging.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1641222557,formattedLastUpdatedAt:"Jan 3, 2022",frontMatter:{title:"Messaging"},sidebar:"docs",previous:{title:"JavaScript \u5e38\u89c1\u95ee\u9898",permalink:"/notes/web/spec/js-faq"},next:{title:"PWA",permalink:"/notes/web/spec/pwa"}},i={},d=[{value:"MessagePort",id:"messageport",level:2},{value:"BroadcastChannel",id:"broadcastchannel",level:2},{value:"Port at index 0 is already neutered",id:"port-at-index-0-is-already-neutered",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"messaging",children:"Messaging"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["MessagePort extends EventTarget\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"postMessage"}),"\n",(0,t.jsx)(n.li,{children:"start - \u5f00\u59cb\u53d1\u9001\u6d88\u606f - \u8bbe\u7f6e onmessage \u9690\u542b start"}),"\n",(0,t.jsx)(n.li,{children:"close"}),"\n",(0,t.jsxs)(n.li,{children:["\u4e8b\u4ef6\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"message"}),"\n",(0,t.jsx)(n.li,{children:"messageerror"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"MessageChannel - port1 <-> port2"}),"\n",(0,t.jsxs)(n.li,{children:["BroadcastChannel - origin \u7eac\u5ea6 - \u591a\u7a97\u53e3\u4fe1\u606f\u4f20\u9012\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"close - \u505c\u6b62\u63a5\u53d7"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API",children:"Channel Messaging API"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://html.spec.whatwg.org/multipage/web-messaging.html",children:"web-messaging"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"demo",children:"Demo"}),"\n",(0,t.jsx)(n.h2,{id:"messageport",children:"MessagePort"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"MessagePort \u53ea\u6709 message \u4f1a\u4e92\u76f8\u4f20\u9012"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const ch = new MessageChannel();\n\n// \u975e message \u53ea\u662f\u76d1\u542c\u5f53\u524d target \u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6\nch.port1.addEventListener('Ready', (e) => {\n  console.debug(`port 1`, e.type, e.detail);\n});\nch.port1.addEventListener('message', (e) => {\n  console.debug(`port 1`, e.type, e.data);\n});\n\nch.port2.addEventListener('Ready', (e) => {\n  console.debug(`port 2`, e.type, e.detail);\n});\nch.port2.addEventListener('message', (e) => {\n  console.debug(`port 2`, e.type, e.data);\n});\n\n// \u4f1a\u76f4\u63a5\u89e6\u53d1\nch.port1.dispatchEvent(new CustomEvent('Ready', { detail: 'to port2' }));\nch.port2.dispatchEvent(new CustomEvent('Ready', { detail: 'to port1' }));\n\n// \u4e0d\u4f1a\u89e6\u53d1 - \u6ca1\u6709 start\nch.port1.postMessage({ type: 'MessageReady', detail: 'to port2' });\nch.port2.postMessage({ type: 'MessageReady', detail: 'to port1' });\n\nconsole.debug(`setup`);\n\n// \u4f7f\u7528 addEventListener \u9700\u8981\u624b\u52a8 start\nch.port1.start();\nch.port2.start();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"broadcastchannel",children:"BroadcastChannel"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53ea\u8981\u540d\u5b57\u76f8\u540c\uff0c\u5728\u4e0d\u540c Tab \u90fd\u53ef\u4ee5\u63a5\u6536\u5230"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const a = new BroadcastChannel('Auth');\nconst b = new BroadcastChannel('Auth');\nconst c = new BroadcastChannel('Auth');\n\na.addEventListener('message', (e) => console.log(`a got`, e.data));\nb.addEventListener('message', (e) => console.log(`b got`, e.data));\nc.addEventListener('message', (e) => console.log(`c got`, e.data));\n\na.postMessage({ by: 'a' });\nb.postMessage({ by: 'b' });\nc.postMessage({ by: 'c' });\n"})}),"\n",(0,t.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(n.h2,{id:"port-at-index-0-is-already-neutered",children:"Port at index 0 is already neutered"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4e0d\u80fd\u91cd\u590d\u8fdb\u884c transfer"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://stackoverflow.com/a/38283644/1870054",children:"https://stackoverflow.com/a/38283644/1870054"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},3354:(e,n,s)=>{var t=s(50959),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,n,s){var t,r={},d=null,c=null;for(t in void 0!==s&&(d=""+s),void 0!==n.key&&(d=""+n.key),void 0!==n.ref&&(c=n.ref),n)o.call(n,t)&&!i.hasOwnProperty(t)&&(r[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===r[t]&&(r[t]=n[t]);return{$$typeof:a,type:e,key:d,ref:c,props:r,_owner:l.current}}n.Fragment=r,n.jsx=d,n.jsxs=d},11527:(e,n,s)=>{e.exports=s(3354)},47214:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>o});var t=s(50959);const a={},r=t.createContext(a);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);