/*! For license information please see 6cbb7668.101a2f23.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[99632],{22836:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var l=s(2488),r=s(62780);const t={title:"Rollup"},i="Rollup",o={id:"web/dev/bundle/rollup",title:"Rollup",description:"- rollupjs",source:"@site/../notes/web/dev/bundle/rollup.md",sourceDirName:"web/dev/bundle",slug:"/web/dev/bundle/rollup",permalink:"/notes/web/dev/bundle/rollup",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/dev/bundle/rollup.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1684216634,formattedLastUpdatedAt:"May 16, 2023",frontMatter:{title:"Rollup"},sidebar:"docs",previous:{title:"Rollup FAQ",permalink:"/notes/web/dev/bundle/rollup-faq"},next:{title:"snowpack",permalink:"/notes/web/dev/bundle/snowpack"}},d={},c=[{value:"Options",id:"options",level:2},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"babel+ts",id:"babelts",level:3},{value:"rollup ts",id:"rollup-ts",level:3},{value:"rollup commonjs",id:"rollup-commonjs",level:3},{value:"babel",id:"babel",level:2}];function a(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.M)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"rollup",children:"Rollup"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://rollupjs.org/",children:"rollupjs"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://rollupjs.org/repl/",children:"Repl"})}),"\n",(0,l.jsxs)(n.li,{children:["\u6ce8\u610f\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"d.ts"})," \u9700\u8981\u4f7f\u7528 tsc \u751f\u6210"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/rollup/awesome",children:"rollup/awesome"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://rollupjs.org/repl/",children:"https://rollupjs.org/repl/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/rollup/rollup/issues/2182",children:"#2182"})," \u4e0d\u652f\u6301\u7f13\u5b58"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/rollup/rollup/issues/2072",children:"#2072"})," UMD/IIFE \u4e0d\u652f\u6301 code splitting"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/rollup/rollup/issues/3799",children:"#3799"})," \u4e0d\u652f\u6301 assert\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/calebdwilliams/rollup-plugin-import-assert",children:"rollup-plugin-import-assert"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u652f\u6301 dynamic"}),"\n",(0,l.jsxs)(n.li,{children:["\u5bf9\u5e94\u7684 acorn \u63d2\u4ef6 ",(0,l.jsx)(n.a,{href:"https://github.com/xtuc/acorn-import-assertions",children:"xtuc/acorn-import-assertions"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["acron \u53ea\u6dfb\u52a0 stage4 \u7279\u6027 ",(0,l.jsx)(n.a,{href:"https://github.com/acornjs/acorn/issues/1111",children:"acorn#1111"})]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,l.jsxs)(n.admonition,{type:"info",children:[(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e0d\u652f\u6301 index.js ",(0,l.jsx)(n.a,{href:"https://github.com/rollup/rollup/issues/470#issuecomment-177594250",children:"#470"})]}),"\n"]}),(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u76f4\u63a5 ",(0,l.jsx)(n.code,{children:"import {abc} from 'abc/index'"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(n.a,{href:"https://github.com/rollup/plugins/tree/master/packages/node-resolve",children:"@rollup/plugin-node-resolve"})]}),"\n"]}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Mark dependency as internal? ",(0,l.jsx)(n.a,{href:"https://github.com/rollup/rollup/issues/1906",children:"#1906"})]}),"\n",(0,l.jsxs)(n.li,{children:["CommonJS \u591a\u4e86\u4e00\u5c42 default \u95ee\u9898\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/questions/33505992",children:"Babel 6 changes how it exports default"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://www.npmjs.com/package/babel-plugin-add-module-exports",children:"babel-plugin-add-module-exports"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f7f\u5176\u6062\u590d\u539f\u6709\u7684\u65b9\u5f0f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7c7b\u4f3c\u95ee\u9898\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/faastjs/faast.js/issues/36",children:"faastjs/faast.js#36"})," - Can't use default import with Babel"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u4e5f\u53ef\u4ee5\u5168\u5c40\u5b89\u88c5 - \u4f46\u662f\u6ca1\u5fc5\u8981\uff0c\u56e0\u4e3a\u901a\u5e38\u4f9d\u8d56\u5176\u4ed6\u63d2\u4ef6\n# npm install --global rollup\n\n# \u5e38\u7528\u63d2\u4ef6\n# monorepo \u63a8\u8350\u5b89\u88c5\u5728 root \u9879\u76ee\nnpm add -D rollup @rollup/plugin-{commonjs,node-resolve,replace,typescript,teser}\n\n# \u4e0d\u63a8\u8350 Babel\n# Babel + Typescript\n# yarn add -D @babel/preset-env @babel/preset-typescript\n# + React\n# yarn add -D @babel/preset-react\n\n# TS\nyarn add -D typescript tslib @rollup/plugin-typescript\n\n# rollup\n# -f amd, cjs, es, iife, umd, system\nrollup -i in.js -f es -p node-resolve -o out.js\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Format"}),(0,l.jsx)(n.th,{children:"Fullname"}),(0,l.jsx)(n.th,{children:"When"}),(0,l.jsx)(n.th,{children:"package.json"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"amd"}),(0,l.jsx)(n.td,{children:"Asynchronous Module Definition"}),(0,l.jsx)(n.td,{children:"RequireJS"}),(0,l.jsx)(n.td,{})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"cjs,commonjs"}),(0,l.jsx)(n.td,{children:"CommonJS"}),(0,l.jsx)(n.td,{children:"Node"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"main"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"es,esm,module"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"<script type=module>"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"module"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"iife"}),(0,l.jsx)(n.td,{children:"self-executing function"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"<script>"})," ",(0,l.jsx)(n.br,{})," Application"]}),(0,l.jsx)(n.td,{})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"umd"}),(0,l.jsx)(n.td,{children:"Universal Module Definition"}),(0,l.jsx)(n.td,{children:"amd, cjs, iife"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"browser"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"system,systemjs"}),(0,l.jsx)(n.td,{children:"SystemJS"}),(0,l.jsx)(n.td,{children:"SystemJS"}),(0,l.jsx)(n.td,{})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"interface Options {\n  // \u5224\u65ad\u662f\u5426\u4e3a \u5916\u90e8 \u4f9d\u8d56\n  external:\n    | (string | RegExp)[]\n    | RegExp\n    // string \u4e3a module id\n    | string\n    // isResolved - id \u662f\u5426\u7531 \u63d2\u4ef6 resolve\n    // \u53ef\u80fd\u8bf7\u6c42\u4e24\u6b21 - resolved=false, resolved=true\n    | ((id: string, parentId: string, isResolved: boolean) => boolean);\n}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://rollupjs.org/guide/en/#big-list-of-options",children:"https://rollupjs.org/guide/en/#big-list-of-options"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,l.jsx)(n.h3,{id:"babelts",children:"babel+ts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm add -D @babel/core @rollup/plugin-babel rollup-plugin-terser @rollup/plugin-node-resolve\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"export default {\n  output: {\n    // \u9ed8\u8ba4 chunk \u5305\u542b\u540d\u5b57\n    // \u652f\u6301 [format] \u66ff\u6362\n    // [name] \u4e3a manualChunks \u7ed3\u679c\u6216 this.emitFile \u7ed3\u679c\n    chunkFileNames: '[name]-[hash].js',\n    entryFileNames: '[name].js', // \u5165\u53e3 - \u652f\u6301\u76f8\u540c\u7684\u66ff\u4ee3\u903b\u8f91\n\n    // \u81ea\u5b9a\u4e49 chunk - \u591a\u9875\u5206 chunk \u52a0\u8f7d\n    manualChunks: {\n      lodash: ['lodash'], // alias: include \u7684\u5b57\u7b26\n    },\n    // id \u4e3a\u5b8c\u6574\u8def\u5f84\n    // \u4f8b\u5982 \u5c06\u76f8\u540c\u8bed\u8a00\u7ffb\u8bd1\u5408\u5e76 foo.strings.en.js,bar.strings.en.js -> shared.en.js\n    manualChunks(id, { getModuleInfo, getModuleIds }) {\n      if (id.includes('@blueprintjs/')) {\n        return 'blueprintjs';\n      }\n      if (id.includes('node_modules')) {\n        return 'vendor';\n      }\n      return undefined;\n    },\n\n    // \u63a7\u5236\u751f\u6210\u4ee3\u7801\n    generatedCode: 'es5', // \u9ed8\u8ba4 es5\n    generatedCode: {\n      preset: 'es2015',\n      arrowFunctions: true,\n      constBindings: true,\n      objectShorthand: true,\n      reservedNamesAsProps: false,\n    },\n\n    // stric, allow-extension, exports-only, false\n    // false - \u4e0d export\n    preserveEntrySignatures: 'strict',\n  },\n};\n"})}),"\n",(0,l.jsx)(n.h3,{id:"rollup-ts",children:"rollup ts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"import typescript from '@rollup/plugin-typescript';\nimport { nodeResolve } from '@rollup/plugin-node-resolve';\nimport commonjs from '@rollup/plugin-commonjs';\n\nexport default [\n  {\n    input: './src/standalone.ts',\n    output: {\n      file: `dist/standalone.umd.js`,\n      sourcemap: true,\n      format: 'umd',\n      name: 'Standalone',\n    },\n    external: [],\n    plugins: [\n      nodeResolve(),\n      commonjs(),\n      typescript({\n        tsconfig: 'tsconfig.json',\n      }),\n    ],\n  },\n];\n"})}),"\n",(0,l.jsx)(n.h3,{id:"rollup-commonjs",children:"rollup commonjs"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"import commonjs from '@rollup/plugin-commonjs';\nimport { nodeResolve } from '@rollup/plugin-node-resolve';\nimport babel from '@rollup/plugin-babel';\n\nfunction createConfig(format) {\n  return {\n    input: 'src/index.ts',\n    output: {\n      file: `dist/console-feed.${format}.js`,\n      sourcemap: true,\n      format,\n    },\n    external: ['react'],\n    plugins: [\n      nodeResolve({ browser: true, extensions: ['.js', '.jsx', '.ts', '.tsx'] }),\n      babel({\n        babelHelpers: 'bundled',\n        babelrc: false,\n        presets: [['@babel/preset-typescript', { allowNamespaces: true }], '@babel/preset-react'],\n        plugins: [\n          ['@babel/plugin-proposal-decorators', { legacy: true }],\n          ['@babel/plugin-proposal-class-properties', { loose: true }],\n        ],\n        extensions: ['.js', '.jsx', '.ts', '.tsx'],\n      }),\n      commonjs({ extensions: ['.js', '.jsx', '.ts', '.tsx'] }),\n    ],\n  };\n}\n\nexport default [createConfig('system'), createConfig('umd')];\n"})}),"\n",(0,l.jsx)(n.h2,{id:"babel",children:"babel"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/rollup/plugins/tree/master/packages/babel",children:"https://github.com/rollup/plugins/tree/master/packages/babel"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},38088:(e,n,s)=>{var l=s(96651),r=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,s){var l,t={},c=null,a=null;for(l in void 0!==s&&(c=""+s),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(a=n.ref),n)i.call(n,l)&&!d.hasOwnProperty(l)&&(t[l]=n[l]);if(e&&e.defaultProps)for(l in n=e.defaultProps)void 0===t[l]&&(t[l]=n[l]);return{$$typeof:r,type:e,key:c,ref:a,props:t,_owner:o.current}}n.Fragment=t,n.jsx=c,n.jsxs=c},2488:(e,n,s)=>{e.exports=s(38088)},62780:(e,n,s)=>{s.d(n,{I:()=>o,M:()=>i});var l=s(96651);const r={},t=l.createContext(r);function i(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);