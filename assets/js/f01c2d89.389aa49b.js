/*! For license information please see f01c2d89.389aa49b.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[76720],{45647:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>o});var l=s(2488),i=s(62780);const r={title:"\u5e38\u89c1\u95ee\u9898",tags:["FAQ"]},t="PostgreSQL FAQ",c={id:"db/relational/postgresql/postgresql-faq",title:"\u5e38\u89c1\u95ee\u9898",description:"- Errors and Messages",source:"@site/../notes/db/relational/postgresql/postgresql-faq.md",sourceDirName:"db/relational/postgresql",slug:"/db/relational/postgresql/faq",permalink:"/notes/db/relational/postgresql/faq",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/postgresql-faq.md",tags:[{label:"FAQ",permalink:"/notes/tags/faq"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1699003495,formattedLastUpdatedAt:"Nov 3, 2023",frontMatter:{title:"\u5e38\u89c1\u95ee\u9898",tags:["FAQ"]},sidebar:"docs",previous:{title:"PostgreSQL Extension",permalink:"/notes/db/relational/postgresql/extension"},next:{title:"PostgreSQL FDW",permalink:"/notes/db/relational/postgresql/fdw"}},d={},o=[{value:"\u9650\u5236",id:"\u9650\u5236",level:2},{value:"unique constraint vs unique index",id:"unique-constraint-vs-unique-index",level:2},{value:"TOAST",id:"toast",level:2},{value:"\u670d\u52a1\u91cd\u8f7d",id:"\u670d\u52a1\u91cd\u8f7d",level:2},{value:"\u7ef4\u62a4",id:"\u7ef4\u62a4",level:2},{value:"\u5347\u7ea7",id:"\u5347\u7ea7",level:2},{value:"Dump",id:"dump",level:2},{value:"CTID",id:"ctid",level:2},{value:"\u65f6\u533a\u95ee\u9898",id:"\u65f6\u533a\u95ee\u9898",level:2},{value:"NULL \u5b57\u7b26 / <code>\\0</code> \u5b57\u7b26",id:"null-\u5b57\u7b26--0-\u5b57\u7b26",level:2},{value:"unsupported Unicode escape sequence",id:"unsupported-unicode-escape-sequence",level:2},{value:"\u5207\u6362\u7528\u6237",id:"\u5207\u6362\u7528\u6237",level:2},{value:"\u5207\u6362\u6570\u636e\u5e93",id:"\u5207\u6362\u6570\u636e\u5e93",level:2},{value:"\u5bc6\u7801\u5b58\u50a8",id:"\u5bc6\u7801\u5b58\u50a8",level:2},{value:"Calculating and Saving Space in PostgreSQL",id:"calculating-and-saving-space-in-postgresql",level:2},{value:"psql \u5f00\u542f\u65f6\u95f4\u8bb0\u5f55",id:"psql-\u5f00\u542f\u65f6\u95f4\u8bb0\u5f55",level:2},{value:"\u6570\u7ec4\u7d22\u5f15",id:"\u6570\u7ec4\u7d22\u5f15",level:2},{value:"\u6570\u7ec4\u5916\u952e",id:"\u6570\u7ec4\u5916\u952e",level:2},{value:"ERROR: cannot alter type of a column used by a view or rule",id:"error-cannot-alter-type-of-a-column-used-by-a-view-or-rule",level:2},{value:"\u65f6\u95f4\u6233\u4e0a\u7684\u6beb\u79d2\u5904\u7406",id:"\u65f6\u95f4\u6233\u4e0a\u7684\u6beb\u79d2\u5904\u7406",level:2},{value:"\u67e5\u8be2\u8bed\u53e5\u7684\u6700\u5927\u5927\u5c0f",id:"\u67e5\u8be2\u8bed\u53e5\u7684\u6700\u5927\u5927\u5c0f",level:2},{value:"IN vs any",id:"in-vs-any",level:2},{value:"\u91cd\u7f6e schema",id:"\u91cd\u7f6e-schema",level:2},{value:"psql \u4f7f\u7528\u8fde\u63a5\u5b57\u7b26\u4e32",id:"psql-\u4f7f\u7528\u8fde\u63a5\u5b57\u7b26\u4e32",level:2},{value:"control reached end of trigger procedure without RETURN",id:"control-reached-end-of-trigger-procedure-without-return",level:2},{value:"query has no destination for result data",id:"query-has-no-destination-for-result-data",level:2},{value:"could not resize shared memory segment &quot;/PostgreSQL.153520683&quot; to 1073812480 bytes: No space left on device",id:"could-not-resize-shared-memory-segment-postgresql153520683-to-1073812480-bytes-no-space-left-on-device",level:2},{value:"set-returning functions are not allowed in UPDATE",id:"set-returning-functions-are-not-allowed-in-update",level:2},{value:"Tuning",id:"tuning",level:2},{value:"Sale Point",id:"sale-point",level:2},{value:"ON CONFLICT DO UPDATE command cannot affect row a second time",id:"on-conflict-do-update-command-cannot-affect-row-a-second-time",level:2},{value:"\u751f\u6210\u5217",id:"\u751f\u6210\u5217",level:2},{value:"generated vs default column",id:"generated-vs-default-column",level:2},{value:"remaining connection slots are reserved for non-replication superuser connection",id:"remaining-connection-slots-are-reserved-for-non-replication-superuser-connection",level:2},{value:"CURRENT_TIMESTAMP vs NOW",id:"current_timestamp-vs-now",level:2},{value:"ON CONFLICT DO UPDATE command cannot affect row a second time (SQLSTATE 21000)",id:"on-conflict-do-update-command-cannot-affect-row-a-second-time-sqlstate-21000",level:2},{value:"column &quot;datlastsysoid&quot; does not exist",id:"column-datlastsysoid-does-not-exist",level:2},{value:"\u67e5\u627e\u6240\u6709\u5916\u952e",id:"\u67e5\u627e\u6240\u6709\u5916\u952e",level:2},{value:"ARRAY/\u6570\u7ec4 \u5916\u952e",id:"array\u6570\u7ec4-\u5916\u952e",level:2},{value:"cannot use column reference in DEFAULT expression",id:"cannot-use-column-reference-in-default-expression",level:2},{value:"lateral vs subquery",id:"lateral-vs-subquery",level:2},{value:"union vs union all",id:"union-vs-union-all",level:2},{value:"\u5916\u952e\u9700\u8981\u5efa\u7acb\u7d22\u5f15\u4e48\uff1f",id:"\u5916\u952e\u9700\u8981\u5efa\u7acb\u7d22\u5f15\u4e48",level:2},{value:"enum vs check vs fk",id:"enum-vs-check-vs-fk",level:2},{value:"\u9884\u52a0\u8f7d table \u5230\u5185\u5b58",id:"\u9884\u52a0\u8f7d-table-\u5230\u5185\u5b58",level:2},{value:"ERROR: could not open file &quot;base/5/2704&quot;: No such file or directory",id:"error-could-not-open-file-base52704-no-such-file-or-directory",level:2},{value:"A field with precision 5, scale 4 must round to an absolute value less than 10^1",id:"a-field-with-precision-5-scale-4-must-round-to-an-absolute-value-less-than-101",level:2},{value:"the database system is in recovery mode the database system is in recovery mode",id:"the-database-system-is-in-recovery-mode-the-database-system-is-in-recovery-mode",level:2},{value:"COLLATE",id:"collate",level:2},{value:"ERROR: could not resize shared memory segment &quot;/PostgreSQL.2692148336&quot; to 1073812480 bytes: No space left on device",id:"error-could-not-resize-shared-memory-segment-postgresql2692148336-to-1073812480-bytes-no-space-left-on-device",level:2},{value:"K8S start &amp; shutdown",id:"k8s-start--shutdown",level:2},{value:"LC_MONETERY",id:"lc_monetery",level:2},{value:"there is no unique constraint matching given keys for referenced table",id:"there-is-no-unique-constraint-matching-given-keys-for-referenced-table",level:2},{value:"permission denied for table",id:"permission-denied-for-table",level:2},{value:"source for a multiple-column UPDATE item must be a sub-SELECT or ROW() expression",id:"source-for-a-multiple-column-update-item-must-be-a-sub-select-or-row-expression",level:2}];function a(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.M)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"postgresql-faq",children:"PostgreSQL FAQ"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/errcodes-appendix.html",children:"Errors and Messages"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-keywords-appendix.html",children:"SQL Key Words"})}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u65e0 Foreign Key Arrays\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"FOREIGN KEY (EACH ELEMENT OF userids) REFERENCES users,"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/a/50441059/1870054",children:"https://stackoverflow.com/a/50441059/1870054"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://commitfest.postgresql.org/17/1252/",children:"https://commitfest.postgresql.org/17/1252/"})}),"\n",(0,l.jsx)(n.li,{children:"S094"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/unsupported-features-sql-standard.html",children:"Unsupported Features"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SQL:2016"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u9650\u5236",children:"\u9650\u5236"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["db \u540d\u5b57\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6700\u957f 63 byte"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u6700\u591a 32767 \u53c2\u6570\u5360\u4f4d - ",(0,l.jsx)(n.code,{children:"?"})," - \u8303\u56f4\u4e3a smallint"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/limits.html",children:"https://www.postgresql.org/docs/current/limits.html"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"unique-constraint-vs-unique-index",children:"unique constraint vs unique index"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u6838\u5fc3\u4e1a\u52a1\u8bed\u4e49\u5c3d\u91cf\u7528 constraint"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["unique constraint\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"unique(tid,entity_id)"})," -> ",(0,l.jsx)(n.code,{children:"flow_tid_entity_id_key"})]}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u5ef6\u540e"}),"\n",(0,l.jsx)(n.li,{children:"\u901a\u8fc7 unique index \u5b9e\u73b0 - \u81ea\u52a8\u521b\u5efa"}),"\n",(0,l.jsxs)(n.li,{children:["\u9644\u5e26\u5728 TABLE \u4e0a\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"unique"})," \u5728 create table \u65f6\u5b9a\u4e49"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"alter table TABLE add unique (tid,rid,cid);"})," \u5728 create table \u4e4b\u540e\u5b9a\u4e49"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4e0d\u652f\u6301 ",(0,l.jsx)(n.code,{children:"ADD CONSTRAINT IF NOT EXISTS"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u652f\u6301 ",(0,l.jsx)(n.code,{children:"DROP CONSTRAINT IF EXISTS"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["unique index\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"create unique index on flow(tid,entity_id)"})," -> ",(0,l.jsx)(n.code,{children:"flow_tid_entity_id_idx"})]}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u5e76\u53d1"}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5 \u5e26\u6761\u4ef6"}),"\n",(0,l.jsxs)(n.li,{children:["\u72ec\u7acb INDEX \u6982\u5ff5\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u80fd\u5728 create table \u65f6\u5b9a\u4e49 - inline index \u6982\u5ff5"}),"\n",(0,l.jsx)(n.li,{children:"UNIQUE \u53ea\u662f INDEX \u7684\u4e00\u4e2a\u9650\u5236"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://stackoverflow.com/a/6804058/1870054",children:"https://stackoverflow.com/a/6804058/1870054"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"add constraint if not exists"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/questions/23542794",children:"https://stackoverflow.com/questions/23542794"})}),"\n",(0,l.jsxs)(n.li,{children:["\u90fd\u652f\u6301 UNIQUE NULLS NOT DISTINCT\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u56e0\u4e3a\u662f INDEX \u7684\u80fd\u529b"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"toast",children:"TOAST"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"TOAST = The Oversized-Attribute Storage Technique"}),"\n",(0,l.jsxs)(n.li,{children:["\u4e00\u884c 2kB - TOAST_TUPLE_THRESHOLD\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u8d85\u8fc7\u5148\u5c1d\u8bd5\u538b\u7f29\u5230 2kB - TOAST_TUPLE_TARGET\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9ed8\u8ba4 default_toast_compression=pglz, \u652f\u6301 lz4"}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u6309\u5217\u8bbe\u7f6e COMPRESSION"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u538b\u7f29\u4e0d\u8db3\uff0c\u5219\u5206 chunk \u5b58\u50a8\u5230\u5173\u8054\u7684 toast \u8868"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"TOAST \u4f7f\u7528 oid \u8ddf\u8e2a - \u6700\u591a 2^32 = 4 \u5341\u4ebf \u6761\u8bb0\u5f55"}),"\n",(0,l.jsxs)(n.li,{children:["\u5b58\u50a8\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"PLAIN - \u4e0d\u538b\u7f29\uff0c\u65e0 out-of-line - \u8d85\u8fc7\u5219\u5f02\u5e38"}),"\n",(0,l.jsx)(n.li,{children:"EXTENDED - \u538b\u7f29+out-of-line"}),"\n",(0,l.jsx)(n.li,{children:"EXTERNAL - out-of-line"}),"\n",(0,l.jsx)(n.li,{children:"MAIN - \u538b\u7f29+\u5c1d\u8bd5\u5c3d\u91cf\u4e0d out-of-line"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/storage-toast.html",children:"TOAST storage"})}),"\n",(0,l.jsxs)(n.li,{children:["wiki ",(0,l.jsx)(n.a,{href:"https://wiki.postgresql.org/wiki/TOAST",children:"TOAST"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u9ed8\u8ba4 EXTENDED\nALTER TABLE users SET STORAGE EXTENDED;\n-- \u4fee\u6539 TOAST_TUPLE_TARGET\nALTER TABLE users SET (toast_tuple_target = N);\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u670d\u52a1\u91cd\u8f7d",children:"\u670d\u52a1\u91cd\u8f7d"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"pg_ctl"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"su postgres\npg_ctl reload\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"sql"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"psql -U postgres\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT pg_reload_conf();\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"service"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"service postgresql restart\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u7ef4\u62a4",children:"\u7ef4\u62a4"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://gist.github.com/rgreenjr/3637525",children:"postgres_queries_and_commands.sql"})," - Useful PostgreSQL Queries and Commands"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5347\u7ea7",children:"\u5347\u7ea7"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://www.xf.is/2019/02/26/convert-postgresql-cluster-to-use-page-checksums/",children:"https://www.xf.is/2019/02/26/convert-postgresql-cluster-to-use-page-checksums/"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"show data_checksums"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u5305\u542b\u6240\u6709\u7248\u672c\u7684\u955c\u50cf\uff0c\u7136\u540e\u8fdb\u884c\u5347\u7ea7 - ",(0,l.jsx)(n.a,{href:"https://github.com/postgres/pgadmin4/blob/master/Dockerfile",children:"Dockerfile"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# https://github.com/tianon/docker-postgres-upgrade\ndocker run --rm \\\n  -v PGDATAOLD:/var/lib/postgresql/OLD/data \\\n  -v PGDATANEW:/var/lib/postgresql/NEW/data \\\n  tianon/postgres-upgrade:OLD-to-NEW\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pg_upgrade --old-datadir /var/lib/pgsql/data/ --new-datadir /var/lib/pgsql/10/data/ \\\n  --old-bindir /usr/bin/ --new-bindir /usr/pgsql-10/bin/\n"})}),"\n",(0,l.jsx)(n.h2,{id:"dump",children:"Dump"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/app-pg-dumpall.html",children:"pg_dumpall"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/app-pgdump.html",children:"https://www.postgresql.org/docs/current/app-pgdump.html"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/app-pgrestore.html",children:"https://www.postgresql.org/docs/current/app-pgrestore.html"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.percona.com/blog/2019/03/27/postgresql-upgrade-using-pg_dump-pg_restore/",children:"https://www.percona.com/blog/2019/03/27/postgresql-upgrade-using-pg_dump-pg_restore/"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# -Z compress\npg_dump -Fc -Z 9 -j $(nproc) --file=file.dump myDb\npg_restore -Fc -j $(nproc) file.dump\n"})}),"\n",(0,l.jsx)(n.h2,{id:"ctid",children:"CTID"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://dba.stackexchange.com/questions/203989/what-is-the-data-type-of-the-ctid-system-column-in-postgres",children:"https://dba.stackexchange.com/questions/203989/what-is-the-data-type-of-the-ctid-system-column-in-postgres"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://postgresql.verite.pro/blog/2019/04/24/oid-column.html",children:"https://postgresql.verite.pro/blog/2019/04/24/oid-column.html"})}),"\n",(0,l.jsx)(n.h2,{id:"\u65f6\u533a\u95ee\u9898",children:"\u65f6\u533a\u95ee\u9898"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"PG \u5b9e\u9645\u5b58\u50a8\u7684\u662f UTC \u4e0d\u4f1a\u5b58\u50a8\u65f6\u533a"}),"\n",(0,l.jsx)(n.li,{children:"\u65f6\u533a\u4fe1\u606f\u4f1a\u7528\u4e8e\u8f6c\u6362"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u5f53\u524d\u65f6\u533a\nshow timezone;\nshow timezone_abbreviations;\n-- \u53ef\u7528\u65f6\u533a\nSELECT * FROM pg_timezone_names;\n\n-- date \u8f6c tz \u5e94\u8be5\u662f\u6b63\u5e38\u7684\nselect ('2020-01-02'::date)::TIMESTAMPTZ;\n\n-- session \u6709\u6548\nSET TIME ZONE TO 'UTC';\nSET TIMEZONE TO 'UTC';\n-- \u4e5f\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a offset\nSET timezone=-4;\n\n-- \u5f53\u524d\u65f6\u95f4\n-- UTC \u53ef\u4ee5\u4f7f\u7528 localtime\nSELECT LOCALTIMESTAMP AT TIME ZONE 'Asia/Shanghai';\n-- timestamp \u4e0d\u663e\u793a TZ \u4fe1\u606f\nSELECT NOW()::TIMESTAMP;\n-- current_timestamp \u662f timestamptz\n-- \u53ef\u4ee5\u63d0\u53d6 tz \u4fe1\u606f \u79d2\u3001\u5c0f\u65f6\nselect current_timestamp,\n       pg_typeof(current_timestamp),\n       extract(timezone from current_timestamp::timestamptz),\n       extract(timezone_h from current_timestamp::timestamptz)\n;\n\n-- db \u914d\u7f6e\nALTER SYSTEM SET timezone = 'UTC';\n\n-- \u4fee\u6539\u89d2\u8272\u65f6\u533a\nALTER ROLE my_role SET TIMEZONE = '+1';\n"})}),"\n",(0,l.jsxs)(n.h2,{id:"null-\u5b57\u7b26--0-\u5b57\u7b26",children:["NULL \u5b57\u7b26 / ",(0,l.jsx)(n.code,{children:"\\0"})," \u5b57\u7b26"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["PG \u4e0d\u5141\u8bb8\u5b57\u7b26\u4e32\u5305\u542b ",(0,l.jsx)(n.code,{children:"\\0"})]}),"\n",(0,l.jsx)(n.li,{children:"\u4f20\u5165\u4e4b\u524d\u66ff\u6362\u6216\u7528 bytea \u5b58\u50a8"}),"\n",(0,l.jsx)(n.li,{children:"JSON \u4e5f\u4e0d\u5141\u8bb8\u5305\u542b\u7a7a\u5b57\u7b26"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"unsupported-unicode-escape-sequence",children:"unsupported Unicode escape sequence"}),"\n",(0,l.jsxs)(n.p,{children:["\u4e00\u822c\u662f\u56e0\u4e3a ",(0,l.jsx)(n.code,{children:"\\u0000"}),", \u66ff\u6362\u6389\u5373\u53ef, pg \u7684\u5b57\u7b26\u4e32\u4e0d\u652f\u6301 ",(0,l.jsx)(n.code,{children:"\\u0000"})]}),"\n",(0,l.jsx)(n.h2,{id:"\u5207\u6362\u7528\u6237",children:"\u5207\u6362\u7528\u6237"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"set role user;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5207\u6362\u6570\u636e\u5e93",children:"\u5207\u6362\u6570\u636e\u5e93"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53ea\u80fd\u91cd\u65b0\u94fe\u63a5"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5bc6\u7801\u5b58\u50a8",children:"\u5bc6\u7801\u5b58\u50a8"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/pgcrypto.html",children:"pgcrypto"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.meetspaceapp.com/2016/04/12/passwords-postgresql-pgcrypto.html",children:"Hashed Passwords with PostgreSQL's pgcrypto"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/questions/15733196/where-2x-prefix-are-used-in-bcrypt",children:"https://stackoverflow.com/questions/15733196/where-2x-prefix-are-used-in-bcrypt"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u751f\u6210 Hash\nselect crypt('12345', gen_salt('bf', 8));\n-- \u5224\u65ad\u5bc6\u7801\u76f8\u7b49\nselect crypt('12345', password) = password\n\n-- PG \u65e0\u6cd5\u5904\u7406 2b - \u6216\u8005\u63d2\u5165\u65f6\u4fee\u6539\u4e3a 2a\nselect *\nfrom users\nwhere username = 'admin'\n  and  regexp_replace(password,'^[$]2b','$2a') = crypt('admin', regexp_replace(salt,'^[$]2b','$2a'));\n"})}),"\n",(0,l.jsx)(n.h2,{id:"calculating-and-saving-space-in-postgresql",children:"Calculating and Saving Space in PostgreSQL"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/a/7431468/1870054",children:"Column Tetris"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=16471242",children:"HN"})}),"\n",(0,l.jsxs)(n.li,{children:["\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u90fd\u6709\u7279\u5b9a\u7684\u5bf9\u9f50\u8981\u6c42 - ",(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/static/catalog-pg-type.html",children:"pg-type"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/static/app-pgcontroldata.html",children:"pg_controldata"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u83b7\u53d6\u6570\u636e\u7684\u65cf\u7fa4\u4fe1\u606f"}),"\n",(0,l.jsx)(n.li,{children:"Maximum data alignment \u663e\u793a\u6570\u636e\u7684\u5bf9\u9f50\u8981\u6c42"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/static/functions-admin.html#FUNCTIONS-ADMIN-DBSIZE",children:"Database Object Size Functions"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pg_controldata data/\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u5217\u5bbd\nselect pg_column_size('int');\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"pg_control version number:            1002\nCatalog version number:               201707211\nDatabase system identifier:           6502788473953883273\nDatabase cluster state:               in production\npg_control last modified:             \u4e94  3/ 9 12:04:15 2018\nLatest checkpoint location:           0/32F8A88\nPrior checkpoint location:            0/32DA0D0\nLatest checkpoint's REDO location:    0/32F8A50\nLatest checkpoint's REDO WAL file:    000000010000000000000003\nLatest checkpoint's TimeLineID:       1\nLatest checkpoint's PrevTimeLineID:   1\nLatest checkpoint's full_page_writes: on\nLatest checkpoint's NextXID:          0:730\nLatest checkpoint's NextOID:          25609\nLatest checkpoint's NextMultiXactId:  1\nLatest checkpoint's NextMultiOffset:  0\nLatest checkpoint's oldestXID:        548\nLatest checkpoint's oldestXID's DB:   1\nLatest checkpoint's oldestActiveXID:  730\nLatest checkpoint's oldestMultiXid:   1\nLatest checkpoint's oldestMulti's DB: 1\nLatest checkpoint's oldestCommitTsXid:0\nLatest checkpoint's newestCommitTsXid:0\nTime of latest checkpoint:            \u4e94  3/ 9 12:04:12 2018\nFake LSN counter for unlogged rels:   0/1\nMinimum recovery ending location:     0/0\nMin recovery ending loc's timeline:   0\nBackup start location:                0/0\nBackup end location:                  0/0\nEnd-of-backup record required:        no\nwal_level setting:                    replica\nwal_log_hints setting:                off\nmax_connections setting:              100\nmax_worker_processes setting:         8\nmax_prepared_xacts setting:           200\nmax_locks_per_xact setting:           64\ntrack_commit_timestamp setting:       off\nMaximum data alignment:               8\nDatabase block size:                  8192\nBlocks per segment of large relation: 131072\nWAL block size:                       8192\nBytes per WAL segment:                16777216\nMaximum length of identifiers:        64\nMaximum columns in an index:          32\nMaximum size of a TOAST chunk:        1996\nSize of a large-object chunk:         2048\nDate/time type storage:               64-bit integers\nFloat4 argument passing:              by value\nFloat8 argument passing:              by value\nData page checksum version:           1\nMock authentication nonce:            32f8310a0cf344f7c1432dd733d3cf6065b748697485724af31fbaf7605f50bc\n"})}),"\n",(0,l.jsx)(n.h2,{id:"psql-\u5f00\u542f\u65f6\u95f4\u8bb0\u5f55",children:"psql \u5f00\u542f\u65f6\u95f4\u8bb0\u5f55"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"\\timing"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u76f4\u63a5\u547d\u4ee4\u884c\u4f7f\u7528\npsql -c '\\timing' -c 'select 1'\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6570\u7ec4\u7d22\u5f15",children:"\u6570\u7ec4\u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"GIN \u7d22\u5f15\u662f\u53cd\u5411\u7d22\u5f15(inverted indexes), \u9002\u7528\u4e8e\u5305\u542b\u591a\u4e2a\u503c\u7684\u60c5\u51b5."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u652f\u6301\u7684\u64cd\u4f5c\u7b26\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"<@"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"@>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"="})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"&&"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u6570\u7ec4\u5916\u952e",children:"\u6570\u7ec4\u5916\u952e"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u652f\u6301"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"error-cannot-alter-type-of-a-column-used-by-a-view-or-rule",children:"ERROR: cannot alter type of a column used by a view or rule"}),"\n",(0,l.jsx)(n.p,{children:"\u5fc5\u987b\u8981\u5148 drop view \u518d\u64cd\u4f5c, \u76ee\u524d\u6ca1\u6709\u6bd4\u8f83\u597d\u7684\u64cd\u4f5c\u65b9\u5f0f, \u4f46\u64cd\u4f5c\u90fd\u53ef\u4ee5\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u5b8c\u6210"}),"\n",(0,l.jsx)(n.p,{children:"\u6709\u4e9b\u4fee\u6539\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u4fee\u6539 pg_attribute \u6765\u8fbe\u5230\u76ee\u7684, \u4f46\u662f\u975e\u5e38\u4e0d\u5efa\u8bae."}),"\n",(0,l.jsx)(n.h2,{id:"\u65f6\u95f4\u6233\u4e0a\u7684\u6beb\u79d2\u5904\u7406",children:"\u65f6\u95f4\u6233\u4e0a\u7684\u6beb\u79d2\u5904\u7406"}),"\n",(0,l.jsx)(n.p,{children:"\u76ee\u524d\u6ca1\u6709\u6bd4\u8f83\u597d\u7684\u5904\u7406\u65b9\u5f0f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u5c06\u4e00\u4e2a\u6beb\u79d2\u7684 ts \u8f6c\u4e3a timestamp \u7c7b\u578b\nALTER TABLE  my_info\n  ALTER COLUMN tstmp TYPE TIMESTAMP USING to_timestamp(tstmp / 1000) + ((tstmp % 1000) || ' milliseconds') :: INTERVAL;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u67e5\u8be2\u8bed\u53e5\u7684\u6700\u5927\u5927\u5c0f",children:"\u67e5\u8be2\u8bed\u53e5\u7684\u6700\u5927\u5927\u5c0f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u76ee\u524d\u4e3a 1G"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dba.stackexchange.com/q/131399",children:"Is there a maximum length constraint for a postgres query?"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/postgres/postgres/blob/REL_10_1/src/common/psprintf.c#L28",children:"src/common/psprintf.c#L28"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-c",children:"#define MaxAllocSize   ((Size) 0x3fffffff) /* 1 gigabyte - 1 */\n"})}),"\n",(0,l.jsx)(n.h2,{id:"in-vs-any",children:"IN vs any"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/a/28995514/1870054",children:"https://stackoverflow.com/a/28995514/1870054"})}),"\n",(0,l.jsxs)(n.li,{children:["IN\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Bitmap \u626b\u63cf"}),"\n",(0,l.jsx)(n.li,{children:"\u6570\u636e\u91cf\u5927\u65f6, \u6267\u884c\u65f6\u95f4\u66f4\u6162\u8ba1\u5212\u65f6\u95f4\u66f4\u4e45"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["ANY\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f1a\u4f7f\u7528\u4e34\u65f6\u8868\u505a JOIN"}),"\n",(0,l.jsx)(n.li,{children:"\u6570\u636e\u91cf\u5927\u65f6, \u6267\u884c\u65f6\u95f4\u66f4\u4e45\u8ba1\u5212\u65f6\u95f4\u66f4\u5feb"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE test (\n  id  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n  val TEXT\n);\n\n-- \u63d2\u5165\u6d4b\u8bd5\u6570\u636e\nDO\n$$\nBEGIN\n  FOR i IN 1..100000 LOOP\n    INSERT INTO test (val) VALUES ('val#' || i);\n  END LOOP;\nEND\n$$;\n\nEXPLAIN SELECT *\n        FROM test\n        WHERE id IN (1, 2, 3);\n\nEXPLAIN SELECT *\n        FROM test\n        WHERE id = ANY (VALUES (1), (2), (3));\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'# IN\nBitmap Heap Scan on test  (cost=12.86..19.97 rows=3 width=40)\n  Recheck Cond: (id = ANY (\'{1,2,3}\'::bigint[]))\n  ->  Bitmap Index Scan on test_pkey  (cost=0.00..12.86 rows=3 width=0)\n        Index Cond: (id = ANY (\'{1,2,3}\'::bigint[]))\n\n# ANY\nNested Loop  (cost=0.32..25.00 rows=3 width=40)\n  ->  HashAggregate  (cost=0.05..0.08 rows=3 width=4)\n        Group Key: ""*VALUES*"".column1\n        ->  Values Scan on ""*VALUES*""  (cost=0.00..0.04 rows=3 width=4)\n  ->  Index Scan using test_pkey on test  (cost=0.28..8.29 rows=1 width=40)\n        Index Cond: (id = ""*VALUES*"".column1)\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-SQL",children:"-- \u6d4b\u8bd5 IN\nDO\n$$\nDECLARE\n  x   TEXT = '';\n  r   REFCURSOR;\n  rec RECORD;\nBEGIN\n  x = '0';\n  FOR i IN 1..1000 LOOP\n    x = x || ',' || i;\n  END LOOP;\n  OPEN r FOR EXECUTE 'EXPLAIN ANALYSE SELECT *\n        FROM test\n        WHERE id IN (' || x || ')';\n\n  FOR i IN 1..6 LOOP\n    FETCH r INTO rec;\n    RAISE NOTICE 'ROW %', rec;\n  END LOOP;\nEND\n$$;\n\n-- \u6d4b\u8bd5 ANY\nDO\n$$\nDECLARE\n  x   TEXT;\n  r   REFCURSOR;\n  rec RECORD;\nBEGIN\n  x = '(0)';\n  FOR i IN 1..1000 LOOP\n    x = x || ',(' || i || ')';\n  END LOOP;\n  OPEN r FOR EXECUTE 'EXPLAIN ANALYSE SELECT *\n        FROM test\n        WHERE id = any (VALUES ' || x || ')';\n\n  FOR i IN 1..10 LOOP\n    FETCH r INTO rec;\n    RAISE NOTICE 'ROW %', rec;\n  END LOOP;\nEND\n$$;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u91cd\u7f6e-schema",children:"\u91cd\u7f6e schema"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DROP SCHEMA public CASCADE;\nCREATE SCHEMA public;\n\n-- 9.3+ \u53ef\u80fd\u9700\u8981\nGRANT ALL ON SCHEMA public TO postgres;\nGRANT ALL ON SCHEMA public TO public;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"psql-\u4f7f\u7528\u8fde\u63a5\u5b57\u7b26\u4e32",children:"psql \u4f7f\u7528\u8fde\u63a5\u5b57\u7b26\u4e32"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'psql -Atx "host=localhost port=5432 dbname=taop user=taop" -c \'select current_date\'\n\n# -d database\npsql -d "host=localhost port=5432 dbname=taop user=taop"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"control-reached-end-of-trigger-procedure-without-return",children:"control reached end of trigger procedure without RETURN"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528 trigger \u65f6\u51fa\u73b0\uff0c\u6dfb\u52a0 return null"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"create or replace function sync_events_trigger() returns trigger\nas\n$$\nBEGIN\n    -- ...\n    return null; -- this is important\nEND;\n$$ language plpgsql volatile;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"query-has-no-destination-for-result-data",children:"query has no destination for result data"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u51fd\u6570\u4e2d select \u9700\u8981\u6307\u5b9a\u8f93\u51fa"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u5c06\u8fd4\u56de\u7c7b\u578b\u6307\u5b9a\u4e3a table"}),"\n",(0,l.jsxs)(n.li,{children:["\u53ef\u4ee5 ",(0,l.jsx)(n.code,{children:"select into"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u53ef\u4ee5 \u8fd4\u56de ",(0,l.jsx)(n.code,{children:"return(select * from tab)"})]}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u4f7f\u7528 perform/execute \u5982\u679c\u4e0d\u60f3\u8981\u7ed3\u679c"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION tst_dates_func()\nRETURNS TABLE( v int) as\n$$\n    select 1;\n$$ LANGUAGE sql;\n\nRETURN QUERY (select 1);\nRETURN(SELECT dblink_disconnect());\n\nSELECT 1 into result;\nRETURN result;\n\nPERFORM select 1;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"could-not-resize-shared-memory-segment-postgresql153520683-to-1073812480-bytes-no-space-left-on-device",children:'could not resize shared memory segment "/PostgreSQL.153520683" to 1073812480 bytes: No space left on device'}),"\n",(0,l.jsx)(n.p,{children:"\u589e\u52a0 docker \u7684 shm_size"}),"\n",(0,l.jsx)(n.h2,{id:"set-returning-functions-are-not-allowed-in-update",children:"set-returning functions are not allowed in UPDATE"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u66ff\u6362 unnest(array_value) -> ",(0,l.jsx)(n.code,{children:"array_value[1]"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u66ff\u6362 ",(0,l.jsx)(n.code,{children:"(regexp_matches(album, '^6,(?:(.+),)?tv\\d+'))[1]"})," -> ",(0,l.jsx)(n.code,{children:"substring (album FROM '^6,(?:(.+),)?tv\\d+')"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"tuning",children:"Tuning"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=28489340",children:"https://news.ycombinator.com/item?id=28489340"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://postgresqlco.nf/",children:"https://postgresqlco.nf/"})}),"\n",(0,l.jsxs)(n.li,{children:["Why Uber Engineering Switched from Postgres to MySQL - 2016\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"MySQL used as key-value storage layer of homegrown sharded non-relational database"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://eng.uber.com/postgres-to-mysql-migration/",children:"https://eng.uber.com/postgres-to-mysql-migration/"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=17280239",children:"https://news.ycombinator.com/item?id=17280239"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=12166585",children:"https://news.ycombinator.com/item?id=12166585"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=26283348",children:"https://news.ycombinator.com/item?id=26283348"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Postgres better for read heavy"}),"\n",(0,l.jsx)(n.li,{children:"MySQL for write heavy"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Pain Point ",(0,l.jsx)(n.a,{href:"https://pgdash.io/blog/postgresql-six-not-so-easy-pieces.html",children:"https://pgdash.io/blog/postgresql-six-not-so-easy-pieces.html"})]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://sql-info.de/postgresql/postgres-gotchas.html",children:"https://sql-info.de/postgresql/postgres-gotchas.html"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"sale-point",children:"Sale Point"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"transactional ddl"}),"\n",(0,l.jsx)(n.li,{children:"JSONB,JSON"}),"\n",(0,l.jsx)(n.li,{children:"Extension"}),"\n",(0,l.jsx)(n.li,{children:"Native Array"}),"\n",(0,l.jsx)(n.li,{children:"window function"}),"\n",(0,l.jsx)(n.li,{children:"custom type"}),"\n",(0,l.jsxs)(n.li,{children:["MySQL 8\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"atomic ddl - \u5f31\u4e8e transactional ddl"}),"\n",(0,l.jsx)(n.li,{children:"window function"}),"\n",(0,l.jsx)(n.li,{children:"arbitrary check"}),"\n",(0,l.jsx)(n.li,{children:"JSON"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://sql-info.de/mysql/gotchas.html",children:"https://sql-info.de/mysql/gotchas.html"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://fromdual.com/mysql-limitations",children:"https://fromdual.com/mysql-limitations"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"on-conflict-do-update-command-cannot-affect-row-a-second-time",children:"ON CONFLICT DO UPDATE command cannot affect row a second time"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u63d2\u5165\u524d\u8fdb\u884c dedup"}),"\n",(0,l.jsx)(n.li,{children:"CTE \u5148 select distinct"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u751f\u6210\u5217",children:"\u751f\u6210\u5217"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u751f\u6210\u5217\u4e0d\u80fd\u88ab\u624b\u52a8\u6307\u5b9a"}),"\n",(0,l.jsx)(n.li,{children:"stored - INSERT \u6216 UPDATE \u65f6\u5199\u5165"}),"\n",(0,l.jsx)(n.li,{children:"virtual - \u5b9e\u65f6\u8ba1\u7b97 - \u7c7b\u4f3c view"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"generated-vs-default-column",children:"generated vs default column"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["default\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53ef\u6307\u5b9a"}),"\n",(0,l.jsx)(n.li,{children:"\u4e0d\u6307\u5b9a\u4f7f\u7528\u9ed8\u8ba4 - \u8ba1\u7b97 1 \u6b21"}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u5173\u8054\u5176\u4ed6\u5217"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["generated\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6bcf\u6b21\u884c\u53d8\u5316\u90fd\u4f1a\u751f\u6210"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"remaining-connection-slots-are-reserved-for-non-replication-superuser-connection",children:"remaining connection slots are reserved for non-replication superuser connection"}),"\n",(0,l.jsx)(n.p,{children:"\u6392\u67e5\u8fde\u63a5\u6570\u95ee\u9898"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Note"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4fee\u6539 max_connections \u5fc5\u987b\u91cd\u542f pg"}),"\n",(0,l.jsx)(n.li,{children:"\u5efa\u8bae\u5e94\u7528\u6307\u5b9a application_name"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u67e5\u770b\u5f53\u524d\u7684\u6700\u5927\u8fde\u63a5\u6570\nshow max_connections;\n\n-- \u67e5\u770b\u8fde\u63a5\u6570\u4e3b\u8981\u8c01\u5360\u7528\n-- idle \u591a\u8fd8\u662f active \u591a\nselect state, usename, application_name, datname, count(*)\nfrom pg_stat_activity\ngroup by state, usename, application_name, datname\norder by 1, 2, 3;\n\n-- \u6392\u67e5 active \u8fde\u63a5\nselect *\nfrom pg_stat_activity\nwhere state = 'active';\n\n-- \u6309\u9700 kill \u8fde\u63a5\n"})}),"\n",(0,l.jsx)(n.h2,{id:"current_timestamp-vs-now",children:"CURRENT_TIMESTAMP vs NOW"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6ca1\u6709\u533a\u522b"}),"\n",(0,l.jsx)(n.li,{children:"CURRENT_TIMESTAMP=\u4e8b\u7269\u5f00\u59cb\u65f6\u95f4=transaction_timestamp()=now()"}),"\n",(0,l.jsxs)(n.li,{children:["\u8f93\u5165\u65f6\u7684 ",(0,l.jsx)(n.code,{children:"now"})," \u4e0d\u7b49\u4e8e ",(0,l.jsx)(n.code,{children:"now()"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/datatype-datetime.html#DATATYPE-DATETIME-SPECIAL-TABLE",children:"Special Date/Time Inputs"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5176\u4ed6\u65f6\u95f4\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"statement_timestamp() - STABLE - \u8bed\u53e5\u65f6\u95f4"}),"\n",(0,l.jsx)(n.li,{children:"clock_timestamp() - VOLATILE - \u771f\u6b63\u5f53\u524d\u65f6\u95f4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dba.stackexchange.com/a/63549/234272",children:"https://dba.stackexchange.com/a/63549/234272"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"on-conflict-do-update-command-cannot-affect-row-a-second-time-sqlstate-21000",children:"ON CONFLICT DO UPDATE command cannot affect row a second time (SQLSTATE 21000)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"insert on conflict \u65f6\u6709\u91cd\u590d\u6570\u636e"}),"\n",(0,l.jsx)(n.li,{children:"\u63d2\u5165\u4e4b\u524d\u5148\u53bb\u91cd"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"column-datlastsysoid-does-not-exist",children:'column "datlastsysoid" does not exist'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"PostgreSQL 15 \u79fb\u9664\u4e86\u8fd9\u4e2a\u5217"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/pgmodeler/pgmodeler/issues/1689",children:"https://github.com/pgmodeler/pgmodeler/issues/1689"})}),"\n",(0,l.jsx)(n.li,{children:"navicat 16 \u4e5f\u6709\u95ee\u9898"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"select distinct datlastsysoid from pg_database;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u67e5\u627e\u6240\u6709\u5916\u952e",children:"\u67e5\u627e\u6240\u6709\u5916\u952e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SELECT conrelid::regclass AS table_name,\n       conname AS foreign_key,\n       pg_get_constraintdef(oid)\nFROM   pg_constraint\nWHERE  contype = 'f'\nAND    connamespace = 'public'::regnamespace\nORDER  BY conrelid::regclass::text, contype DESC;\n\n-- psql\n\\d table_name\n"})}),"\n",(0,l.jsx)(n.h2,{id:"array\u6570\u7ec4-\u5916\u952e",children:"ARRAY/\u6570\u7ec4 \u5916\u952e"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u652f\u6301"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/questions/41054507",children:"https://stackoverflow.com/questions/41054507"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"cannot-use-column-reference-in-default-expression",children:"cannot use column reference in DEFAULT expression"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u80fd\u5728 default \u4e2d\u4f7f\u7528\u5176\u4ed6\u5217"}),"\n",(0,l.jsx)(n.li,{children:"\u901a\u8fc7 before insert \u89e6\u53d1\u5668\u5b9e\u73b0"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"lateral-vs-subquery",children:"lateral vs subquery"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["lateral\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"PostgreSQL 9.3+"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Correlated_subquery",children:"correlated subquery"})}),"\n",(0,l.jsx)(n.li,{children:"\u4e0d\u4ea7\u751f\u65b0\u7684\u884c"}),"\n",(0,l.jsx)(n.li,{children:"\u6bcf\u884c\u53ea\u6267\u884c 1 \u6b21"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"LEFT JOIN LATERAL (select 1) t ON TRUE"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"LATERAL (select 1) t"})}),"\n",(0,l.jsx)(n.li,{children:"\u67e5\u8be2\u53ef\u4ee5\u5f15\u7528\u5916\u90e8\u5217"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["subquery\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53ea\u80fd\u8fd4\u56de\u4e00\u4e2a\u503c"}),"\n",(0,l.jsx)(n.li,{children:"\u53ea\u6267\u884c 1 \u6b21"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"union-vs-union-all",children:"union vs union all"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["union\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5408\u5e76\u53bb\u91cd"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["union all\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u505a\u5904\u7406"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5916\u952e\u9700\u8981\u5efa\u7acb\u7d22\u5f15\u4e48",children:"\u5916\u952e\u9700\u8981\u5efa\u7acb\u7d22\u5f15\u4e48\uff1f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"pk \u548c unique \u4f1a\u81ea\u52a8\u5efa\u7acb\u7d22\u5f15"}),"\n",(0,l.jsxs)(n.li,{children:["fk \u4e0d\u4f1a\u81ea\u52a8\u5efa\u7acb\u7d22\u5f15\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5efa\u8bae\u5efa\u7acb\u7d22\u5f15"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"enum-vs-check-vs-fk",children:"enum vs check vs fk"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["enum\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u80fd\u5220\u9664"}),"\n",(0,l.jsx)(n.li,{children:"\u987a\u5e8f\u4e0d\u53ef\u53d8"}),"\n",(0,l.jsx)(n.li,{children:"\u4e0d\u53ef\u4ee5\u6a21\u5f0f\u5339\u914d"}),"\n",(0,l.jsx)(n.li,{children:"\u5b9e\u9645\u5b58\u50a8 oridinal"}),"\n",(0,l.jsx)(n.li,{children:"\u9ed8\u8ba4\u6700\u957f 63byte"}),"\n",(0,l.jsx)(n.li,{children:"\u53ea\u6709 value"}),"\n",(0,l.jsx)(n.li,{children:"\u5b58\u50a8\u5728 pg_enum"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/datatype-enum.html",children:"https://www.postgresql.org/docs/current/datatype-enum.html"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["check\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6240\u89c1\u5373\u6240\u5f97"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["fk\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u5305\u542b label - \u65b9\u4fbf\u751f\u6210"}),"\n",(0,l.jsx)(n.li,{children:"\u53ef\u4ee5\u52a8\u6001\u53d8\u5316"}),"\n",(0,l.jsx)(n.li,{children:"\u63a8\u8350 FK Value"}),"\n",(0,l.jsx)(n.li,{children:"\u4e0d\u9700\u8981 alter table"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- ENUM\nCREATE TYPE valid_colors AS ENUM ('red', 'green', 'blue');\n\nCREATE TABLE t (\n    color VALID_COLORS\n);\n\n-- CHECK\nCREATE TABLE t (\n    colors TEXT CHECK (colors IN ('red', 'green', 'blue'))\n);\n\n-- FK ID\nCREATE TABLE valid_colors (\n    id SERIAL PRIMARY KEY NOT NULL,\n    color TEXT\n);\n\nINSERT INTO valid_colors (color) VALUES\n    ('red'),\n    ('green'),\n    ('blue');\n\nCREATE TABLE t (\n    color_id INTEGER REFERENCES valid_colors (id)\n);\n\n-- FK value\nCREATE TABLE valid_colors (\n    value text PRIMARY KEY NOT NULL,\n    label text\n);\n\nINSERT INTO valid_colors (value) VALUES\n    ('red'),\n    ('green'),\n    ('blue');\n\nCREATE TABLE t (\n    color text REFERENCES valid_colors (value)\n);\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/a/10984951/1870054",children:"https://stackoverflow.com/a/10984951/1870054"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u9884\u52a0\u8f7d-table-\u5230\u5185\u5b58",children:"\u9884\u52a0\u8f7d table \u5230\u5185\u5b58"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"/notes/db/relational/postgresql/pg_prewarm",children:"pg_prewarm"})}),"\n",(0,l.jsx)(n.h2,{id:"error-could-not-open-file-base52704-no-such-file-or-directory",children:'ERROR: could not open file "base/5/2704": No such file or directory'}),"\n",(0,l.jsx)(n.p,{children:"\u6570\u636e\u5e93\u5c11\u4e86\u6570\u636e\u6587\u4ef6"}),"\n",(0,l.jsx)(n.h2,{id:"a-field-with-precision-5-scale-4-must-round-to-an-absolute-value-less-than-101",children:"A field with precision 5, scale 4 must round to an absolute value less than 10^1"}),"\n",(0,l.jsx)(n.h2,{id:"the-database-system-is-in-recovery-mode-the-database-system-is-in-recovery-mode",children:"the database system is in recovery mode the database system is in recovery mode"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 pg_isready \u5224\u65ad\u662f\u5426\u53ef\u7528"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"collate",children:"COLLATE"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"create index on t (name COLLATE \"C\");\n-- \u652f\u6301\u4f7f\u7528 Index\nexplain select * from t where name like 'W%';\n-- \u4e0d\u4f1a\u7528 Index\nexplain select * from t where name = 'Wener';\n-- \u4f1a\u7528 Index\nexplain select * from t where name = 'Wener' collate \"C\";\n\n-- \u4fee\u6539\u9ed8\u8ba4 COLLATE\nalter table t alter column name set data type text collate \"C\";\n-- \u4f1a\u7528 Index\nexplain select * from t where name = 'Wener';\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:'COLLATE "C" \u652f\u6301\u524d\u7f00\u8fc7\u6ee4\u7d22\u5f15'}),"\n",(0,l.jsx)(n.li,{children:"LC_COLLATE"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"error-could-not-resize-shared-memory-segment-postgresql2692148336-to-1073812480-bytes-no-space-left-on-device",children:'ERROR: could not resize shared memory segment "/PostgreSQL.2692148336" to 1073812480 bytes: No space left on device'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"vacuum \u65f6\u53d1\u751f"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sysctl kernel.shmmax\nls -lash /dev/shm\n# PostgreSQL.1489521326\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"K8S \u4fee\u6539"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spec:\n  containers:\n    - name: postgres\n      image: postgres\n      volumeMounts:\n        - mountPath: /dev/shm\n          name: dshm\n      ports:\n        - containerPort: 5432\n  volumes:\n    - name: dshm\n      emptyDir:\n        medium: Memory\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Docker"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run --cap-add=SYS_ADMIN --shm-size 2G postgres\n"})}),"\n",(0,l.jsx)(n.h2,{id:"k8s-start--shutdown",children:"K8S start & shutdown"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"preStop:\n  exec:\n    command: ['/bin/sh', '-c', 'pg_ctl -D /var/lib/postgresql/data/pgdata -w -t 60 stop -m fast']\n    #command: ['/usr/local/bin/pg_ctl stop -D /var/lib/postgresql/data -w -t 60 -m fast']\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://stackoverflow.com/a/75829325/1870054",children:"https://stackoverflow.com/a/75829325/1870054"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"lc_monetery",children:"LC_MONETERY"}),"\n",(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"collate \u4e0d\u80fd\u521b\u5efa db \u540e\u4fee\u6539\uff0c\u53ef\u4ee5\u9488\u5bf9 column \u6216 table \u4fee\u6539\u3002"}),"\n"]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"show lc_collate;\nshow lc_monetary;\n\nselect *\nfrom pg_settings\nwhere name like 'lc_%';\n\nset lc_monetary to \"en_IE.utf8\";\nselect 10::money;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/catalog-pg-collation.html",children:"pg_collation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/collation.html",children:"https://www.postgresql.org/docs/current/collation.html"})}),"\n",(0,l.jsxs)(n.li,{children:["LC_COLLATE\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9ed8\u8ba4 en_US.utf8"}),"\n",(0,l.jsx)(n.li,{children:"\u63a8\u8350 C"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"LC_CTYPE"}),"\n",(0,l.jsx)(n.li,{children:"LC_MONETERY"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"name"}),(0,l.jsx)(n.th,{children:"default"}),(0,l.jsx)(n.th,{children:"aliyun"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"lc_collate"}),(0,l.jsx)(n.td,{children:"en_US.utf8"}),(0,l.jsx)(n.td,{children:"C"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"lc_ctype"}),(0,l.jsx)(n.td,{children:"en_US.utf8"}),(0,l.jsx)(n.td,{children:"en_US.utf8"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"lc_messages"}),(0,l.jsx)(n.td,{children:"en_US.utf8"}),(0,l.jsx)(n.td,{children:'""'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"lc_monetary"}),(0,l.jsx)(n.td,{children:"en_US.utf8"}),(0,l.jsx)(n.td,{children:"C"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"lc_numeric"}),(0,l.jsx)(n.td,{children:"en_US.utf8"}),(0,l.jsx)(n.td,{children:"C"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"lc_time"}),(0,l.jsx)(n.td,{children:"en_US.utf8"}),(0,l.jsx)(n.td,{children:"C"})]})]})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["initdb - ",(0,l.jsx)(n.code,{children:"--encoding=UTF-8 --lc-collate=C --lc-ctype=C"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"POSTGRES_INITDB_ARGS: '--encoding=UTF-8 --lc-collate=C --lc-ctype=C'\n"})}),"\n",(0,l.jsx)(n.h2,{id:"there-is-no-unique-constraint-matching-given-keys-for-referenced-table",children:"there is no unique constraint matching given keys for referenced table"}),"\n",(0,l.jsx)(n.p,{children:"\u5916\u952e\u5fc5\u987b unique"}),"\n",(0,l.jsx)(n.h2,{id:"permission-denied-for-table",children:"permission denied for table"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5916\u952e\u9700\u8981 REFERENCES"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/ddl-priv.html",children:"https://www.postgresql.org/docs/current/ddl-priv.html"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"source-for-a-multiple-column-update-item-must-be-a-sub-select-or-row-expression",children:"source for a multiple-column UPDATE item must be a sub-SELECT or ROW() expression"}),"\n",(0,l.jsx)(n.p,{children:"\u4e0d\u80fd\u5355\u4e2a\u5b57\u6bb5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"on conflict(value) do update set (label)= (excluded.label);\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4fee\u6539\u4e3a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"on conflict(value) do update set (label,extensions)= (excluded.label,excluded.extensions);\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},38088:(e,n,s)=>{var l=s(96651),i=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,c=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function o(e,n,s){var l,r={},o=null,a=null;for(l in void 0!==s&&(o=""+s),void 0!==n.key&&(o=""+n.key),void 0!==n.ref&&(a=n.ref),n)t.call(n,l)&&!d.hasOwnProperty(l)&&(r[l]=n[l]);if(e&&e.defaultProps)for(l in n=e.defaultProps)void 0===r[l]&&(r[l]=n[l]);return{$$typeof:i,type:e,key:o,ref:a,props:r,_owner:c.current}}n.Fragment=r,n.jsx=o,n.jsxs=o},2488:(e,n,s)=>{e.exports=s(38088)},62780:(e,n,s)=>{s.d(n,{I:()=>c,M:()=>t});var l=s(96651);const i={},r=l.createContext(i);function t(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);