/*! For license information please see 23b3eed0.a8bb6c11.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[21512],{86192:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>x,frontMatter:()=>r,metadata:()=>d,toc:()=>h});var l=i(2488),s=i(62780);const r={tags:["SQL"]},c="Clickhouse SQL",d={id:"db/column/clickhouse/clickhouse-sql",title:"Clickhouse SQL",description:"REST API",source:"@site/../notes/db/column/clickhouse/clickhouse-sql.md",sourceDirName:"db/column/clickhouse",slug:"/db/column/clickhouse/sql",permalink:"/notes/db/column/clickhouse/sql",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/column/clickhouse/clickhouse-sql.md",tags:[{label:"SQL",permalink:"/notes/tags/sql"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1686920980,formattedLastUpdatedAt:"Jun 16, 2023",frontMatter:{tags:["SQL"]},sidebar:"docs",previous:{title:"ClickHouse FAQ",permalink:"/notes/db/column/clickhouse/faq"},next:{title:"CQL",permalink:"/notes/db/column/cql"}},t={},h=[{value:"REST API",id:"rest-api",level:2},{value:"\u6570\u636e\u7c7b\u578b",id:"data-types",level:2},{value:"Query",id:"query",level:2},{value:"JSON",id:"json",level:2},{value:"Alter Table JSON NO_SUCH_COLUMN_IN_TABLE",id:"alter-table-json-no_such_column_in_table",level:3},{value:"Database Engines",id:"database-engines",level:2},{value:"Table Engine",id:"table-engine",level:2},{value:"MergeTree",id:"mergetree",level:3},{value:"Log Family",id:"log-family",level:3},{value:"Special",id:"special",level:3},{value:"S3",id:"s3",level:3},{value:"PostgreSQL",id:"postgresql",level:3},{value:"Mutation",id:"mutation",level:2},{value:"SELECT *",id:"select-",level:2},{value:"Cannot iterate over non-finalized ColumnObject",id:"cannot-iterate-over-non-finalized-columnobject",level:2},{value:"Memory limit (for query) exceeded",id:"memory-limit-for-query-exceeded",level:2},{value:"SQLite database file path must be inside &#39;user_files&#39; directory. (PATH_ACCESS_DENIED)",id:"sqlite-database-file-path-must-be-inside-user_files-directory-path_access_denied",level:2},{value:"To execute this query it&#39;s necessary to have grant CREATE USER ON",id:"to-execute-this-query-its-necessary-to-have-grant-create-user-on",level:2},{value:"FINAL",id:"final",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.M)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h1,{id:"clickhouse-sql",children:"Clickhouse SQL"}),"\n",(0,l.jsx)(e.h2,{id:"rest-api",children:"REST API"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"echo 'SELECT version()' | curl 'http://localhost:8123/' --data-binary @-\n\ncurl 'http://192.168.66.61:8123?query=select%20version()'\ncurl --get http://192.168.66.61:8123 --data-urlencode 'query=select version()'\n"})}),"\n",(0,l.jsx)(e.h2,{id:"data-types",children:"\u6570\u636e\u7c7b\u578b"}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"\u652f\u6301\u8303\u578b\u7684\u5f3a\u7c7b\u578b Schema"}),"\n"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["UInt8, UInt16, UInt32, UInt64, UInt256, Int8, Int16, Int32, Int64, Int128, Int256\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Int8 \u2014 TINYINT, BOOL, BOOLEAN, INT1."}),"\n",(0,l.jsx)(e.li,{children:"Int16 \u2014 SMALLINT, INT2."}),"\n",(0,l.jsx)(e.li,{children:"Int32 \u2014 INT, INT4, INTEGER."}),"\n",(0,l.jsx)(e.li,{children:"Int64 \u2014 BIGINT"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Float32, Float64\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"FLOAT, DOUBLE"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S), Decimal256(S)\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"P - precision - [ 1 : 76 ]"}),"\n",(0,l.jsx)(e.li,{children:"S - scale - [ 0 : P ]"}),"\n",(0,l.jsx)(e.li,{children:"P [ 1 : 9 ] - Decimal32(S)"}),"\n",(0,l.jsx)(e.li,{children:"P [ 10 : 18 ] - Decimal64(S)"}),"\n",(0,l.jsx)(e.li,{children:"P [ 19 : 38 ] - Decimal128(S)"}),"\n",(0,l.jsx)(e.li,{children:"P [ 39 : 76 ] - Decimal256(S)"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Boolean\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"UInt8 - 0,1"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["String\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5982\u679c\u521b\u5efa VARCHAR(255) \u4f1a\u5ffd\u7565\u957f\u5ea6"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"FixedString(N) - N bytes"}),"\n",(0,l.jsx)(e.li,{children:"UUID"}),"\n",(0,l.jsxs)(e.li,{children:["Date\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"2byte, days since 1970-01-01"}),"\n",(0,l.jsx)(e.li,{children:"\u6700\u5927 2148 \u5e74"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"DateTime([timezone])"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"unix timestamp"}),"\n",(0,l.jsx)(e.li,{children:"\u6700\u5927 2105 \u5e74"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"DateTime64(precision, [timezone])"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Int64, epoch"}),"\n",(0,l.jsx)(e.li,{children:"precision=3 \u5219\u662f\u6beb\u79d2\u7ea7"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"Enum('k1'=1,'k2'=2)"})}),"\n",(0,l.jsxs)(e.li,{children:["LowCardinality(data_type)\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"change internal to dictionary-encoded"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["array(T) - ",(0,l.jsx)(e.code,{children:"[]"})]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"AggregateFunction(name, types_of_arguments\u2026)"})}),"\n",(0,l.jsx)(e.li,{children:"Nested - \u5d4c\u5957\u7c7b\u578b - \u7c7b\u4f3c\u5b9a\u4e49\u4e00\u4e2a struct"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"tuple(T1, T2, ...)"})}),"\n",(0,l.jsxs)(e.li,{children:["\u7279\u6b8a\u7c7b\u578b\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Set"}),"\n",(0,l.jsx)(e.li,{children:"Nothing"}),"\n",(0,l.jsx)(e.li,{children:"Interval"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u57df\u7c7b\u578b\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"IPv4, IPv6"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Geo \u7c7b\u578b\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Point, Ring, Polygon, MultiPolygon"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Map(key, value)"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"query",children:"Query"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"select version();\n\nselect currentDatabase();\nselect currentProfiles();\nselect currentUser();\nselect currentRoles();\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["CREATE TABLE\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ENGINE"}),"\n",(0,l.jsxs)(e.li,{children:["\u5217\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"DEFAULT - \u8bbe\u7f6e\u9ed8\u8ba4\u503c"}),"\n",(0,l.jsx)(e.li,{children:"MATERIALIZED"}),"\n",(0,l.jsxs)(e.li,{children:["ALIAS - \u522b\u540d\u5217 - \u4e0d\u5305\u542b\u5728 ",(0,l.jsx)(e.code,{children:"*"})]}),"\n",(0,l.jsx)(e.li,{children:"EPHEMERAL - \u4e0d\u4f1a\u5b58\u50a8\uff0c\u4e0d\u80fd\u88ab SELECT \u5728 CREATE \u53ef\u4ee5\u88ab\u5f15\u7528"}),"\n",(0,l.jsxs)(e.li,{children:["compression_codec\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9ed8\u8ba4 lz4"}),"\n",(0,l.jsx)(e.li,{children:"NONE, LZ4"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"LZ4HC(9)"})," - 1-12, \u63a8\u8350 4-9"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ZSTD(1)"})," - 1-22"]}),"\n",(0,l.jsx)(e.li,{children:"DEFLATE_QPL"}),"\n",(0,l.jsxs)(e.li,{children:["\u7279\u6b8a\u7f16\u7801\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"Delta(delta_bytes)"})}),"\n",(0,l.jsx)(e.li,{children:"DoubleDelta"}),"\n",(0,l.jsx)(e.li,{children:"Gorilla - XOR - Gorilla TSDB"}),"\n",(0,l.jsx)(e.li,{children:"FPC"}),"\n",(0,l.jsx)(e.li,{children:"T64"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u52a0\u5bc6\u7f16\u7801\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"AES_128_GCM_SIV"}),"\n",(0,l.jsx)(e.li,{children:"AES-256-GCM-SIV"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"TTL"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["REPLACE TABLE\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u53ea\u6709 Atomic \u5f15\u64ce\u53ef\u4ee5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Dictionaries - ",(0,l.jsx)(e.code,{children:"key -> attributes"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources",children:"\u5916\u90e8"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Local file"}),"\n",(0,l.jsx)(e.li,{children:"Executable File"}),"\n",(0,l.jsx)(e.li,{children:"Executable Pool"}),"\n",(0,l.jsx)(e.li,{children:"HTTP(s)"}),"\n",(0,l.jsxs)(e.li,{children:["DBMS\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ODBC"}),"\n",(0,l.jsx)(e.li,{children:"MySQL"}),"\n",(0,l.jsx)(e.li,{children:"ClickHouse"}),"\n",(0,l.jsx)(e.li,{children:"MongoDB"}),"\n",(0,l.jsx)(e.li,{children:"Redis"}),"\n",(0,l.jsx)(e.li,{children:"Cassandra"}),"\n",(0,l.jsx)(e.li,{children:"PostgreSQL"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"json",children:"JSON"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["JSON -> ",(0,l.jsx)(e.code,{children:"Object('json')"})]}),"\n",(0,l.jsx)(e.li,{children:"\u76ee\u524d\u8fd8\u6709\u5f88\u591a\u95ee\u9898"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"SET allow_experimental_object_type=1;\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://clickhouse.com/docs/en/sql-reference/functions/json-functions/",children:"JSON Functions"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://clickhouse.com/docs/en/guides/developer/working-with-json",children:"Working with JSON"})}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"alter-table-json-no_such_column_in_table",children:"Alter Table JSON NO_SUCH_COLUMN_IN_TABLE"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/ClickHouse/ClickHouse/issues/38517",children:"https://github.com/ClickHouse/ClickHouse/issues/38517"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/ClickHouse/ClickHouse/issues/37730",children:"https://github.com/ClickHouse/ClickHouse/issues/37730"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"database-engines",children:"Database Engines"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Atomic"}),"\n",(0,l.jsx)(e.li,{children:"MySQL"}),"\n",(0,l.jsx)(e.li,{children:"MaterializedMySQL"}),"\n",(0,l.jsx)(e.li,{children:"Lazy"}),"\n",(0,l.jsx)(e.li,{children:"PostgreSQL"}),"\n",(0,l.jsx)(e.li,{children:"MaterializedPostgreSQL"}),"\n",(0,l.jsx)(e.li,{children:"Replicated"}),"\n",(0,l.jsx)(e.li,{children:"SQLite"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"CREATE DATABASE sqlite_database\nENGINE = SQLite('db_path');\n"})}),"\n",(0,l.jsx)(e.h2,{id:"table-engine",children:"Table Engine"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"MergeTree Family"}),(0,l.jsx)(e.th,{children:"Log Family"}),(0,l.jsx)(e.th,{children:"Integrations"}),(0,l.jsx)(e.th,{children:"Special"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"MergeTree"}),(0,l.jsx)(e.td,{children:"StripeLog"}),(0,l.jsx)(e.td,{children:"ODBC"}),(0,l.jsx)(e.td,{children:"Distributed"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ReplacingMergeTree"}),(0,l.jsx)(e.td,{children:"Log"}),(0,l.jsx)(e.td,{children:"JDBC"}),(0,l.jsx)(e.td,{children:"MaterializedView"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"SummingMergeTree"}),(0,l.jsx)(e.td,{children:"TinyLog"}),(0,l.jsx)(e.td,{children:"MySQL"}),(0,l.jsx)(e.td,{children:"Dictionary"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"AggregatingMergeTree"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"MongoDB"}),(0,l.jsx)(e.td,{children:"Merge"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"CollapsingMergeTree"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"HDFS"}),(0,l.jsx)(e.td,{children:"File"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"VersionedCollapsingMergeTree"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"S3"}),(0,l.jsx)(e.td,{children:"Null"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"GraphiteMergeTree"}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"Kafka"}),(0,l.jsx)(e.td,{children:"Set"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"EmbeddedRocksDB"}),(0,l.jsx)(e.td,{children:"Join"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"RabbitMQ"}),(0,l.jsx)(e.td,{children:"URL"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"PostgreSQL"}),(0,l.jsx)(e.td,{children:"View"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"Memory"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{}),(0,l.jsx)(e.td,{children:"Buffer"})]})]})]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://clickhouse.com/docs/en/engines/table-engines/",children:"Table Engines"})}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"mergetree",children:"MergeTree"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["MergeTree - \u5efa\u8bae\u7528\u4e8e\u5355\u8282\u70b9\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5217\u5b58\u50a8"}),"\n",(0,l.jsx)(e.li,{children:"\u57fa\u4e8e PK \u6392\u5e8f"}),"\n",(0,l.jsx)(e.li,{children:"\u652f\u6301\u526f\u672c"}),"\n",(0,l.jsx)(e.li,{children:"\u652f\u6301\u91c7\u6837"}),"\n",(0,l.jsx)(e.li,{children:"\u652f\u6301 TTL"}),"\n",(0,l.jsx)(e.li,{children:"\u81ea\u5b9a\u4e49\u5206\u7247"}),"\n",(0,l.jsx)(e.li,{children:"sparse primary index"}),"\n",(0,l.jsx)(e.li,{children:"secondary data-skipping indexes"}),"\n",(0,l.jsxs)(e.li,{children:["\u7d22\u5f15\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"annoy - \u7a7a\u95f4"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ORDER BY tuple()"})," \u8868\u793a\u4e0d\u9700\u8981\u6392\u5e8f"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"TTL create_time + INTERVAL 1 MONTH"})}),"\n",(0,l.jsxs)(e.li,{children:["SETTINGS\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"index_granularity=8192"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u7c7b\u4f3c LSM tree \u7ed3\u6784\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"optimize table tbl final;"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"compaction"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"Replicated*"})," - \u526f\u672c - \u7528\u4e8e\u591a\u8282\u70b9\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"table \u7ef4\u5ea6"}),"\n",(0,l.jsx)(e.li,{children:"\u5305\u542b: INSERT, ALTER"}),"\n",(0,l.jsx)(e.li,{children:"\u652f\u6301\u6570\u636e\u53bb\u91cd"}),"\n",(0,l.jsxs)(e.li,{children:["\u4e0d\u5305\u542b: CREATE, DROP, ATTACH, DETACH, RENAME\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"RENAME - \u53ef\u4ee5\u8ba9\u526f\u672c\u8868\u540d\u5b57\u4e0d\u540c"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replacingmergetree/",children:"ReplacingMergeTree([ver])"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u57fa\u4e8e sorting key \u53bb\u91cd\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5728 compaction/optimize \u65f6 - \u8017\u65f6\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e0d\u4e00\u5b9a\u80fd\u6ee1\u8db3\u5b9e\u65f6\u8981\u6c42"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u4e0d\u540c\u8282\u70b9\u4e0d\u80fd\u53bb\u91cd"}),"\n",(0,l.jsx)(e.li,{children:"\u5206\u5e03\u5f0f\u65f6 \u53ef\u80fd\u76f8\u540c key \u5728\u4e0d\u540c\u8282\u70b9"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u9ed8\u8ba4 \u4fdd\u7559\u6700\u540e\u63d2\u5165"}),"\n",(0,l.jsxs)(e.li,{children:["\u5982\u679c\u7ed9\u5b9a\u4e86 ver \u5219\u4f1a\u57fa\u4e8e ver \u6392\u5e8f\u9009\u62e9\u6700\u7ec8\u4fdd\u7559\u7684\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["ver \u7c7b\u578b\u4e3a ",(0,l.jsx)(e.code,{children:"UInt*"}),", ",(0,l.jsx)(e.code,{children:"Date"}),", ",(0,l.jsx)(e.code,{children:"DateTime"}),", ",(0,l.jsx)(e.code,{children:"DateTime64"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["CollapsingMergeTree\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u57fa\u4e8e Sign \u5220\u9664\u91cd\u590d - \u53ef\u4ee5\u591a\u4e2a\u76f8\u540c\u6570\u636e"}),"\n",(0,l.jsx)(e.li,{children:"Sign = 1 - state"}),"\n",(0,l.jsx)(e.li,{children:"Sign = -1 - cancel"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636e\u91cf\u5927\u65f6\u53ef\u80fd\u5bfc\u81f4 out-of-order \u95ee\u9898"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["VersionedCollapsingMergeTree\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5728 CollapsingMergeTree \u4e4b\u4e0a\u6dfb\u52a0\u7248\u672c\u4fe1\u606f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["SummingMergeTree\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u57fa\u4e8e PK \u9884\u805a\u5408"}),"\n",(0,l.jsx)(e.li,{children:"\u805a\u5408\u9664\u4e86 PK \u4ee5\u5916\u7684\u6240\u6709\u5217"}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u679c\u7c7b\u578b \u4e0d\u80fd sum\uff0c\u5219\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u503c"}),"\n",(0,l.jsxs)(e.li,{children:["\u7528\u4e8e\u52a0\u901f\u67e5\u8be2\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8be6\u7ec6\u4fe1\u606f\u4f7f\u7528 MergeTree \u5b58\u50a8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["AggregatingMergeTree\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u81ea\u5b9a\u4e49\u5408\u5e76\u805a\u5408\u903b\u8f91 - \u7c7b\u4f3c SummingMergeTree"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"log-family",children:"Log Family"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Append sequence"}),"\n",(0,l.jsx)(e.li,{children:"\u4e0d\u652f\u6301 Delete & Update"}),"\n",(0,l.jsx)(e.li,{children:"\u4e0d\u652f\u6301 Index"}),"\n",(0,l.jsx)(e.li,{children:"\u4e0d\u652f\u6301 Atomic writing"}),"\n",(0,l.jsx)(e.li,{children:"insert block select"}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["TinyLog\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e0d\u80fd \u5e76\u884c \u8bfb"}),"\n",(0,l.jsx)(e.li,{children:"\u67e5\u8be2\u6027\u80fd\u5dee"}),"\n",(0,l.jsx)(e.li,{children:"\u683c\u5f0f\u7b80\u5355\uff0c\u9002\u5408\u4e34\u65f6\u4f7f\u7528"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["StripLog\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u80fd \u5e76\u884c\u8bfb"}),"\n",(0,l.jsx)(e.li,{children:"\u6027\u80fd\u4f18\u4e8e TinyLog"}),"\n",(0,l.jsx)(e.li,{children:"\u4ee5\u5217\u683c\u5f0f\u5b58\u50a8\u4e3a\u5355\u4e2a\u5927\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Log\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7c7b\u4f3c StripLog - \u6bcf\u4e2a\u5217\u5355\u72ec\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"special",children:"Special"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Memory\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9002\u5408\u4e0d\u9700\u8981\u6301\u4e45\u5316\u7684\u5c0f\u8868"}),"\n",(0,l.jsx)(e.li,{children:"\u4e34\u65f6\u8868"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Buffer\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Buffer \u6ee1\u540e flush \u5230\u78c1\u76d8"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["File\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u76f4\u63a5\u8bfb\u53d6\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Null\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e22\u5f03\u6570\u636e"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"s3",children:"S3"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- PostgreSQL\n-- =======================\n-- connect table\n-- insert, select\nCREATE TABLE\n  db_in_ch.table1 (id UInt64, column1 String) ENGINE = PostgreSQL(\n    'postgres-host.domain.com:5432',\n    'db_in_psg',\n    'table1',\n    'clickhouse_user',\n    'ClickHouse_123'\n  );\n\n-- materialized\n-- replica of the database\nSET\n  allow_experimental_database_materialized_postgresql = 1;\n\nCREATE DATABASE db1_postgres ENGINE = MaterializedPostgreSQL(\n  'postgres-host.domain.com:5432',\n  'db1',\n  'clickhouse_user',\n  'ClickHouse_123'\n) SETTINGS materialized_postgresql_tables_list = 'table1';\n\n-- S3\n-- =========================\n-- \u5143\u4fe1\u606f _path, _file\nSELECT\n  *\nFROM\n  s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_*.gz',\n    'TabSeparatedWithNames'\n  )\nLIMIT\n  10;\n\n-- \u5199\u5165\nINSERT INTO\n  FUNCTION s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/csv/trips.csv.lz4',\n    's3_key',\n    's3_secret',\n    'CSV'\n  )\nSELECT\n  *\nFROM\n  trips\nLIMIT\n  10000;\n\n-- \u5199\u5165\u591a\u4e2a\u6587\u4ef6\nINSERT INTO\n  FUNCTION s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/csv/trips_{_partition_id}.csv.lz4',\n    's3_key',\n    's3_secret',\n    'CSV'\n  ) PARTITION BY rand() % 10\nSELECT\n  *\nFROM\n  trips\nLIMIT\n  100000;\n\n-- engine\nCREATE TABLE\n  trips_dest (\n    `trip_id` UInt32,\n    `pickup_date` Date,\n    `pickup_datetime` DateTime,\n    `dropoff_datetime` DateTime,\n    `tip_amount` Float32,\n    `total_amount` Float32\n  ) ENGINE = S3('<bucket path>/trips.bin', 'Native');\n"})}),"\n",(0,l.jsx)(e.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u901a\u8fc7 ",(0,l.jsx)(e.code,{children:"COPY (SELECT ...) TO STDOUT"})," \u5b9e\u73b0"]}),"\n",(0,l.jsx)(e.li,{children:"\u652f\u6301 Materialized - \u521d\u6b21\u540c\u6b65\u540e\u540e\u7eed\u901a\u8fc7 WAL \u66f4\u65b0"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"mutation",children:"Mutation"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- 0 async, 1 sync\nset mutations_sync=0;\n\nselect * from system.mutations;\n"})}),"\n",(0,l.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,l.jsx)(e.h2,{id:"select-",children:"SELECT *"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e0d\u5305\u542b MATERIALIZED \u548c ALIAS"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u6570\u636e\u91cf\u65f6\u5f88\u5c11\u4f7f\u7528"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"cannot-iterate-over-non-finalized-columnobject",children:"Cannot iterate over non-finalized ColumnObject"}),"\n",(0,l.jsx)(e.p,{children:"JSON \u5217\u6709\u95ee\u9898"}),"\n",(0,l.jsx)(e.h2,{id:"memory-limit-for-query-exceeded",children:"Memory limit (for query) exceeded"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"max_memory_usage=10GB"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- \u9700\u8981\u5168\u90e8\u6570\u636e\u52a0\u8f7d\u5230\u5185\u5b58\u57fa\u4e8e PK \u6392\u5e8f\nINSERT INTO table\nSELECT x,y,z FROM source;\n\n-- \u6392\u67e5\nSHOW PROCESSLIST;\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"set max_block_size=512, max_threads=1, max_rows_to_read=512;"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"sqlite-database-file-path-must-be-inside-user_files-directory-path_access_denied",children:"SQLite database file path must be inside 'user_files' directory. (PATH_ACCESS_DENIED)"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9ed8\u8ba4 /var/lib/clickhouse/user_files/"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings/#server_configuration_parameters-user_files_path",children:"https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings/#server_configuration_parameters-user_files_path"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"to-execute-this-query-its-necessary-to-have-grant-create-user-on",children:"To execute this query it's necessary to have grant CREATE USER ON"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["users.xml\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"<access_management>1</access_management>"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"final",children:"FINAL"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"-- force collapsing, dedup, operation\nSELECT * FROM events FINAL;\n"})}),"\n",(0,l.jsx)(e.h1,{id:"snippets",children:"Snippets"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"SET describe_extend_object_types=1\nDESCRIBE tab\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"TableSize"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-sql",children:"SELECT table,\n       formatReadableSize(sum(bytes_on_disk))           as disk_size,\n       formatReadableSize(sum(data_compressed_bytes))   as compressed_size,\n       formatReadableSize(sum(data_uncompressed_bytes)) as uncompressed_size,\n       min(min_date)                                    as min_date,\n       max(max_date)                                    as max_date\nFROM system.parts\nWHERE active\nGROUP BY table\nORDER BY sum(bytes_on_disk) DESC;\n"})})]})}function x(n={}){const{wrapper:e}={...(0,s.M)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},38088:(n,e,i)=>{var l=i(96651),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,d=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function h(n,e,i){var l,r={},h=null,a=null;for(l in void 0!==i&&(h=""+i),void 0!==e.key&&(h=""+e.key),void 0!==e.ref&&(a=e.ref),e)c.call(e,l)&&!t.hasOwnProperty(l)&&(r[l]=e[l]);if(n&&n.defaultProps)for(l in e=n.defaultProps)void 0===r[l]&&(r[l]=e[l]);return{$$typeof:s,type:n,key:h,ref:a,props:r,_owner:d.current}}e.Fragment=r,e.jsx=h,e.jsxs=h},2488:(n,e,i)=>{n.exports=i(38088)},62780:(n,e,i)=>{i.d(e,{I:()=>d,M:()=>c});var l=i(96651);const s={},r=l.createContext(s);function c(n){const e=l.useContext(r);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);