/*! For license information please see 562831af.0ac9f716.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[95566],{16579:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>c});var t=s(11527),r=s(47214);const d={title:"protobuf-web"},i="protobuf-web",o={id:"service/api/protobuf/protobuf-web",title:"protobuf-web",description:"- bufbuild/protobuf-es",source:"@site/../notes/service/api/protobuf/protobuf-web.md",sourceDirName:"service/api/protobuf",slug:"/service/api/protobuf/web",permalink:"/notes/service/api/protobuf/web",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/api/protobuf/protobuf-web.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1677222278,formattedLastUpdatedAt:"Feb 24, 2023",frontMatter:{title:"protobuf-web"},sidebar:"docs",previous:{title:"Protobuf Go",permalink:"/notes/service/api/protobuf/go"},next:{title:"protoc-gen-validate",permalink:"/notes/service/api/protobuf/protoc-gen-validate"}},l={},c=[{value:"ts-proto",id:"ts-proto",level:2},{value:"protobuf-es",id:"protobuf-es",level:2},{value:"protobufjs",id:"protobufjs",level:2}];function j(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h1,{id:"protobuf-web",children:"protobuf-web"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://github.com/bufbuild/protobuf-es",children:"bufbuild/protobuf-es"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u4e0e protobuf-ts \u76f8\u540c\u4f5c\u8005"}),"\n",(0,t.jsx)(e.li,{children:"@bufbuild/protoc-gen-es"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/timostamm/protobuf-ts",children:"timostamm/protobuf-ts"})}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://github.com/protobufjs/protobuf.js",children:"protobufjs/protobuf.js"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:".proto, JSON descriptors, reflectiom, custom class"}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://protobufjs.github.io/protobuf.js/",children:"https://protobufjs.github.io/protobuf.js/"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://github.com/protocolbuffers/protobuf-javascript",children:"protocolbuffers/protobuf-javascript"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u76ee\u524d\u7ef4\u62a4\u4e0d\u8db3"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://github.com/stephenh/ts-proto",children:"stephenh/ts-proto"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u4e0d\u751f\u6210 index.ts ",(0,t.jsx)(e.a,{href:"https://github.com/stephenh/ts-proto/issues/212",children:"#212"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"ts-proto",children:"ts-proto"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"nice-grpc \u4f7f\u7528"}),"\n",(0,t.jsx)(e.li,{children:"\u751f\u6210\u5355\u72ec\u6587\u4ef6"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"opt"}),(0,t.jsx)(e.th,{children:"default"}),(0,t.jsx)(e.th,{children:"notes"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"context"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"forceLong"}),(0,t.jsx)(e.td,{children:"number"}),(0,t.jsx)(e.td,{children:"long,string"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"esModuleInterop"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"env"}),(0,t.jsx)(e.td,{children:"both"}),(0,t.jsx)(e.td,{children:"node,browser"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"useOptionals"}),(0,t.jsx)(e.td,{children:"none"}),(0,t.jsx)(e.td,{children:"message,all"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"exportCommonSymbols"}),(0,t.jsx)(e.td,{children:"true"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"oneof"}),(0,t.jsx)(e.td,{children:"unions"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"unrecognizedEnum"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{children:"\u662f\u5426\u5305\u542b UNRECOGNIZED=-1"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"lowerCaseServiceMethods"}),(0,t.jsx)(e.td,{children:"true"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"snakeToCamel"}),(0,t.jsx)(e.td,{children:"true"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"outputEncodeMethods"}),(0,t.jsx)(e.td,{children:"true"}),(0,t.jsx)(e.td,{children:"encode,decode"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"outputJsonMethods"}),(0,t.jsx)(e.td,{children:"true"}),(0,t.jsx)(e.td,{children:"fromJSON,toJSON"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"stringEnums"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsxs)(e.td,{children:["\u8981\u6c42 ",(0,t.jsx)(e.code,{children:"outputEncodeMethods=false"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"outputClientImpl"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:"grpc-web"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"returnObservable"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"Observable<T>"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"addGrpcMetadata"}),(0,t.jsx)(e.td,{}),(0,t.jsxs)(e.td,{children:["\u8981\u6c42 ",(0,t.jsx)(e.code,{children:"nestJs=true"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"addNestjsRestParameter"}),(0,t.jsx)(e.td,{}),(0,t.jsxs)(e.td,{children:["\u8981\u6c42 ",(0,t.jsx)(e.code,{children:"nestJs=true"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"nestJs"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"useDate"}),(0,t.jsx)(e.td,{children:"true"}),(0,t.jsx)(e.td,{children:"google.protobuf.Timestamp"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"useObjectId"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{children:"mongodb.ObjectId"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"outputSchema"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"outputTypeRegistry"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"$type"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"outputServices"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:"grpc-js,nice-grpc,generic-definitions,none,false"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"metadataType"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"Foo@./some-file"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"useAsyncIterable"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"emitImportedFiles"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"fileSuffix"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"importSuffix"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"enumsAsLiterals"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"as const"})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"useExactTypes"}),(0,t.jsx)(e.td,{children:"true"}),(0,t.jsx)(e.td,{children:"fromPartial"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"unknownFields"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"onlyTypes"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{children:"\u53ea\u751f\u6210\u7c7b\u578b"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"usePrototypeForDefaults"}),(0,t.jsx)(e.td,{}),(0,t.jsx)(e.td,{children:"Object.create"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"useJsonWireFormat"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"useNumericEnumForJson"}),(0,t.jsx)(e.td,{children:"false"}),(0,t.jsx)(e.td,{})]})]})]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["useOptionals - ",(0,t.jsx)(e.code,{children:"field: Message | undefined"}),", ",(0,t.jsx)(e.code,{children:"field?: Message"})]}),"\n",(0,t.jsx)(e.li,{children:"exportCommonSymbols - export DeepPartial"}),"\n",(0,t.jsx)(e.li,{children:"fromJSON - \u4f1a\u8bbe\u7f6e\u9ed8\u8ba4\u503c"}),"\n",(0,t.jsx)(e.li,{children:"toJSON - \u4e0d\u4f1a\u5ffd\u7565\u9ed8\u8ba4\u503c - \u672a\u6765\u53ef\u80fd\u4f1a"}),"\n",(0,t.jsx)(e.li,{children:"outputClientImpl - grpc-web, twirp, grpc-js, nextjs"}),"\n",(0,t.jsx)(e.li,{children:"useContext - \u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684 context \u53c2\u6570"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"outputServices=nice-grpc,outputServices=generic-definitions,useExactTypes=false,esModuleInterop=true,forceLong=long,outputTypeRegistry=true\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"// Basic gRPC\ninterface Rpc {\n  request(service: string, method: string, data: Uint8Array): Promise<Uint8Array>;\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"protobuf-es",children:"protobuf-es"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u65e0 RPC \u96c6\u6210 - \u901a\u8fc7\u81ea\u5df1\u5b9e\u73b0\u63d2\u4ef6"}),"\n",(0,t.jsxs)(e.li,{children:["\u652f\u6301\u63d2\u4ef6 ",(0,t.jsx)(e.a,{href:"https://github.com/bufbuild/protobuf-es/blob/main/docs/writing_plugins.md",children:"https://github.com/bufbuild/protobuf-es/blob/main/docs/writing_plugins.md"})]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"go install github.com/bufbuild/protobuf-es/cmd/protoc-gen-es@latest\n"})}),"\n",(0,t.jsx)(e.h2,{id:"protobufjs",children:"protobufjs"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u5f00\u53d1\u4e0d\u6d3b\u8dc3"}),"\n"]}),"\n",(0,t.jsx)(e.admonition,{type:"caution",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u4e0d\u652f\u6301 ESM ",(0,t.jsx)(e.a,{href:"https://github.com/protobufjs/protobuf.js/issues/1230",children:"#1230"})]}),"\n",(0,t.jsxs)(e.li,{children:["protobufjs \u751f\u6210\u7684 JSON \u7f3a\u5c11\u4fe1\u606f\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u65e0 comment"}),"\n",(0,t.jsxs)(e.li,{children:["option \u53ea\u80fd\u8bb0\u5f55 1 \u4e2a\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u65e0\u6cd5\u8bb0\u5f55 repeated option"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"\u65e0\u6cd5\u8bb0\u5f55\u5d4c\u5957 option"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["option \u4e3a\u5bf9\u8c61\u4f1a\u5931\u8d25 ",(0,t.jsx)(e.a,{href:"https://github.com/protobufjs/protobuf.js/issues/1788",children:"#1788"})]}),"\n"]})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"npm add -D protobufjs-cli\n\n# -t,--target - json, json-module, proto2, proto3, static, static-module\npbjs -t json file1.proto file2.proto > bundle.json\npbjs -t json-module -w commonjs -o bundle.js file1.proto file2.proto\n\npbjs -t static-module -w commonjs -o compiled.js file1.proto file2.proto\n\npbts -o compiled.d.ts compiled.js\npbjs -t static-module file1.proto file2.proto | pbts -o bundle.d.ts -\n\n#\npbjs -t json -p ./protos/bundles/ ./protos/core/**/*.proto -o src/protos/pb.json\npbjs -t static-module -p ./protos/bundles/ ./protos/core/**/*.proto -w es6 -o src/protos/pb.js\npbts -o src/protos/pb.d.ts src/protos/pb.js\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"source"}),(0,t.jsx)(e.th,{children:"lib"}),(0,t.jsx)(e.th,{children:"pros"}),(0,t.jsx)(e.th,{children:"cons"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:".proto"}),(0,t.jsx)(e.td,{children:"full"}),(0,t.jsx)(e.td,{children:"\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u7f16\u8bd1"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"json"}),(0,t.jsx)(e.td,{children:"light"}),(0,t.jsx)(e.td,{children:"\u5355 bundle\uff0c\u4e0d\u9700\u8981 parse"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"static"}),(0,t.jsx)(e.td,{children:"minimal"}),(0,t.jsx)(e.td,{children:"\u4e0d\u9700\u8981 eval, \u6709 comment"}),(0,t.jsx)(e.td,{children:"\u4ee3\u7801\u975e\u5e38\u957f"})]})]})]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u9ed8\u8ba4 root \u4e3a default"}),"\n",(0,t.jsxs)(e.li,{children:["static \u4ee3\u7801\u5f88\u957f - 1000 loc json -> 10,000 loc js\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u5f88\u591a\u7a7a\u884c\u548c\u6ce8\u91ca"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/protobufjs/protobuf.js/blob/master/cli/README.md",children:"https://github.com/protobufjs/protobuf.js/blob/master/cli/README.md"})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"| pbjs          |\n| ------------- | ------------------ |\n| --alt-comment | \u89e3\u6790\u51fa\u66f4\u591a comment |\n| -w            | es6                |"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"import * as $protobuf from 'protobufjs/light';\n\n// \u53ef\u4ee5\u6709\u591a\u4e2a ROOT\n$protobuf.roots['default'] = new $protobuf.Root();\n"})})]})}function h(n={}){const{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(j,{...n})}):j(n)}},3354:(n,e,s)=>{var t=s(50959),r=Symbol.for("react.element"),d=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(n,e,s){var t,d={},c=null,j=null;for(t in void 0!==s&&(c=""+s),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(j=e.ref),e)i.call(e,t)&&!l.hasOwnProperty(t)&&(d[t]=e[t]);if(n&&n.defaultProps)for(t in e=n.defaultProps)void 0===d[t]&&(d[t]=e[t]);return{$$typeof:r,type:n,key:c,ref:j,props:d,_owner:o.current}}e.Fragment=d,e.jsx=c,e.jsxs=c},11527:(n,e,s)=>{n.exports=s(3354)},47214:(n,e,s)=>{s.d(e,{Z:()=>o,a:()=>i});var t=s(50959);const r={},d=t.createContext(r);function i(n){const e=t.useContext(d);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),t.createElement(d.Provider,{value:e},n.children)}}}]);