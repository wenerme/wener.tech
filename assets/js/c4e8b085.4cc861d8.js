/*! For license information please see c4e8b085.4cc861d8.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[65436],{80148:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>t,toc:()=>r});var i=l(2488),s=l(62780);const o={title:"Ansible Collection"},a="Ansible Collection",t={id:"devops/infra/ansible/ansible-collection",title:"Ansible Collection",description:"- Collection \u662f Ansible Galaxy Role \u7684\u7ee7\u627f\u8005",source:"@site/../notes/devops/infra/ansible/ansible-collection.md",sourceDirName:"devops/infra/ansible",slug:"/devops/infra/ansible/collection",permalink:"/notes/devops/infra/ansible/collection",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/infra/ansible/ansible-collection.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1693463269,formattedLastUpdatedAt:"Aug 31, 2023",frontMatter:{title:"Ansible Collection"},sidebar:"docs",previous:{title:"Ansible for Cloud",permalink:"/notes/devops/infra/ansible/cloud"},next:{title:"Ansible Cookbook",permalink:"/notes/devops/infra/ansible/cookbook"}},c={},r=[{value:"dev",id:"dev",level:2},{value:"lint",id:"lint",level:2},{value:"playbook",id:"playbook",level:2},{value:"requirements.yml",id:"requirementsyml",level:2},{value:"ansible.cfg",id:"ansiblecfg",level:2},{value:"\u5185\u7f6e",id:"\u5185\u7f6e",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,s.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"ansible-collection",children:"Ansible Collection"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Collection \u662f Ansible Galaxy Role \u7684\u7ee7\u627f\u8005"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u53ea\u80fd\u5305\u542b role\uff0c\u8fd8\u80fd\u5305\u542b\u5404\u79cd\u63d2\u4ef6\uff0c\u6587\u6863\uff0c\u4efb\u52a1\u7b49"}),"\n",(0,i.jsxs)(n.li,{children:["\u9ed8\u8ba4\u5b89\u88c5\u76ee\u5f55 ",(0,i.jsx)(n.code,{children:"~/.ansible/collections"})," - COLLECTIONS_PATHS,"]}),"\n",(0,i.jsx)(n.li,{children:"\u5168\u5c40\u4f4d\u7f6e /usr/share/ansible/collections"}),"\n",(0,i.jsxs)(n.li,{children:["\u9ed8\u8ba4\u670d\u52a1\u5668 ",(0,i.jsx)(n.a,{href:"https://galaxy.ansible.com",children:"https://galaxy.ansible.com"})," - GALAXY_SERVER"]}),"\n",(0,i.jsx)(n.li,{children:"server_list \u6216 GALAXY_SERVER_LIST \u53ef\u6307\u5b9a\u4e00\u7ec4\u670d\u52a1"}),"\n",(0,i.jsxs)(n.li,{children:["\u5185\u5efa collections \u5b89\u88c5\u4f4d\u7f6e ",(0,i.jsx)(n.code,{children:"/usr/lib/python3.8/site-packages/ansible_collections"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ansible.com/ansible/devel/user_guide/collections_using.html",children:"\u4f7f\u7528\u6587\u6863"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# namespace.collection\nansible-galaxy collection install wenerme.alpine\n# \u53ef\u4ee5\u4e0b\u8f7d\u79bb\u7ebf\u4f7f\u7528\nansible-galaxy collection download wenerme.alpine\n\n# \u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5 tar\uff0c\u53ef\u4ee5\u6307\u5b9a\u76ee\u5f55\n# \u76ee\u5f55\u4f1a\u6dfb\u52a0 ansible_collections\nansible-galaxy collection install my_namespace-my_collection-1.0.0.tar.gz -p ./collections\n\n# \u53ef\u4ee5\u9650\u5b9a\u7248\u672c\nansible-galaxy collection install 'my_namespace.my_collection:>=1.0.0,<2.0.0'\n\n# \u80fd\u4ece\u4ed3\u5e93\u5b89\u88c5\n# \u4e5f\u65b9\u4fbf\u4f7f\u7528\u79c1\u6709 collection\nansible-galaxy collection install git+https://github.com/organization/repo_name.git,devel\nansible-galaxy collection install git@github.com:organization/repo_name.git\nansible-galaxy collection install git+file:///home/user/path/to/repo/.git\n\n# \u5b89\u88c5\u4f9d\u8d56\n# \u7b49\u540c\u4e8e ansible-galaxy role install -r + ansible-galaxy collection install -r\nansible-galaxy install -r requirements.yml\n# \u53ef\u4ee5\u4e0b\u8f7d\u6240\u6709\u4f9d\u8d56\nansible-galaxy collection download -r requirements.yml\n\n# \u67e5\u770b\u5df2\u5b89\u88c5\nansible-galaxy collection list\n# \u67e5\u770b\u76ee\u5f55\u4e0b\u5185\u5bb9\nansible-galaxy collection list -p '/opt/ansible/collections:/etc/ansible/collections'\n# \u9a8c\u8bc1\nansible-galaxy collection verify wenerme.alpine -vvv\n"})}),"\n",(0,i.jsx)(n.h2,{id:"dev",children:"dev"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/dev_guide/developing_collections.html",children:"Developing collections"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/ansible/creator-ee",children:"ansible/creator-ee"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ansible-galaxy collection init my_namespace.my_collection\n"})}),"\n",(0,i.jsx)(n.h2,{id:"lint",children:"lint"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u6240\u6709\u89c4\u5219\nansible-lint -L\n# \u53ea\u6267\u884c\u90e8\u5206\u89c4\u5219\nansible-lint --enable-list command-instead-of-shell\n\n# auto lint\nansible-lint\n"})}),"\n",(0,i.jsx)(n.h2,{id:"playbook",children:"playbook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# FQDN\n- hosts: all\n  tasks:\n  - my_namespace.my_collection.mymodule:\n      option1: value\n  - import_role:\n      name: my_namespace.my_collection.role1\n  - debug:\n      msg: '{{ lookup(\"my_namespace.my_collection.lookup1\", 'param1')| my_namespace.my_collection.filter1 }}'\n---\n# use collections\n- hosts: all\n  collections:\n  - my_namespace.my_collection\n  tasks:\n  - import_role:\n      name: role1\n  - mymodule:\n      option1: value\n  - debug:\n      msg: '{{ lookup(\"my_namespace.my_collection.lookup1\", 'param1')| my_namespace.my_collection.filter1 }}'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"requirementsyml",children:"requirements.yml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Ansible Galaxy \u89d2\u8272\nroles:\n  - name: geerlingguy.java\n    version: 1.9.6\n\ncollections:\n  # \u540d\u5b57\n  - wenerme.alpine\n  # \u8be6\u7ec6\u4fe1\u606f\n  - name: https://github.com/organization/repo_name.git\n    type: git\n    version: devel\n\n  - name: geerlingguy.php_roles\n    version: 0.9.3\n    source: https://galaxy.ansible.com\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ansiblecfg",children:"ansible.cfg"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"[default]\n# \u5b89\u88c5\u5230\u5f53\u524d\u76ee\u5f55\n# ./ansible_collections/<namespace>/<collection>\ncollections_paths = ./\n# ./roles/<namespace>.<collection>\nroles_path = ./roles\n\n# \u5b9a\u4e49\u670d\u52a1\u7aef\n[galaxy]\nserver_list = automation_hub, my_org_hub, release_galaxy, test_galaxy\n\n[galaxy_server.automation_hub]\n# url, token, username, password, auth_url\n# ANSIBLE_GALAXY_SERVER_{{ id }}_{{ key }}\nurl=https://cloud.redhat.com/api/automation-hub/\nauth_url=https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token\ntoken=my_ah_token\n\n[galaxy_server.my_org_hub]\nurl=https://automation.my_org/\nusername=my_user\npassword=my_pass\n\n[galaxy_server.release_galaxy]\nurl=https://galaxy.ansible.com/\ntoken=my_token\n\n[galaxy_server.test_galaxy]\nurl=https://galaxy-dev.ansible.com/\ntoken=my_test_token\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5185\u7f6e",children:"\u5185\u7f6e"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/collections/index.html",children:"Collection Index"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html",children:"ansible.builtin"})}),"\n"]}),"\n"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},38088:(e,n,l)=>{var i=l(96651),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,t=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function r(e,n,l){var i,o={},r=null,d=null;for(i in void 0!==l&&(r=""+l),void 0!==n.key&&(r=""+n.key),void 0!==n.ref&&(d=n.ref),n)a.call(n,i)&&!c.hasOwnProperty(i)&&(o[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===o[i]&&(o[i]=n[i]);return{$$typeof:s,type:e,key:r,ref:d,props:o,_owner:t.current}}n.Fragment=o,n.jsx=r,n.jsxs=r},2488:(e,n,l)=>{e.exports=l(38088)},62780:(e,n,l)=>{l.d(n,{I:()=>t,M:()=>a});var i=l(96651);const s={},o=i.createContext(s);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);