/*! For license information please see 6a4493dd.ed521c95.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[12332],{52428:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var s=r(2488),t=r(62780);const i={title:"K3S \u914d\u7f6e",tags:["Configuration"]},o="K3S \u914d\u7f6e",l={id:"devops/kubernetes/distro/k3s/k3s-conf",title:"K3S \u914d\u7f6e",description:"- \u81ea v1.19 \u652f\u6301 yaml \u914d\u7f6e",source:"@site/../notes/devops/kubernetes/distro/k3s/k3s-conf.md",sourceDirName:"devops/kubernetes/distro/k3s",slug:"/devops/kubernetes/distro/k3s/conf",permalink:"/notes/devops/kubernetes/distro/k3s/conf",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/distro/k3s/k3s-conf.md",tags:[{label:"Configuration",permalink:"/notes/tags/configuration"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1689238697,formattedLastUpdatedAt:"Jul 13, 2023",frontMatter:{title:"K3S \u914d\u7f6e",tags:["Configuration"]},sidebar:"docs",previous:{title:"Centos",permalink:"/notes/devops/kubernetes/distro/k3s/centos"},next:{title:"K3S Cookbook",permalink:"/notes/devops/kubernetes/distro/k3s/cookbook"}},a={},c=[{value:"registries.yaml",id:"registriesyaml",level:2},{value:"config.yaml",id:"configyaml",level:2},{value:"server",id:"server",level:3},{value:"agent",id:"agent",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,t.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"k3s-\u914d\u7f6e",children:"K3S \u914d\u7f6e"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u81ea v1.19 \u652f\u6301 yaml \u914d\u7f6e"}),"\n",(0,s.jsxs)(n.li,{children:["/etc/rancher/k3s/config.yaml - K3S_CONFIG_FILE, --config, -c\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"yaml \u914d\u7f6e"}),"\n",(0,s.jsx)(n.li,{children:"\u53c2\u6570\u57fa\u672c\u4e0e\u547d\u4ee4\u884c\u53c2\u6570\u4e00\u81f4"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/etc/rancher/k3s/config.yaml.d/*.yaml"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["key \u524d\u9762\u52a0 ",(0,s.jsx)(n.code,{children:"+"})," \u53ef\u7528\u4e8e\u9644\u52a0\u5185\u5bb9"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"/etc/rancher/k3s/k3s.yaml - KUBECONFIG"}),"\n",(0,s.jsx)(n.li,{children:"/etc/rancher/k3s/registries.yaml - \u5bb9\u5668\u955c\u50cf\u4ed3\u5e93\u914d\u7f6e"}),"\n",(0,s.jsx)(n.li,{children:"\u73af\u5883\u53d8\u91cf K3S_DATASTORE_ENDPOINT \u6620\u5c04\u4e3a datastore-endpoint"}),"\n",(0,s.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.k3s.io/installation/configuration",children:"https://docs.k3s.io/installation/configuration"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.k3s.io/reference/env-variables",children:"https://docs.k3s.io/reference/env-variables"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"registriesyaml",children:"registries.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'mirrors:\n  # \u9488\u5bf9 docker.io \u7684\u955c\u50cf\u4ed3\u5e93\n  docker.io:\n    endpoint:\n      - https://fogjl973.mirror.aliyuncs.com\n      - https://8x40wsit.mirror.aliyuncs.com\n      - https://docker.mirrors.ustc.edu.cn\n      - https://registry-1.docker.io\n# \u79c1\u6709\u4ed3\u5e93\u8fd8\u9700\u8981\u914d\u7f6e\u8ba4\u8bc1\u4fe1\u606f\n# configs:\n#   # \u6dfb\u52a0\u6388\u6743\u548c\u8bc1\u4e66\n#   "mycustomreg:5000":\n#     auth:\n#       username: xxxxxx\n#       password: xxxxxx\n#     tls:\n#       cert_file:\n#       key_file:\n#       ca_file:\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.k3s.io/installation/private-registry",children:"https://docs.k3s.io/installation/private-registry"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configyaml",children:"config.yaml"}),"\n",(0,s.jsx)(n.h3,{id:"server",children:"server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# \u6570\u636e\u5e93\u914d\u7f6e\ndatastore-endpoint:\n# TLS \u8fde\u63a5 - \u6bd4\u5982 PG\ndatastore-cafile:\ndatastore-certfile:\ndatastore-keyfile:\n\n# \u52a0\u5165 server \u548c agent\ntoken:\ntoken-file:\n\nagent-token:\nagent-token-file:\n\n# \u5199\u5165 kubeconfig\nwrite-kubeconfig: /etc/rancher/k3s/k3s.yml\nwrite-kubeconfig-mode: '0644'\n\n# Agent \u914d\u7f6e - server \u4e5f\u4f1a\u8fd0\u884c agent\uff0c\u914d\u7f6e\u540c agent \u914d\u7f6e\n#\n\n# \u76d1\u542c\u914d\u7f6e\nbind-address: 0.0.0.0\nhttps-listen-port: 6443\nadvertise-address: #node-external-ip/node-ip\nadvertise-port:\n# \u5982\u679c\u5e0c\u671b\u8bc1\u4e66\u5728\u67d0\u4e2a\u57df\u540d\u4e0b\u53ef\u4f7f\u7528\u5219\u9700\u8981\u6dfb\u52a0 SAN\ntls-san:\n  - k3s.example.com\n\n# \u5982\u679c\u975e ROOT ${HOME}/.rancher/k3s\ndata-dir: /var/lib/rancher/k3s\n\n# \u7f51\u7edc\ncluster-cidr: 10.42.0.0/16\nservice-cidr: 10.43.0.0/16\n# CoreDNS\ncluster-dns: 10.43.0.10\ncluster-domain: cluster.local\n# none,vxlan,ipsec,host-gw,wireguard\nflannel-backend: vxlan\n\n# \u81ea\u5b9a\u4e49\nkube-apiserver-arg:\nkube-scheduler-arg:\nkube-controller-manager-arg:\nkube-cloud-controller-manager-arg:\n\nkubelet-arg:\nkube-proxy-arg:\n\n# \u9ed8\u8ba4\u672c\u5730\u57fa\u4e8e path \u7684 sc \u5b58\u50a8\u8def\u5f84\ndefault-local-storage-path:\n\n# \u7ec4\u4ef6\n# coredns, servicelb, traefik, local-storage, metrics-server\ndisable:\n  - servicelb\n  - traefik\ndisable-scheduler: false\ndisable-cloud-controller: false\ndisable-network-policy: false\n\n# \u5b9e\u9a8c\u9636\u6bb5\nrootless: false\nserver:\n\n# --cluster-init\n# --cluster-reset\n\n# Secret encryption at rest\nsecrets-encryption: false\n"})}),"\n",(0,s.jsx)(n.h3,{id:"agent",children:"agent"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.k3s.io/cli/agent",children:"https://docs.k3s.io/cli/agent"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"token: value\ntoken-file: k3s-agent.token\nserver: value\n\ndata-dir: /var/lib/rancher/k3s\n\n# Note\nnode-name: hostname\n# with-node-id: true\n# node-label\n# node-taint\n\n# Runtime\n# docker: true\ncontainer-runtime-endpoint:\npause-image: docker.io/rancher/pause:3.1\nprivate-registry: /etc/rancher/k3s/registries.yaml\n\n# Networking\n# node-ip:\n# node-external-ip:\n# resolv-conf\nflannel-iface:\nflannel-conf:\n\nkubelet-arg:\nkube-proxy-arg:\n\nrootless: true\n"})})]})}function u(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},38088:(e,n,r)=>{var s=r(96651),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,r){var s,i={},c=null,d=null;for(s in void 0!==r&&(c=""+r),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(d=n.ref),n)o.call(n,s)&&!a.hasOwnProperty(s)&&(i[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===i[s]&&(i[s]=n[s]);return{$$typeof:t,type:e,key:c,ref:d,props:i,_owner:l.current}}n.Fragment=i,n.jsx=c,n.jsxs=c},2488:(e,n,r)=>{e.exports=r(38088)},62780:(e,n,r)=>{r.d(n,{I:()=>l,M:()=>o});var s=r(96651);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);