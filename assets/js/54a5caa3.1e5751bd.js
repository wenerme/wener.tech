/*! For license information please see 54a5caa3.1e5751bd.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[68331],{20186:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>a});var s=t(11527),r=t(47214);const i={title:"Citus Columnar"},l="Citus Columnar",o={id:"db/relational/postgresql/citus-columnar",title:"Citus Columnar",description:"- src/backend/columnar",source:"@site/../notes/db/relational/postgresql/citus-columnar.md",sourceDirName:"db/relational/postgresql",slug:"/db/relational/postgresql/citus-columnar",permalink:"/notes/db/relational/postgresql/citus-columnar",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/citus-columnar.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1660268591,formattedLastUpdatedAt:"Aug 12, 2022",frontMatter:{title:"Citus Columnar"},sidebar:"docs",previous:{title:"PostgresSQL",permalink:"/notes/db/relational/postgresql/"},next:{title:"Citus Version",permalink:"/notes/db/relational/postgresql/citus-version"}},c={},a=[{value:"Chunk Group Filtering",id:"chunk-group-filtering",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,r.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"citus-columnar",children:"Citus Columnar"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/citusdata/citus/tree/master/src/backend/columnar",children:"src/backend/columnar"})}),"\n",(0,s.jsx)(e.li,{children:"\u683c\u5f0f\u884d\u751f\u81ea ORC\uff0c\u4f46\u5143\u6570\u636e\u5728 PG\uff0c\u80fd\u4e8b\u52a1\u4fee\u6539"}),"\n",(0,s.jsxs)(e.li,{children:["\u53c2\u8003\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://www.citusdata.com/blog/2021/03/06/citus-10-columnar-compression-for-postgres/",children:"Citus 10 brings columnar compression to Postgres"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"No UPDATE or DELETE"}),"\n",(0,s.jsx)(e.li,{children:"No logical replication or logical decoding"}),"\n",(0,s.jsx)(e.li,{children:"btree and hash indexe"}),"\n",(0,s.jsx)(e.li,{children:"\u5e9f\u5f03 cstore_fdw"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://news.ycombinator.com/item?id=26369305",children:"HN"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/citusdata/citus/issues/4742",children:"#4742"})," unlogged"]}),"\n",(0,s.jsx)(e.li,{children:"\u5728 I/O-bound \u975e\u5e38\u6709\u7528, CPU-bound \u573a\u666f\u80af\u5b9a\u6bd4\u4e0d\u8fc7\u4e13\u95e8\u4e3a column \u8bbe\u8ba1\u7684\u6267\u884c\u5f15\u64ce"}),"\n"]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE contestant (\n    handle TEXT,\n    birthdate DATE,\n    rating INT,\n    percentile FLOAT,\n    country CHAR(3),\n    achievements TEXT[]\n) USING columnar;\n\n\n-- \u8f6c\u6362\u4e3a \u884c \u5b58\u50a8\nSELECT alter_table_set_access_method('contestant', 'heap');\n-- \u8f6c\u6362\u4e3a \u5217 \u5b58\u50a8 - index \u4f1a\u88ab drop\nSELECT alter_table_set_access_method('contestant', 'columnar');\n\nVACUUM VERBOSE contestant;\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9002\u7528\u4e8e\u5355\u884c\u6570\u636e\u91cf\u5927\u65f6\uff0c\u51cf\u5c11\u52a0\u8f7d\u5230\u5185\u5b58\u7684\u6570\u636e"}),"\n",(0,s.jsx)(e.li,{children:"\u9002\u7528\u4e8e\u5927\u6570\u636e\u5206\u6790 - \u5b9a\u65f6\u751f\u6210\u8868"}),"\n",(0,s.jsxs)(e.li,{children:["\u6709\u975e\u5e38\u591a\u7684\u4f7f\u7528\u9650\u5236\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Append-only - \u4e0d\u53ef\u66f4\u65b0\u548c\u5220\u9664"}),"\n",(0,s.jsx)(e.li,{children:"Rollback \u4e5f\u4e0d\u4f1a\u6062\u590d\u5df2\u5199\u5165\u7a7a\u95f4"}),"\n",(0,s.jsx)(e.li,{children:"\u53ea\u652f\u6301 hash \u548c btree \u7d22\u5f15"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 index scan, bitmap index scan"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 tiscan"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 sample scan"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 toast - inline \u5b58\u50a8"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 onconflict - \u652f\u6301\u7eaf DO NOTHING"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 \u9501 - SELECT \u2026 FOR SHARE, SELECT \u2026 FOR UPDATE"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 serializable isolation level"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 foreign keys, unique constraints, exclusion constraints"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 logical decoding"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 intra-node parallel scans"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u652f\u6301 AFTER \u2026 FOR EACH ROW trigger"}),"\n",(0,s.jsx)(e.li,{children:"\u65e0 UNLOGGED, TEMPORARY"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["strip\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"150000 rows/strip - alter_columnar_table_set \u53ef\u4fee\u6539"}),"\n",(0,s.jsx)(e.li,{children:"\u538b\u7f29\u5355\u4f4d"}),"\n",(0,s.jsxs)(e.li,{children:["\u6bcf\u4e2a\u4e8b\u52a1\u4f1a\u521b\u5efa - \u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u53ea\u63d2\u5165\u4e00\u6761\u4e5f\u4f1a\u521b\u5efa\u4e00\u4e2a strip\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5c3d\u91cf\u6279\u91cf\u63d2\u5165"}),"\n",(0,s.jsx)(e.li,{children:"\u5982\u679c\u6709\u5f88\u591a\u5c0f strip\uff0c\u8868\u662f\u65e0\u6cd5\u4fee\u590d\u7684\uff0c\u53ea\u80fd\u4ece\u65b0 INSERT INTO SELECT"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",metastring:'title="\u4fee\u590d\u8868"',children:"BEGIN;\nCREATE TABLE foo_compacted (LIKE foo) USING columnar;\nINSERT INTO foo_compacted SELECT * FROM foo;\nDROP TABLE foo;\nALTER TABLE foo_compacted RENAME TO foo;\nCOMMIT;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"chunk-group-filtering",children:"Chunk Group Filtering"})]})}function u(n={}){const{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},3354:(n,e,t)=>{var s=t(50959),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function a(n,e,t){var s,i={},a=null,d=null;for(s in void 0!==t&&(a=""+t),void 0!==e.key&&(a=""+e.key),void 0!==e.ref&&(d=e.ref),e)l.call(e,s)&&!c.hasOwnProperty(s)&&(i[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps)void 0===i[s]&&(i[s]=e[s]);return{$$typeof:r,type:n,key:a,ref:d,props:i,_owner:o.current}}e.Fragment=i,e.jsx=a,e.jsxs=a},11527:(n,e,t)=>{n.exports=t(3354)},47214:(n,e,t)=>{t.d(e,{Z:()=>o,a:()=>l});var s=t(50959);const r={},i=s.createContext(r);function l(n){const e=s.useContext(i);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);