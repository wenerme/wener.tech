"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[64417],{49613:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return g}});var r=n(59496);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),c=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=a,g=p["".concat(i,".").concat(m)]||p[m]||d[m]||o;return n?r.createElement(g,s(s({ref:t},u),{},{components:n})):r.createElement(g,s({ref:t},u))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[p]="string"==typeof e?e:a,s[1]=l;for(var c=2;c<o;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},94430:function(e,t,n){n.r(t),n.d(t,{assets:function(){return b},contentTitle:function(){return k},default:function(){return x},frontMatter:function(){return g},metadata:function(){return f},toc:function(){return v}});var r=n(49613),a=Object.defineProperty,o=Object.defineProperties,s=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))i.call(t,n)&&u(e,n,t[n]);if(l)for(var n of l(t))c.call(t,n)&&u(e,n,t[n]);return e},d=(e,t)=>o(e,s(t)),m=(e,t)=>{var n={};for(var r in e)i.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&l)for(var r of l(e))t.indexOf(r)<0&&c.call(e,r)&&(n[r]=e[r]);return n};const g={id:"nextjs-cookbook",title:"NextJS Cookbook",tags:["Cookbook"]},k="NextJS Cookbook",f={unversionedId:"web/framework/nextjs/nextjs-cookbook",id:"web/framework/nextjs/nextjs-cookbook",title:"NextJS Cookbook",description:"- \u5b98\u65b9\u4f8b\u5b50 https://github.com/zeit/next.js/tree/canary/examples",source:"@site/../notes/web/framework/nextjs/nextjs-cookbook.md",sourceDirName:"web/framework/nextjs",slug:"/web/framework/nextjs/cookbook",permalink:"/notes/web/framework/nextjs/cookbook",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/web/framework/nextjs/nextjs-cookbook.md",tags:[{label:"Cookbook",permalink:"/notes/tags/cookbook"}],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1669864776,formattedLastUpdatedAt:"Dec 1, 2022",frontMatter:{id:"nextjs-cookbook",title:"NextJS Cookbook",tags:["Cookbook"]},sidebar:"docs",previous:{title:"App Layout",permalink:"/notes/web/framework/nextjs/app"},next:{title:"NextJS FAQ",permalink:"/notes/web/framework/nextjs/faq"}},b={},v=[{value:"\u914d\u7f6e\u95ee\u9898\u6392\u67e5",id:"\u914d\u7f6e\u95ee\u9898\u6392\u67e5",level:2},{value:"\u9875\u9762\u57fa\u7840\u4ee3\u7801",id:"\u9875\u9762\u57fa\u7840\u4ee3\u7801",level:2},{value:"API \u57fa\u7840\u4ee3\u7801",id:"api-\u57fa\u7840\u4ee3\u7801",level:2},{value:"\u9875\u9762\u8df3\u8f6c",id:"\u9875\u9762\u8df3\u8f6c",level:2},{value:"SSE - Servr-Send Event",id:"sse---servr-send-event",level:2},{value:"CSS \u5bfc\u5165\u5b57\u4f53",id:"css-\u5bfc\u5165\u5b57\u4f53",level:2},{value:"\u5bfc\u5165 SVG",id:"\u5bfc\u5165-svg",level:2},{value:"\u4f7f\u7528 @svgr/webpack",id:"\u4f7f\u7528-svgrwebpack",level:3},{value:"\u4f7f\u7528 inline-react-svg",id:"\u4f7f\u7528-inline-react-svg",level:3}],h={toc:v},N="wrapper";function x(e){var t=e,{components:n}=t,a=m(t,["components"]);return(0,r.kt)(N,d(p(p({},h),a),{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",p({},{id:"nextjs-cookbook"}),"NextJS Cookbook"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b98\u65b9\u4f8b\u5b50 ",(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/zeit/next.js/tree/canary/examples"}),"https://github.com/zeit/next.js/tree/canary/examples")),(0,r.kt)("li",{parentName:"ul"},"compose ",(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/JerryCauser/next-compose/blob/master/index.js"}),"https://github.com/JerryCauser/next-compose/blob/master/index.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://dev.to/toomuchdesign/next-js-react-router-2kl8"}),"https://dev.to/toomuchdesign/next-js-react-router-2kl8"))),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"// \u5224\u65ad\u670d\u52a1\u7aef\nconst isServer = typeof window === 'undefined';\n")),(0,r.kt)("h2",p({},{id:"\u914d\u7f6e\u95ee\u9898\u6392\u67e5"}),"\u914d\u7f6e\u95ee\u9898\u6392\u67e5"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-js"}),"// \u8f93\u51fa Webpack \u7684\u5339\u914d\u89c4\u5219\nconfig.module.rules.forEach((rule) => console.log(`Rule Test ${rule.test} Use`, rule.use));\n")),(0,r.kt)("h2",p({},{id:"\u9875\u9762\u57fa\u7840\u4ee3\u7801"}),"\u9875\u9762\u57fa\u7840\u4ee3\u7801"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import React from 'react';\nimport { NextPage } from 'next';\n\nconst Page: NextPage = () => {\n  return <div></div>;\n};\n\nexport default Page;\n")),(0,r.kt)("h2",p({},{id:"api-\u57fa\u7840\u4ee3\u7801"}),"API \u57fa\u7840\u4ee3\u7801"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import { NextApiRequest, NextApiResponse } from 'next';\n\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.status(200).json({ version: process.env.APP_VERSION || '1.0.0' });\n};\n\nexport default handler;\n")),(0,r.kt)("h2",p({},{id:"\u9875\u9762\u8df3\u8f6c"}),"\u9875\u9762\u8df3\u8f6c"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"// \u521d\u59cb\u9636\u6bb5\u8df3\u8f6c\nPage.getInitialProps = async ({ res }) => {\n  // \u76ee\u6807\u5730\u5740\n  let targetUrl = '...';\n  if (!res) {\n    window.location.href = targetUrl;\n  } else {\n    res.writeHead(302, { Location: targetUrl });\n    res.end();\n  }\n  return {};\n};\n\n// \u9875\u9762\u5185\u8df3\u8f6c\nfunction MyPage() {\n  const router = useRouter();\n  useEffect(() => {\n    if (!auth) {\n      router.push('...');\n    }\n  }, []);\n}\n\n// API \u8df3\u8f6c\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.clearCookie('authenticated');\n  res.writeHead(302, { Location: '/login' });\n  res.end();\n};\n")),(0,r.kt)("h2",p({},{id:"sse---servr-send-event"}),"SSE - Servr-Send Event"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"import { NextApiRequest, NextApiResponse } from 'next';\n\nexport const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n\n// curl -Nv localhost:3000/test/see\n// https://zeit.co/pricing#limits Zeit free only allowed 10s/req\n// NOTE Zeit deploy not works - because the request will be buffered\n// https://github.com/zeit/next.js/issues/9965\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Content-Type', 'text/event-stream;charset=utf-8');\n  res.setHeader('Cache-Control', 'no-cache, no-transform');\n  res.setHeader('X-Accel-Buffering', 'no');\n\n  for (let i = 0; i < 5; i++) {\n    res.write(`data: Hello seq ${i}\\n\\n`);\n    await sleep(1000);\n  }\n  res.end('done\\n');\n};\n\nexport default handler;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-html"}),"<!DOCTYPE html>\n<html>\n  <head>\n    <meta http-equiv=\"Content-type\" content=\"text/html; charset=utf-8\" />\n    <title>EventSource test</title>\n  </head>\n  <body>\n    <h1>EventSource test</h1>\n    <ul></ul>\n\n    <script type=\"text/javascript\">\n      var logger = document.getElementsByTagName('ul')[0],\n        socket = new EventSource('/');\n\n      var log = function (text) {\n        logger.innerHTML += '<li>' + text + '</li>';\n      };\n\n      socket.onopen = function () {\n        log('OPEN');\n      };\n\n      socket.onmessage = function (event) {\n        log('MESSAGE: ' + event.data);\n      };\n\n      socket.addEventListener('update', function (event) {\n        log('UPDATE(' + event.lastEventId + '): ' + event.data);\n      });\n\n      socket.onerror = function (event) {\n        log('ERROR: ' + event.message);\n      };\n    <\/script>\n  </body>\n</html>\n")),(0,r.kt)("h2",p({},{id:"css-\u5bfc\u5165\u5b57\u4f53"}),"CSS \u5bfc\u5165\u5b57\u4f53"),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-js"}),"config.module.rules.push({\n  test: /\\.(eot|woff|woff2|ttf)$/,\n  use: {\n    loader: 'url-loader',\n    options: {\n      limit: 100000,\n      name: '[name].[ext]',\n    },\n  },\n});\n")),(0,r.kt)("h2",p({},{id:"\u5bfc\u5165-svg"}),"\u5bfc\u5165 SVG"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"url-loader inline \u4f1a\u751f\u6210 dataurl - react \u53ef\u80fd\u5bfc\u81f4\u5f02\u5e38"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/twopluszero/next-images"}),"next-images"))),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-ts"}),"// Typescript \u786e\u4fdd\u4e0d\u4f1a\u51fa\u73b0\u7c7b\u578b\u9519\u8bef\ndeclare module '*.svg';\n\ndeclare module '*.png';\ndeclare module '*.jpg';\ndeclare module '*.jpeg';\ndeclare module '*.gif';\n")),(0,r.kt)("h3",p({},{id:"\u4f7f\u7528-svgrwebpack"}),"\u4f7f\u7528 @svgr/webpack"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u4f7f\u7528 tsconfig \u4e2d\u7684 path"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://react-svgr.com/docs/webpack/"}),"https://react-svgr.com/docs/webpack/")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/webpack-contrib/url-loader/issues/86"}),"https://github.com/webpack-contrib/url-loader/issues/86")),(0,r.kt)("li",{parentName:"ul"},"Base64 \u95ee\u9898",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/gregberge/svgr/issues/361"}),"https://github.com/gregberge/svgr/issues/361")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",p({parentName:"li"},{href:"https://github.com/gregberge/svgr/issues/404"}),"https://github.com/gregberge/svgr/issues/404"))))),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"yarn add --dev @svgr/webpack babel-loader\n")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-js"}),"config.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  use: [\n    {\n      loader: 'babel-loader',\n    },\n    {\n      loader: '@svgr/webpack',\n      options: {\n        babel: false,\n        icon: true,\n      },\n    },\n  ],\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-js"}),"// \u533a\u5206 js \u6216 css \u5bfc\u5165\nconfig.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  issuer: {\n    test: /\\.[tj]sx?$/,\n  },\n  use: ['babel-loader', '@svgr/webpack', 'file-loader'],\n});\n\nconfig.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  loader: 'url-loader',\n});\n")),(0,r.kt)("h3",p({},{id:"\u4f7f\u7528-inline-react-svg"}),"\u4f7f\u7528 inline-react-svg"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u4e0d\u53ef\u4ee5")," \u4f7f\u7528 tsconfig \u4e2d\u7684 path"),(0,r.kt)("li",{parentName:"ul"},"\u4f1a\u7528 SVGO \u4f18\u5316")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"yarn add --dev babel-plugin-inline-react-svg\n")),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-json"}),'{\n  "presets": ["next/babel"],\n  "plugins": ["inline-react-svg"]\n}\n')))}x.isMDXComponent=!0}}]);