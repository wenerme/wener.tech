/*! For license information please see 543b6826.7a5e72b7.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[19972],{75e3:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>a,frontMatter:()=>t,metadata:()=>r,toc:()=>o});var i=s(2488),c=s(62780);const t={title:"juicefs"},l="juicefs",r={id:"service/storage/juicefs/README",title:"juicefs",description:"- juicedata/juicefs",source:"@site/../notes/service/storage/juicefs/README.md",sourceDirName:"service/storage/juicefs",slug:"/service/storage/juicefs/",permalink:"/notes/service/storage/juicefs/",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/service/storage/juicefs/README.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1709090151,formattedLastUpdatedAt:"Feb 28, 2024",frontMatter:{title:"juicefs"},sidebar:"docs",previous:{title:"Gluster",permalink:"/notes/service/storage/gluster"},next:{title:"JuiceFS Configuration",permalink:"/notes/service/storage/juicefs/conf"}},d={},o=[{value:"Command",id:"command",level:2},{value:"Metdata",id:"metdata",level:2},{value:"Docker",id:"docker",level:2}];function j(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"juicefs",children:"juicefs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/juicedata/juicefs",children:"juicedata/juicefs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Apache-2.0, Go"}),"\n",(0,i.jsx)(n.li,{children:"\u5143\u6570\u636e \u548c \u6570\u636e \u5206\u79bb"}),"\n",(0,i.jsxs)(n.li,{children:["distributed ",(0,i.jsx)(n.strong,{children:"POSIX"})," fs"]}),"\n",(0,i.jsx)(n.li,{children:"metadata - Redis, Postgres, MySQL, SQLite3, badger, TiKV"}),"\n",(0,i.jsxs)(n.li,{children:["data - s3, minio, webdav, redis, file, sqlite3, mysql, postgres, sftp\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://juicefs.com/docs/community/how_to_setup_object_storage/#supported-object-storage",children:"Supported Object Storage"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u63a5\u53e3\u652f\u6301 S3, HDFS, CSI"}),"\n",(0,i.jsx)(n.li,{children:"64MiB Chunk -> Slice -> 4 MiB Block"}),"\n",(0,i.jsx)(n.li,{children:"4MiB cache granularity"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u538b\u7f29 - lz4, zstd"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u52a0\u5bc6"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u56de\u6536\u7ad9"}),"\n",(0,i.jsxs)(n.li,{children:["\u5bf9\u5e26\u5bbd\u8981\u6c42\u9ad8\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5e26\u5bbd\u4e0d\u8db3\uff0c\u53ef\u4ee5\u628a\u7f13\u5b58\u8bbe\u5927\uff0c\u518d\u5f00\u542f\u5f02\u6b65\u5199\u5165\u6a21\u5f0f --writeback"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53c2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://juicefs.com/zh-cn/blog/engineering/distributed-filesystem-comparison",children:"https://juicefs.com/zh-cn/blog/engineering/distributed-filesystem-comparison"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://juicefs.com/zh-cn/blog/solutions/clickhouse-disaggregated-storage-and-compute-practice",children:"https://juicefs.com/zh-cn/blog/solutions/clickhouse-disaggregated-storage-and-compute-practice"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://juicefs.com/zh-cn/blog/engineering/similarities-and-differences-between-seaweedfs-and-juicefs-structures",children:"vs SeaweedFS"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"\u4e0d\u63d0\u4f9b\u5b9e\u9645\u5b58\u50a8",type:"caution",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5c06\u5bf9\u8c61\u5b58\u50a8\u66b4\u9732\u4e3a FS \u5b58\u50a8\u534f\u8bae"}),"\n",(0,i.jsx)(n.li,{children:"\u7ef4\u62a4 FS \u5143\u6570\u636e"}),"\n",(0,i.jsx)(n.li,{children:"\u672c\u8eab\u4e0d\u5b58\u50a8\u6570\u636e"}),"\n"]})}),"\n",(0,i.jsxs)(n.admonition,{title:"\u9650\u5236",type:"info",children:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"limit"}),(0,i.jsx)(n.th,{children:"for"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u76ee\u5f55\u6df1\u5ea6"}),(0,i.jsx)(n.td,{children:"\u4e0d\u9650"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u6587\u4ef6\u540d\u957f\u5ea6"}),(0,i.jsx)(n.td,{children:"255"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"soft link \u957f\u5ea6"}),(0,i.jsx)(n.td,{children:"4096 bytes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"hard link"}),(0,i.jsx)(n.td,{children:"2^31"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u76ee\u5f55\u6587\u4ef6\u6570"}),(0,i.jsx)(n.td,{children:"2^31"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"volume \u6587\u4ef6\u6570"}),(0,i.jsx)(n.td,{children:"unlimited"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5355\u6587\u4ef6\u5927\u5c0f"}),(0,i.jsx)(n.td,{children:"2^(26+31) = 2^57 = 128 TiB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u603b\u6587\u4ef6\u5927\u5c0f"}),(0,i.jsx)(n.td,{children:"4EiB"})]})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"brew install juicefs # macOS\n\n# \u624b\u52a8\u5b89\u88c5 Linux, Darwin\nVER=$(curl -s https://api.github.com/repos/juicedata/juicefs/releases/latest | grep 'tag_name' | cut -d '\"' -f 4 | tr -d 'v')\nOS=$(uname -s | tr '[:upper:]' '[:lower:]')\ncurl -LO \"https://github.com/juicedata/juicefs/releases/download/v${VER}/juicefs-${VER}-${OS}-amd64.tar.gz\"\ntar zxvf juicefs-*.tar.gz\n\n# META-URL MOUNTPOINT\n# --storage file --bucket $HOME/.juicefs/local \u4e3a\u9ed8\u8ba4\u503c\njuicefs format \\\n  --storage file --bucket $HOME/.juicefs/local \\\n  sqlite3://jfs.db jfs\n\nls $HOME/.juicefs/local/jfs/\nsqlite3 jfs.db \"select * from jfs_setting\"\n\n# macOS \u9700\u8981\u5b89\u88c5 macFUSE\nbrew install macfuse\n\n# 100GB \u7f13\u5b58\u5230 $HOME/.juicefs/cache\n# 1h \u5143\u6570\u636e\u5907\u4efd\n# http://localhost:9567/metrics\njuicefs mount \\\n  --cache-dir $HOME/.juicefs/cache --cache-size 102400 \\\n  --backup-meta 1h \\\n  -o allow_other -o allow_root \\\n  sqlite3://jfs.db $PWD/mnt\n\ncd mnt\njuicefs bench .\n\ntouch test.txt\ntouch $(cat /dev/urandom | tr -dc '0' | head -c 255) # \u6210\u529f\ntouch $(cat /dev/urandom | tr -dc '0' | head -c 256) # \u5931\u8d25\n\ncd -\n\njuicefs info mnt/test.txt            # \u6587\u4ef6\u4fe1\u606f\njuicefs info mnt                     # \u76ee\u5f55\u4fe1\u606f\njuicefs config sqlite3://jfs.db      # \u914d\u7f6e\u4fe1\u606f\njuicefs status sqlite3://jfs.db      # session \u72b6\u6001\njuicefs gc sqlite3://jfs.db          # \u6570\u636e\u626b\u63cf\njuicefs gc sqlite3://jfs.db --delete # \u6570\u636e\u6e05\u7406\njuicefs fsck sqlite3://jfs.db        # \u6570\u636e\u6821\u9a8c\njuicefs profile mnt                  # \u64cd\u4f5c\u76d1\u63a7\njuicefs stats mnt                    # io \u7edf\u8ba1\n\njuicefs gateway sqlite3://jfs.db 0.0.0.0:9090 # S3 \u7f51\u5173\n\n# \u5143\u6570\u636e\u5907\u4efd\n# --subdir \u53ea\u5907\u4efd\u6307\u5b9a\u76ee\u5f55\njuicefs dump sqlite3://jfs.db meta.dump.json\n# \u5143\u6570\u636e\u6062\u590d - \u786e\u4fdd\u6ca1\u6709\u5199\u5165\njuicefs load redis://127.0.0.1:6379/1 meta.dump.json\n\n# \u6570\u636e\u6e05\u7a7a\nUUID=$(juicefs status sqlite3://jfs.db | jq .Setting.UUID -r)\n# \u6240\u6709 session \u65ad\u5f00\u540e\u624d\u53ef\u4ee5\u64cd\u4f5c\njuicefs destroy sqlite3://jfs.db $UUID\ndu -sh $HOME/.juicefs/local/jfs/\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["~/.juicefs/local/jfs/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"juicefs_uuid"}),"\n",(0,i.jsx)(n.li,{children:"chunks/"}),"\n",(0,i.jsx)(n.li,{children:"testing/"}),"\n",(0,i.jsxs)(n.li,{children:["meta/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"dump-2023-03-16-174211.json.gz"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["/mnt/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:".accesslog"}),"\n",(0,i.jsx)(n.li,{children:".config"}),"\n",(0,i.jsx)(n.li,{children:".stats - \u7edf\u8ba1"}),"\n",(0,i.jsxs)(n.li,{children:[".trash/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["YYYY-mm-dd-hh/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{\u7236\u76ee\u5f55 inode}-{\u6587\u4ef6 inode}-{\u539f\u59cb\u6587\u4ef6\u540d}"})," - \u67e5\u8be2 inode ",(0,i.jsx)(n.code,{children:"juicefs info -i 3"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"meta/ - \u5143\u6570\u636e\u5907\u4efd"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["backup-meta\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u26a0\ufe0f \u8d85\u8fc7 100 \u4e07 \u5219\u4e0d\u5728\u6bcf 1h \u81ea\u52a8\u5907\u4efd\uff0c\u9700\u8981\u624b\u52a8\u914d\u7f6e\u66f4\u5927\u95f4\u9694"}),"\n",(0,i.jsx)(n.li,{children:"Redis 100 \u4e07 1 \u5206\u949f 1GB \u5185\u5b58"}),"\n",(0,i.jsxs)(n.li,{children:["\u6e05\u7406\u89c4\u5219\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4fdd\u7559 2 \u5929\u5b8c\u6574"}),"\n",(0,i.jsx)(n.li,{children:"< 2 \u5468, \u6bcf\u5929\u4fdd\u7559 1 \u4efd"}),"\n",(0,i.jsx)(n.li,{children:"< 2 \u6708, \u6bcf\u5468\u4fdd\u7559 1 \u4efd"}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"2 \u6708, \u6bcf\u6708\u4fdd\u7559 1 \u4efd"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["file\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"$HOME/.juicefs/local"}),"\n",(0,i.jsx)(n.li,{children:"/var/jfs"}),"\n",(0,i.jsx)(n.li,{children:"C:/jfs/local"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["fuse \u9009\u9879\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["writeback_cache\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Linux 3.15+ ",(0,i.jsx)(n.a,{href:"https://www.kernel.org/doc/Documentation/filesystems/fuse-io.txt",children:"https://www.kernel.org/doc/Documentation/filesystems/fuse-io.txt"})]}),"\n",(0,i.jsx)(n.li,{children:"\u5229\u4e8e\u5c0f\u6570\u636e(e.g. 100b)\u9891\u7e41\u8bfb\u5199"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"user_id=100,group_id=100"}),"\n",(0,i.jsx)(n.li,{children:"debug"}),"\n",(0,i.jsx)(n.li,{children:"allow_other"}),"\n",(0,i.jsx)(n.li,{children:"allow_root"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/pjd/pjdfstest",children:"pjd/pjdfstest"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"POSIX test suite"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/linux-test-project/ltp",children:"linux-test-project/ltp"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"flag"}),(0,i.jsx)(n.th,{children:"env"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"--access-key value"}),(0,i.jsx)(n.td,{children:"ACCESS_KEY"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"--secret-key value"}),(0,i.jsx)(n.td,{children:"SECRET_KEY"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"command",children:"Command"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://juicefs.com/docs/community/command_reference/",children:"https://juicefs.com/docs/community/command_reference/"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"juicefs mount -o allow_other,writeback_cache sqlite3://myjfs.db ~/jfs\n"})}),"\n",(0,i.jsx)(n.h2,{id:"metdata",children:"Metdata"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Redis\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"300b \u4e00\u4e2a\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["META_PASSWORD\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6570\u636e\u5e93\u5bc6\u7801"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"juicefs format \\\n  --storage sqlite3 \\\n  --bucket data.db \\\n  sqlite3://meta.db jfs\n\n# \u4e0d\u652f\u6301 fsck, gc\n# \u4e0d\u80fd\u591a\u8fdb\u7a0b\u6302\u8f7d\njuicefs format \\\n  --storage sqlite3 \\\n  --bucket data.db \\\n  badger://$PWD/meta jfs\n"})}),"\n",(0,i.jsx)(n.h2,{id:"docker",children:"Docker"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker plugin install juicedata/juicefs --alias juicefs\n\ndocker volume create -d juicefs \\\n  -o name=VOLUME_NAME \\\n  -o metaurl=META_URL \\\n  -o storage=STORAGE_TYPE \\\n  -o bucket=BUCKET_NAME \\\n  -o access-key=ACCESS_KEY \\\n  -o secret-key=SECRET_KEY \\\n  jfsvolume\n\n# \u5df2\u6709 volume\ndocker volume create -d juicefs \\\n  -o name=VOLUME_NAME \\\n  -o metaurl=META_URL \\\n  jfsvolume\n\ndocker run -it -v jfsvolume:/opt wener/base ls /opt\n\ndocker volume rm jfsvolume\n\n# disable,upgrade,enable,rm\ndocker plugin disable juicefs\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://hub.docker.com/r/juicedata/mount",children:"https://hub.docker.com/r/juicedata/mount"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/juicedata/juicefs/blob/main/hack/builder/Dockerfile",children:"https://github.com/juicedata/juicefs/blob/main/hack/builder/Dockerfile"})}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,c.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(j,{...e})}):j(e)}},38088:(e,n,s)=>{var i=s(96651),c=Symbol.for("react.element"),t=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function o(e,n,s){var i,t={},o=null,j=null;for(i in void 0!==s&&(o=""+s),void 0!==n.key&&(o=""+n.key),void 0!==n.ref&&(j=n.ref),n)l.call(n,i)&&!d.hasOwnProperty(i)&&(t[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===t[i]&&(t[i]=n[i]);return{$$typeof:c,type:e,key:o,ref:j,props:t,_owner:r.current}}n.Fragment=t,n.jsx=o,n.jsxs=o},2488:(e,n,s)=>{e.exports=s(38088)},62780:(e,n,s)=>{s.d(n,{I:()=>r,M:()=>l});var i=s(96651);const c={},t=i.createContext(c);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);