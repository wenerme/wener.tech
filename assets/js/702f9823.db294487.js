/*! For license information please see 702f9823.db294487.js.LICENSE.txt */
"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[64656],{32850:(n,s,e)=>{e.r(s),e.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>d,metadata:()=>l,toc:()=>o});var t=e(11527),r=e(47214);const d={title:"SOPS"},i="SOPS",l={id:"security/crypto/sops",title:"SOPS",description:"- mozilla/sops",source:"@site/../notes/security/crypto/sops.md",sourceDirName:"security/crypto",slug:"/security/crypto/sops",permalink:"/notes/security/crypto/sops",draft:!1,unlisted:!1,editUrl:"https://github.com/wenerme/wener/edit/master/notes/../notes/security/crypto/sops.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1693463269,formattedLastUpdatedAt:"Aug 31, 2023",frontMatter:{title:"SOPS"},sidebar:"docs",previous:{title:"rsa",permalink:"/notes/security/crypto/rsa"},next:{title:"CVE",permalink:"/notes/security/cve"}},c={},o=[{value:"spawnSync sops ENOENT",id:"spawnsync-sops-enoent",level:2},{value:"vsc",id:"vsc",level:2}];function h(n){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"sops",children:"SOPS"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/mozilla/sops",children:"mozilla/sops"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["sops \u662f\u4e2a ",(0,t.jsx)(s.strong,{children:"\u7f16\u8f91\u5668"})]}),"\n",(0,t.jsx)(s.li,{children:"\u52a0\u5bc6 yaml, json \u5b57\u6bb5\u800c\u975e\u6574\u4e2a\u6587\u4ef6"}),"\n",(0,t.jsx)(s.li,{children:"\u652f\u6301 yaml, json, dotenv, plaintext, ini"}),"\n",(0,t.jsxs)(s.li,{children:["\u652f\u6301\u540e\u7aef: ",(0,t.jsx)(s.a,{href:"/notes/security/crypto/age",children:"age"}),", ",(0,t.jsx)(s.a,{href:"/notes/security/crypto/gpg",children:"pgp"}),", vault"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\u52a0\u5bc6\u540e\u5b57\u6bb5 ",(0,t.jsx)(s.code,{children:"ENC[\u7b97\u6cd5\u540d\u5b57,data:,iv:,add:,tag:]"})]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"caution",children:(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\u6682\u4e0d\u652f\u6301 SSH keys + age\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/mozilla/sops/pull/1134",children:"#1134"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"SOPS_AGE_SSH_PRIVATE_KEY"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/mozilla/sops/pull/898",children:"#898"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\u6682\u4e0d\u652f\u6301 SSH keys ",(0,t.jsx)(s.a,{href:"https://github.com/mozilla/sops/issues/692",children:"sops#692"})]}),"\n"]})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"brew install sops # macOS\n# \u76f4\u63a5\u4e0b\u8f7d\ncurl -Lo ~/bin/sops https://github.com/mozilla/sops/releases/download/v3.7.3/sops-v3.7.3.darwin.amd64\nchmod 755 ~/bin/sops\n\n# \u914d\u7f6e git diff \u5904\u7406 sops \u52a0\u5bc6\u6587\u4ef6\ngit config diff.sopsdiffer.textconv \"sops -d\"\n\n# \u52a0\u5bc6\u90e8\u5206\u6587\u4ef6\nsops --encrypt --encrypted-regex '^(data|stringData)$' k8s-secrets.yaml\n"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["age\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"--age,SOPS_AGE_RECIPIENTS"}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"$XDG_CONFIG_HOME/sops/age/keys.txt"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"$HOME/Library/Application Support/sops/age/keys.txt"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"%AppData%\\sops\\age\\keys.txt"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",metastring:'title="\u52a0\u5bc6\u540e\u7684\u6570\u636e"',children:"# \u6570\u636e\na: 1\n\n# \u9644\u52a0\u6570\u636e\nsops:\n  kms: []\n  gcp_kms: []\n  azure_kv: []\n  hc_vault: []\n  age: []\n  lastmodified: '2022-11-08T01:41:42Z'\n  mac:\n  pgp:\n    - created_at: '2022-11-08T01:40:45Z'\n      enc: |-\n        -----BEGIN PGP MESSAGE-----\n        -----END PGP MESSAGE-----\n      fp:\n  unencrypted_suffix: _unencrypted\n  version: 3.7.3\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:".sops.yaml"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"creation_rules:\n  - path_regex:\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"env"}),(0,t.jsx)(s.th,{children:"for"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"SOPS_GPG_EXEC"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"EDITOR"}),(0,t.jsx)(s.td,{children:"vim"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"flag"}),(0,t.jsx)(s.th,{children:"for"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"-d,--decrypt"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"-e,--encrypt"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"-r,--rotate"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"-p,--pgp SOPS_PGP_FP"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"-a,--age SOPS_AGE_RECIPIENTS"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"-i,--in-place"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--extract PATH"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--input-type TYPE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--output-type TYPE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"-s,--show-master-keys"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--add-hc-vault-transit VALUE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--rm-hc-vault-transit VALUE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--add-age VALUE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--rm-age VALUE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--add-pgp VALUE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--rm-pgp VALUE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--ignore-mac"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--unencrypted-suffix SUFFIX"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--unencrypted-regex REGEX"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--cofig FILE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:'--set "PATH VALUE"'}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--shamir-secret-sharing-threshold 0"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--output FILE"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--enable-local-keyservice"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--keyservice PATH"}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"--verbose"}),(0,t.jsx)(s.td,{})]})]})]}),"\n",(0,t.jsx)(s.h1,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(s.h2,{id:"spawnsync-sops-enoent",children:"spawnSync sops ENOENT"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/signageos/vscode-sops/issues/4",children:"https://github.com/signageos/vscode-sops/issues/4"})}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"vsc",children:"vsc"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'EDITOR="code --wait" sops values.yaml\n'})})]})}function a(n={}){const{wrapper:s}={...(0,r.a)(),...n.components};return s?(0,t.jsx)(s,{...n,children:(0,t.jsx)(h,{...n})}):h(n)}},3354:(n,s,e)=>{var t=e(50959),r=Symbol.for("react.element"),d=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function o(n,s,e){var t,d={},o=null,h=null;for(t in void 0!==e&&(o=""+e),void 0!==s.key&&(o=""+s.key),void 0!==s.ref&&(h=s.ref),s)i.call(s,t)&&!c.hasOwnProperty(t)&&(d[t]=s[t]);if(n&&n.defaultProps)for(t in s=n.defaultProps)void 0===d[t]&&(d[t]=s[t]);return{$$typeof:r,type:n,key:o,ref:h,props:d,_owner:l.current}}s.Fragment=d,s.jsx=o,s.jsxs=o},11527:(n,s,e)=>{n.exports=e(3354)},47214:(n,s,e)=>{e.d(s,{Z:()=>l,a:()=>i});var t=e(50959);const r={},d=t.createContext(r);function i(n){const s=t.useContext(d);return t.useMemo((function(){return"function"==typeof n?n(s):{...s,...n}}),[s,n])}function l(n){let s;return s=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),t.createElement(d.Provider,{value:s},n.children)}}}]);