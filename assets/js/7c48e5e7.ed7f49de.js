"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([[5656],{49613:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(59496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),m=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=m(e.components);return a.createElement(c.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=m(n),d=r,k=u["".concat(c,".").concat(d)]||u[d]||s[d]||l;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=u;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var m=2;m<l;m++)i[m]=n[m];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},55485:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return o},metadata:function(){return m},toc:function(){return s}});var a=n(96600),r=n(27279),l=(n(59496),n(49613)),i=["components"],o={title:"manticoresearch"},c="manticoresearch",m={unversionedId:"db/search/manticoresearch",id:"db/search/manticoresearch",title:"manticoresearch",description:"- manticoresoftware/manticoresearch",source:"@site/../notes/db/search/manticoresearch.md",sourceDirName:"db/search",slug:"/db/search/manticoresearch",permalink:"/notes/db/search/manticoresearch",draft:!1,editUrl:"https://github.com/wenerme/wener/edit/master/../notes/db/search/manticoresearch.md",tags:[],version:"current",lastUpdatedBy:"wener",lastUpdatedAt:1659221825,formattedLastUpdatedAt:"Jul 30, 2022",frontMatter:{title:"manticoresearch"},sidebar:"docs",previous:{title:"groonga",permalink:"/notes/db/search/groonga"},next:{title:"OpenSearch",permalink:"/notes/db/search/opensearch"}},p={},s=[{value:"HTTP",id:"http",level:2},{value:"Notes",id:"notes",level:2},{value:"NLP",id:"nlp",level:2},{value:"Kubernetes",id:"kubernetes",level:2},{value:"Cluster",id:"cluster",level:2}],u={toc:s};function d(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"manticoresearch"},"manticoresearch"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/manticoresoftware/manticoresearch"},"manticoresoftware/manticoresearch"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"GPLv2, C++"),(0,l.kt)("li",{parentName:"ul"},"Database for search"),(0,l.kt)("li",{parentName:"ul"},"MySQL \u534f\u8bae\u548c\u8bed\u6cd5"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301 \u884c\u5b58\u3001\u5217\u5b58\u3001\u6587\u6863\u5b58\u50a8"),(0,l.kt)("li",{parentName:"ul"},"Replication based on ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/codership/galera"},"Galera")),(0,l.kt)("li",{parentName:"ul"},"forked from Sphinx 2.3.2 in 2017"),(0,l.kt)("li",{parentName:"ul"},"JSON interface"),(0,l.kt)("li",{parentName:"ul"},"cjk, non_cjk"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301 Declarative \u5b9a\u4e49"))),(0,l.kt)("li",{parentName:"ul"},"\u53c2\u8003",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://play.manticoresearch.com/"},"https://play.manticoresearch.com/")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://manual.manticoresearch.com/"},"https://manual.manticoresearch.com/")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/manticoresoftware/columnar"},"manticoresoftware/columnar"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Apache-2.0"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://pgm.di.unipi.it/"},"PGM algorithm")," \u4e8c\u7ea7\u7d22\u5f15")))),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301 automatic sharding"),(0,l.kt)("li",{parentName:"ul"},"ID \u56fa\u5b9a\u4e3a bigint"))),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"port"),(0,l.kt)("th",{parentName:"tr",align:null},"for"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"9306"),(0,l.kt)("td",{parentName:"tr",align:null},"mysql")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"9308"),(0,l.kt)("td",{parentName:"tr",align:null},"HTTP")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"9312"),(0,l.kt)("td",{parentName:"tr",align:null},"binary protocol")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# https://hub.docker.com/r/manticoresearch/manticore/\n# /var/lib/manticore/\n# /etc/manticoresearch/manticore.conf\ndocker run --rm -it \\\n  -v $(pwd)/data:/var/lib/manticore \\\n  -v $(pwd)/manticore.conf:/etc/manticoresearch/manticore.conf \\\n  -p 127.0.0.1:9306:9306 \\\n  -p 127.0.0.1:9308:9308 \\\n  -p 127.0.0.1:9312:9312 \\\n  --ulimit nofile=65536:65536 \\\n  --cap-add=IPC_LOCK --ulimit memlock=-1:-1 \\\n  --name manticore manticoresearch/manticore\ndocker exec -it manticore mysql -w\n\ncurl -s "http://localhost:9308/search"\ncurl -sX POST http://localhost:9308/cli -d "create table products(title text, price float) morphology=\'stem_en\'"\n\n# macOS\nbrew install manticoresoftware/manticore/manticoresearch\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"HTTP",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"/search"),(0,l.kt)("li",{parentName:"ul"},"/cli"),(0,l.kt)("li",{parentName:"ul"},"/insert"),(0,l.kt)("li",{parentName:"ul"},"/update"),(0,l.kt)("li",{parentName:"ul"},"/delete")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- table \u5373\u4e3a\u4e00\u4e2a\u7d22\u5f15\ncreate table\n  movies(title text, year int) morphology = 'stem_en' html_strip = '1' stopwords = 'en';\n\ninsert into\n  movies(title, year)\nvalues\n  ('The Seven Samurai', 1954),\n  ('Bonnie and Clyde', 1954),\n  ('Reservoir Dogs', 1992),\n  ('Airplane!', 1980),\n  ('Raging Bull', 1980),\n  ('Groundhog Day', 1993),\n  (\n    '<a href=\"http://google.com/\">Jurassic Park</a>',\n    1993\n  ),\n  ('Ferris Bueller''s Day Off', 1986);\n\nselect\n  highlight(),\n  year\nfrom\n  movies\nwhere\n  match('the dog');\n\nselect\n  highlight(),\n  year\nfrom\n  movies\nwhere\n  match('days') facet year;\n\nselect\n  *\nfrom\n  movies\nwhere\n  match('google');\n\n-- Column\ncreate table\n  idx(title text, type int, price float engine = 'rowwise') engine = 'columnar'\ncreate table\n  idx(title text, type int, price float engine = 'columnar');\n\ncreate table\n  idx(title text, type int, price float engine = 'columnar') engine = 'rowwise';\n\n-- \u4fee\u6539 plain index \u914d\u7f6e\u540e\n-- ALTER TABLE <index_name> RECONFIGURE\n")),(0,l.kt)("h2",{id:"http"},"HTTP"),(0,l.kt)("h2",{id:"notes"},"Notes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Real-time index",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7531\u591a\u4e2a plain indexes \u7ec4\u6210"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u66f4\u65b0 schema"),(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u53ef\u4ee5\u7528 indexer"),(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u53ef\u4ee5\u5173\u8054 source"),(0,l.kt)("li",{parentName:"ul"},"\u751f\u6210\u6587\u4ef6",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},".lock")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},".ram")," - RAM chunk",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"rt_mem_limit"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},".meta")," - RT index headers"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},".*.sp*")," - disk chunks",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"optimize_cutoff - chunk \u6570\u91cf"))))))),(0,l.kt)("li",{parentName:"ul"},"Plain index",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u9002\u7528\u4e8e\u9759\u6001\u6570\u636e - \u6570\u636e\u4e0d\u53ef\u4fee\u6539"),(0,l.kt)("li",{parentName:"ul"},"source+indexer",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"source \u5fc5\u987b\u5305\u542b\u552f\u4e00\u6807\u8bc6\u7b26"),(0,l.kt)("li",{parentName:"ul"},"source \u652f\u6301 main+delta \u589e\u91cf\u6784\u5efa"))),(0,l.kt)("li",{parentName:"ul"},"\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u76f4\u63a5\u914d\u7f6e\u597d"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"string|text [stored|attribute] [indexed]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"indexed - FTS"),(0,l.kt)("li",{parentName:"ul"},"stored - docstore, \u5b58\u50a8\u5728\u78c1\u76d8, lazy read"),(0,l.kt)("li",{parentName:"ul"},"attribute - \u53ef\u4ee5 sort, group by"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"string")," \u9ed8\u8ba4 attribute"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"text")," \u9ed8\u8ba4 ",(0,l.kt)("inlineCode",{parentName:"li"},"stored indexed")))),(0,l.kt)("li",{parentName:"ul"},"multi,multi64 - \u591a\u503c\u7c7b\u578b"),(0,l.kt)("li",{parentName:"ul"},"columnar",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301\u5b58\u50a8 JSON"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fast_fetch='0'"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8282\u7701\u7a7a\u95f4\uff0c\u4e0d\u989d\u5916\u5b58\u50a8\u5230 docstore")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"source source {\n  type             = mysql\n  sql_host         = localhost\n  sql_user         = myuser\n  sql_pass         = mypass\n  sql_db           = mydb\n  sql_query        = SELECT id, title, description, category_id  from mytable\n  sql_attr_uint    = category_id\n  sql_field_string = title\n }\n\nindex idx {\n  # plain,rt\n  type   = plain\n  source = source\n  path   = /path/to/index\n\n  stored_fields = title, content\n  stored_only_fields = title,content\n\n  rt_field          = subject\n  rt_attr_uint      = gid\n  rt_attr_bigint    = gid\n  rt_attr_multi     = tags\n  rt_attr_multi_64  = wide_tags\n  rt_attr_float     = lat\n  rt_attr_float     = lon\n  rt_attr_bool      = available\n  rt_attr_string    = title\n  rt_attr_json      = properties\n  rt_attr_timestamp = date_added\n  rt_mem_limit      = 128M\n\n  # plain\n  killlist_target = main:kl\n  columnar_attrs = *\n  columnar_attrs = id, attr1, attr2, attr3\n }\n")),(0,l.kt)("h2",{id:"nlp"},"NLP"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Chinese",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"charset_table=chinese or ngram_chars=chinese"),(0,l.kt)("li",{parentName:"ul"},"zh"),(0,l.kt)("li",{parentName:"ul"},"morphology=icu_chinese or ngram_chars=1 correspondingly"),(0,l.kt)("li",{parentName:"ul"},"ICU \u66f4\u51c6\u786e")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE\n  products(title text, price float) charset_table = 'cjk' morphology = 'icu_chinese' stopwords = 'zh';\n\n-- n-grams\nCREATE TABLE\n  products(title text, price float) charset_table = 'non_cjk' ngram_len = '1' ngram_chars = 'cjk';\n")),(0,l.kt)("h2",{id:"kubernetes"},"Kubernetes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/manticoresoftware/manticoresearch-helm"},"https://github.com/manticoresoftware/manticoresearch-helm"))),(0,l.kt)("h2",{id:"cluster"},"Cluster"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- primary\nCREATE TABLE\n  testrt (title text, content text, gid integer);\n\nCREATE CLUSTER posts;\n\nALTER CLUSTER posts\nADD\n  testrt;\n\n-- replica\nJOIN CLUSTER posts AT 'manticore-1:9312';\n\nINSERT INTO\n  posts: testrt(title, content, gid)\nVALUES\n  ('hello', 'world', 1);\n\n-- \u7c7b\u4f3c sharding \u6548\u679c\ncreate table\n  user type = 'distributed' local = 'user1' local = 'user2';\n")))}d.isMDXComponent=!0}}]);