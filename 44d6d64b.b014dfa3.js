(window.webpackJsonp=window.webpackJsonp||[]).push([[186],{260:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return b})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return o})),n.d(t,"default",(function(){return p}));var a=n(3),r=n(8),l=(n(0),n(790)),b={id:"boot",title:"Spring Boot"},i={unversionedId:"java/spring/boot",id:"java/spring/boot",isDocsHomePage:!1,title:"Spring Boot",description:"Tips",source:"@site/notes/java/spring/spring-boot.md",slug:"/java/spring/boot",permalink:"/notes/java/spring/boot",editUrl:"https://github.com/wenerme/wener/edit/master/notes/java/spring/spring-boot.md",version:"current",sidebar:"docs",previous:{title:"\u53d1\u5e03\u5386\u53f2",permalink:"/notes/java/spring/releases"},next:{title:"Spring Cloud",permalink:"/notes/java/spring/cloud"}},o=[{value:"Tips",id:"tips",children:[]},{value:"\u53c2\u8003",id:"\u53c2\u8003",children:[]},{value:"\u4f7f\u7528 Jetty \u800c\u4e0d\u4f7f\u7528 Tomcat",id:"\u4f7f\u7528-jetty-\u800c\u4e0d\u4f7f\u7528-tomcat",children:[]},{value:"\u5e38\u91cf",id:"\u5e38\u91cf",children:[]},{value:"\u91cd\u8981\u7684\u5904\u7406\u63a5\u53e3",id:"\u91cd\u8981\u7684\u5904\u7406\u63a5\u53e3",children:[]},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",children:[{value:"\u4e3b\u8981\u914d\u7f6e\u5bf9\u8c61",id:"\u4e3b\u8981\u914d\u7f6e\u5bf9\u8c61",children:[]},{value:"\u914d\u7f6e\u5c5e\u6027\u52a0\u8f7d\u987a\u5e8f",id:"\u914d\u7f6e\u5c5e\u6027\u52a0\u8f7d\u987a\u5e8f",children:[]},{value:"\u67e5\u627e\u5c5e\u6027\u6587\u4ef6\u7684\u987a\u5e8f",id:"\u67e5\u627e\u5c5e\u6027\u6587\u4ef6\u7684\u987a\u5e8f",children:[]},{value:"\u7279\u6b8a\u914d\u7f6e\u8bf4\u660e",id:"\u7279\u6b8a\u914d\u7f6e\u8bf4\u660e",children:[]},{value:"\u5c5e\u6027\u6587\u4ef6\u53ef\u4f7f\u7528\u5360\u4f4d\u7b26",id:"\u5c5e\u6027\u6587\u4ef6\u53ef\u4f7f\u7528\u5360\u4f4d\u7b26",children:[]},{value:"\u5355\u4e2a YAML \u53ef\u6307\u5b9a\u591a\u4e2a profile",id:"\u5355\u4e2a-yaml-\u53ef\u6307\u5b9a\u591a\u4e2a-profile",children:[]},{value:"\u914d\u7f6e\u6ce8\u89e3",id:"\u914d\u7f6e\u6ce8\u89e3",children:[]},{value:"\u7ed1\u5b9a\u5c5e\u6027\u540d",id:"\u7ed1\u5b9a\u5c5e\u6027\u540d",children:[]},{value:"\u65e5\u5fd7\u914d\u7f6e",id:"\u65e5\u5fd7\u914d\u7f6e",children:[]},{value:"\u5e38\u7528\u914d\u7f6e",id:"\u5e38\u7528\u914d\u7f6e",children:[]},{value:"Tips",id:"tips-1",children:[]}]},{value:"Actuator",id:"actuator",children:[{value:"\u5e38\u7528\u7ec8\u7aef",id:"\u5e38\u7528\u7ec8\u7aef",children:[]},{value:"\u914d\u7f6e",id:"\u914d\u7f6e-1",children:[]}]},{value:"Remote shell",id:"remote-shell",children:[{value:"\u914d\u7f6e",id:"\u914d\u7f6e-2",children:[]}]},{value:"Metrics",id:"metrics",children:[{value:"\u76d1\u63a7\u4fe1\u606f",id:"\u76d1\u63a7\u4fe1\u606f",children:[]},{value:"\u81ea\u5b9a\u4e49",id:"\u81ea\u5b9a\u4e49",children:[]},{value:"\u8f93\u51fa\u76d1\u63a7\u4fe1\u606f",id:"\u8f93\u51fa\u76d1\u63a7\u4fe1\u606f",children:[]},{value:"\u83b7\u53d6 XmlMapper",id:"\u83b7\u53d6-xmlmapper",children:[]},{value:"\u83b7\u53d6\u8bf7\u6c42\u4f53\u6587\u672c",id:"\u83b7\u53d6\u8bf7\u6c42\u4f53\u6587\u672c",children:[]},{value:"\u53bb\u9664\u9519\u8bef\u767d\u677f\u9875",id:"\u53bb\u9664\u9519\u8bef\u767d\u677f\u9875",children:[]}]},{value:"\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u81ea\u52a8\u914d\u7f6e",id:"\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u81ea\u52a8\u914d\u7f6e",children:[]}],c={toc:o};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h2",{id:"tips"},"Tips"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"\u65b9\u4fbf\u67e5\u770b\u6bcf\u4e2a\u7248\u672c\u7684\u4f9d\u8d56\u7248\u672c",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",{parentName:"li",href:"http://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-parent/2.0.0.RELEASE"},"org.springframework.boot/spring-boot-starter-parent"))))),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},"# \u5b89\u88c5\u547d\u4ee4\u884c\u5de5\u5177\nbrew tap pivotal/tap\nbrew install springboot\n# \u5b89\u88c5 Spring Cloud \u6269\u5c55\n# https://cloud.spring.io/spring-cloud-cli/\nspring install org.springframework.cloud:spring-cloud-cli:1.3.2.RELEASE\n\n# \u5982\u679c\u60f3\u7528\u52a0\u5bc6\u7684\u529f\u80fd\u8fd8\u9700\u8981\u5b89\u88c5 jce\n# http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html\n")),Object(l.b)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",{parentName:"li",href:"http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/"},"\u6700\u65b0\u6587\u6863")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",{parentName:"li",href:"http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#common-application-properties"},"\u6240\u6709\u7684\u914d\u7f6e\u5c5e\u6027"))),Object(l.b)("h2",{id:"\u4f7f\u7528-jetty-\u800c\u4e0d\u4f7f\u7528-tomcat"},"\u4f7f\u7528 Jetty \u800c\u4e0d\u4f7f\u7528 Tomcat"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-web</artifactId>\n    <exclusions>\n        <exclusion>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-tomcat</artifactId>\n        </exclusion>\n    </exclusions>\n</dependency>\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-jetty</artifactId>\n</dependency>\n")),Object(l.b)("h2",{id:"\u5e38\u91cf"},"\u5e38\u91cf"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"org.springframework.http.HttpHeaders"),Object(l.b)("li",{parentName:"ul"},"org.springframework.http.HttpStatus")),Object(l.b)("h2",{id:"\u91cd\u8981\u7684\u5904\u7406\u63a5\u53e3"},"\u91cd\u8981\u7684\u5904\u7406\u63a5\u53e3"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"org.springframework.util.PathMatcher\n\u8def\u5f84\u7684\u5339\u914d\u683c\u5f0f,\u6bd4\u5982 cors \u914d\u7f6e"),Object(l.b)("li",{parentName:"ul"},"org.springframework.boot.logging.LoggingSystem",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"\u7528\u4e8e\u63a7\u5236\u65e5\u5fd7\u7ea7\u522b"),Object(l.b)("li",{parentName:"ul"},"\u8fd0\u884c\u65f6\u4f1a\u66b4\u9732 logger endpoint, \u53ef\u67e5\u770b\u548c\u4fee\u6539\u65e5\u5fd7\u7ea7\u522b",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"org.springframework.boot.actuate.endpoint.LoggersEndpoint"))),Object(l.b)("li",{parentName:"ul"},"\u65e5\u5fd7\u7ea7\u522b",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF"))),Object(l.b)("li",{parentName:"ul"},"\u65e5\u5fd7\u5c5e\u6027\u5206\u4e3a configuredLevel \u548c effectiveLevel",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"\u4fee\u6539\u65f6\u4f7f\u7528 configuredLevel"))),Object(l.b)("li",{parentName:"ul"},"Spring Boot \u81ea\u5e26\u4e86\u8f83\u591a\u7684 Logback \u914d\u7f6e",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"org.springframework.boot.logging.logback")))))),Object(l.b)("h2",{id:"\u914d\u7f6e"},"\u914d\u7f6e"),Object(l.b)("h3",{id:"\u4e3b\u8981\u914d\u7f6e\u5bf9\u8c61"},"\u4e3b\u8981\u914d\u7f6e\u5bf9\u8c61"),Object(l.b)("p",null,"\u914d\u7f6e\u5bf9\u8c61\u90fd\u901a\u8fc7 Adapter/Configurer \u7684\u7c7b\u8fdb\u884c\u914d\u7f6e, \u53ea\u662f\u5bf9\u5185\u90e8\u914d\u7f6e\u8fdb\u884c\u4fee\u6539\u800c\u4e0d\u662f\u76f4\u63a5\u66ff\u6362."),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter"),Object(l.b)("li",{parentName:"ul"},"org.springframework.security.config.annotation.authentication.configurers.GlobalAuthenticationConfigurerAdapter"),Object(l.b)("li",{parentName:"ul"},"org.springframework.data.rest.webmvc.config.RepositoryRestConfigurerAdapter"),Object(l.b)("li",{parentName:"ul"},"org.springframework.security.config.annotation.SecurityConfigurerAdapter"),Object(l.b)("li",{parentName:"ul"},"org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter"),Object(l.b)("li",{parentName:"ul"},"org.springframework.scheduling.annotation.AsyncConfigurer"),Object(l.b)("li",{parentName:"ul"},"org.springframework.cache.annotation.CachingConfigurer"),Object(l.b)("li",{parentName:"ul"},"org.springframework.web.servlet.config.annotation.ContentNegotiationConfigurer"),Object(l.b)("li",{parentName:"ul"},"org.springframework.security.config.annotation.web.configurers.HeadersConfigurer"),Object(l.b)("li",{parentName:"ul"},"org.springframework.boot.autoconfigure.security.oauth2.resource.JwtAccessTokenConverterConfigurer"),Object(l.b)("li",{parentName:"ul"},"org.springframework.web.servlet.config.annotation.PathMatchConfigurer"),Object(l.b)("li",{parentName:"ul"},"org.springframework.security.config.annotation.web.configurers.RequestCacheConfigurer"),Object(l.b)("li",{parentName:"ul"},"org.springframework.transaction.annotation.TransactionManagementConfigurer")),Object(l.b)("h3",{id:"\u914d\u7f6e\u5c5e\u6027\u52a0\u8f7d\u987a\u5e8f"},"\u914d\u7f6e\u5c5e\u6027\u52a0\u8f7d\u987a\u5e8f"),Object(l.b)("ol",{start:0},Object(l.b)("li",{parentName:"ol"},"\u547d\u4ee4\u884c\u53c2\u6570"),Object(l.b)("li",{parentName:"ol"},"\u73af\u5883\u53d8\u91cf ",Object(l.b)("inlineCode",{parentName:"li"},"SPRING_APPLICATION_JSON")," \u6307\u5b9a\u7684 JSON \u914d\u7f6e\u6216\u7cfb\u7edf\u5c5e\u6027"),Object(l.b)("li",{parentName:"ol"},"JNDI \u5c5e\u6027 ",Object(l.b)("inlineCode",{parentName:"li"},"java:comp/env")),Object(l.b)("li",{parentName:"ol"},"Java \u7cfb\u7edf\u5c5e\u6027 (System.getProperties())"),Object(l.b)("li",{parentName:"ol"},"\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u53d8\u91cf"),Object(l.b)("li",{parentName:"ol"},Object(l.b)("inlineCode",{parentName:"li"},"RandomValuePropertySource")," \u4e3a ",Object(l.b)("inlineCode",{parentName:"li"},"random.*")," \u8bbe\u7f6e\u968f\u673a\u5c5e\u6027\u503c"),Object(l.b)("li",{parentName:"ol"},"Jar \u5305\u5916\u57fa\u4e8e profile \u7684\u5e94\u7528\u5c5e\u6027 (application-{profile}.properties \u6216 YAML)"),Object(l.b)("li",{parentName:"ol"},"Jar \u5305\u5185\u57fa\u4e8e profile \u7684\u5e94\u7528\u5c5e\u6027 (application-{profile}.properties \u6216 YAML)"),Object(l.b)("li",{parentName:"ol"},"Jar \u5305\u5916\u7684\u5e94\u7528\u5c5e\u6027\u914d\u7f6e (application.properties \u6216 YAML)"),Object(l.b)("li",{parentName:"ol"},"Jar \u5305\u5185\u7684\u5e94\u7528\u5c5e\u6027\u914d\u7f6e (application.properties \u6216 YAML)"),Object(l.b)("li",{parentName:"ol"},Object(l.b)("inlineCode",{parentName:"li"},"@Configuration")," \u7c7b\u4e0a\u7684 ",Object(l.b)("inlineCode",{parentName:"li"},"@PropertySource")),Object(l.b)("li",{parentName:"ol"},"\u9ed8\u8ba4\u5c5e\u6027 (\u901a\u8fc7 SpringApplication.setDefaultProperties \u6307\u5b9a)")),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u793a\u4f8b")),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},'SPRING_APPLICATION_JSON=\'{"foo":{"bar":"spam"}}\' java -jar myapp.jar\njava -Dspring.application.json=\'{"foo":"bar"}\' -jar myapp.jar\njava -jar myapp.jar --spring.application.json=\'{"foo":"bar"}\'\n')),Object(l.b)("h3",{id:"\u67e5\u627e\u5c5e\u6027\u6587\u4ef6\u7684\u987a\u5e8f"},"\u67e5\u627e\u5c5e\u6027\u6587\u4ef6\u7684\u987a\u5e8f"),Object(l.b)("ol",{start:0},Object(l.b)("li",{parentName:"ol"},"\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 ",Object(l.b)("inlineCode",{parentName:"li"},"/config")," \u5b50\u76ee\u5f55"),Object(l.b)("li",{parentName:"ol"},"\u5f53\u524d\u76ee\u5f55"),Object(l.b)("li",{parentName:"ol"},"\u7c7b\u8def\u5f84\u4e0b\u7684 ",Object(l.b)("inlineCode",{parentName:"li"},"/config")," \u5305"),Object(l.b)("li",{parentName:"ol"},"\u7c7b\u8def\u5f84\u6839")),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u4fee\u6539")),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},'# \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540d\njava -jar myproject.jar --spring.config.name=myproject\n# \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\njava -jar myproject.jar --spring.config.location=classpath:/default.properties,classpath:/override.properties\n# \u901a\u8fc7\u73af\u5883\u53d8\u91cf\u4fee\u6539\u6587\u4ef6\u540d\nSPRING_CONFIG_NAME=myproject java -jar myproject.jar\n# \u53ef\u540c\u65f6\u52a0\u8f7d\u591a\u4e2a\u914d\u7f6e\u540d\n# --spring.config.name=server-app,env\n# \u53ef\u5728\u542f\u52a8\u65f6\u6fc0\u6d3b\u76f8\u5e94\u914d\u7f6e\n# --spring.profiles.active=local\n# \u53ef\u4fee\u6539\u914d\u7f6e\u7684\u641c\u7d22\u8def\u5f84\n# --spring.profiles.location=file:./conf\n# \u4fee\u6539\u9ed8\u8ba4 Profile\n# --spring.profiles.default=test\n# \u53ef\u76f4\u63a5\u4f20\u9012 JSON \u53c2\u6570\n# --spring.application.json={"redis.port":6379}\n')),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},Object(l.b)("strong",{parentName:"p"},"\u6ce8\u610f"),":"),Object(l.b)("ul",{parentName:"blockquote"},Object(l.b)("li",{parentName:"ul"},"\u4f7f\u7528 Profile \u65f6, include \u7684\u4f18\u5148\u7ea7\u4f1a\u6bd4\u5f53\u524d\u914d\u7f6e\u7684\u4f18\u5148\u7ea7\u9ad8,\u56e0\u6b64\u5728\u4f7f\u7528\u65f6\u5efa\u8bae\u907f\u514d\u4f7f\u7528 include \u6765\u5305\u542b\u9ed8\u8ba4\u914d\u7f6e."),Object(l.b)("li",{parentName:"ul"},"\u6307\u5b9a\u591a\u4e2a profile \u65f6\u540e\u9762\u7684\u4f1a\u8986\u76d6\u524d\u9762\u7684"))),Object(l.b)("h3",{id:"\u7279\u6b8a\u914d\u7f6e\u8bf4\u660e"},"\u7279\u6b8a\u914d\u7f6e\u8bf4\u660e"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"DevTool \u4f1a\u5c1d\u8bd5\u67e5\u627e HOME \u4e0b\u7684 ",Object(l.b)("inlineCode",{parentName:"li"},".spring-boot-devtools.properties")," \u914d\u7f6e\u6587\u4ef6"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"spring.main")," \u4e0b\u7684\u53c2\u6570\u4f1a\u5e94\u7528\u5230 ",Object(l.b)("inlineCode",{parentName:"li"},"SpringApplication")," \u4e0a,\u56e0\u6b64\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e ",Object(l.b)("inlineCode",{parentName:"li"},"spring.main.web_environment: false")," \u8fd9\u6837\u7684\u53c2\u6570"),Object(l.b)("li",{parentName:"ul"},"Spring \u542f\u52a8\u65f6\u7684\u5904\u7406\u7c7b\u4e3a ",Object(l.b)("inlineCode",{parentName:"li"},"org.springframework.boot.context.config.ConfigFileApplicationListener"),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"\u8d1f\u8d23\u52a0\u8f7d\u7ed9\u5b9a\u7684\u914d\u7f6e ",Object(l.b)("inlineCode",{parentName:"li"},"spring.config.name"),",",Object(l.b)("inlineCode",{parentName:"li"},"spring.profiles.active"),",",Object(l.b)("inlineCode",{parentName:"li"},"spring.profiles.location")),Object(l.b)("li",{parentName:"ul"},"\u8d1f\u8d23\u5c06 ",Object(l.b)("inlineCode",{parentName:"li"},"spring.main")," \u4e0a\u7684\u5c5e\u6027\u7ed1\u5b9a\u5230 ",Object(l.b)("inlineCode",{parentName:"li"},"SpringApplication")," \u4e0a"))),Object(l.b)("li",{parentName:"ul"},"\u53ef\u542f\u7528\u65e5\u5fd7,\u8bb0\u5f55\u6240\u6709\u5c1d\u8bd5\u52a0\u8f7d\u7684\u914d\u7f6e\u6587\u4ef6\u540d")),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},'<logger name="org.springframework.boot.context.config.ConfigFileApplicationListener"\n        level="TRACE"\n        additivity="false">\n    <appender-ref ref="CONSOLE"/>\n    <appender-ref ref="FILE"/>\n</logger>\n')),Object(l.b)("h3",{id:"\u5c5e\u6027\u6587\u4ef6\u53ef\u4f7f\u7528\u5360\u4f4d\u7b26"},"\u5c5e\u6027\u6587\u4ef6\u53ef\u4f7f\u7528\u5360\u4f4d\u7b26"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"app.name=MyApp\napp.description=${app.name:Default Name} is a Spring Boot application\n")),Object(l.b)("h3",{id:"\u5355\u4e2a-yaml-\u53ef\u6307\u5b9a\u591a\u4e2a-profile"},"\u5355\u4e2a YAML \u53ef\u6307\u5b9a\u591a\u4e2a profile"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-yaml"},"server:\n    address: 192.168.1.100\n---\nspring:\n    profiles: development\nserver:\n    address: 127.0.0.1\n---\nspring:\n    profiles: production\nserver:\n    address: 192.168.1.120\n")),Object(l.b)("h3",{id:"\u914d\u7f6e\u6ce8\u89e3"},"\u914d\u7f6e\u6ce8\u89e3"),Object(l.b)("p",null,"\u9ed8\u8ba4\u4f1a\u5f00\u542f ",Object(l.b)("inlineCode",{parentName:"p"},"@EnableConfigurationProperties")," \u6ce8\u89e3\u914d\u7f6e, \u6709 ",Object(l.b)("inlineCode",{parentName:"p"},"@ConfigurationProperties")," \u6ce8\u89e3\u4f1a\u81ea\u52a8\u4f7f\u7528 ",Object(l.b)("inlineCode",{parentName:"p"},"Environment")," \u8fdb\u884c\u521d\u59cb\u5316.\u4e5f\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 ",Object(l.b)("inlineCode",{parentName:"p"},"@EnableConfigurationProperties")," \u6765\u6ce8\u518c\u914d\u7f6e\u5bf9\u8c61"),Object(l.b)("h3",{id:"\u7ed1\u5b9a\u5c5e\u6027\u540d"},"\u7ed1\u5b9a\u5c5e\u6027\u540d"),Object(l.b)("p",null,"\u8fdb\u884c\u7ed1\u5b9a\u7684\u5c5e\u6027\u540d\u76f8\u5bf9\u5bbd\u5bb9"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},"\u5c5e\u6027\u540d\u683c\u5f0f"),Object(l.b)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"person.firstName"),Object(l.b)("td",{parentName:"tr",align:null},"\u6807\u51c6\u9a7c\u5cf0\u8bed\u6cd5")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"person.first-name"),Object(l.b)("td",{parentName:"tr",align:null},"\u6a2a\u7ebf\u5206\u9694, \u63a8\u8350\u5728 .properties \u548c .yml \u4e2d\u4f7f\u7528")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"PERSON_FIRST_NAME"),Object(l.b)("td",{parentName:"tr",align:null},"\u5927\u5199\u683c\u5f0f, \u63a8\u8350\u5728\u7cfb\u7edf\u53d8\u91cf\u4f7f\u7528")))),Object(l.b)("h3",{id:"\u65e5\u5fd7\u914d\u7f6e"},"\u65e5\u5fd7\u914d\u7f6e"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},"Spring Environment"),Object(l.b)("th",{parentName:"tr",align:null},"System Property"),Object(l.b)("th",{parentName:"tr",align:null},"Comments"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"logging.exception-conversion-word"),Object(l.b)("td",{parentName:"tr",align:null},"LOG_EXCEPTION_CONVERSION_WORD"),Object(l.b)("td",{parentName:"tr",align:null},"The conversion word that\u2019s used when logging exceptions.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"logging.file"),Object(l.b)("td",{parentName:"tr",align:null},"LOG_FILE"),Object(l.b)("td",{parentName:"tr",align:null},"\u5982\u679c\u5b9a\u4e49\u4e86\u4f1a\u4f5c\u4e3a\u9ed8\u8ba4\u65e5\u5fd7\u914d\u7f6e")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"logging.path"),Object(l.b)("td",{parentName:"tr",align:null},"LOG_PATH"),Object(l.b)("td",{parentName:"tr",align:null})),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"logging.pattern.console"),Object(l.b)("td",{parentName:"tr",align:null},"CONSOLE_LOG_PATTERN"),Object(l.b)("td",{parentName:"tr",align:null},"\u63a7\u5236\u53f0(stdout)\u8f93\u51fa\u7684\u65e5\u5fd7\u683c\u5f0f(\u4e0d\u652f\u6301 JDK logger)")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"logging.pattern.file"),Object(l.b)("td",{parentName:"tr",align:null},"FILE_LOG_PATTERN"),Object(l.b)("td",{parentName:"tr",align:null},"\u8f93\u51fa\u5230\u6587\u4ef6\u7684\u65e5\u5fd7\u683c\u5f0f")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"logging.pattern.level"),Object(l.b)("td",{parentName:"tr",align:null},"LOG_LEVEL_PATTERN"),Object(l.b)("td",{parentName:"tr",align:null},"\u8f93\u51fa\u65e5\u5fd7\u7b49\u7ea7\u7684\u683c\u5f0f(\u9ed8\u8ba4 %5p)(logging.pattern.level \u652f\u6301\u76f4 Logback)")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"PID"),Object(l.b)("td",{parentName:"tr",align:null},"PID"),Object(l.b)("td",{parentName:"tr",align:null})))),Object(l.b)("h3",{id:"\u5e38\u7528\u914d\u7f6e"},"\u5e38\u7528\u914d\u7f6e"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-yaml"},"# \u65e5\u5fd7\u914d\u7f6e\nlogging.level.root: INFO\nlogging.level.org.springframework.web: DEBUG\nlogging.level.org.hibernate: ERROR\n\n# \u542f\u7528 h2 \u63a7\u5236\u53f0\nspring.h2.console.enabled: true\n# \u4fee\u6539\u63a7\u5236\u53f0\u8def\u5f84,\u9ed8\u8ba4 /h2-console\nspring.h2.console.path: /h2-console\n\n# \u4fee\u6539 Jackson \u65f6\u95f4\u683c\u5f0f,\u8bbe\u7f6e\u6b63\u786e\u7684\u65f6\u533a\u975e\u5e38\u91cd\u8981,\u5426\u5219\u4f1a\u5bfc\u81f4\u5e8f\u5217\u5316\u7684\u65f6\u95f4\u6709\u65f6\u5dee\nspring:\n  jackson:\n    date-format: yyyy-MM-dd HH:mm:ss\n    locale: zh_CN\n    time-zone: GMT+8\n")),Object(l.b)("h3",{id:"tips-1"},"Tips"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"\u53ef\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b\u8f6c\u6362 ",Object(l.b)("a",{parentName:"li",href:"https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config-conversion"},"Properties conversion")),Object(l.b)("li",{parentName:"ul"},"\u53ef\u4f7f\u7528 ",Object(l.b)("inlineCode",{parentName:"li"},"javax.validation")," \u5bf9\u914d\u7f6e\u7684\u5c5e\u6027\u8fdb\u884c\u6821\u9a8c"),Object(l.b)("li",{parentName:"ul"},"\u53ef\u901a\u8fc7 ",Object(l.b)("inlineCode",{parentName:"li"},"spring-boot-actuator")," \u6a21\u5757\u5728 ",Object(l.b)("inlineCode",{parentName:"li"},"/configprops")," \u67e5\u770b\u5c5e\u6027\u914d\u7f6e")),Object(l.b)("h2",{id:"actuator"},"Actuator"),Object(l.b)("h3",{id:"\u5e38\u7528\u7ec8\u7aef"},"\u5e38\u7528\u7ec8\u7aef"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},"ID"),Object(l.b)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"),Object(l.b)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u654f\u611f"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"actuator"),Object(l.b)("td",{parentName:"tr",align:null},"\u63d0\u4f9b\u57fa\u4e8e\u8d85\u5a92\u4f53\u7684\u53d1\u73b0\u9875,\u9700\u8981 Spring HATEOAS."),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"autoconfig"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u81ea\u52a8\u914d\u7f6e\u7684\u6c47\u62a5,\u663e\u793a\u6240\u6709\u81ea\u52a8\u914d\u7f6e\u7684\u5019\u9009\u548c\u4e3a\u4ec0\u4e48\u6ca1\u6709\u88ab\u4f7f\u7528"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"beans"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u7a0b\u5e8f\u4e2d\u7684 beans \u5217\u8868"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"configprops"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u6240\u6709 ",Object(l.b)("inlineCode",{parentName:"td"},"@ConfigurationProperties")),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"docs"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u6587\u6863,\u5305\u62ec\u8bf7\u6c42\u548c\u76f8\u5e94\u7684\u4f8b\u5b50,\u9700\u8981 ",Object(l.b)("inlineCode",{parentName:"td"},"spring-boot-actuator-docs")),Object(l.b)("td",{parentName:"tr",align:null},"false")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"dump"),Object(l.b)("td",{parentName:"tr",align:null},"\u6267\u884c\u7ebf\u7a0b\u8f6c\u50a8"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"env"),Object(l.b)("td",{parentName:"tr",align:null},"\u66b4\u9732 ",Object(l.b)("inlineCode",{parentName:"td"},"ConfigurableEnvironment")," \u7684\u5c5e\u6027"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"flyway"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a Flyway \u6570\u636e\u5e93\u7684\u8fc1\u79fb\u72b6\u6001"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"health"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u5e94\u7528\u7684\u76d1\u63a7\u4fe1\u606f,\u6388\u6743\u540e\u8bf7\u6c42\u8fd4\u56de\u8be6\u7ec6\u4fe1\u606f"),Object(l.b)("td",{parentName:"tr",align:null},"false")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"info"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u4efb\u4f55\u4fe1\u606f"),Object(l.b)("td",{parentName:"tr",align:null})),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"liquibase"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a liquibase \u6570\u636e\u5e93\u8fc1\u79fb\u72b6\u6001"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"logfile"),Object(l.b)("td",{parentName:"tr",align:null},"\u8fd4\u56de logfile \u4e2d\u7684\u5185\u5bb9(\u5982\u679c\u8bbe\u7f6e\u4e86 logging.file \u6216 logging.path \u5c5e\u6027).\u9700\u8981 MVC \u652f\u6301.\u652f\u6301 HTTP \u5934\u7684\u8303\u56f4\u8bf7\u6c42."),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"metrics"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u5f53\u524d\u5e94\u7528\u7684 metrices \u4fe1\u606f"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"mappings"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u6240\u6709 ",Object(l.b)("inlineCode",{parentName:"td"},"@RequestMapping")," \u8def\u5f84"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"shutdown"),Object(l.b)("td",{parentName:"tr",align:null},"\u505c\u6b62\u5e94\u7528(\u9ed8\u8ba4\u672a\u5f00\u542f)"),Object(l.b)("td",{parentName:"tr",align:null},"true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"trace"),Object(l.b)("td",{parentName:"tr",align:null},"\u663e\u793a\u8ddf\u8e2a\u4fe1\u606f(\u9ed8\u8ba4\u53ea\u663e\u793a\u524d\u51e0\u4e2a HTTP \u8bf7\u6c42)"),Object(l.b)("td",{parentName:"tr",align:null},"true")))),Object(l.b)("h3",{id:"\u914d\u7f6e-1"},"\u914d\u7f6e"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-yaml"},"# \u4fee\u6539\u4e00\u4e2a\u7ec8\u7aef\u7684\u654f\u611f\u503c\nendpoints.beans.id=springbeans\nendpoints.beans.sensitive=false\n# \u63a7\u5236\u662f\u5426\u542f\u7528\u7ec8\u7aef\nendpoints.enabled=false\nendpoints.info.enabled=true\nendpoints.shutdown.enabled=true\n# \u63a7\u5236\u662f\u5426\u542f\u7528\u654f\u611f\nendpoints.sensitive=true\nendpoints.info.sensitive=false\n# \u63a7\u5236 CORS\nendpoints.cors.allowed-origins: http://example.com\nendpoints.cors.allowed-methods: GET,POST\n# \u63a7\u5236\u662f\u5426\u542f\u7528\u76d1\u63a7\u68c0\u67e5\nmanagement.health.defaults.enabled=false\n# \u63a7\u5236\u8def\u5f84\u548c\u7aef\u53e3\u5730\u5740\nmanagement.context-path: /manage\nmanagement.port=8081\nmanagement.address=127.0.0.1\n# \u5b9a\u5236\u5316\u901a\u8fc7 info \u7ec8\u7aef\u66b4\u9732\u7684\u4fe1\u606f\ninfo.app.name=MyService\ninfo.app.description=My awesome service\ninfo.app.version=1.0.0\n# \u901a\u8fc7 Maven \u81ea\u52a8\u5c55\u5f00\u5c5e\u6027\n# spring boot parent \u4f7f\u7528 git \u63d2\u4ef6\u63d0\u4f9b\u4e86 git.properties \u6587\u4ef6\nproject.artifactId=myproject\nproject.name=Demo\nproject.version=X.X.X.X\nproject.description=Demo project for info endpoint\ninfo.build.artifact=@project.artifactId@\ninfo.build.name=@project.name@\ninfo.build.description=@project.description@\ninfo.build.version=@project.version@\n# \u63a7\u5236\u8bbf\u95ee\u7ba1\u7406\u53f0\u9700\u8981\u7684\u89d2\u8272\nmanagement.security.role=SUPERUSER\n# \u4e3a\u5355\u72ec\u7684\u7ec8\u7aef\u6307\u5b9a\u8def\u5f84\nendpoints.{name}.path\n# \u7981\u7528 HTTP \u7ec8\u7aef\nmanagement.port=-1\n# \u4fee\u6539 MBean \u540d\u5b57\nendpoints.jmx.domain=myapp\nendpoints.jmx.unique-names: true\n")),Object(l.b)("h2",{id:"remote-shell"},"Remote shell"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-remote-shell</artifactId>\n</dependency>\n")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"\u9ed8\u8ba4\u7aef\u53e3\u4e3a 2000"),Object(l.b)("li",{parentName:"ul"},"\u547d\u4ee4\u626b\u63cf\u8def\u5f84\u4e3a")),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"classpath*:/commands/**\nclasspath*:/crash/commands/**\n")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"\u53ef\u901a\u8fc7 ",Object(l.b)("inlineCode",{parentName:"li"},"shell.command-path-patterns")," \u6765\u4fee\u6539\u547d\u4ee4\u8def\u5f84"),Object(l.b)("li",{parentName:"ul"},"\u7ee7\u627f\u81ea ",Object(l.b)("inlineCode",{parentName:"li"},"org.crsh.plugin.CRaSHPlugin")," \u7684 Bean \u4f1a\u81ea\u52a8\u6ce8\u518c")),Object(l.b)("h3",{id:"\u914d\u7f6e-2"},"\u914d\u7f6e"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"shell.auth.simple.user.name\nshell.auth.simple.user.password\n")),Object(l.b)("h2",{id:"metrics"},"Metrics"),Object(l.b)("h3",{id:"\u76d1\u63a7\u4fe1\u606f"},"\u76d1\u63a7\u4fe1\u606f"),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u7cfb\u7edf\u76d1\u63a7")),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},"\u952e"),Object(l.b)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"),Object(l.b)("th",{parentName:"tr",align:null},"\u5355\u4f4d"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"mem"),Object(l.b)("td",{parentName:"tr",align:null},"\u603b\u5185\u5b58"),Object(l.b)("td",{parentName:"tr",align:null},"KB")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"mem.free"),Object(l.b)("td",{parentName:"tr",align:null},"\u7a7a\u95f2\u5185\u5b58"),Object(l.b)("td",{parentName:"tr",align:null},"KB")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"processors"),Object(l.b)("td",{parentName:"tr",align:null},"\u8fdb\u7a0b\u6570"),Object(l.b)("td",{parentName:"tr",align:null})),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"uptime"),Object(l.b)("td",{parentName:"tr",align:null},"\u7cfb\u7edf\u8fd0\u884c\u65f6\u95f4  ms"),Object(l.b)("td",{parentName:"tr",align:null})),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"instance.uptime"),Object(l.b)("td",{parentName:"tr",align:null},"\u7a0b\u5e8f\u8fd0\u884c\u65f6\u95f4"),Object(l.b)("td",{parentName:"tr",align:null},"ms")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"systemload.average"),Object(l.b)("td",{parentName:"tr",align:null},"\u7cfb\u7edf\u5e73\u5747\u8d1f\u8f7d"),Object(l.b)("td",{parentName:"tr",align:null})),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"heap",Object(l.b)("br",null),"heap.committed",Object(l.b)("br",null),"heap.init",Object(l.b)("br",null),"heap.used"),Object(l.b)("td",{parentName:"tr",align:null},"\u5806\u4fe1\u606f"),Object(l.b)("td",{parentName:"tr",align:null},"KB")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"threads",Object(l.b)("br",null),"thread.peak",Object(l.b)("br",null),"thread.daemon"),Object(l.b)("td",{parentName:"tr",align:null},"\u7ebf\u7a0b\u4fe1\u606f"),Object(l.b)("td",{parentName:"tr",align:null})),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"classes",Object(l.b)("br",null),"classes.loaded",Object(l.b)("br",null),"classes.unloaded"),Object(l.b)("td",{parentName:"tr",align:null},"\u7c7b\u52a0\u8f7d\u4fe1\u606f"),Object(l.b)("td",{parentName:"tr",align:null})),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"gc.xxx.count",Object(l.b)("br",null),"gc.xxx.time"),Object(l.b)("td",{parentName:"tr",align:null},"\u5783\u573e\u56de\u6536\u4fe1\u606f"),Object(l.b)("td",{parentName:"tr",align:null})))),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u6570\u636e\u6e90\u76d1\u63a7")),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},"\u952e"),Object(l.b)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"datasource.xxx.active"),Object(l.b)("td",{parentName:"tr",align:null},"\u6fc0\u6d3b\u94fe\u63a5\u6570")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"datasource.xxx.usage"),Object(l.b)("td",{parentName:"tr",align:null},"\u5f53\u524d\u7ebf\u7a0b\u6c60\u7684\u4f7f\u7528\u60c5\u51b5")))),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"datasource.primary")," \u8868\u793a ",Object(l.b)("inlineCode",{parentName:"li"},"@Primary")," \u7684\u6570\u636e\u6e90"),Object(l.b)("li",{parentName:"ul"},"\u5982\u679c\u4e00\u4e2a\u6570\u636e\u6e90 bean \u7684\u540d\u5b57\u662f\u4ee5 DataSource \u7ed3\u5c3e\u7684,\u90a3\u4e48 metric \u91cc\u53ea\u4f1a\u663e\u793a\u4e4b\u524d\u7684,\u4f8b\u5982 ",Object(l.b)("inlineCode",{parentName:"li"},"myDataSource")," \u663e\u793a\u4e3a ",Object(l.b)("inlineCode",{parentName:"li"},"datasource.my")),Object(l.b)("li",{parentName:"ul"},"\u5426\u5219\u90fd\u662f\u7528 bean \u540d\u4f5c\u4e3a metric \u540d"),Object(l.b)("li",{parentName:"ul"},"\u53ef\u901a\u8fc7\u6ce8\u518c ",Object(l.b)("inlineCode",{parentName:"li"},"DataSourcePublicMetrics")," \u6765\u4fee\u6539\u90e8\u5206\u9ed8\u8ba4\u914d\u7f6e."),Object(l.b)("li",{parentName:"ul"},"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u663e\u793a\u6240\u6709\u652f\u6301\u7684\u5143\u6570\u636e,\u53ef\u901a\u8fc7 ",Object(l.b)("inlineCode",{parentName:"li"},"DataSourcePoolMetadataProvider")," Bean \u6dfb\u52a0\u989d\u5916\u7684. \u8bf7\u67e5\u770b",Object(l.b)("inlineCode",{parentName:"li"},"DataSourcePoolMetadataProvidersConfiguration"),".")),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u7f13\u5b58\u76d1\u63a7")),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},"\u952e"),Object(l.b)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"cache.xxx.size"),Object(l.b)("td",{parentName:"tr",align:null},"\u7f13\u5b58\u5927\u5c0f")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"cache.xxx.hit.ratio"),Object(l.b)("td",{parentName:"tr",align:null},"\u547d\u4e2d\u7387")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"cache.xxx.miss.ratio"),Object(l.b)("td",{parentName:"tr",align:null},"\u672a\u547d\u4e2d\u7387")))),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"TOMCAT SESSION")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"httpsessions.active"),Object(l.b)("li",{parentName:"ul"},"httpsessions.max")),Object(l.b)("h3",{id:"\u81ea\u5b9a\u4e49"},"\u81ea\u5b9a\u4e49"),Object(l.b)("p",null,"\u53ef\u901a\u8fc7\u6ce8\u5165 CounterService \u6216 GaugeService \u6765\u63d0\u4f9b\u5e94\u7528\u76d1\u63a7, \u867d\u7136\u4efb\u4f55\u5b57\u7b26\u4e32\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u540d\u5b57,\u4f46\u5efa\u8bae\u53c2\u8003 ",Object(l.b)("a",{parentName:"p",href:"http://matt.aimonetti.net/posts/2013/06/26/practical-guide-to-graphite-monitoring/"},"\u8be5\u6307\u5357"),"."),Object(l.b)("p",null,"\u53ef\u901a\u8fc7\u6ce8\u518c ",Object(l.b)("inlineCode",{parentName:"p"},"PublicMetrics")," \u6765\u505a\u901a\u8fc7\u8ba1\u7b97\u5f97\u51fa\u7684\u7edf\u8ba1.\u53ef\u901a\u8fc7 ",Object(l.b)("inlineCode",{parentName:"p"},"MetricsEndpoint")," \u6765\u5b9a\u5236\u5904\u7406\u65b9\u5f0f."),Object(l.b)("h3",{id:"\u8f93\u51fa\u76d1\u63a7\u4fe1\u606f"},"\u8f93\u51fa\u76d1\u63a7\u4fe1\u606f"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"spring.metrics.export\n  .send-latest\n  .delay-millis\n  .includes\n  .excludes\n# \u4e5f\u53ef\u4e3a\u6bcf\u4e2a bean \u8bbe\u7f6e\nspring.metrics.export.triggers.<name>.*\n")),Object(l.b)("h4",{id:"\u8f93\u51fa\u5230-redis"},"\u8f93\u51fa\u5230 Redis"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},"@Bean\n@ExportMetricWriter\nMetricWriter metricWriter(MetricExportProperties export) {\n    return new RedisMetricRepository(connectionFactory,\n      export.getRedis().getPrefix(), export.getRedis().getKey());\n}\n")),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"spring.metrics.export.redis.prefix: metrics.mysystem.${spring.application.name:application}.${random.value:0000}\nspring.metrics.export.redis.key: keys.metrics.mysystem\n")),Object(l.b)("h4",{id:"\u8f93\u51fa\u5230-statd"},"\u8f93\u51fa\u5230 statd"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},'@Value("${spring.application.name:application}.${random.value:0000}")\nprivate String prefix = "metrics";\n\n@Bean\n@ExportMetricWriter\nMetricWriter metricWriter() {\n    return new StatsdMetricWriter(prefix, "localhost", "8125");\n}\n')),Object(l.b)("h4",{id:"\u5bfc\u51fa\u5230-jmx"},"\u5bfc\u51fa\u5230 JMX"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},"@Bean\n@ExportMetricWriter\nMetricWriter metricWriter(MBeanExporter exporter) {\n    return new JmxMetricWriter(exporter);\n}\n")),Object(l.b)("h3",{id:"\u83b7\u53d6-xmlmapper"},"\u83b7\u53d6 XmlMapper"),Object(l.b)("p",null,Object(l.b)("a",{parentName:"p",href:"http://docs.spring.io/spring-boot/docs/current/reference/html/howto-spring-mvc.html"},"http://docs.spring.io/spring-boot/docs/current/reference/html/howto-spring-mvc.html")),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>com.fasterxml.jackson.dataformat</groupId>\n    <artifactId>jackson-dataformat-xml</artifactId>\n</dependency>\n")),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},"@Autowired\npublic void init(MappingJackson2XmlHttpMessageConverter xmlConverter){\n    XmlMapper mapper = (XmlMapper) xmlConverter.getObjectMapper();\n}\n")),Object(l.b)("h3",{id:"\u83b7\u53d6\u8bf7\u6c42\u4f53\u6587\u672c"},"\u83b7\u53d6\u8bf7\u6c42\u4f53\u6587\u672c"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},'@RequestMapping(path = "/echo", method = RequestMethod.POST)\npublic Object echo(HttpServletRequest request) throws IOException {\n  String content = CharStreams.toString(new InputStreamReader(request.getInputStream()));\n  return content;\n}\n')),Object(l.b)("h3",{id:"\u53bb\u9664\u9519\u8bef\u767d\u677f\u9875"},"\u53bb\u9664\u9519\u8bef\u767d\u677f\u9875"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},'@RestController\npublic class IndexController implements ErrorController{\n\n    private static final String PATH = "/error";\n\n    private final ErrorAttributes errorAttributes;\n\n    // \u4e5f\u53ef\u4ee5\u81ea\u5df1\u5904\u7406\u9519\u8bef\n    @Autowired\n    public IndexController(ErrorAttributes errorAttributes) {\n      Assert.notNull(errorAttributes, "ErrorAttributes must not be null");\n      this.errorAttributes = errorAttributes;\n    }\n\n    @RequestMapping(value = PATH)\n    public String error() {\n        return "Error handling";\n    }\n\n    @Override\n    public String getErrorPath() {\n        return PATH;\n    }\n}\n// \u9ed8\u8ba4\u7684\u9519\u8bef\u63a7\u5236\u5668\u4e3a ErrorMvcAutoConfiguration#basicErrorController\n')),Object(l.b)("h2",{id:"\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u81ea\u52a8\u914d\u7f6e"},"\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u81ea\u52a8\u914d\u7f6e"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",{parentName:"li",href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html"},"46. Creating Your Own Auto-configuration")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"META-INF/spring.factories")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"org.springframework.boot.autoconfigure.EnableAutoConfiguration="),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"\u9017\u53f7\u5206\u9694")))))}p.isMDXComponent=!0},790:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return s}));var a=n(0),r=n.n(a);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,b=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,s=m["".concat(b,".").concat(d)]||m[d]||u[d]||l;return n?r.a.createElement(s,i(i({ref:t},c),{},{components:n})):r.a.createElement(s,i({ref:t},c))}));function s(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,b=new Array(l);b[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,b[1]=i;for(var c=2;c<l;c++)b[c]=n[c];return r.a.createElement.apply(null,b)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);