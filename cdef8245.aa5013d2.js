(window.webpackJsonp=window.webpackJsonp||[]).push([[698],{771:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return p}));var a=t(3),r=t(8),i=(t(0),t(914)),s={id:"alpine-ops",title:"Alpine \u8fd0\u7ef4\u7b14\u8bb0"},l={unversionedId:"os/alpine/alpine-ops",id:"os/alpine/alpine-ops",isDocsHomePage:!1,title:"Alpine \u8fd0\u7ef4\u7b14\u8bb0",description:"Tips",source:"@site/notes/os/alpine/alpine-ops.md",slug:"/os/alpine/alpine-ops",permalink:"/notes/os/alpine/alpine-ops",editUrl:"https://github.com/wenerme/wener/edit/master/notes/os/alpine/alpine-ops.md",version:"current",sidebar:"docs",previous:{title:"Alpine local backup",permalink:"/notes/os/alpine/alpine-lbu"},next:{title:"Alpine \u5305\u7ef4\u62a4",permalink:"/notes/os/alpine/alpine-pkgs"}},c=[{value:"Tips",id:"tips",children:[]},{value:"bash",id:"bash",children:[]},{value:"manpages",id:"manpages",children:[]},{value:"\u57fa\u7840\u8fd0\u7ef4",id:"\u57fa\u7840\u8fd0\u7ef4",children:[]},{value:"\u7cfb\u7edf\u8fd0\u7ef4",id:"\u7cfb\u7edf\u8fd0\u7ef4",children:[]},{value:"\u786c\u4ef6\u8fd0\u7ef4",id:"\u786c\u4ef6\u8fd0\u7ef4",children:[]},{value:"setup-disk",id:"setup-disk",children:[]},{value:"\u672c\u5730\u4ed3\u5e93",id:"\u672c\u5730\u4ed3\u5e93",children:[]},{value:"\u5bb9\u5668",id:"\u5bb9\u5668",children:[]},{value:"\u78c1\u76d8\u6269\u5c55",id:"\u78c1\u76d8\u6269\u5c55",children:[]},{value:"udev",id:"udev",children:[]},{value:"zfs",id:"zfs",children:[{value:"uninstall zfs",id:"uninstall-zfs",children:[]}]},{value:"btrfs",id:"btrfs",children:[{value:"failed to read the system array",id:"failed-to-read-the-system-array",children:[]}]},{value:"networking",id:"networking",children:[]},{value:"network benchmark",id:"network-benchmark",children:[]},{value:"init",id:"init",children:[]},{value:"iscsi",id:"iscsi",children:[]},{value:"netatalk",id:"netatalk",children:[]},{value:"stress",id:"stress",children:[]},{value:"disk",id:"disk",children:[]},{value:"QEMU",id:"qemu",children:[{value:"kvm",id:"kvm",children:[]},{value:"virtual-disk",id:"virtual-disk",children:[]}]},{value:"ftp",id:"ftp",children:[]},{value:"lvm",id:"lvm",children:[]},{value:"libguestfs",id:"libguestfs",children:[]},{value:"acf",id:"acf",children:[]},{value:"crond",id:"crond",children:[]},{value:"wireguard",id:"wireguard",children:[]},{value:"FAQ",id:"faq",children:[{value:"ip: ioctl 0x8913 failed: no such device",id:"ip-ioctl-0x8913-failed-no-such-device",children:[]},{value:"\u6062\u590d\u7f51\u5361\u540d\u5b57",id:"\u6062\u590d\u7f51\u5361\u540d\u5b57",children:[]},{value:"\u6587\u4ef6\u7cfb\u7edf\u53d8\u6210\u4e86\u53ea\u8bfb",id:"\u6587\u4ef6\u7cfb\u7edf\u53d8\u6210\u4e86\u53ea\u8bfb",children:[]},{value:"find: /sys/module/pcc_cpufreq",id:"find-sysmodulepcc_cpufreq",children:[]},{value:"traps: rc-status3854 general protection",id:"traps-rc-status3854-general-protection",children:[]},{value:"ip: RTNETLINK answers: File exists",id:"ip-rtnetlink-answers-file-exists",children:[]},{value:"grsec: time set by /sbin/hwclockhwclock:2863",id:"grsec-time-set-by-sbinhwclockhwclock2863",children:[]},{value:"node docker seg fault",id:"node-docker-seg-fault",children:[]},{value:"PHP \u4e0b iconv \u6709\u95ee\u9898",id:"php-\u4e0b-iconv-\u6709\u95ee\u9898",children:[]},{value:"rc-status sysinit \u5f02\u5e38",id:"rc-status-sysinit-\u5f02\u5e38",children:[]},{value:"\u542f\u52a8\u5206\u533a\u4fee\u590d",id:"\u542f\u52a8\u5206\u533a\u4fee\u590d",children:[]},{value:"TBD",id:"tbd",children:[]}]}],b={toc:c};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"tips"},"Tips"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u5e38\u7528\u547d\u4ee4\nlsblk --output NAME,SIZE,VENDOR,FSTYPE,LABEL,UUID,MODE\n# \u4f7f\u7528 NAME \u6392\u5e8f\nlsblk -x NAME --output NAME,SIZE,VENDOR,FSTYPE,LABEL,UUID,MODE\n\n# \u57fa\u7840\u5b89\u88c5\u5305\napk add wpa_supplicant e2fsprogs-extra\n")),Object(i.b)("h2",{id:"bash"},"bash"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://pkgs.alpinelinux.org/packages?name=*-bash-completion&branch=v3.6&repo=&arch=x86_64"},"*-bash-completion"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"\u5176\u4ed6\u7684 bash \u8865\u5168\u7684\u5305")))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# Bash\napk add shadow bash\nusermod --shell /bin/bash admin\n# \u8be5\u6b65\u9aa4\u8981\u6c42\u8f93\u5165\u5bc6\u7801\n# chsh root -s /bin/bash\n\n# \u8865\u5168\napk add bash-completion\n# \u52a0\u8f7d\u8865\u5168\nsource /etc/profile.d/bash_completion.sh\n")),Object(i.b)("h2",{id:"manpages"},"manpages"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Alpine \u9ed8\u8ba4\u4e0d\u4f1a\u5b89\u88c5 doc \u548c man"),Object(i.b)("li",{parentName:"ul"},"\u6240\u6709\u7684\u6587\u6863\u4ee5 -doc \u7ed3\u5c3e"),Object(i.b)("li",{parentName:"ul"},"\u6587\u6863\u4f4d\u4e8e /usr/share/man"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiki.alpinelinux.org/wiki/How_to_get_regular_stuff_working"},"How to get regular stuff working"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"apk add --no-cache man man-pages mdocml-apropos less less-doc\nexport PAGER=less\n\n# \u5b89\u88c5\u548c\u67e5\u770b\napk add --no-cache curl-doc\nman curl\n\n# \u6216\u8005\u76f4\u63a5\u4f7f\u7528 docker \u4fbf\u4e8e\u67e5\u6587\u6863\ndocker run --rm -it wener/base:man\n# \u53ef\u4ee5\u5b89\u88c5\u6620\u5c04\u5230\u4e3b\u673a\ndocker run --rm -it -v $PWD/man:/usr/share/man wener/base:man\n")),Object(i.b)("h2",{id:"\u57fa\u7840\u8fd0\u7ef4"},"\u57fa\u7840\u8fd0\u7ef4"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u57fa\u7840\u5de5\u5177\napk add nano file grep htop rsync curl openssl\n\n# \u7b80\u5316\u94fe\u63a5\napk add tmux mosh\n\n# sshrc - https://github.com/Russell91/sshrc\n# \u4f9d\u8d56\u5305\napk add vim tar coreutils openssl\n\n# \u8bc1\u4e66\n# /etc/ssl/certs/ca-certificates.crt\n\n# \u7cfb\u7edf\u4fe1\u606f\napk add neofetch\n")),Object(i.b)("h2",{id:"\u7cfb\u7edf\u8fd0\u7ef4"},"\u7cfb\u7edf\u8fd0\u7ef4"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u5e38\u7528\u5de5\u5177\napk add util-linux\n# \u6269\u5c55\u5de5\u5177\napk add blkid cfdisk findmnt mcookie setpriv sfdisk\n# \u8865\u5168\napk add util-linux-bash-completion\n\n# \u4fe1\u606f\u67e5\u8be2\u5de5\u5177\napk add lsof\n")),Object(i.b)("h2",{id:"\u786c\u4ef6\u8fd0\u7ef4"},"\u786c\u4ef6\u8fd0\u7ef4"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"apk add pciutils\napk add usbutils\napk add parted\napk add ddrescue\n\n# dmidecode ownership vpddecode biosdecode\napk add dmidecode\n")),Object(i.b)("h2",{id:"setup-disk"},"setup-disk"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u5236\u4f5c\u7cfb\u7edf\u76d8\n# swap 0\nsetup-disk -m sys -s 0 -v /dev/sda\n\n# ==========\n# \u65b0\u7cfb\u7edf\u68c0\u67e5\u9879\n# ==========\n# \u4fee\u6539\u4e3b\u673a\u540d\nsetup-hostname -n alpine-test\n/etc/init.d/hostname --quiet restart\nnano /etc/hosts\n\n# \u4fee\u6539\u7f51\u7edc\u5730\u5740\nnano /etc/network/interfaces\n")),Object(i.b)("h2",{id:"\u672c\u5730\u4ed3\u5e93"},"\u672c\u5730\u4ed3\u5e93"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"ARCH=$(apk print --print-arch)\nREPO=$PWD/repo\nmkdir -p $REPO/$ARCH\napk fetch -vRo $REPO/$ARCH nano\n# \u53ef\u4ee5\u6307\u5b9a\u4ed3\u5e93\napk fetch -vRo $REPO/$ARCH -X http://mirrors.aliyun.com/alpine/edge/main --no-cache linux-firmware-brcm\n\n# \u521b\u5efa\u7d22\u5f15\n# \u8fd9\u91cc\u7684 APKINDEX \u662f\u672a\u7b7e\u540d\u7684\napk index -o $REPO/$ARCH/APKINDEX.tar.gz $REPO/$ARCH/*.apk\napk -X $REPO update --allow-untrust\napk -X $REPO search --allow-untrust nano\n\n")),Object(i.b)("h2",{id:"\u5bb9\u5668"},"\u5bb9\u5668"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# Docker\napk add docker\nrc-update add docker\n")),Object(i.b)("h2",{id:"\u78c1\u76d8\u6269\u5c55"},"\u78c1\u76d8\u6269\u5c55"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u6269\u5c55\u5206\u533a\n# \u5047\u8bbe\u5206\u533a\u7ed3\u6784\u4e3a: boot,swap,root,\u7a7a\u95f2\n# \u5220\u9664\u6700\u540e\u4e00\u4e2a\u5206\u533a, \u518d\u521b\u5efa\u6700\u540e\u4e00\u4e2a\u5206\u533a, \u786e\u4fdd\u8d77\u70b9\u4f4d\u7f6e\u4e0d\u53d8\n# F \u53ef\u4ee5\u770b\u5230\u7a7a\u4f59\u7a7a\u95f4\n# \u624b\u52a8\u5206\u533a\n# fdisk /dev/sda\n# \u6216\u76f4\u63a5\u5206\u533a\napk add util-linux\necho -e 'd\\n\\nn\\n\\n\\n\\n\\n\\np\\nw\\n' | fdisk /dev/sda\n\n# \u91cd\u542f\n# \u4e0d\u91cd\u542f\u5e94\u8be5\u4e5f\u662f\u53ef\u4ee5\u7684\nreboot\n\n# \u6269\u5c55\u6587\u4ef6\u7cfb\u7edf\napk add e2fsprogs-extra\nresize2fs /dev/sda2\n\n# \u68c0\u67e5\u7ed3\u679c\ndf -h /\n\n# parted \u4e5f\u53ef\u4ee5\nparted /dev/sdb resize 1 1 200M\nparted /dev/sdb resizepart 1 400M\nresize2fs /dev/sdb1 400M\n")),Object(i.b)("h2",{id:"udev"},"udev"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Gentoo ",Object(i.b)("a",{parentName:"li",href:"https://wiki.gentoo.org/wiki/Project:Eudev"},"Eudev"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u8bbe\u7f6e /dev/disk\napk add udev-init-scripts\n# OpenRC compatible fork of systemd-udev\napk add eudev\n# init: udev udev-trigger udev-postmount udev-settle\nrc-update add udev sysinit\nrc-update add udev-trigger sysinit\n\n# \u5982\u679c\u60f3\u8981\u7acb\u5373\u542f\u7528\nrc-service udev start\nrc-service udev-trigger start\n\nudevadm trigger\n\n# \u8be5\u5305\u4f1a\u5f71\u54cd\u7f51\u5361\u540d\u5b57\n# \u4f1a\u6dfb\u52a0 /lib/udev/rules.d/80-net-name-slot.rules\n# \u9700\u8981\u53c2\u6570 net.ifnames=0 \u6765\u5173\u95ed\n# \u5927\u591a\u6570\u65f6\u5019\u4e0d\u9700\u8981\n# apk add eudev-netifnames\n\n# \u6240\u6709\u5b9a\u4e49\u7684\u89c4\u5219\nudevadm info --export-db\n")),Object(i.b)("h2",{id:"zfs"},"zfs"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u5148\u5b89\u88c5 ",Object(i.b)("a",{parentName:"li",href:"#udev"},"udev")," \u73af\u5883"),Object(i.b)("li",{parentName:"ul"},"\u4f7f\u7528 zfs \u65f6\u6700\u597d\u4f7f\u7528 uuid, \u56e0\u4e3a\u540d\u5b57\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316"),Object(i.b)("li",{parentName:"ul"},"0.6 \u65f6, \u5bfc\u81f4\u76f4\u63a5\u7cfb\u7edf\u91cd\u542f"),Object(i.b)("li",{parentName:"ul"},"0.6 \u7684 init \u4e0d\u662f openrc \u7684\u811a\u672c, \u542f\u52a8\u4f1a\u8b66\u544a")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"apk add zfs zfs-{scripts,udev,utils-py}\n# vanilla \u5185\u6838\napk add zfs-vanilla\n# \u52a0\u8f7d\u5185\u6838\u6a21\u5757\nmodprobe zfs\necho zfs >> /etc/modules\n\n# init: zfs-import zfs-mount zfs-share zfs-zed\nrc-update add zfs-import sysinit\nrc-update add zfs-mount sysinit\n\n# \u7acb\u5373\u542f\u52a8\nrc-service zfs-import start\nrc-service zfs-mount start\n\n# \u68c0\u6d4b\u662f\u5426\u6b63\u5e38\nzpool status\n\n# \u67e5\u770b\u78c1\u76d8\u91cf\nparted --list\n# \u67e5\u770b\u73b0\u6709\u78c1\u76d8 UUID\n# \u4f9d\u8d56\u4e8e udev\n# \u4e00\u822c\u4f1a\u6709 ata, scsi, wwn \u524d\u7f00\u4e4b\u7c7b\nls -lh /dev/disk/by-id/\n# \u53ea\u770b\u4e3b\u76d8\nls -lh /dev/disk/by-id/ | grep 'sd.$'\n\n# -f \u5f3a\u5236\u521b\u5efa, \u907f\u514d Does not contain an EFI label \u9519\u8bef\n# -o ashift=12 \u4f7f\u7528\u9ad8\u7ea7\u78c1\u76d8\u683c\u5f0f\n# -m /mnt/data \u6307\u5b9a\u6302\u8f7d\u70b9, \u4e0d\u6307\u5b9a\u5219\u9ed8\u8ba4\u6302\u8f7d\u4e3a /<pool>\n# p1 Pool \u7684\u540d\u5b57\n# raidz \u4f7f\u7528 RADI-Z \u5197\u4f59\nzpool create -f -o ashift=12 -m /mnt/data p1 \\\n  raidz \\\n    ata-VBOX_HARDDISK_VB63cffc10-3a66b288 \\\n    ata-VBOX_HARDDISK_VBfb21373d-56cc6c57 \\\n    ata-VBOX_HARDDISK_VB91ae7aad-d4a73895\n\n# \u67e5\u770b\u72b6\u6001\nzpool status\n\n#   pool: p1\n#  state: ONLINE\n#   scan: none requested\n# config:\n#\n#   NAME                                       STATE     READ WRITE CKSUM\n#   p1                                         ONLINE       0     0     0\n#     raidz1-0                                 ONLINE       0     0     0\n#       ata-VBOX_HARDDISK_VB63cffc10-3a66b288  ONLINE       0     0     0\n#       ata-VBOX_HARDDISK_VBfb21373d-56cc6c57  ONLINE       0     0     0\n#       ata-VBOX_HARDDISK_VB91ae7aad-d4a73895  ONLINE       0     0     0\n#\n# errors: No known data errors\n\n# \u6b64\u65f6\u53ef\u4ee5\u91cd\u542f\u6d4b\u8bd5\u770b\u770b pool \u662f\u5426\u8fd8\u5728\n\nzpool status -x\n\n# \u5c06 scrub \u4f5c\u4e3a\u5468\u671f\u6027\u4efb\u52a1\n# \u4e00\u822c\u4e00\u4e24\u5468\u4e00\u6b21, \u81f3\u5c11\u4e00\u6708\u4e00\u6b21\necho '#!/bin/sh -\nzpool scrub main\n' > /etc/periodic/weekly/zfs-scrub\nchmod +x /etc/periodic/weekly/zfs-scrub\n\n# \u6d4b\u8bd5 crond\n# busybox \u7684 run-parts \u529f\u80fd\u8f83\u5c11\napk add run-parts\nrun-parts /etc/periodic/weekly -v --report\n")),Object(i.b)("h3",{id:"uninstall-zfs"},"uninstall zfs"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u9500\u6bc1\u4f7f\u7528\u7684 pool\nzpool destroy pool\n\n# \u505c\u6b62 service\nrc-service zfs-import stop\nrc-service zfs-mount stop\n\n# \u79fb\u9664 init\nrc-update del zfs-import sysinit\nrc-update del zfs-mount sysinit\n\n# \u79fb\u9664\u5185\u6838\u6a21\u5757\nmodprobe -r zfs\n")),Object(i.b)("h2",{id:"btrfs"},"btrfs"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"kernel ",Object(i.b)("a",{parentName:"p",href:"https://btrfs.wiki.kernel.org/"},"btrfs")),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs(5)"},"btrfs.5")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://btrfs.wiki.kernel.org/index.php/Status"},"Status")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://btrfs.wiki.kernel.org/index.php/Mount_options"},"Mount options")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://btrfs.wiki.kernel.org/index.php/Incremental_Backup"},"Incremental Backup")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://btrfs.wiki.kernel.org/index.php/Problem_FAQ"},"FAQ")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://btrfs.wiki.kernel.org/index.php/Gotchas"},"Gotchas"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"\u4e0d\u5efa\u8bae\u4f7f\u7528 RAID5, RAID6"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices"},"Using Btrfs with Multiple Devices")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Debian ",Object(i.b)("a",{parentName:"p",href:"https://wiki.debian.org/Btrfs"},"Btrfs")),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"\u4e0d\u8981\u4f7f\u7528 4.11.x"),Object(i.b)("li",{parentName:"ul"},"quotas \u548c qgroups \u6709\u95ee\u9898"),Object(i.b)("li",{parentName:"ul"},"subvol \u4e0d\u80fd\u591f\u88ab\u6302\u5728\u4e3a\u4e0d\u540c\u7684\u9009\u9879"),Object(i.b)("li",{parentName:"ul"},"compress=lzo \u53ef\u80fd\u6bd4\u8f83\u5371\u9669"),Object(i.b)("li",{parentName:"ul"},"-o compress \u53ef\u80fd\u4f1a\u653e\u5927\u788e\u7247"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Archlinux ",Object(i.b)("a",{parentName:"p",href:"https://wiki.archlinux.org/index.php/Btrfs"},"Btrfs")),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiki.archlinux.org/index.php/Btrfs_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)"},"\u4e2d\u6587")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"raid0, raid1, raid5, raid6, raid10, dup, single"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'# \u8f85\u52a9\u7a0b\u5e8f\napk add btrfs-progs\napk add btrfs-progs-extra\n# \u8865\u5168\napk add btrfs-progs-bash-completion\n\n# \u52a0\u8f7d\u5185\u6838\u6a21\u5757\nmodprobe btrfs\n# \u786e\u4fdd\u542f\u52a8\u65f6\u52a0\u8f7d\necho btrfs >> /etc/modules\n\n# \u52a0\u8f7d\u6a21\u5757\u540e\u4f1a\u751f\u6210, \u5982\u679c\u6ca1\u6709\u53ef\u4ee5\u624b\u52a8\u521b\u5efa\n# mknod /dev/btrfs-control c 10 234\n\n# -M \u6df7\u5408\u5143\u6570\u636e\u548c\u6570\u636e, \u9002\u7528\u4e8e\u5c0f\u6570\u636e, \u6570\u636e\u5927\u4e86\u8fc7\u540e\u78c1\u76d8\u5e03\u5c40\u4e0d\u53ef\u9884\u89c1\n# -L \u6307\u5b9a\u6807\u7b7e\n# -U \u53ef\u624b\u52a8\u6307\u5b9a UUID, \u907f\u514d\u4fee\u6539 fstab\n# -O \u6307\u5b9a\u7279\u6027\nmkfs.btrfs --help\n\n# \u67e5\u770b\u652f\u6301\u7684\u7279\u6027\nmkfs.btrfs -O list-all\n# mixed-bg            - mixed data and metadata block groups (0x4, compat=2.6.37, safe=2.6.37)\n# extref              - increased hardlink limit per file to 65536 (0x40, compat=3.7, safe=3.12, default=3.12)\n# raid56              - raid56 extended format (0x80, compat=3.9)\n# skinny-metadata     - reduced-size metadata extent refs (0x100, compat=3.10, safe=3.18, default=3.18)\n# no-holes            - no explicit hole extents for files (0x200, compat=3.14, safe=4.0)\n\n# a.b.c.d \u505a raid 1\n# \u8fd9\u51e0\u4e2a\u8bbe\u5907\u7684 uuid \u4f1a\u53d8\u6210\u4e00\u6837\nmkfs.btrfs -d raid1 -m raid1 /dev/sd{a,b,c,d}\n\n# \u6b64\u65f6\u53ef\u4ee5\u5c06\u4efb\u610f\u4e00\u4e2a\u8bbe\u5907\u8fdb\u884c\u6302\u8f7d\nmount /dev/sda /mnt/main/\n\n# \u8bbe\u5907\u626b\u63cf\nbtrfs device scan\n# \u67e5\u770b\u6587\u4ef6\u7cfb\u7edf\nbtrfs filesystem show\n# \u67e5\u770b\u4f7f\u7528\u91cf\nbtrfs fi df /data\n\n# \u6267\u884c scrub\n# https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs-scrub\n# \u7ed3\u679c\u4f1a\u5b58\u50a8\u4e8e /var/lib/btrfs/\nbtrfs sc start /data\n# \u67e5\u770b\u6267\u884c\u72b6\u6001\nbtrfs sc status /data\n\n# \u6267\u884c check\n# check or repair a btrfs filesystem\n# https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs-check\n# \u4e0d\u5efa\u8bae\u6267\u884c\u5728\u7ebf\u68c0\u6d4b\n\n# \u81ea\u52a8\u6302\u8f7d\u9700\u8981\u4fee\u6539 /etc/fstab\necho "UUID=$(blkid -s UUID -o value /dev/sda) /data btrfs defaults 0 0" >> /etc/fstab\n')),Object(i.b)("h3",{id:"failed-to-read-the-system-array"},"failed to read the system array"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u4f1a\u5bfc\u81f4\u542f\u52a8\u65f6\u6302\u8f7d\u5931\u8d25")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"[ 1985.671707] BTRFS info (device sde): disk space caching is enabled\n[ 1985.671712] BTRFS info (device sde): has skinny extents\n[ 1985.675608] BTRFS error (device sde): failed to read the system array: -5\n[ 1985.731217] BTRFS error (device sde): open_ctree failed\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u4ece\u65b0\u626b\u63cf\u540e\u6302\u8f7d\nbtrfs dev scan\nmount -a\n\n# \u5982\u679c\u8fd8\u4e0d\u884c\u53ef\u4ee5\u5c1d\u8bd5\nbtrfs rescue zero-log /dev/sde\nmount -a\n")),Object(i.b)("h2",{id:"networking"},"networking"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"auto",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"try to ",Object(i.b)("inlineCode",{parentName:"li"},"ip link set <dev> up"),"  at boot.  Best choice for anything PCIe/SoC."))),Object(i.b)("li",{parentName:"ul"},"allow-hotplug",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"for kernel+drivers+udev to detect the device, then ",Object(i.b)("inlineCode",{parentName:"li"},"ip link set <dev> up")," it.  The only thing that can deal with annoying USB, SDIO, etc.")))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"apk add ethtool\n# \u652f\u6301\u66f4\u591a\u7684\u53c2\u6570\napk add ifupdown\napk add iftop\n# \u652f\u6301 -v\napk add run-parts\napk add iproute2\n# A utility to ping multiple hosts at once\n# http://fping.org/\napk add fping\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u8bbe\u7f6e\u5730\u5740\u548c\u63a9\u7801\nifconfig eth1 192.168.8.182 netmask 255.255.252.0\n# \u5b9e\u9645\u8c03\u7528\n# \u8fd9\u91cc\u7684 run-parts \u53ef\u80fd\u662f busybox \u7684 run-parts, \u4e0d\u652f\u6301 -v, \u5efa\u8bae\u989d\u5916\u5b89\u88c5\n# run-parts --exit-on-error --verbose /etc/network/if-pre-up.d\n# ip addr add 192.168.8.182/255.255.252.0 broadcast 192.168.11.255    dev eth1 label eth1\nifup -v eth1\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"# \u4e00\u4e2a\u7f51\u5361, \u591a\u4e2a\u7f51\u5173\nauto eth0\niface eth0 inet static\n    address 10.1.248.11\n    netmask 255.255.255.0\n    up ip route add default via 10.1.248.1 dev eth0  metric 100\n    up ip route add default via 10.1.248.3 dev eth0  metric 200\n\n# \u4e00\u4e2a\u7f51\u5361, \u591a\u4e2a\u5730\u5740\nauto eth0\niface eth0 inet static\n  address aaa.aaa.aaa.aaa\n  netmask 255.255.254.0\n  gateway bbb.bbb.bbb.bbb\n  dns-nameservers ccc.ccc.ccc.ccc ddd.ddd.ddd.ddd eee.eee.eee.eee\n  dns-search vps-number.com\n  # \u6216\u8005\n  up ip addr add fff.fff.fff.fff/prefixlen dev eth0\n\nauto eth0:0\niface eth0:0 inet static\n  address fff.fff.fff.fff\n  netmask 255.255.254.0\n\n")),Object(i.b)("h2",{id:"network-benchmark"},"network benchmark"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"apk add iperf3 iptraf-ng iftop\n\niperf3 -s\niperf3 -c HOST\n")),Object(i.b)("h2",{id:"init"},"init"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"openrc"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"/etc/conf.d/localmount"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"\u53ef\u914d\u7f6e\u5f3a\u5236\u6302\u8f7d\u70b9")))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-conf"},"")),Object(i.b)("h2",{id:"iscsi"},"iscsi"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/open-iscsi"},"https://github.com/open-iscsi")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/open-iscsi/open-iscsi"},"https://github.com/open-iscsi/open-iscsi")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/open-iscsi/targetcli-fb"},"https://github.com/open-iscsi/targetcli-fb")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiki.archlinux.org/index.php/ISCSI_Target"},"https://wiki.archlinux.org/index.php/ISCSI_Target"))),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"http://scst.sourceforge.net/"},"http://scst.sourceforge.net/")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# An administration shell for storage targets\n# init: targetcli\n# bin: targetcli\n# apk add targetcli\n\n# ISCSI target for SCST - userspace tools\n# apk add iscsi-scst\n\n# High performance, transport independent, multi-platform iSCSI initiator\n# init: iscsid\n# bin: iscsi_discovery, iscsiadm, iscsi-iname\n# sbin: iscsid, iscsistart\n# conf:\n#   /etc/iscsi/initiatorname.iscsi\n#   /etc/iscsi/iscsid.conf\n#   /etc/iscsi/ifaces/iface\napk add open-iscsi\n\n")),Object(i.b)("h2",{id:"netatalk"},"netatalk"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"http://netatalk.sourceforge.net"},"netatalk")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Netatalk"},"Netatalk:wiki")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Apple_Filing_Protocol"},"APF")," - Apple Filing Protocol",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"CNID - Catalog Node ID"),Object(i.b)("li",{parentName:"ul"},"\u4f7f\u7528 ID \u5f15\u7528, \u800c\u975e\u8def\u5f84"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"http://netatalk.sourceforge.net/3.1/htmldocs/configuration.html"},"http://netatalk.sourceforge.net/3.1/htmldocs/configuration.html"))),Object(i.b)("h2",{id:"stress"},"stress"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"stress --vm-bytes $(awk '/MemFree/{printf \"%d\\n\", $2 * 0.9;}' < /proc/meminfo)k --vm-keep -m 1\nstress --vm-bytes $(awk '/MemFree/{printf \"%d\\n\", $2 * 0.097;}' < /proc/meminfo)k --vm-keep -m 10\n")),Object(i.b)("h2",{id:"disk"},"disk"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"badblocks"),Object(i.b)("li",{parentName:"ul"},"e2fsprogs-extra")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"apk add cdrkit\n# \u68c0\u6d4b iso \u662f\u5426\u53ef\u542f\u52a8\n# \u7ed3\u679c\u4e2d\u4f1a\u5305\u542b El Torito \u4fe1\u606f\n# https://en.wikipedia.org/wiki/El_Torito_(CD-ROM_standard)\nisoinfo -d -i is_it_bootable.iso\n\n# burn iso\npv spp-2016.10.0.iso | dd bs=4M of=/dev/sdd\n")),Object(i.b)("h2",{id:"qemu"},"QEMU"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://www.qemu.org/"},"QEMU"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://qemu.weilnetz.de/doc/qemu-doc.html"},"Doc"))))),Object(i.b)("p",null,'If you want to run VM as unprivileged user and let Qemu create tunX devices,\nthen you must add that user to the group "qemu".\nIf you use KVM for hardware-assisted virtualization, then you may also need\nto add that user to the group "kvm".'),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://wiki.archlinux.org/index.php/QEMU_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)"},"https://wiki.archlinux.org/index.php/QEMU_(\u7b80\u4f53\u4e2d\u6587)")),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://allyourco.de/running-vmware-esxi-under-qemu-kvm/"},"https://allyourco.de/running-vmware-esxi-under-qemu-kvm/")),Object(i.b)("h3",{id:"kvm"},"kvm"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiki.alpinelinux.org/wiki/KVM"},"https://wiki.alpinelinux.org/wiki/KVM"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u57fa\u7840\napk add qemu-system-x86_64 libvirt\n# 32 \u4f4d\napk add qemu-system-i386\n# \u5982\u679c\u9700\u8981 GUI \u7ba1\u7406\napk add libvirt-daemon dbus polkit\n# \u5982\u679c\u60f3\u7528\u5176\u4ed6\u78c1\u76d8\u683c\u5f0f\napk add qemu-img\n# \u542f\u7528\u5185\u6838\u6a21\u5757\nmodprobe kvm-intel\necho kvm-intel >> /etc/modules\n# \u5982\u679c\u662f AMD\n# modprobe kvm-amd\n\n# \u5f00\u673a\u542f\u7528\nrc-update add libvirtd\nrc-update add dbus\n\n# KVM \u9ed8\u8ba4\u4f1a\u6865\u63a5 NAT, \u5982\u679c\u60f3\u4f7f\u7528\u9ed8\u8ba4\u7684\u7f51\u7edc\u914d\u7f6e, \u9700\u8981\u52a0\u8f7d tun \u6a21\u5757\nmodprobe tun\n\n# \u6dfb\u52a0\u7528\u6237\u5230\u5206\u7ec4\naddgroup $USER kvm\naddgroup $USER qemu\naddgroup $USER libvirt\n")),Object(i.b)("h3",{id:"virtual-disk"},"virtual-disk"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://en.wikibooks.org/wiki/QEMU/Images"},"https://en.wikibooks.org/wiki/QEMU/Images")),Object(i.b)("li",{parentName:"ul"},"qemu-nbd",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"QEMU Disk Network Block Device Server")))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"modprobe nbd max_part=16\n# \u94fe\u63a5\nqemu-nbd -c /dev/nbd0 image.qcow2\npartprobe /dev/nbd0\n# \u6302\u8f7d\nmount /dev/nbd0p1 /mnt/image\n\numount /mnt/image\n\n# \u65ad\u5f00\u8fde\u63a5\nqemu-nbd -c /dev/nbd0\n\n")),Object(i.b)("h2",{id:"ftp"},"ftp"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Archlinux ",Object(i.b)("a",{parentName:"li",href:"https://wiki.archlinux.org/index.php/Very_Secure_FTP_Daemon"},"vsftpd")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"http://vsftpd.beasts.org/vsftpd_conf.html"},"vsftpd.conf")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://security.appspot.com/vsftpd.html"},"https://security.appspot.com/vsftpd.html"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'apk add vsftp\n# \u4fee\u6539\u914d\u7f6e\nnano /etc/vsftpd/vsftpd.conf\n# \u6700\u7b80\u914d\u7f6e, \u5141\u8bb8\u533f\u540d\u64cd\u4f5c\ncp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.old\necho "\nanonymous_enable=YES\nwrite_enable=YES\nanon_upload_enable=YES\nanon_mkdir_write_enable=YES\ndirmessage_enable=YES\nxferlog_enable=YES\nxferlog_file=/dev/stdout\nconnect_from_port_20=YES\nftpd_banner=Welcome to wener FTP service.\nlisten=YES\nbackground=NO\n" > /etc/vsftpd/vsftpd.conf\n\n')),Object(i.b)("h2",{id:"lvm"},"lvm"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"apk add lvm2\nmodprobe dm-mod\n\n# \u626b\u63cf\u903b\u8f91\u5206\u7ec4\nvgscan\n# \u6fc0\u6d3b\nvgchange -ay SangomaVG\nlvs\n# \u6302\u8f7d\nmount /dev/SangomaVG/root /mnt/data\n")),Object(i.b)("h2",{id:"libguestfs"},"libguestfs"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Libguestfs"},"https://en.wikipedia.org/wiki/Libguestfs")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://bugs.alpinelinux.org/issues/1792"},"https://bugs.alpinelinux.org/issues/1792")),Object(i.b)("li",{parentName:"ul"},"\u4f1a\u7f16\u8bd1\u5931\u8d25, \u56e0\u4e3a\u7528\u4e86 glibc \u7279\u6709\u7684 printf \u4fee\u9970\u7b26",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://www.redhat.com/archives/libguestfs/2016-August/msg00002.html"},"https://www.redhat.com/archives/libguestfs/2016-August/msg00002.html")),Object(i.b)("li",{parentName:"ul"},"No support for glibc-style extended printf formatters.")))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"guestfish: guest filesystem shell\nguestfish lets you edit virtual machine filesystems\nCopyright (C) 2009-2016 Red Hat Inc.\nUsage:\n  guestfish [--options] cmd [: cmd : cmd ...]\nOptions:\n  -h|--cmd-help        List available commands\n  -h|--cmd-help cmd    Display detailed help on 'cmd'\n  -a|--add image       Add image\n  -c|--connect uri     Specify libvirt URI for -d option\n  --csh                Make --listen csh-compatible\n  -d|--domain guest    Add disks from libvirt guest\n  --echo-keys          Don't turn off echo for passphrases\n  -f|--file file       Read commands from file\n  --format[=raw|..]    Force disk format for -a option\n  -i|--inspector       Automatically mount filesystems\n  --keys-from-stdin    Read passphrases from stdin\n  --listen             Listen for remote commands\n  --live               Connect to a live virtual machine\n  -m|--mount dev[:mnt[:opts[:fstype]]]\n                       Mount dev on mnt (if omitted, /)\n  --network            Enable network\n  -N|--new [filename=]type\n                       Create prepared disk (test<N>.img or filename)\n  -n|--no-sync         Don't autosync\n  --no-dest-paths      Don't tab-complete paths from guest fs\n  --pipe-error         Pipe commands can detect write errors\n  --progress-bars      Enable progress bars even when not interactive\n  --no-progress-bars   Disable progress bars\n  --remote[=pid]       Send commands to remote guestfish\n  -r|--ro              Mount read-only\n  --selinux            Enable SELinux support\n  -v|--verbose         Verbose messages\n  -V|--version         Display version and exit\n  -w|--rw              Mount read-write\n  -x                   Echo each command before executing it\n\nTo examine a disk image, ISO, hard disk, filesystem etc:\n  guestfish [--ro|--rw] -i -a /path/to/disk.img\nor\n  guestfish [--ro|--rw] -i -d name-of-libvirt-domain\n\n--ro recommended to avoid any writes to the disk image.  If -i option fails\nrun again without -i and use 'run' + 'list-filesystems' + 'mount' cmds.\n\nFor more information, see the manpage guestfish(1).\n")),Object(i.b)("h2",{id:"acf"},"acf"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiki.alpinelinux.org/wiki/Alpine_Configuration_Framework_Design"},"Alpine Configuration Framework Design")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiki.alpinelinux.org/wiki/ACF_packages"},"ACF packages")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://pkgs.alpinelinux.org/packages?name=acf-*&branch=v3.6&arch=x86_64"},"acf-*"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"")),Object(i.b)("h2",{id:"crond"},"crond"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u5b9e\u9645\u6267\u884c\u65f6\u4f7f\u7528\u7684 run-parts"),Object(i.b)("li",{parentName:"ul"},"busybox \u81ea\u5e26\u7684 run-parts \u529f\u80fd\u8f83\u5c11, \u53ef\u989d\u5916\u5b89\u88c5")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"echo 'CRON_OPTS=\"-c /etc/crontabs -L /var/log/crond.log -l 6\"' > /etc/conf.d/crond\nrc-update add crond\nrc-service crond restart\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"BusyBox v1.26.2 (2017-10-04 13:37:41 GMT) multi-call binary.\n\nUsage: run-parts [-a ARG]... [-u UMASK] [--reverse] [--test] [--exit-on-error] DIRECTORY\n\nRun a bunch of scripts in DIRECTORY\n\n    -a ARG      Pass ARG as argument to scripts\n    -u UMASK    Set UMASK before running scripts\n    --reverse   Reverse execution order\n    --test      Dry run\n    --exit-on-error Exit if a script exits with non-zero\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"Usage: run-parts [OPTION]... DIRECTORY\n      --test          print script names which would run, but don't run them.\n      --list          print names of all valid files (can not be used with\n                      --test)\n  -v, --verbose       print script names before running them.\n      --report        print script names if they produce output.\n      --reverse       reverse execution order of scripts.\n      --exit-on-error exit as soon as a script returns with a non-zero exit\n                      code.\n      --lsbsysinit    validate filenames based on LSB sysinit specs.\n      --new-session   run each script in a separate process session\n      --regex=PATTERN validate filenames based on POSIX ERE pattern PATTERN.\n  -u, --umask=UMASK   sets umask to UMASK (octal), default is 022.\n  -a, --arg=ARGUMENT  pass ARGUMENT to scripts, use once for each argument.\n  -V, --version       output version information and exit.\n  -h, --help          display this help and exit.\n")),Object(i.b)("h2",{id:"wireguard"},"wireguard"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"3.8 \u8fd8\u6ca1\u6709\uff0c\u9700\u8981\u4f7f\u7528 edge")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"qemu-img create -f raw edge-virt.raw 300M\nwget https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.8/releases/x86_64/alpine-virt-3.8.2-x86_64.iso\nqemu-system-x86_64 -m 2g -hda edge-virt.raw -net nic -net user,hostfwd=tcp::2222-:22 -cdrom alpine-virt-3.8.2-x86_64.iso -boot d\n\n# Setup VM\nsetup-interfaces\nrc-service networking restart\nsetup-sshd -c openssh\necho 'PermitRootLogin yes' >> /etc/ssh/sshd_config\necho root:root | chpasswd\nrc-service sshd restart\n\n# From Host\nssh-keygen -R [127.0.0.1]:2222\nssh root@127.0.0.1 -p 2222\n\necho \"http://mirrors.aliyun.com/alpine/edge/main\nhttp://mirrors.aliyun.com/alpine/edge/community\nhttp://mirrors.aliyun.com/alpine/edge/testing\" >> /etc/apk/repositories\napk update\n\nERASE_DISKS=/dev/sda setup-disk -m sys -s 0 /dev/sda\npoweroff\n")),Object(i.b)("h2",{id:"faq"},"FAQ"),Object(i.b)("h3",{id:"ip-ioctl-0x8913-failed-no-such-device"},"ip: ioctl 0x8913 failed: no such device"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u53ef\u80fd\u662f\u7f51\u5361\u540d\u5b57\u53d1\u751f\u4e86\u6539\u53d8")),Object(i.b)("h3",{id:"\u6062\u590d\u7f51\u5361\u540d\u5b57"},"\u6062\u590d\u7f51\u5361\u540d\u5b57"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u5b89\u88c5 udev \u540e\u53ef\u80fd\u4f1a\u51fa\u73b0, \u56e0\u4e3a udev \u53ef\u80fd\u4f1a\u8fdb\u884c\u91cd\u547d\u540d"),Object(i.b)("li",{parentName:"ul"},"\u6b64\u65f6 eth0 \u53ef\u80fd\u5c31\u4e0d\u5b58\u5728\u4e86, \u6b64\u65f6\u53ef\u80fd\u540d\u5b57\u4e3a enp0s3 \u8fd9\u6837\u7684"),Object(i.b)("li",{parentName:"ul"},"\u5728 udev \u4e2d\u6539\u53d8 if name \u7684\u4e3a\u72ec\u7acb\u5305, ",Object(i.b)("inlineCode",{parentName:"li"},"\teudev-netifnames"),", \u5c06\u8be5\u5305\u79fb\u9664\u5373\u53ef",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"/lib/udev/rules.d/80-net-name-slot.rules"))))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u7f51\u7edc\u8bbe\u5907\u540d\ncat /proc/net/dev\n\n# \u67e5\u770b\u7f51\u7edc\u63a7\u5236\u5668\nlspci | egrep -i --color 'network|ethernet'\n# \u67e5\u770b\u7f51\u7edc\u76f8\u5173\u786c\u4ef6\nlshw -class network\n\nifconfig -a\nip link show\nip a\n")),Object(i.b)("h3",{id:"\u6587\u4ef6\u7cfb\u7edf\u53d8\u6210\u4e86\u53ea\u8bfb"},"\u6587\u4ef6\u7cfb\u7edf\u53d8\u6210\u4e86\u53ea\u8bfb"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u770b\u770b ",Object(i.b)("inlineCode",{parentName:"li"},"/etc/fstab")," \u7684 UUID \u662f\u5426\u6709\u591a\u7684,\u9519\u8bef\u7684\u6216\u91cd\u590d\u7684"),Object(i.b)("li",{parentName:"ul"},"\u4f7f\u7528 df \u67e5\u770b\u5f53\u524d\u6302\u8f7d\u8bbe\u5907"),Object(i.b)("li",{parentName:"ul"},"blkid \u67e5\u770b\u8bbe\u5907 UUID"),Object(i.b)("li",{parentName:"ul"},"\u4ece\u65b0\u6302\u8f7d\u4e3a\u8bfb\u5199 ",Object(i.b)("inlineCode",{parentName:"li"},"mount -rw -o remount UUID=<\u6b63\u786e\u7684 UUID> /")),Object(i.b)("li",{parentName:"ul"},"\u4fee\u6539 ",Object(i.b)("inlineCode",{parentName:"li"},"/etc/fstab")),Object(i.b)("li",{parentName:"ul"},"\u91cd\u542f")),Object(i.b)("h3",{id:"find-sysmodulepcc_cpufreq"},"find: /sys/module/pcc_cpufreq"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u67e5\u770b linux/cpufreq")),Object(i.b)("h3",{id:"traps-rc-status3854-general-protection"},"traps: rc-status","[3854]"," general protection"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"rc-status sysinit")," \u65f6\u51fa\u73b0\u8be5\u5f02\u5e38"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/OpenRC/openrc/issues/168"},"OpenRC/openrc#168"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"[ 6921.149981] traps: rc-status[3854] general protection ip:7ca2e00baa1b sp:7ecdf01d7038 error:0\n[ 6921.149987]  in ld-musl-x86_64.so.1[7ca2e009d000+89000]\n[ 6921.150003] grsec: From 192.168.11.29: Segmentation fault occurred at            (nil) in /bin/rc-status[rc-status:3854] uid/euid:0/0 gid/egid:0/0, parent /bin/bash[bash:3570] uid/euid:0/0 gid/egid:0/0\n[ 6921.150020] grsec: From 192.168.11.29: denied resource overstep by requesting 4096 for RLIMIT_CORE against limit 0 for /bin/rc-status[rc-status:3854] uid/euid:0/0 gid/egid:0/0, parent /bin/bash[bash:3570] uid/euid:0/0 gid/egid:0/0\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u751f\u6210\u8f6c\u50a8\u7684\u5f02\u5e38\u4e3a denied resource overstep by requesting 4096 for RLIMIT_CORE against limit 0\n# \u67e5\u770b\u5f53\u524d\u7684 limit\nulimit -a\n# \u914d\u7f6e\u6587\u4ef6\ncat /etc/security/limits.conf\n# RLIMIT_CORE = 0 \u8bf4\u660e\u4e0d\u80fd\u521b\u5efa\u8f6c\u50a8\n# \u9488\u5bf9\u5f53\u524d\u4f1a\u8bdd\u8bbe\u7f6e, \u518d\u6b21\u8c03\u7528\u65f6\u4f1a\u751f\u6210 core \u6587\u4ef6\nulimit -c 4096\n")),Object(i.b)("p",null,"RLIMIT_AS //\u8fdb\u7a0b\u7684\u6700\u5927\u865a\u5185\u5b58\u7a7a\u95f4\uff0c\u5b57\u8282\u4e3a\u5355\u4f4d\u3002\nRLIMIT_CORE //\u5185\u6838\u8f6c\u5b58\u6587\u4ef6\u7684\u6700\u5927\u957f\u5ea6\u3002\nRLIMIT_CPU //\u6700\u5927\u5141\u8bb8\u7684CPU\u4f7f\u7528\u65f6\u95f4\uff0c\u79d2\u4e3a\u5355\u4f4d\u3002\u5f53\u8fdb\u7a0b\u8fbe\u5230\u8f6f\u9650\u5236\uff0c\u5185\u6838\u5c06\u7ed9\u5176\u53d1\u9001SIGXCPU\u4fe1\u53f7\uff0c\u8fd9\u4e00\u4fe1\u53f7\u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u7ec8\u6b62\u8fdb\u7a0b\u7684\u6267\u884c\u3002\u7136\u800c\uff0c\u53ef\u4ee5\u6355\u6349\u4fe1\u53f7\uff0c\u5904\u7406\u53e5\u67c4\u53ef\u5c06\u63a7\u5236\u8fd4\u56de\u7ed9\u4e3b\u7a0b\u5e8f\u3002\u5982\u679c\u8fdb\u7a0b\u7ee7\u7eed\u8017\u8d39CPU\u65f6\u95f4\uff0c\u6838\u5fc3\u4f1a\u4ee5\u6bcf\u79d2\u4e00\u6b21\u7684\u9891\u7387\u7ed9\u5176\u53d1\u9001SIGXCPU\u4fe1\u53f7\uff0c\u76f4\u5230\u8fbe\u5230\u786c\u9650\u5236\uff0c\u90a3\u65f6\u5c06\u7ed9\u8fdb\u7a0b\u53d1\u9001 SIGKILL\u4fe1\u53f7\u7ec8\u6b62\u5176\u6267\u884c\u3002\nRLIMIT_DATA //\u8fdb\u7a0b\u6570\u636e\u6bb5\u7684\u6700\u5927\u503c\u3002\nRLIMIT_FSIZE //\u8fdb\u7a0b\u53ef\u5efa\u7acb\u7684\u6587\u4ef6\u7684\u6700\u5927\u957f\u5ea6\u3002\u5982\u679c\u8fdb\u7a0b\u8bd5\u56fe\u8d85\u51fa\u8fd9\u4e00\u9650\u5236\u65f6\uff0c\u6838\u5fc3\u4f1a\u7ed9\u5176\u53d1\u9001SIGXFSZ\u4fe1\u53f7\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5c06\u7ec8\u6b62\u8fdb\u7a0b\u7684\u6267\u884c\u3002\nRLIMIT_LOCKS //\u8fdb\u7a0b\u53ef\u5efa\u7acb\u7684\u9501\u548c\u79df\u8d41\u7684\u6700\u5927\u503c\u3002\nRLIMIT_MEMLOCK //\u8fdb\u7a0b\u53ef\u9501\u5b9a\u5728\u5185\u5b58\u4e2d\u7684\u6700\u5927\u6570\u636e\u91cf\uff0c\u5b57\u8282\u4e3a\u5355\u4f4d\u3002\nRLIMIT_MSGQUEUE //\u8fdb\u7a0b\u53ef\u4e3aPOSIX\u6d88\u606f\u961f\u5217\u5206\u914d\u7684\u6700\u5927\u5b57\u8282\u6570\u3002\nRLIMIT_NICE //\u8fdb\u7a0b\u53ef\u901a\u8fc7setpriority() \u6216 nice()\u8c03\u7528\u8bbe\u7f6e\u7684\u6700\u5927\u5b8c\u7f8e\u503c\u3002\nRLIMIT_NOFILE //\u6307\u5b9a\u6bd4\u8fdb\u7a0b\u53ef\u6253\u5f00\u7684\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u8bcd\u5927\u4e00\u7684\u503c\uff0c\u8d85\u51fa\u6b64\u503c\uff0c\u5c06\u4f1a\u4ea7\u751fEMFILE\u9519\u8bef\u3002\nRLIMIT_NPROC //\u7528\u6237\u53ef\u62e5\u6709\u7684\u6700\u5927\u8fdb\u7a0b\u6570\u3002\nRLIMIT_RTPRIO //\u8fdb\u7a0b\u53ef\u901a\u8fc7sched_setscheduler \u548c sched_setparam\u8bbe\u7f6e\u7684\u6700\u5927\u5b9e\u65f6\u4f18\u5148\u7ea7\u3002\nRLIMIT_SIGPENDING //\u7528\u6237\u53ef\u62e5\u6709\u7684\u6700\u5927\u6302\u8d77\u4fe1\u53f7\u6570\u3002\nRLIMIT_STACK //\u6700\u5927\u7684\u8fdb\u7a0b\u5806\u6808\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002"),Object(i.b)("h3",{id:"ip-rtnetlink-answers-file-exists"},"ip: RTNETLINK answers: File exists"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"ip addr add \u65f6\u51fa\u73b0"),Object(i.b)("li",{parentName:"ul"},"usually indicates that a route already exists and you are trying to add it again."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"http://man7.org/linux/man-pages/man7/rtnetlink.7.html"},"rtnetlink.7"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Linux IPv4 routing socket"))),Object(i.b)("li",{parentName:"ul"},"\u7f51\u7edc\u542f\u505c\u65f6\u662f\u4f9d\u636e ",Object(i.b)("inlineCode",{parentName:"li"},"/var/run/ifstate")," \u4e2d\u7684 if \u72b6\u6001\u8fdb\u884c\u64cd\u4f5c"),Object(i.b)("li",{parentName:"ul"},"\u5982\u679c\u4e00\u5f00\u59cb\u505c\u6b62\u5931\u8d25, \u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u542f\u52a8\u662f\u4f1a, \u5bfc\u81f4\u5b9e\u9645\u7684 if \u72b6\u6001\u548c ifstate \u4e2d\u7684\u72b6\u6001\u4e0d\u4e00\u81f4"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://www.thomas-krenn.com/en/wiki/Two_Default_Gateways_on_One_System"},"Two Default Gateways on One System")),Object(i.b)("li",{parentName:"ul"},"inetfaces \u4e2d\u53ea\u80fd\u6307\u5b9a\u4e00\u6761 gateway",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"\u5982\u679c\u6307\u5b9a\u4e86\u591a\u6761\u4f1a\u51fa\u73b0\u8be5\u5f02\u5e38"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"http://lartc.org/"},"Linux Advanced Routing & Traffic Control"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u4f8b\u5982\nip addr add 192.168.8.182/255.255.252.0 broadcast 192.168.8.255 dev eth1 label eth1\n# \u6b64\u65f6\u53ef\u4ee5\u5c1d\u8bd5\nip addr flush dev eth1\n# \u67e5\u770b\u5b9e\u9645\u64cd\u4f5c\nstrace -e open ifup eth1\n# \u76f4\u63a5\u6dfb\u52a0 eth1=eth1\nnano /var/run/ifstate\n# \u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u64cd\u4f5c ifup \u548c ifdown \u4e86\n")),Object(i.b)("h3",{id:"grsec-time-set-by-sbinhwclockhwclock2863"},"grsec: time set by /sbin/hwclock","[hwclock:2863]"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"[   14.977686] grsec: time set by /sbin/hwclock[hwclock:2863] uid/euid:0/0 gid/egid:0/0, parent /lib/rc/sh/openrc-run.sh[openrc-run.sh:2838] uid/euid:0/0 gid/egid:0/0\n")),Object(i.b)("h3",{id:"node-docker-seg-fault"},"node docker seg fault"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/sass/node-sass/issues/2031"},"sass/node-sass#2031")," Segmentation fault on Node 8 alpine (docker)"),Object(i.b)("li",{parentName:"ul"},"\u662f\u7531\u4e8e\u7ebf\u7a0b\u6808\u592a\u5c0f\u4e86\u5bfc\u81f4"),Object(i.b)("li",{parentName:"ul"},"jubel-han \u7684 ",Object(i.b)("a",{parentName:"li",href:"https://github.com/jubel-han/dockerfiles/blob/master/node/Dockerfile"},"Dockerfile")," \u63d0\u4f9b\u4e86\u4e00\u4e2a LD_PRELOAD"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://stackoverflow.com/q/426230/1870054"},"What is the LD_PRELOAD trick?")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"http://wiki.musl-libc.org/wiki/Functional_differences_from_glibc#Thread_stack_size"},"http://wiki.musl-libc.org/wiki/Functional_differences_from_glibc#Thread_stack_size"))),Object(i.b)("h3",{id:"php-\u4e0b-iconv-\u6709\u95ee\u9898"},"PHP \u4e0b iconv \u6709\u95ee\u9898"),Object(i.b)("p",null,"Alpine \u4e0b PHP \u7684 iconv \u6709\u95ee\u9898 ",Object(i.b)("a",{parentName:"p",href:"https://github.com/docker-library/php/issues/428"},"https://github.com/docker-library/php/issues/428"),"\n",Object(i.b)("a",{parentName:"p",href:"https://github.com/docker-library/php/issues/240"},"https://github.com/docker-library/php/issues/240")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'apk add --no-cache gnu-libiconv --repository http://mirrors.aliyun.com/alpine/edge/testing\nLD_PRELOAD=/usr/lib/preloadable_libiconv.so php\n# \u6216\nexport LD_PRELOAD="/usr/lib/preloadable_libiconv.so php"\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-Dockerfile"},"RUN apk add gnu-libiconv --no-cache --repository mirrors.aliyun.com/alpine/edge/testing\nENV LD_PRELOAD /usr/lib/preloadable_libiconv.so php\n")),Object(i.b)("h3",{id:"rc-status-sysinit-\u5f02\u5e38"},"rc-status sysinit \u5f02\u5e38"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u53ef\u80fd\u662f\u7531\u4e8e zfs-zed \u5bfc\u81f4"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/OpenRC/openrc/issues/168#issuecomment-349870167"},"https://github.com/OpenRC/openrc/issues/168#issuecomment-349870167")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/zfsonlinux/zfs/issues/6930"},"https://github.com/zfsonlinux/zfs/issues/6930")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiki.debian.org/LSBInitScripts"},"https://wiki.debian.org/LSBInitScripts"))),Object(i.b)("h3",{id:"\u542f\u52a8\u5206\u533a\u4fee\u590d"},"\u542f\u52a8\u5206\u533a\u4fee\u590d"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"mbr \u574f\u4e86\u4f46\u5206\u533a\u662f\u597d\u7684")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"dd bs=440 conv=notrunc count=1 if=/usr/share/syslinux/mbr.bin of=/dev/sdc\n")),Object(i.b)("ol",{start:2},Object(i.b)("li",{parentName:"ol"},"\u542f\u52a8\u5206\u533a\u574f\u4e86")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u5206\u533a\u4fe1\u606f\nfile -s /dev/sdc1\n")),Object(i.b)("h3",{id:"tbd"},"TBD"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"[    0.013013] DMAR-IR: This system BIOS has enabled interrupt remapping\n               on a chipset that contains an erratum making that\n               feature unstable.  To maintain system stability\n               interrupt remapping is being disabled.  Please\n               contact your BIOS vendor for an update\n\n\n\n[ 7785.189928] perf: interrupt took too long (2658 > 2500), lowering kernel.perf_event_max_sample_rate to 75000\n")))}p.isMDXComponent=!0},914:function(e,n,t){"use strict";t.d(n,"a",(function(){return o})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var b=r.a.createContext({}),p=function(e){var n=r.a.useContext(b),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},o=function(e){var n=p(e.components);return r.a.createElement(b.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},u=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,b=c(e,["components","mdxType","originalType","parentName"]),o=p(t),u=a,m=o["".concat(s,".").concat(u)]||o[u]||d[u]||i;return t?r.a.createElement(m,l(l({ref:n},b),{},{components:t})):r.a.createElement(m,l({ref:n},b))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var b=2;b<i;b++)s[b]=t[b];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);