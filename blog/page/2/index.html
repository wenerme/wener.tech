<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1")</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1")</script>

<title data-react-helmet="true">Blog</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Blog"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" name="twitter:card" content="summary">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.cb15e1ce.css">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}function e(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}var n=window.matchMedia("(prefers-color-scheme: dark)");n.addListener((function(n){null===e()&&t(n.matches?"dark":"")}));var a=e();null!==a?t(a):n.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong>Wener</strong></a><a class="navbar__item navbar__link" href="/notes/java/java">笔记</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">故事</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a><a class="navbar__item navbar__link" href="/notes/tool/network/ip-lookup">工具</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/wenerme/wener">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_3gvz"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_2Zd- moon_Tgrt"></span></div><div class="react-toggle-track-x"><span class="toggle_2Zd- sun_38Cb"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong>Wener</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/java">笔记</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">故事</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/wenerme/wener">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/tool/network/ip-lookup">工具</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--xl"><div class="row"><div class="col col--8 col--offset-2"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/jraphql">Java with GraphQL</a></h2><div class="margin-bottom--sm"><time datetime="2018-05-21T00:00:00.000Z" class="blogPostDate_29VR">May 21, 2018</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="jraphql"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#jraphql" title="Direct link to heading">#</a>JraphQL</h1><p>Java with GraphQL</p><table><thead><tr><th>Module</th><th>Description</th></tr></thead><tbody><tr><td>jraphql-lang</td><td>GraphQL language representation</td></tr><tr><td>jraphql-runtime</td><td>GraphQL execution engine</td></tr><tr><td>jraphql-parser-antlr</td><td>Parser written in Antlr4 parse to jraphql-lang</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="get-started"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-started" title="Direct link to heading">#</a>Get Started</h2><ul><li>Maven <a href="https://search.maven.org/#search%7Cga%7C1%7Cg%3A%22me.wener.jraphql%22">me.wener.jraphql</a></li></ul><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-undefined codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;dependency&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;groupId&gt;me.wener.jraphql&lt;/groupId&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;artifactId&gt;jraphql-runtimer&lt;/artifactId&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;version&gt;0.0.6&lt;/version&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/dependency&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;dependency&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;groupId&gt;me.wener.jraphql&lt;/groupId&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;artifactId&gt;jraphql-parser-antlr&lt;/artifactId&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;version&gt;0.0.6&lt;/version&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/dependency&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="features"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#features" title="Direct link to heading">#</a>Features</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="language-representation"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#language-representation" title="Direct link to heading">#</a>Language representation</h3><table><thead><tr><th>Feature</th><th>Description</th></tr></thead><tbody><tr><td><strong>Serializable</strong></td><td>can parse or stringify to or from JSON</td></tr><tr><td><strong>Immutable</strong></td><td>friendly to cache or precompile</td></tr><tr><td><strong>Buildable</strong></td><td>every type has a builder for it generated by lombok.</td></tr><tr><td><strong>Pluggable</strong></td><td>language representation is not related to parser impl</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="syntax-extension"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#syntax-extension" title="Direct link to heading">#</a>Syntax Extension</h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="add-extend-by-name-syntax-for-object-and-interface"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#add-extend-by-name-syntax-for-object-and-interface" title="Direct link to heading">#</a>Add <code>extend by name</code> syntax for object and interface</h4><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="weave-multi-schemas"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#weave-multi-schemas" title="Direct link to heading">#</a>Weave multi schemas</h4><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-graphql codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># common.graphqls</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">scalar</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Version</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># crm.graphqls</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CrmQuery</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">customer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">ID</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">Customer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">crmVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Version</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CrmUser</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">customers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">Customer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extend </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Query</span><span class="token plain"> by CrmQuery</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extend </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">User</span><span class="token plain"> by CrmUser</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># erp.graphqls</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ErpQuery</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">product</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">ID</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">Product</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extend </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Query</span><span class="token plain"> by ErpQuery</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="conditional-schema"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conditional-schema" title="Direct link to heading">#</a>Conditional schema</h4><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-graphql codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Only admin can see and use these methods</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AdminMutation</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">changePassword</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token attr-name" style="color:rgb(255, 203, 107)">password</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ChangePasswordPayload</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extend </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Mutation</span><span class="token plain"> by AdminMutation </span><span class="token directive function" style="color:rgb(130, 170, 255)">@Role</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">role</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;admin&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="allowed-directives-on-directive-definition-add-directive-location"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#allowed-directives-on-directive-definition-add-directive-location" title="Direct link to heading">#</a>Allowed directives on directive definition, add DIRECTIVE location</h4><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-graphql codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">directive </span><span class="token directive function" style="color:rgb(130, 170, 255)">@JavaType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">DIRECTIVE</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">directive </span><span class="token directive function" style="color:rgb(130, 170, 255)">@Auth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token directive function" style="color:rgb(130, 170, 255)">@JavaType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Auth&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">FIELD_DEFINITION</span><span class="token plain">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="allowed-schema-has-optional-name"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#allowed-schema-has-optional-name" title="Direct link to heading">#</a>Allowed schema has optional name</h4><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-graphql codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> Test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">query</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> MyQuery</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="runtime-extension"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#runtime-extension" title="Direct link to heading">#</a>Runtime Extension</h3><ol><li>Type implements interface don&#x27;t need to write the fields again.</li></ol><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-graphql codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ID</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">User</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Node</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># id: ID! # This is optional</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><ol start="2"><li>Can disable introspection<ul><li><code>new MetaResolver().setDisableIntrospection(true)</code></li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="embeddable-schema"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#embeddable-schema" title="Direct link to heading">#</a>Embeddable Schema</h3><p>JraphQL Runtime contain a embedded schema <a href="./jraphql-runtime/src/main/java/me/wener/jraphql/schema/MetaSchema.java">MetaSchema</a>, generated by <a href="./jraphql-runtime/src/test/java/me/wener/jraphql/example/EmbededSchema.java">EmbededSchema</a>.   </p><ul><li>Parse Schema</li><li>Serialize to JSON</li><li>Best compress GZip</li><li>Encode use mime base64</li><li>Original JSON 32631 byte -&gt; Encoded Base64 5352 byte</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="example"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example" title="Direct link to heading">#</a>Example</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="starwar"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#starwar" title="Direct link to heading">#</a>StarWar</h3><ul><li><a href="./jraphql-runtime/src/test/java/me/wener/jraphql/example/StarWarApplication.java">StarWarApplication</a><ul><li>SpringBoot WebFlux based</li><li>start and visite http://localhost:8080</li></ul></li><li><a href="./jraphql-runtime/src/test/java/me/wener/jraphql/example/StarWarResolverV1.java">StarWarResolver</a><ul><li>resolve the StarWar schema. </li></ul></li></ul><p>Queries you can try</p><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-graphql codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">mutation</span><span class="token plain"> addRev </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  createReview</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">episode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">EMPIRE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token attr-name" style="color:rgb(255, 203, 107)">review</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token attr-name" style="color:rgb(255, 203, 107)">stars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token attr-name" style="color:rgb(255, 203, 107)">commentary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Ok Good&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    stars</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    commentary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">query</span><span class="token plain"> rev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">Episode </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">EMPIRE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  hero</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">episode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    appearsIn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  reviews</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">episode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    stars</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    commentary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">query</span><span class="token plain"> search </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;o&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    __typename</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Human</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Droid</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      primaryFunction</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Starship</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      length</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">query</span><span class="token plain"> baseQuery </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  starship</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;3000&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">unit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">FOOT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  character</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2000&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Human</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      mass</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      starships </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Droid</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      appearsIn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  human</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1003&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    friendsConnection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">after</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1002&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      friends </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      pageInfo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        hasNextPage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        startCursor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        endCursor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    friends </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="work-with-goaphql"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#work-with-goaphql" title="Direct link to heading">#</a>Work with GoaphQL</h2><p><a href="https://github.com/wenerme/goaphql">GoaphQL</a> can generate code from schema that depends on jrapgql-api, can directly run on jraphql-graphql-java-adapter.  </p><p>The generated code is static type and full featured, everything is an interface.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/项目">项目</a><a class="margin-horiz--sm" href="/blog/tags/java">Java</a><a class="margin-horiz--sm" href="/blog/tags/graph-ql">GraphQL</a></div><div class="col text--right"><a aria-label="Read more about Java with GraphQL" href="/blog/jraphql"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/ubuntu-home">Ubuntu 家用</a></h2><div class="margin-bottom--sm"><time datetime="2017-02-09T00:00:00.000Z" class="blogPostDate_29VR">February 9, 2017</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="ubuntu-家用"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ubuntu-家用" title="Direct link to heading">#</a>Ubuntu 家用</h1><ul><li>Ubuntu 桌面版</li><li>安装至少需要 1024*768 的显示器</li></ul><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-bash codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> upgrade</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> dist-upgrade</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 桌面版没有 sshd</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y openssh-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># brew</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">brew </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> gcc redis tmux mosh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 容器服务配置</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">############</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 使用阿里提供的仓库进行安装会非常快</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sh</span><span class="token plain"> -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 安装完毕后为当前用户添加权限,需要退出重新登录才能生效</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">usermod</span><span class="token plain"> -aG docker </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$USER</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 安装完成建议选择一家容器镜像,比如 https://cr.console.aliyun.com 或者 daocloud</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull gogs/gogs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker network create --subnet</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.0/24 home-net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 准备数据目录</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chown</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$USER</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token environment constant" style="color:rgb(130, 170, 255)">$USER</span><span class="token plain"> /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ==========</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 监控配置</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ==========</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull grafana/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull prom/container-exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull prom/prometheus</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.10 -d --restart always -v /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/grafana:/var/lib/grafana </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/grafana.ini:/etc/grafana/grafana.ini </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name grafana grafana/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">nohup</span><span class="token plain"> node_exporter </span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">2</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">node_exporter.log </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.21 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v /sys/fs/cgroup:/cgroup </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name container-exporter prom/container-exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.20 -d --restart always -v /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/prom:/prometheus </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/prom.yaml:/etc/prometheus/prometheus.yml </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name prom prom/prometheus</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Web 服务</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 选择需要的 Caddy 插件用于构建容器</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> -p /tmp/caddy </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /tmp/caddy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;https://caddyserver.com/download/build?os=linux&amp;arch=amd64&amp;features=cors%2Cexpires%2Cfilemanager%2Cgit%2Chugo%2Cipfilter%2Cjsonp%2Cjwt%2Clocale%2Cmailout%2Cminify%2Cmultipass%2Cprometheus%2Cratelimit%2Crealip%2Csearch%2Cupload&#x27;</span><span class="token plain"> -O caddy.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> -zxvf caddy.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker build -t home/caddy -f caddy.Dockerfile </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --net home-net --ip </span><span class="token number" style="color:rgb(247, 140, 108)">172.18</span><span class="token plain">.1.30  -d --restart always -v /etc/localtime:/etc/localtime:ro </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/Caddyfile:/etc/Caddyfile </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/caddy:/data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$HOME</span><span class="token plain">/.caddy:/root/.caddy </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -p </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain">:80 -p </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain">:443 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name web home/caddy</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="caddydockerfile"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#caddydockerfile" title="Direct link to heading">#</a>caddy.Dockerfile</h3><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-Dockerfile codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FROM alpine</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MAINTAINER wener &lt;wener@wener.me&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">COPY caddy /app/caddy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">VOLUME     [ &quot;/data&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WORKDIR    /data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXPOSE 2015</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXPOSE 2000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENTRYPOINT [&quot;/app/caddy&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CMD [&quot;-conf&quot;,&quot;/etc/Caddyfile&quot;,&quot;-log&quot;,&quot;./internal/log&quot;]</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="grafanaini"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#grafanaini" title="Direct link to heading">#</a>grafana.ini</h3><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-ini codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">##################### Grafana Configuration Example #####################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Everything has defaults so you only need to uncomment things you want to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># possible values : production, development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; app_mode = production</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># instance name, defaults to HOSTNAME environment variable value or hostname if HOSTNAME var is empty</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; instance_name = ${HOSTNAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Paths ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[paths]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;data = /var/lib/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Directory where grafana can store logs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;logs = /var/log/grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Directory where grafana will automatically scan and look for plugins</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;plugins = /var/lib/grafana/plugins</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Server ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[server]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Protocol (http or https)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;protocol = http</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The ip address to bind to, empty will bind to all interfaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;http_addr =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The http port  to use</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;http_port = 3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The public facing domain name used to access grafana from a browser</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">domain = d.yikaiye.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Redirect to correct domain if host header does not match domain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Prevents DNS rebinding attacks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enforce_domain = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 使用 /monitor 作为路径,以便于反向代理</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;root_url = %(protocol)s://%(domain)s:%(http_port)s/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">root_url = /monitor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Log web requests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;router_logging = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the path relative working path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;static_root_path = public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># enable gzip</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enable_gzip = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https certs &amp; key file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cert_file =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cert_key =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Database ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[database]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;mysql&quot;, &quot;postgres&quot; or &quot;sqlite3&quot;, it&#x27;s your choice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;type = sqlite3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;host = 127.0.0.1:3306</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;name = grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;user = root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;password =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;postgres&quot; only, either &quot;disable&quot;, &quot;require&quot; or &quot;verify-full&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;ssl_mode = disable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;sqlite3&quot; only, path relative to data_path setting</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;path = grafana.db</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Session ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[session]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;memory&quot;, &quot;file&quot;, &quot;redis&quot;, &quot;mysql&quot;, &quot;postgres&quot;, default is &quot;file&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;provider = file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Provider config options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># memory: not have any config yet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># file: session dir path, is relative to grafana data_path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis: config like redis server e.g. `addr=127.0.0.1:6379,pool_size=100,db=grafana`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># mysql: go-sql-driver/mysql dsn config string, e.g. `user:password@tcp(127.0.0.1:3306)/database_name`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgres: user=a password=b host=localhost port=5432 dbname=c sslmode=disable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;provider_config = sessions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Session cookie name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_name = grafana_sess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># If you use session in https only, default is false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_secure = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Session life time, default is 86400</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;session_life_time = 86400</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Analytics ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[analytics]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Server reporting, sends usage counters to stats.grafana.org every 24 hours.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># No ip addresses are being tracked, only simple counters to track</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># running instances, dashboard and error counts. It is very helpful to us.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Change this option to false to disable reporting.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;reporting_enabled = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Set to false to disable all checks to https://grafana.net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># for new vesions (grafana itself and plugins), check is used</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># in some UI views to notify that grafana or plugin update exists</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This option does not cause any auto updates, nor send any information</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># only a GET request to http://grafana.net to get latest versions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">check_for_updates = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Google Analytics universal tracking code, only enabled if you specify an id here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;google_analytics_ua_id =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Security ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[security]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># default admin user, created on startup</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;admin_user = admin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># default admin password, can be changed before first start of grafana,  or in profile settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;admin_password = admin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># used for signing</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;secret_key = SW2YcwTIb9zpOOhoPsMm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Auto-login remember days</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;login_remember_days = 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_username = grafana_user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cookie_remember_name = grafana_remember</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># disable gravatar profile images</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;disable_gravatar = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># data source proxy whitelist (ip_or_domain:port separated by spaces)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;data_source_proxy_whitelist =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[snapshots]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># snapshot sharing options</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">external_enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;external_snapshot_url = https://snapshots-origin.raintank.io</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;external_snapshot_name = Publish to snapshot.raintank.io</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Users ####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[users]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 禁用注册功能</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">allow_sign_up = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 不允许非管理员创建组织</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">allow_org_create = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Set to true to automatically assign new users to the default organization (id 1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auto_assign_org = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Default role new users will be automatically assigned (if disabled above is set to true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auto_assign_org_role = Viewer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Background text for the user field on the login page</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">login_hint = 用户名</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Default UI theme (&quot;dark&quot; or &quot;light&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">default_theme = light</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Anonymous Auth ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[auth.anonymous]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># enable anonymous access</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># specify organization name that should be used for unauthenticated users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;org_name = Main Org.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># specify role for unauthenticated users</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;org_role = Viewer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Auth Proxy ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[auth.proxy]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;header_name = X-WEBAUTH-USER</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;header_property = username</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;auto_sign_up = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Basic Auth ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[auth.basic]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### SMTP / Emailing ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[smtp]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;host = localhost:25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;user =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;password =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;cert_file =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;key_file =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;skip_verify = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;from_address = admin@grafana.localhost</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[emails]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;welcome_email_on_sign_up = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Logging ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;console&quot;, &quot;file&quot;, &quot;syslog&quot;. Default is console and  file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Use space to separate multiple modes, e.g. &quot;console file&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;mode = console, file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Either &quot;trace&quot;, &quot;debug&quot;, &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;, &quot;critical&quot;, default is &quot;info&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level = info</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;console&quot; mode only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log.console]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># log line format, valid options are text, console and json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;format = console</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># For &quot;file&quot; mode only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log.file]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># log line format, valid options are text, console and json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;format = text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This enables automated log rotate(switch of following options), default is true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;log_rotate = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Max line number of single file, default is 1000000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;max_lines = 1000000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Max size shift of single file, default is 28 means 1 &lt;&lt; 28, 256MB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;max_size_shift = 28</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Segment log daily, default is true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;daily_rotate = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Expired days of log file(delete after max days), default is 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;max_days = 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[log.syslog]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;level =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># log line format, valid options are text, console and json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;format = text</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Syslog network type and address. This can be udp, tcp, or unix. If left blank, the default unix endpoints will be used.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;network =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;address =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Syslog facility. user, daemon and local0 through local7 are valid.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;facility =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Syslog tag. By default, the process&#x27; argv[0] is used.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;tag =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### AMQP Event Publisher ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[event_publisher]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;rabbitmq_url = amqp://localhost/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;exchange = grafana_events</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;#################################### Dashboard JSON files ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[dashboards.json]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;path = /var/lib/grafana/dashboards</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Internal Grafana Metrics ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics available at HTTP API Url /api/metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Disable / Enable internal metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;enabled           = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Publish interval</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">;interval_seconds  = 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Send internal metrics to Graphite</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; [metrics.graphite]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; address = localhost:2003</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">; prefix = prod.grafana.%(instance_name)s.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#################################### Internal Grafana Metrics ##########################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Url used to to import dashboards directly from Grafana.net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[grafana_net]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">url = https://grafana.net</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="promyaml"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#promyaml" title="Direct link to heading">#</a>prom.yaml</h3><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-yaml codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">     5s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Attach these labels to any time series or alerts when communicating with</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># external systems (federation, remote storage, Alertmanager).</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">external_labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">monitor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;dev-monitor&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">rule_files</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> mysql.rules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># A scrape configuration containing exactly one endpoint to scrape:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Here it&#x27;s Prometheus itself.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">scrape_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;prometheus&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Override the global default and scrape targets from this job every 5 seconds.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 5s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9090&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> container_exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;172.18.1.21:9104&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> node_exporter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;172.18.1.1:9100&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> caddy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;172.18.1.30:2000&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="caddyfile"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#caddyfile" title="Direct link to heading">#</a>Caddyfile</h3><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-undefined codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">:80 {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  log internal/access.log {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      rotate {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          size 50</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          age  14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          keep 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  prometheus :2000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  root .</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  internal ./internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  filemanager /file {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    show file/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  proxy /monitor 172.18.1.10:3000 {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    without /monitor</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    transparent</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-undefined codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo vim /etc/udev/rules.d/75-persistent-net-generator.rules</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, ATTR{address}==&quot;f0:42:1c:85:07:41&quot;, NAME=&quot;eth0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sudo vim /etc/network/interfaces</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre></section><footer class="row margin-vert--lg"><div class="col text--right"><a aria-label="Read more about Ubuntu 家用" href="/blog/ubuntu-home"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/attack-on-programmer">进击的程序猿</a></h2><div class="margin-bottom--sm"><time datetime="2017-01-19T00:00:00.000Z" class="blogPostDate_29VR">January 19, 2017</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="进击的程序猿"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#进击的程序猿" title="Direct link to heading">#</a>进击的程序猿</h1><p>2016 年会节目</p><ul><li><a href="https://github.com/wenerme/wener/tree/master/story/2017/am2016/%E8%BF%9B%E5%87%BB%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%8C%BF.fountain">脚本</a>/<a href="https://github.com/wenerme/wener/tree/master/story/2017/am2016/%E8%BF%9B%E5%87%BB%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%8C%BF.pdf">PDF</a></li><li>舞台前端/舞台后端</li></ul></section><footer class="row margin-vert--lg"><div class="col text--right"><a aria-label="Read more about 进击的程序猿" href="/blog/attack-on-programmer"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/ubuntu-new-server">Ubuntu 新服务器配置</a></h2><div class="margin-bottom--sm"><time datetime="2016-09-28T00:00:00.000Z" class="blogPostDate_29VR">September 28, 2016</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="ubuntu-新服务器配置"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ubuntu-新服务器配置" title="Direct link to heading">#</a>Ubuntu 新服务器配置</h1><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-bash codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 修改主机名</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostnamectl set-hostname myHostName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 如果想要直接使用主机名,还需要在 /etc/hosts 里添加相关记录</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># nano /etc/hostname</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># nano /etc/hosts</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 生成中文</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">locale-gen zh_CN.UTF-8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 基本更新</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> upgrade</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 出现 The following packages have been kept back 可考虑 apt dist-upgrade 或 install</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 当 /etc/apt/sources.list* 有其他仓库时使用 dist-upgrade 相对没那么安全</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 修改密码</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">passwd</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 创建用于部署的用户</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">useradd</span><span class="token plain"> deploy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> /home/deploy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> /home/deploy/.ssh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">chmod</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">700</span><span class="token plain"> /home/deploy/.ssh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 将需要使用该用户的公钥添加进去</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">vim</span><span class="token plain"> /home/deploy/.ssh/authorized_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">chmod</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">400</span><span class="token plain"> /home/deploy/.ssh/authorized_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">chown</span><span class="token plain"> deploy:deploy /home/deploy -R</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 编辑 sudoers</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">visudo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 将需要 sudo 的用户添加进去</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># deploy  ALL=(ALL) ALL</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 修改 sshd 权限</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">vim</span><span class="token plain"> /etc/ssh/sshd_config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># PermitRootLogin no # 不允许直接 root 登陆</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># PasswordAuthentication no # 不允许密码登陆</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># AllowUsers deploy@(your-ip) deploy@(another-ip-if-any) # 只允许指定地址的人登陆</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># service ssh restart</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 防火墙设置</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># DNS 53</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># mosh allow 60000:61000/udp 或 allow mosh</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ufw allow </span><span class="token number" style="color:rgb(247, 140, 108)">22</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ufw allow </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ufw allow </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ufw default deny</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ufw </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">enable</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><ul><li><a href="https://news.ycombinator.com/item?id=5316093">How I spend my first 5 minutes on a server </a></li><li><a href="https://www.upguard.com/blog/10-essential-steps-for-configuring-a-new-server">10 Essential Steps for Configuring a New Server</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="tips"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#tips" title="Direct link to heading">#</a>Tips</h2><p>当有多台主机需要部署的时候,建议使用 sshrc, tmuxrc, 这样能快速的将所有的配置都带给服务器,能够快速方便的对多台进行安装部署.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="mosh-dev"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#mosh-dev" title="Direct link to heading">#</a>mosh-dev</h3><p>由于 mosh 部分鼠标相关的功能需要最新版,所以建议直接安装 dev 版本</p><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-bash codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y software-properties-common</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">add-apt-repository ppa:keithw/mosh-dev</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y mosh</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="fail2ban"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#fail2ban" title="Direct link to heading">#</a>fail2ban</h2><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-bash codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> fail2ban</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># bantime = 3600 # ban 1 小时</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># destemail = admin@admin # 发送警告的邮箱地址</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 将 ssh/ssh-ddos 等段落下的 enable 设置为 true 打开相应的 filter</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="env"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#env" title="Direct link to heading">#</a>env</h2><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-bash codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> software-properties-common</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 添加 Oracle Java 仓库</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">add-apt-repository ppa:webupd8team/java</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 安装 Oracle Java 8 JDK</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> oracle-java8-installer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 如果有多个 Java 环境可调整配置</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">update-alternatives --config java</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="ipv6"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ipv6" title="Direct link to heading">#</a>ipv6</h2><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-bash codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># https://jiandanxinli.github.io/2016-08-06.html</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/sysctl.conf</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># net.ipv6.conf.all.disable_ipv6=0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># net.ipv6.conf.default.disable_ipv6=0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># net.ipv6.conf.lo.disable_ipv6=0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sysctl -p</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># https://www.tunnelbroker.net/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 选择 linux route2, 然后执行脚本</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 检测 ipv6 是否可用</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># http://ready.chair6.net/?url=wener.me</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 如果操作失败了则删除通道从来</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">ip</span><span class="token plain"> tun del he-ipv6</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre></section><footer class="row margin-vert--lg"><div class="col text--right"><a aria-label="Read more about Ubuntu 新服务器配置" href="/blog/ubuntu-new-server"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/learning-dist-arch">分布式架构手记</a></h2><div class="margin-bottom--sm"><time datetime="2016-08-25T15:33:00.000Z" class="blogPostDate_29VR">August 25, 2016</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><p>这几天尝试了很多的 *aaS, 期望能找到在当前架构下适合公司后续发展的一个系统架构, 然而一路下来发现并没那么简单.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/架构">架构</a></div><div class="col text--right"><a aria-label="Read more about 分布式架构手记" href="/blog/learning-dist-arch"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/go-rm">Go Redis module</a></h2><div class="margin-bottom--sm"><time datetime="2016-08-09T00:00:00.000Z" class="blogPostDate_29VR">August 9, 2016</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><p>Writing Redis Module in Golang.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/项目">项目</a><a class="margin-horiz--sm" href="/blog/tags/golang">Golang</a><a class="margin-horiz--sm" href="/blog/tags/redis">Redis</a></div><div class="col text--right"><a aria-label="Read more about Go Redis module" href="/blog/go-rm"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/bbvm">BBVM - BeBasic Virtual Machine</a></h2><div class="margin-bottom--sm"><time datetime="2015-10-30T00:00:00.000Z" class="blogPostDate_29VR">October 30, 2015</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><p>The first VM in my live.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/项目">项目</a><a class="margin-horiz--sm" href="/blog/tags/golang">Golang</a><a class="margin-horiz--sm" href="/blog/tags/java">Java</a><a class="margin-horiz--sm" href="/blog/tags/游戏">游戏</a><a class="margin-horiz--sm" href="/blog/tags/虚拟机">虚拟机</a></div><div class="col text--right"><a aria-label="Read more about BBVM - BeBasic Virtual Machine" href="/blog/bbvm"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/guava-intro">Guava 简介</a></h2><div class="margin-bottom--sm"><time datetime="2015-10-02T00:00:00.000Z" class="blogPostDate_29VR">October 2, 2015</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="overviews---five-ws"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#overviews---five-ws" title="Direct link to heading">#</a>Overviews - Five Ws</h2><table><thead><tr><th>问题</th><th>答案</th></tr></thead><tbody><tr><td>是什么</td><td>一套开源的 Java 公共组件</td></tr><tr><td>谁开发的</td><td>主要由 Google 工程师开发维护</td></tr><tr><td>哪里用</td><td>所有使用 Java 的地方</td></tr><tr><td>什么时候出现的</td><td>2008年九月 第一个Google Collection版本出现在 <a href="http://mvnrepository.com/artifact/com.google.collections/google-collections">maven 仓库</a>;<br>2010年四月第一个Guava版本出现在<a href="http://mvnrepository.com/artifact/com.google.guava/guava">maven 仓库</a></td></tr><tr><td>什么使用</td><td>为什么不使用 ?</td></tr></tbody></table></section><footer class="row margin-vert--lg"><div class="col text--right"><a aria-label="Read more about Guava 简介" href="/blog/guava-intro"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/ketama-consistence-hash">一致性Hash算法</a></h2><div class="margin-bottom--sm"><time datetime="2014-11-12T00:00:00.000Z" class="blogPostDate_29VR">November 12, 2014</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="ketama"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ketama" title="Direct link to heading">#</a>ketama</h1><p>该算法最开始是开发来替代<code>memcached</code>键到服务器的映射算法的.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/算法">算法</a></div><div class="col text--right"><a aria-label="Read more about 一致性Hash算法" href="/blog/ketama-consistence-hash"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2bK6"><a href="/blog/mom-intro">消息中间件简介 mom-intro</a></h2><div class="margin-bottom--sm"><time datetime="2014-09-06T00:00:00.000Z" class="blogPostDate_29VR">September 6, 2014</time></div><div class="avatar margin-bottom--md"><div class="avatar__intro"></div></div></header><section class="markdown"><ol><li><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="异步-vs-同步"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#异步-vs-同步" title="Direct link to heading">#</a>异步 VS 同步</h1></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="同步"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#同步" title="Direct link to heading">#</a>同步</h2><p>分布式对象技术(Distributed Object Technologies - DOT), 远程过程调用RPC:  同步操作 (调用被阻塞,直到被调用者返回).</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/中间件">中间件</a></div><div class="col text--right"><a aria-label="Read more about 消息中间件简介 mom-intro" href="/blog/mom-intro"><strong>Read More</strong></a></div></footer></article><nav class="pagination-nav"><div class="pagination-nav__item"><a aria-current="page" class="pagination-nav__link active" href="/blog"><h4 class="pagination-nav__link--label">« Newer Entries</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/page/3"><h4 class="pagination-nav__link--label">Older Entries »</h4></a></div></nav></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">笔记</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/notes/java/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/ops/os/alpine/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes/k8s-intro">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip/voip-intro">VoIP</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Projects</h4><ul class="footer__items"><div>
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              - <a class="footer__link-item" href="https://travis-ci.com/wenerme/wener" title="wenerme/wener - travis-ci">
                <img style="vertical-align: middle;opacity: .4;" src="https://travis-ci.com/wenerme/wener.svg?branch=master">
                </a>
              - <a class="footer__link-item" href="https://github.com/wenerme/wenerme.github.io/deployments" title="GitHub Pages 部署">部署状态</a>
              </div>
              </div><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://apis.wener.me">Wener&#x27;s Apis</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a aria-current="page" class="footer__link-item active" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/wenerme" href="https://github.com/wenerme">GitHub</a></li><li class="footer__item"><a class="footer__link-item" to="https://twitter.com/wenerme" href="https://twitter.com/wenerme">Twitter</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Wener Site" src="/img/wener-logo.svg"></div>Copyright © 1992-2020 Wener - 构建时间 2020-10-10 21:30</div></div></footer>
</div>

<script src="/styles.3bfef576.js"></script>

<script src="/runtime~main.21bc78aa.js"></script>

<script src="/main.995ead94.js"></script>

<script src="/1.ea46efd4.js"></script>

<script src="/2.9c5675ff.js"></script>

<script src="/a6aa9e1f.9f87e2ac.js"></script>

<script src="/3786319b.e80acbbe.js"></script>

<script src="/d470cb24.f7337461.js"></script>

<script src="/176a729b.a08a8f34.js"></script>

<script src="/b91569ca.67862355.js"></script>

<script src="/57528ad1.dd28a9fc.js"></script>

<script src="/b785759a.8f4a7e56.js"></script>

<script src="/6bc48d31.f2931939.js"></script>

<script src="/46c0c62b.82d0101d.js"></script>

<script src="/07b3ecf8.7af2b0e9.js"></script>

<script src="/fbf55505.0a0e8048.js"></script>

<script src="/30684255.e0c5838a.js"></script>


</body>
</html>