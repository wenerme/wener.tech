<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1")</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1")</script>

<title data-react-helmet="true">GitLab配置</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Wener Live &amp; Life · Passion I&#x27;ve found"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="# Gitlab 配置"><meta data-react-helmet="true" property="og:description" content="# Gitlab 配置"><meta data-react-helmet="true" property="og:url" content="https://wener.me/notes/ops/service/gitlab-config">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.cb15e1ce.css">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}function e(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}var n=window.matchMedia("(prefers-color-scheme: dark)");n.addListener((function(n){null===e()&&t(n.matches?"dark":"")}));var a=e();null!==a?t(a):n.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong>Wener</strong></a><a class="navbar__item navbar__link" href="/notes/java/java">笔记</a><a class="navbar__item navbar__link" href="/blog">故事</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a><a class="navbar__item navbar__link" href="/notes/tool/network/ip-lookup">工具</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/wenerme/wener">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_3gvz"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_2Zd- moon_Tgrt"></span></div><div class="react-toggle-track-x"><span class="toggle_2Zd- sun_38Cb"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong>Wener</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/java">笔记</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">故事</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/wenerme/wener">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/tool/network/ip-lookup">工具</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_NanV"><div class="docSidebarContainer_1igf"><div class="sidebar_291D"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2ovr" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Java</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/java">Java</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/maven">Maven</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">版本</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/version/version">Java版本</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/version/java-11">Java 11</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/version/java-10">Java 10</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/version/java-9">Java 9</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/version/java-8">Java 8</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/version/java-7">Java 7</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/version/java-6">Java 6</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Spring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/spring">Spring</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/boot">Spring Boot</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/data">Spring Data</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/data-rest">Spring Data REST</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/security">Spring Security</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/security-oauth2">Spring Security OAuth2</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/cloud">Spring Cloud</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/spring/releases">发布历史</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/library/productive">生产力</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/library/hazelcast">Hazelcast</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/library/hibernate-orm">Hibernate</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/library/hibernate-enver">Hibernate Enver</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/library/quarkus">Quarkus</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/java/library/guava">Guava</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">前端技术</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">框架</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/nextjs">NextJS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/nextjs-version">NextJS 版本历史</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/nextjs-cookbook">NextJS Cookbook</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/electron">Electron</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/vue">Vue</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/angular">Angular</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/riot">Riot</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/web/framework/prisma">Prisma</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">语言</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/languages/languages">语言</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/parsing">语法解析</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/peg">PEG</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/pegjs">PEG.js</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/php">PHP</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/zig">Zig</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/go/go-intro">Golang</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/go/go-template">Go 模板</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/go/go-pkg-net-rpc">Go net/rpc</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/go/go-kit">go-kit</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/lua/lua">Lua</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/languages/lua/lua-version">Lua 版本</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">开发运维</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/tracing/tracing">Tracing</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">指标监控</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/metrics">指标监控</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/prometheus">Prometheus</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/promql">PromQL</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/prometheus-exporter">Prometheus Exporter</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/statsd_exporter">statsd_exporter</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/prometheus-k8s">Prometheus K8S</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/prometheus-storage">Prometheus 存储</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/grafana">Grafana</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/thanos">Thanos</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/metrics/cortex">Cortex</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">服务</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/microservices">Microservices</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/servicemesh">Service Mesh</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/linkerd">Linkerd</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/kuma">Kuma</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/consul">Consul</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/consul-conf">Consul 配置</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/consul-connect">Consule Connect Mesh</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/service/fabio">fabio</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Web</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/web/nginx">Nginx</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/web/caddy">Caddy</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/web/traefik">Traefik</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">平台服务</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/xaas/db-schema">Tenant DB Schema</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/xaas/paas/dokku">Dokku</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">AlpineLinux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine">Alpine</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine-intro">Alpine 入门</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine-ops">Alpine 运维笔记</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine-pkgs">Alpine 包维护</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine-lbu">Alpine local backup</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine-boot">Alpin Boot</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine-version">版本历史</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/alpine/alpine-faq">Alpine FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Docker</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/docker/docker-intro">Docker</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/docker/docker-network">Docker 网络</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/docker/docker-storage">Docker 存储</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/docker/docker-swarm">Docker Swarm</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/docker/docker-cookbook">Docker 常用服务</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Kubernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/k8s-intro">Kubernates</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/k8s-dashboard">Kubernates 面板</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/k3s">K3S</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/k3d">K3S in Docker</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/k8s-glossary">K8S 词汇表</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/helm-intro">HELM 包管理器</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/helm2">HELM2 - 不推荐</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/rancher-intro">Rancher UI</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/rancher-rke">RKE - 安装器</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/tool/kustomize">kustomize</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/tool/krew">krew</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">网络</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/network/k8s-network">Kubernates 网络</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/network/kong-ingress">Kong Ingress</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/network/nginx-ingress">Nginx Ingress</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/network/traefik-ingress">Traefik Ingress</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/network/metallb">MetalLB</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/network/flannel">Flannel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">存储</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/storage/k8s-storage">Kubernates 存储</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/storage/longhorn">Longhorn</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/storage/k8s-nfs">NFS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/storage/rook">Rook</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">平台</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/platform/knative-intro">Knative</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/platform/istio-intro">Istio 服务网格</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">应用</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/app/cert-manager">Cert Manager</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/app/k8s-consul">Consol</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/devops/kubernetes/app/harbor">Harbor</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">指南</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">运维</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/howto/ops/alpine-admin-ansible">如何通过 Ansible 来管理 AlpineLinux ？</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">网络</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/dns-prevent-spoofing">如何避免 DNS 污染且能正常访问国内域名？</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/tinc-get-started">如何部署 TINC 网络？</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/tinc-multi-path-failover">如何配置 TINC 实现多路容灾？</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/tinc-transparency-proxy">如何基于 TINC 实现透明代理</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">系统管理</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/admin/htop">htop</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/admin/mosh">MOSH</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">基础设施</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/infra">基础设施</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/ansible">Ansible</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/ansible-awx">Ansible AWX</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/ansible-faq">ansible-faq</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/terraform">Terraform</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/terraform-provider">Terraform Provider</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/terraform-cookbook">Terraform 常用脚本</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/packer">Packer</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/infra/cloud-init">Cloud Init</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">虚拟化</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/virt">虚拟化</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/qemu-doc">QEMU 文档</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/qemu-monitor">QEMU监视器</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/qemu-version">QEMU Version</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/libvirt">Libvirt</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/libvirtd">Libvirt Daemon</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/libvirt-faq">Libvirt常见问题</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/virt/virsh">Virsh</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">启动</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/boot/syslinux">Syslinux</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/linux/boot/uboot">U-Boot</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">工具</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">网络</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/tool/network/ip-lookup">常用IP地址段查询</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">操作系统</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Darwin</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/darwin/darwin">Darwin</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/darwin/macos">macOS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/darwin/brew">Brew</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Windows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/windows/windows">Windows</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/windows/windows-dc">Windows 域控</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/os/windows/windows-faq">Windows FAQ</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">数据库</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/db/db">数据库</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">PostgreSQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/postgresql">PostgresSQL</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/datatype">数据类型</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/fts">PostgreSQL 全文检索</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/version">版本历史</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/faq">常见问题</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/postgresql-sql-faq">Pg SQL 常见问题</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/timescale">TimeScale</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/postgrest-hello">PostREST 入门部署</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/postgresql/hasura">Hasura</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">关系型</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/mysql">MySQL</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/mysql-gtid">MySQL GTID</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/relational/sqlite">SQLite</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">文档型</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/db/document/mongodb">MongoDB</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/document/rethinkdb">RethinkDB</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/document/couchdb">CouchDB</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">键值型</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/db/kv/kv">Key Value</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/kv/redis">Redis</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/kv/lmdb">LMDB</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/db/kv/leveldb">LevelDB</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">参考</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/reference/words">词汇对比</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">软件</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/reference/software/saas">SaaS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/reference/software/glossary">开发词汇</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">用户增长</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/reference/growth/formula">增长相关公式</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/reference/growth/glossary">增长相关词汇</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">烹饪</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/reference/cook/glossary">烹饪词汇</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">网络</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">应用</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/application/dns">DNS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/application/http">HTTP</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/application/ssl">SSL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">链路</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/link/wireless">无线网络</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/link/infiniband">InfiniBand</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">私有</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/private/intro">私有网络</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/private/tinc">Tinc</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/private/privoxy">Privoxy</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/private/privoxy-action">Privoxy Action</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/private/ipsec">IPSec</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/private/wireguard">WireGuard</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/private/vpn-faq">私有虚拟网络常见问题</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">工具</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/intro">网络相关工具集</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/bonding">Bonding</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/dnsmasq">dnsmasq</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/ifconfig">ifconfig</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/iproute2">IPRoute2</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/iptables">IPTables</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/mitmproxy">MitmProxy</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/nmap">NMap</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/powerdns">PowerDNS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/tool/wireshark">Wireshark</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/network/standard/ieee-802">IEEE 802</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">存储</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/intro">Storage</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">块存储</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/block/raid">RAID</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/block/mdadm">mdadm</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/block/lvm">LVM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">文件存储</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/fs/intro">Filesystem</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/fs/zfs">ZFS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/fs/btrfs">Btrfs</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/fs/fuse">FUSE</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/fs/nfs">NFS</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/fs/smb">Samba</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/fs/ntfs">NTFS</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">网络存储</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/network/share">Share</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/storage/network/sshfs">SSHFS</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">开发服务</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Auth</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/auth">Auth 概念</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/auth-faq">认证授权常见问题</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/keycloak">Keycloak</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/keycloak-dev">Keycloak 开发</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/keycloak-faq">Keycloak 常见问题</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/louketo">Louketo Proxy</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/oauth2-proxy">oauth2-proxy</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/ldap">LADP</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/ldap-schema">LDAP Schema</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/ldif">LDIF</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/apacheds">Apache Directory</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/apacheds-ops">ApacheDS 运维</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/apacheds-kerberos">ApacheDS Kerberos</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/kerberos">Kerberos</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/kerberos-faq">Kerberos FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/oauth">OAuth</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/jwt">JWT</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/auth-protocol">协议</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/auth/auth-glossary">词汇</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">内容管理</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/service/cms/cms">CMS 概览</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Office</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/service/office/office">办公套件</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/office/collabora">Collabora Online</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/office/onlyoffice">ONLYOFFICE</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">客户关系管理</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/service/crm/crm-insight">理解 CRM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">文件</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/service/file/nextcloud">NextCloud</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/file/nextcloud-config">Nextcloud 配置</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/file/nextcloud-faq">Nextcloud FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">存储</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/seaweedfs">seaweedfs</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/minio">Minio</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/minio-operator">MinIO Kubernetes Operator</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/ceph">Ceph</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/ceph-glossary">Ceph 术语</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/ceph-k8s">Ceph Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/ceph-ubuntu-16-install">Ubuntu 16.04 安装 Ceph</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/service/storage/distributed-storage">分布式存储</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">仓库</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/service/repository/nexus">Nexus</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">运维</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">服务</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/ops/service/remote-desktop">远程桌面</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/service/matomo">Matomo</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Gitlab</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/notes/ops/service/gitlab-config">GitLab配置</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/service/gitlab-cicd">GitaLab持续集成持续交付</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/ops/service/gitlab-k8s">GitLab K8S 集成</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">VoIP</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/voip/voip-intro">VoIP</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/hardware/intro">硬件设备</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/sip/provider">SIP 提供商</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/glossary">词汇表</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Asterisk</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/intro">Asterisk</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/version">Asterisk 版本</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/asterisk-moduls">Asterisk Modules</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/dev">开发</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/conf">Asterisk 配置</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/dialplan">拨号计划</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/codec">Asterisk 编码</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/chan_dahdi">DAHDi Channel</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/chan_dongle">chan_dongle</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/reference">参考</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/glossory">Asterisk 词汇</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/faq">常见问题</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/voip/asterisk/the-definitive-guide-4th">Asterisk 权威指南,第四版</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3XKI"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_AHR_"><article><header><h1 class="docTitle_3A0L">GitLab配置</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="gitlab-配置"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#gitlab-配置" title="Direct link to heading">#</a>Gitlab 配置</h1><ul><li>组建<ul><li>gitaly - 提供 RPC 操作 Git 仓库的服务</li></ul></li><li><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template">gitlab.rb.template</a><ul><li>ruby 配置文件</li><li>位于 <code>/etc/gitlab/gitlab.rb</code></li><li>修改后操作 <code>gitlab-ctl reconfigure</code> 可让服务器不重启的情况下从新配置</li></ul></li><li><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/gitlab.yml.md">gitlab.yml</a> - <a href="https://gitlab.com/gitlab-org/gitlab/blob/master/config/gitlab.yml.example">gitlab.yml.example</a><ul><li>yaml 格式的配置文件</li><li>会映射为 ruby 配置</li><li>配置后会生成 <code>/var/opt/gitlab/gitlab-rails/etc/gitlab.yml</code></li></ul></li><li><a href="https://docs.gitlab.com/omnibus/settings/configuration.html">配置</a></li></ul><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-rb codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 可以引入外部配置文件</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from_file &quot;/home/admin/external_gitlab.rb&quot;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="基础配置"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#基础配置" title="Direct link to heading">#</a>基础配置</h2><ul><li>如果想要开启 Git over SSH - 那么只能是将域名解析指向 Gitlab<ul><li>或者单独转发单个端口</li><li>做不到外部反向代理+SSH - 因为 SSH 没有域名概念 - 也不适合将整个外部的 22 都指向 Gitlab</li></ul></li><li>注意<ul><li>配置了 external_url 后，如果为 https 则只监听 https - <a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/1891">#1891</a> - 同时监听 80 和 443</li></ul></li></ul><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-rb codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 用于 SSH 的主机名</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_ssh_host&#x27;] = &#x27;ssh.host_example.com&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;time_zone&#x27;] = &#x27;UTC&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="授权配置"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#授权配置" title="Direct link to heading">#</a>授权配置</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ldap"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ldap" title="Direct link to heading">#</a>LDAP</h3><ul><li>由于 Git 需要密码 - 想要中心化管理密码只能使用 LDAP</li><li>LDAP 可以禁止登陆 - 例如 只允许 OpenID 登陆</li><li><a href="https://docs.gitlab.com/ee/administration/auth/ldap.html">LDAP集成</a> <ul><li>CE 版本只支持作为登陆</li><li>EE 支持同步账号和分组</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="openid-connect"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#openid-connect" title="Direct link to heading">#</a>OpenID Connect</h3><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="pages-配置"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pages-配置" title="Direct link to heading">#</a>Pages 配置</h2><ul><li>注意<ul><li>不能用 gitlab 的二级域名</li><li>只能通过域名访问</li><li>默认存储目录 <code>/var/opt/gitlab/gitlab-rails/shared/pages</code></li><li>如果使用自定义域名，则可能需要开启反向端口</li></ul></li><li><a href="https://docs.gitlab.com/ee/administration/pages">Pages 管理</a></li></ul><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-rb codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 启用 Pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_pages[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 访问地址</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 例如项目 wener/app 则地址为 wener.pages.wener.me/app 可以测试访问</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># curl -H &#x27;Host: wener.pages.wener.me&#x27;  gitlab.wener.me/app</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 如果配置为 http 需要配置证书或者会自动从 let&#x27;s encrypt 获取</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pages_external_url &#x27;http://pages.wener.me&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 如果配置为 https 没有配置 cert 则会使用域名拼 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 例如  &quot;/etc/gitlab/ssl/example.io.crt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 如果想要 https 但是又没有证书，可以考虑配置为主域名证书，然后在外面反向代理的时候忽略验证</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 如果没有 cert 会一直失败 cannot load certificate &quot;/etc/gitlab/ssl/pages.example.io.crt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pages_nginx[&#x27;redirect_http_to_https&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pages_nginx[&#x27;ssl_certificate&#x27;] = &quot;/etc/gitlab/ssl/gitlab.example.com.crt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pages_nginx[&#x27;ssl_certificate_key&#x27;] = &quot;/etc/gitlab/ssl/gitlab.example.com.key&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 查看状态的路径</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_pages[&#x27;status_uri&#x27;] = &quot;/@status&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 避免 bind mount - 在 docker 里默认没有权限</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 会 mount 在 /var/opt/gitlab/gitlab-pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_pages[&#x27;inplace_chroot&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 存储路径</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 默认 /var/opt/gitlab/gitlab-rails/shared/pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;pages_path&#x27;] = &quot;/mnt/storage/pages&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># pages 监听的端口</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 默认是 localhost:8090</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 例如项目 wener/app 可以通过如下方式访问 - 注意协议是 HTTP 和配置的外部 URL 有关</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># curl -H &#x27;Host: wener.pages.wener.me&#x27;  localhost:8090/app</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_pages[&#x27;listen_proxy&#x27;] = &quot;localhost:8090&quot;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="gitlabrb"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#gitlabrb" title="Direct link to heading">#</a>gitlab.rb</h2><pre class="mdxCodeBlock_2E1g"><div class="codeBlockWrapper_1h2Z"><pre class="prism-code language-rb codeBlock_3dxb" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Email Settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_email_enabled&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_email_from&#x27;] = &#x27;example@example.com&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_email_display_name&#x27;] = &#x27;Example&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_email_reply_to&#x27;] = &#x27;noreply@example.com&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_email_subject_suffix&#x27;] = &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### GitLab user privileges</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_default_can_create_group&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># default true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;gitlab_username_changing_enabled&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 反向代理地址</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;trusted_proxies&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 监控白名单</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;monitoring_whitelist&#x27;] = [&#x27;127.0.0.0/8&#x27;, &#x27;::1/128&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Email account username</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! **With third party providers, this is usually the full email address.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! **With self-hosted email servers, this is usually the user part of the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####!   email address.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_email&#x27;] = &quot;gitlab-incoming@gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_password&#x27;] = &quot;[REDACTED]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### IMAP Settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_host&#x27;] = &quot;imap.gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_port&#x27;] = 993</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_ssl&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_start_tls&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Incoming Mailbox Settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! The mailbox where incoming mail will end up. Usually &quot;inbox&quot;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_mailbox_name&#x27;] = &quot;inbox&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! The IDLE command timeout.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;incoming_email_idle_timeout&#x27;] = 60</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Git LFS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;lfs_object_store_connection&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;provider&#x27; =&gt; &#x27;AWS&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;region&#x27; =&gt; &#x27;eu-west-1&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;aws_access_key_id&#x27; =&gt; &#x27;AWS_ACCESS_KEY_ID&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;aws_secret_access_key&#x27; =&gt; &#x27;AWS_SECRET_ACCESS_KEY&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # # The below options configure an S3 compatible host instead of AWS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;aws_signature_version&#x27; =&gt; 4, # For creation of signed URLs. Set to 2 if provider does not support v4.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;endpoint&#x27; =&gt; &#x27;https://s3.amazonaws.com&#x27;, # default: nil - Useful for S3 compliant services such as DigitalOcean Spaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;host&#x27; =&gt; &#x27;s3.amazonaws.com&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;path_style&#x27; =&gt; false # Use &#x27;host/bucket_name/object&#x27; instead of &#x27;bucket_name.host/object&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### GitLab uploads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/ee/administration/uploads.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;uploads_object_store_connection&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;provider&#x27; =&gt; &#x27;AWS&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;region&#x27; =&gt; &#x27;eu-west-1&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;aws_access_key_id&#x27; =&gt; &#x27;AWS_ACCESS_KEY_ID&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;aws_secret_access_key&#x27; =&gt; &#x27;AWS_SECRET_ACCESS_KEY&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # # The below options configure an S3 compatible host instead of AWS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;host&#x27; =&gt; &#x27;s3.amazonaws.com&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;aws_signature_version&#x27; =&gt; 4, # For creation of signed URLs. Set to 2 if provider does not support v4.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;endpoint&#x27; =&gt; &#x27;https://s3.amazonaws.com&#x27;, # default: nil - Useful for S3 compliant services such as DigitalOcean Spaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # &#x27;path_style&#x27; =&gt; false # Use &#x27;host/bucket_name/object&#x27; instead of &#x27;bucket_name.host/object&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;mattermost_host&#x27;] = &quot;https://mattermost.example.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### LDAP Settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **Be careful not to break the indentation in the ldap_servers block. It is</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###!   in yaml format and the spaces must be retained. Using tabs will not work.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;ldap_enabled&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **remember to close this block with &#x27;EOS&#x27; below**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;ldap_servers&#x27;] = YAML.load &lt;&lt;-&#x27;EOS&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   main: # &#x27;main&#x27; is the GitLab &#x27;provider ID&#x27; of this LDAP server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     label: &#x27;LDAP&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     host: &#x27;_your_ldap_server&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     port: 389</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     uid: &#x27;sAMAccountName&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     bind_dn: &#x27;_the_full_dn_of_the_user_you_will_bind_with&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     password: &#x27;_the_password_of_the_bind_user&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     encryption: &#x27;plain&#x27; # &quot;start_tls&quot; or &quot;simple_tls&quot; or &quot;plain&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     verify_certificates: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     smartcard_auth: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     active_directory: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     allow_username_or_email_login: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     lowercase_usernames: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     block_auto_created_users: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     base: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     user_filter: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     ## EE only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     group_base: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     admin_group: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     sync_ssh_keys: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   secondary: # &#x27;secondary&#x27; is the GitLab &#x27;provider ID&#x27; of second LDAP server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     label: &#x27;LDAP&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     host: &#x27;_your_ldap_server&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     port: 389</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     uid: &#x27;sAMAccountName&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     bind_dn: &#x27;_the_full_dn_of_the_user_you_will_bind_with&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     password: &#x27;_the_password_of_the_bind_user&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     encryption: &#x27;plain&#x27; # &quot;start_tls&quot; or &quot;simple_tls&quot; or &quot;plain&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     verify_certificates: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     smartcard_auth: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     active_directory: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     allow_username_or_email_login: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     lowercase_usernames: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     block_auto_created_users: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     base: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     user_filter: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     ## EE only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     group_base: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     admin_group: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     sync_ssh_keys: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># EOS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Backup Settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/omnibus/settings/backups.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;manage_backup_path&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;backup_path&#x27;] = &quot;/var/opt/gitlab/backups&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! The duration in seconds to keep backups before they are allowed to be deleted</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;backup_keep_time&#x27;] = 604800</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;backup_upload_connection&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;provider&#x27; =&gt; &#x27;AWS&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;region&#x27; =&gt; &#x27;eu-west-1&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;aws_access_key_id&#x27; =&gt; &#x27;AKIAKIAKI&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;aws_secret_access_key&#x27; =&gt; &#x27;secret123&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;backup_upload_remote_directory&#x27;] = &#x27;my.s3.bucket&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;backup_multipart_chunk_size&#x27;] = 104857600</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Extra customization</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;extra_google_analytics_id&#x27;] = &#x27;_your_tracking_id&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;extra_piwik_url&#x27;] = &#x27;_your_piwik_url&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;extra_piwik_site_id&#x27;] = &#x27;_your_piwik_site_id&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/environment-variables.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;env&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;BUNDLE_GEMFILE&#x27; =&gt; &quot;/opt/gitlab/embedded/service/gitlab-rails/Gemfile&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;PATH&#x27; =&gt; &quot;/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Change the initial default admin password and shared runner registration tokens.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! **Only applicable on initial setup, changing these settings after database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####!   is created and seeded won&#x27;t yield any change.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;initial_root_password&#x27;] = &quot;password&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;initial_shared_runners_registration_token&#x27;] = &quot;token&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### GitLab database settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/omnibus/settings/database.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **Only needed if you use an external database.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_adapter&#x27;] = &quot;postgresql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_encoding&#x27;] = &quot;unicode&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_collation&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_database&#x27;] = &quot;gitlabhq_production&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_pool&#x27;] = 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_username&#x27;] = &quot;gitlab&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_password&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_host&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_port&#x27;] = 5432</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_socket&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_sslmode&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_sslcompression&#x27;] = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_sslrootcert&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_prepared_statements&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;db_statements_limit&#x27;] = 1000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### GitLab Redis settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Connect to your own Redis instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Redis TCP connection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;redis_host&#x27;] = &quot;127.0.0.1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;redis_port&#x27;] = 6379</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;redis_ssl&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;redis_password&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;redis_database&#x27;] = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;redis_enable_client&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Redis local UNIX socket (will be disabled if TCP method is used)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;redis_socket&#x27;] = &quot;/var/opt/gitlab/redis/redis.socket&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### GitLab email server settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **Use smtp instead of sendmail/postfix.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_address&#x27;] = &quot;smtp.server&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_port&#x27;] = 465</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_user_name&#x27;] = &quot;smtp user&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_password&#x27;] = &quot;smtp password&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_domain&#x27;] = &quot;example.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_authentication&#x27;] = &quot;login&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;smtp_tls&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **Can be: &#x27;none&#x27;, &#x27;peer&#x27;, &#x27;client_once&#x27;, &#x27;fail_if_no_peer_cert&#x27;**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: http://api.rubyonrails.org/classes/ActionMailer/Base.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;smtp_openssl_verify_mode&#x27;] = &#x27;none&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;smtp_ca_path&#x27;] = &quot;/etc/ssl/certs&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;smtp_ca_file&#x27;] = &quot;/etc/ssl/certs/ca-certificates.crt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Container Registry settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/ce/administration/container_registry.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># registry_external_url &#x27;https://registry.gitlab.example.com&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Settings used by GitLab application</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;registry_enabled&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;registry_host&#x27;] = &quot;registry.gitlab.example.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;registry_port&#x27;] = &quot;5005&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gitlab_rails[&#x27;registry_path&#x27;] = &quot;/var/opt/gitlab/gitlab-rails/shared/registry&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Error Reporting and Logging with Sentry</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;sentry_enabled&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;sentry_dsn&#x27;] = &#x27;https://&lt;key&gt;@sentry.io/&lt;project&gt;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;sentry_clientside_dsn&#x27;] = &#x27;https://&lt;key&gt;@sentry.io/&lt;project&gt;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;sentry_environment&#x27;] = &#x27;production&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab Workhorse</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/README.md</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_workhorse[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_workhorse[&#x27;ha&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_workhorse[&#x27;listen_network&#x27;] = &quot;unix&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_workhorse[&#x27;listen_umask&#x27;] = 000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_workhorse[&#x27;listen_addr&#x27;] = &quot;/var/opt/gitlab/gitlab-workhorse/socket&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_workhorse[&#x27;auth_backend&#x27;] = &quot;http://localhost:8080&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab PostgreSQL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Changing any of these settings requires a restart of postgresql.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! By default, reconfigure reloads postgresql if it is running. If you</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! change any of these settings, be sure to run `gitlab-ctl restart postgresql`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! after reconfigure in order for the changes to take effect.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;listen_address&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;port&#x27;] = 5432</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;data_dir&#x27;] = &quot;/var/opt/gitlab/postgresql/data&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **recommend value is 1/4 of total RAM, up to 14GB.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;shared_buffers&#x27;] = &quot;256MB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Advanced settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;ha&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;dir&#x27;] = &quot;/var/opt/gitlab/postgresql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;log_directory&#x27;] = &quot;/var/log/gitlab/postgresql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;username&#x27;] = &quot;gitlab-psql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;group&#x27;] = &quot;gitlab-psql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! `SQL_USER_PASSWORD_HASH` can be generated using the command `gitlab-ctl pg-password-md5 gitlab`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;sql_user_password&#x27;] = &#x27;SQL_USER_PASSWORD_HASH&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;uid&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;gid&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;shell&#x27;] = &quot;/bin/sh&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;home&#x27;] = &quot;/var/opt/gitlab/postgresql&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;user_path&#x27;] = &quot;/opt/gitlab/embedded/bin:/opt/gitlab/bin:$PATH&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;sql_user&#x27;] = &quot;gitlab&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_connections&#x27;] = 200</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;md5_auth_cidr_addresses&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;trust_auth_cidr_addresses&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;wal_buffers&#x27;] = &quot;-1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_max_workers&#x27;] = &quot;3&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_freeze_max_age&#x27;] = &quot;200000000&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;log_statement&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;track_activity_query_size&#x27;] = &quot;1024&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;shared_preload_libraries&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;dynamic_shared_memory_type&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;hot_standby&#x27;] = &quot;off&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### SSL settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://www.postgresql.org/docs/9.6/static/runtime-config-connection.html#GUC-SSL-CERT-FILE for more details</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;ssl&#x27;] = &#x27;on&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;ssl_ciphers&#x27;] = &#x27;HIGH:MEDIUM:+3DES:!aNULL:!SSLv3:!TLSv1&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;ssl_cert_file&#x27;] = &#x27;server.crt&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;ssl_key_file&#x27;] = &#x27;server.key&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;ssl_ca_file&#x27;] = &#x27;/opt/gitlab/embedded/ssl/certs/cacert.pem&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;ssl_crl_file&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Replication settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Note, some replication settings do not require a full restart. They are documented below.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;wal_level&#x27;] = &quot;hot_standby&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_wal_senders&#x27;] = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_replication_slots&#x27;] = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_locks_per_transaction&#x27;] = 128</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Backup/Archive settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;archive_mode&#x27;] = &quot;off&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Changing any of these settings only requires a reload of postgresql. You do not need to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! restart postgresql if you change any of these and run reconfigure.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;work_mem&#x27;] = &quot;16MB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;maintenance_work_mem&#x27;] = &quot;16MB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;checkpoint_segments&#x27;] = 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;checkpoint_timeout&#x27;] = &quot;5min&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;checkpoint_completion_target&#x27;] = 0.9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;effective_io_concurrency&#x27;] = 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;checkpoint_warning&#x27;] = &quot;30s&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;effective_cache_size&#x27;] = &quot;1MB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;shmmax&#x27;] =  17179869184 # or 4294967295</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;shmall&#x27;] =  4194304 # or 1048575</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum&#x27;] = &quot;on&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;log_autovacuum_min_duration&#x27;] = &quot;-1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_naptime&#x27;] = &quot;1min&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_vacuum_threshold&#x27;] = &quot;50&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_analyze_threshold&#x27;] = &quot;50&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_vacuum_scale_factor&#x27;] = &quot;0.02&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_analyze_scale_factor&#x27;] = &quot;0.01&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_vacuum_cost_delay&#x27;] = &quot;20ms&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;autovacuum_vacuum_cost_limit&#x27;] = &quot;-1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;statement_timeout&#x27;] = &quot;60000&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;idle_in_transaction_session_timeout&#x27;] = &quot;60000&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;log_line_prefix&#x27;] = &quot;%a&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_worker_processes&#x27;] = 8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_parallel_workers_per_gather&#x27;] = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;log_lock_waits&#x27;] = 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;deadlock_timeout&#x27;] = &#x27;5s&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;track_io_timing&#x27;] = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;default_statistics_target&#x27;] = 1000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Available in PostgreSQL 9.6 and later</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;min_wal_size&#x27;] = 80MB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_wal_size&#x27;] = 1GB</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Backup/Archive settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;archive_command&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;archive_timeout&#x27;] = &quot;0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Replication settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;sql_replication_user&#x27;] = &quot;gitlab_replicator&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;sql_replication_password&#x27;] = &quot;md5 hash of postgresql password&quot; # You can generate with `gitlab-ctl pg-password-md5 &lt;dbuser&gt;`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;wal_keep_segments&#x27;] = 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_standby_archive_delay&#x27;] = &quot;30s&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;max_standby_streaming_delay&#x27;] = &quot;30s&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;synchronous_commit&#x27;] = on</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;synchronous_standby_names&#x27;] = &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;hot_standby_feedback&#x27;] = &#x27;off&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;random_page_cost&#x27;] = 2.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;log_temp_files&#x27;] = -1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;log_checkpoints&#x27;] = &#x27;off&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># To add custom entries to pg_hba.conf use the following</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresql[&#x27;custom_pg_hba_entries&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   APPLICATION: [ # APPLICATION should identify what the settings are used for</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#       type: example,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#       database: example,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#       user: example,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#       cidr: example,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#       method: example,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#       option: example</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://www.postgresql.org/docs/9.6/static/auth-pg-hba-conf.html for an explanation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># of the values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab Redis</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Can be disabled if you are using your own Redis instance.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/redis.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;ha&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;hz&#x27;] = 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;dir&#x27;] = &quot;/var/opt/gitlab/redis&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;log_directory&#x27;] = &quot;/var/log/gitlab/redis&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;username&#x27;] = &quot;gitlab-redis&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;group&#x27;] = &quot;gitlab-redis&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;maxclients&#x27;] = &quot;10000&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;maxmemory&#x27;] = &quot;0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;maxmemory_policy&#x27;] = &quot;noeviction&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;maxmemory_samples&#x27;] = &quot;5&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;tcp_backlog&#x27;] = 511</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;tcp_timeout&#x27;] = &quot;60&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;tcp_keepalive&#x27;] = &quot;300&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;uid&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;gid&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Disable or obfuscate unnecessary redis command names</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Uncomment and edit this block to add or remove entries.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### See https://docs.gitlab.com/omnibus/settings/redis.html#renamed-commands</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### for detailed usage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;rename_commands&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;KEYS&#x27;: &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **To enable only Redis service in this machine, uncomment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###!   one of the lines below (choose master or slave instance types).**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###!       https://docs.gitlab.com/ce/administration/high_availability/redis.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis_master_role[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis_slave_role[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Redis TCP support (will disable UNIX socket transport)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;bind&#x27;] = &#x27;0.0.0.0&#x27; # or specify an IP to bind to a single one</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;port&#x27;] = 6379</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;password&#x27;] = &#x27;redis-password-goes-here&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Redis Sentinel support</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **You need a master slave Redis replication to be able to do failover**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! **Please read the documentation before enabling it to understand the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###!   caveats:**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">###! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Replication support</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Slave Redis instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;master&#x27;] = false # by default this is true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Slave and Sentinel shared configuration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! **Both need to point to the master Redis instance to get replication and</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####!   heartbeat monitoring**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;master_name&#x27;] = &#x27;gitlab-redis&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;master_ip&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;master_port&#x27;] = 6379</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Support to run redis slaves in a Docker or NAT environment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! Docs: https://redis.io/topics/replication#configuring-replication-in-docker-and-nat</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;announce_ip&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;announce_port&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! **Master password should have the same value defined in</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####!   redis[&#x27;password&#x27;] to enable the instance to transition to/from</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####!   master/slave in a failover event.**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;master_password&#x27;] = &#x27;redis-password-goes-here&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####! Increase these values when your slaves can&#x27;t catch up with master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;client_output_buffer_limit_normal&#x27;] = &#x27;0 0 0&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;client_output_buffer_limit_slave&#x27;] = &#x27;256mb 64mb 60&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;client_output_buffer_limit_pubsub&#x27;] = &#x27;32mb 8mb 60&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#####! Redis snapshotting frequency</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#####! Set to [] to disable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#####! Set to [&#x27;&#x27;] to clear previously set values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># redis[&#x27;save&#x27;] = [ &#x27;900 1&#x27;, &#x27;300 10&#x27;, &#x27;60 10000&#x27; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab Web server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#using-a-non-bundled-web-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! When bundled nginx is disabled we need to add the external webserver user to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! the GitLab webserver group.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># web_server[&#x27;external_users&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># web_server[&#x27;username&#x27;] = &#x27;gitlab-www&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># web_server[&#x27;group&#x27;] = &#x27;gitlab-www&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># web_server[&#x27;uid&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># web_server[&#x27;gid&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># web_server[&#x27;shell&#x27;] = &#x27;/bin/false&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># web_server[&#x27;home&#x27;] = &#x27;/var/opt/gitlab/nginx&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab NGINX</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;client_max_body_size&#x27;] = &#x27;250m&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;redirect_http_to_https&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;redirect_http_to_https_port&#x27;] = 80</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Most root CA&#x27;s are included by default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_client_certificate&#x27;] = &quot;/etc/gitlab/ssl/ca.crt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! enable/disable 2-way SSL client authentication</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_verify_client&#x27;] = &quot;off&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! if ssl_verify_client on, verification depth in the client certificates chain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_verify_depth&#x27;] = &quot;1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_certificate&#x27;] = &quot;/etc/gitlab/ssl/#{node[&#x27;fqdn&#x27;]}.crt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_certificate_key&#x27;] = &quot;/etc/gitlab/ssl/#{node[&#x27;fqdn&#x27;]}.key&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_ciphers&#x27;] = &quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_prefer_server_ciphers&#x27;] = &quot;on&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Recommended by: https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##!                   https://cipherli.st/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_protocols&#x27;] = &quot;TLSv1.2 TLSv1.3&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Recommended in: https://nginx.org/en/docs/http/ngx_http_ssl_module.html**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_session_cache&#x27;] = &quot;builtin:1000  shared:SSL:10m&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Default according to https://nginx.org/en/docs/http/ngx_http_ssl_module.html**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_session_timeout&#x27;] = &quot;5m&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;ssl_dhparam&#x27;] = nil # Path to dhparams.pem, eg. /etc/gitlab/ssl/dhparams.pem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;listen_addresses&#x27;] = [&#x27;*&#x27;, &#x27;[::]&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Defaults to forcing web browsers to always communicate using only HTTPS**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-http-strict-transport-security</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;hsts_max_age&#x27;] = 31536000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;hsts_include_subdomains&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Defaults to stripping path information when making cross-origin requests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;referrer_policy&#x27;] = &#x27;strict-origin-when-cross-origin&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Docs: http://nginx.org/en/docs/http/ngx_http_gzip_module.html**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;gzip_enabled&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Override only if you use a reverse proxy**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-the-nginx-listen-port</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;listen_port&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Override only if your reverse proxy internally communicates over HTTP**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#supporting-proxied-ssl</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;listen_https&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;custom_gitlab_server_config&#x27;] = &quot;location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;custom_nginx_config&#x27;] = &quot;include /etc/nginx/conf.d/example.conf;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;proxy_read_timeout&#x27;] = 3600</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;proxy_connect_timeout&#x27;] = 300</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;proxy_set_headers&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;Host&quot; =&gt; &quot;$http_host_with_default&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;X-Real-IP&quot; =&gt; &quot;$remote_addr&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;X-Forwarded-For&quot; =&gt; &quot;$proxy_add_x_forwarded_for&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;X-Forwarded-Proto&quot; =&gt; &quot;https&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;X-Forwarded-Ssl&quot; =&gt; &quot;on&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;Upgrade&quot; =&gt; &quot;$http_upgrade&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;Connection&quot; =&gt; &quot;$connection_upgrade&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;proxy_cache_path&#x27;] = &#x27;proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;proxy_cache&#x27;] = &#x27;gitlab&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;http2_enabled&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;real_ip_trusted_addresses&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;real_ip_header&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;real_ip_recursive&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;custom_error_pages&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   &#x27;404&#x27; =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     &#x27;title&#x27; =&gt; &#x27;Example title&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     &#x27;header&#x27; =&gt; &#x27;Example header&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     &#x27;message&#x27; =&gt; &#x27;Example message&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Advanced settings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;dir&#x27;] = &quot;/var/opt/gitlab/nginx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;log_directory&#x27;] = &quot;/var/log/gitlab/nginx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;worker_processes&#x27;] = 4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;worker_connections&#x27;] = 10240</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;log_format&#x27;] = &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; $status $body_bytes_sent &quot;$http_referer&quot; &quot;$http_user_agent&quot;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;sendfile&#x27;] = &#x27;on&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;tcp_nopush&#x27;] = &#x27;on&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;tcp_nodelay&#x27;] = &#x27;on&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;gzip&#x27;] = &quot;on&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;gzip_http_version&#x27;] = &quot;1.0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;gzip_comp_level&#x27;] = &quot;2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;gzip_proxied&#x27;] = &quot;any&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;gzip_types&#x27;] = [ &quot;text/plain&quot;, &quot;text/css&quot;, &quot;application/x-javascript&quot;, &quot;text/xml&quot;, &quot;application/xml&quot;, &quot;application/xml+rss&quot;, &quot;text/javascript&quot;, &quot;application/json&quot; ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;keepalive_timeout&#x27;] = 65</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;cache_max_size&#x27;] = &#x27;5000m&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;server_names_hash_bucket_size&#x27;] = 64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! These paths have proxy_request_buffering disabled</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;request_buffering_off_path_regex&#x27;] = &quot;\.git/git-receive-pack$|\.git/info/refs?service=git-receive-pack$|\.git/gitlab-lfs/objects|\.git/info/lfs/objects/batch$&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### Nginx status</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx[&#x27;status&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;enable&quot; =&gt; true,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;listen_addresses&quot; =&gt; [&quot;127.0.0.1&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;fqdn&quot; =&gt; &quot;dev.example.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;port&quot; =&gt; 9999,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;vts_enable&quot; =&gt; true,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;options&quot; =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#    &quot;stub_status&quot; =&gt; &quot;on&quot;, # Turn on stats</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#    &quot;server_tokens&quot; =&gt; &quot;off&quot;, # Don&#x27;t show the version of NGINX</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#    &quot;access_log&quot; =&gt; &quot;off&quot;, # Disable logs for stats</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#    &quot;allow&quot; =&gt; &quot;127.0.0.1&quot;, # Only allow access from localhost</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#    &quot;deny&quot; =&gt; &quot;all&quot; # Deny access to anyone else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab Logging</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;svlogd_size&#x27;] = 200 * 1024 * 1024 # rotate after 200 MB of log data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;svlogd_num&#x27;] = 30 # keep 30 rotated log files</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;svlogd_timeout&#x27;] = 24 * 60 * 60 # rotate after 24 hours</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;svlogd_filter&#x27;] = &quot;gzip&quot; # compress logs with gzip</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;svlogd_udp&#x27;] = nil # transmit log messages via UDP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;svlogd_prefix&#x27;] = nil # custom prefix for log messages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_frequency&#x27;] = &quot;daily&quot; # rotate logs daily</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_maxsize&#x27;] = nil # rotate logs when they grow bigger than size bytes even before the specified time interval (daily, weekly, monthly, or yearly)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_size&#x27;] = nil # do not rotate by size by default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_rotate&#x27;] = 30 # keep 30 rotated logs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_compress&#x27;] = &quot;compress&quot; # see &#x27;man logrotate&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_method&#x27;] = &quot;copytruncate&quot; # see &#x27;man logrotate&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_postrotate&#x27;] = nil # no postrotate command by default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;logrotate_dateformat&#x27;] = nil # use date extensions for rotated files rather than numbers e.g. a value of &quot;-%Y-%m-%d&quot; would give rotated files like production.log-2016-03-09.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">### UDP log forwarding</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: http://docs.gitlab.com/omnibus/settings/logs.html#udp-log-forwarding</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! remote host to ship log messages to via UDP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;udp_log_shipping_host&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! override the hostname used when logs are shipped via UDP,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##  by default the system hostname will be used.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;udp_log_shipping_hostname&#x27;] = nil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! remote port to ship log messages to via UDP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logging[&#x27;udp_log_shipping_port&#x27;] = 514</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Logrotate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html#logrotate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! You can disable built in logrotate feature.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># logrotate[&#x27;enable&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Users and groups accounts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Disable management of users and groups accounts.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Set only if creating accounts manually**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-user-and-group-account-management</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># manage_accounts[&#x27;enable&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Storage directories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Disable managing storage directories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-storage-directories-management</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! **Set only if the select directories are created manually**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># manage_storage_directories[&#x27;enable&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># manage_storage_directories[&#x27;manage_etc&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Runtime directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com//omnibus/settings/configuration.html#configuring-runtime-directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># runtime_dir &#x27;/run&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Advanced setting for configuring git system settings for omnibus-gitlab</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! internal git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! For multiple options under one header use array of comma separated values,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! eg.:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! { &quot;receive&quot; =&gt; [&quot;fsckObjects = true&quot;], &quot;alias&quot; =&gt; [&quot;st = status&quot;, &quot;co = checkout&quot;] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># omnibus_gitconfig[&#x27;system&#x27;] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;pack&quot; =&gt; [&quot;threads = 1&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;receive&quot; =&gt; [&quot;fsckObjects = true&quot;, &quot;advertisePushOptions = true&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;repack&quot; =&gt; [&quot;writeBitmaps = true&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#  &quot;transfer&quot; =&gt; [&quot;hideRefs=^refs/tmp/&quot;, &quot;hideRefs=^refs/keep-around/&quot;, &quot;hideRefs=^refs/remotes/&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab Pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/ce/pages/administration.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Define to enable GitLab Pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># pages_external_url &quot;http://pages.example.com/&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;enable&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure to expose GitLab Pages on external IP address, serving the HTTP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;external_http&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure to expose GitLab Pages on external IP address, serving the HTTPS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;external_https&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure to use the default list of cipher suites</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;insecure_ciphers&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure to enable health check endpoint on GitLab Pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;status_uri&#x27;] = &quot;/@status&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Tune the maximum number of concurrent connections GitLab Pages will handle.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! This should be in the range 1 - 10000, defaulting to 5000.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;max_connections&#x27;] = 5000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure to use JSON structured logging in GitLab Pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;log_format&#x27;] = &quot;json&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure verbose logging for GitLab Pages</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;log_verbose&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Error Reporting and Logging with Sentry</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;sentry_enabled&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;sentry_dsn&#x27;] = &#x27;https://&lt;key&gt;@sentry.io/&lt;project&gt;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;sentry_environment&#x27;] = &#x27;production&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Listen for requests forwarded by reverse proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;listen_proxy&#x27;] = &quot;localhost:8090&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure GitLab Pages to use an HTTP Proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;http_proxy&#x27;] = &quot;http://example:8080&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;redirect_http&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;use_http2&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;dir&#x27;] = &quot;/var/opt/gitlab/gitlab-pages&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;log_directory&#x27;] = &quot;/var/log/gitlab/gitlab-pages&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;artifacts_server&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;artifacts_server_url&#x27;] = nil # Defaults to external_url + &#x27;/api/v4&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;artifacts_server_timeout&#x27;] = 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Environments that do not support bind-mounting should set this parameter to</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! true. This is incompatible with the artifacts server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;inplace_chroot&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Prometheus metrics for Pages docs: https://gitlab.com/gitlab-org/gitlab-pages/#enable-prometheus-metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;metrics_address&#x27;] = &quot;:9235&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Specifies the minimum SSL/TLS version (&quot;ssl3&quot;, &quot;tls1.0&quot;, &quot;tls1.1&quot; or &quot;tls1.2&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;tls_min_version&#x27;] = &quot;ssl3&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Specifies the maximum SSL/TLS version (&quot;ssl3&quot;, &quot;tls1.0&quot;, &quot;tls1.1&quot; or &quot;tls1.2&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;tls_max_version&#x27;] = &quot;tls1.2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Configure the pages admin API</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;admin_secret_token&#x27;] = &#x27;custom secret&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;admin_https_listener&#x27;] = &#x27;0.0.0.0:5678&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;admin_https_cert&#x27;] = &#x27;/etc/gitlab/pages-admin.crt&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;admin_https_key&#x27;] = &#x27;/etc/gitlab/pages-admin.key&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Client side configuration for gitlab-pages admin API, in case pages runs on a different host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;pages_admin_address&#x27;] = &#x27;pages.gitlab.example.com:5678&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;pages_admin_certificate&#x27;] = &#x27;/etc/gitlab/pages-admin.crt&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Pages access control</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;access_control&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;gitlab_id&#x27;] = nil # Automatically generated if not present</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;gitlab_secret&#x27;] = nil # Generated if not present</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;auth_redirect_uri&#x27;] = nil # Defaults to projects subdomain of pages_external_url and + &#x27;/auth&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;gitlab_server&#x27;] = nil # Defaults to external_url</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;auth_secret&#x27;] = nil # Generated if not present</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Define custom gitlab-pages HTTP headers for the whole instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_pages[&#x27;headers&#x27;] = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab Pages NGINX</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># All the settings defined in the &quot;GitLab Nginx&quot; section are also available in</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># this &quot;GitLab Pages NGINX&quot; section, using the key `pages_nginx`.  However,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># those settings should be explicitly set. That is, settings given as</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># `nginx[&#x27;some_setting&#x27;]` WILL NOT be automatically replicated as</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># `pages_nginx[&#x27;some_setting&#x27;]` and should be set separately.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Below you can find settings that are exclusive to &quot;GitLab Pages NGINX&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># pages_nginx[&#x27;enable&#x27;] = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_rails[&#x27;pages_path&#x27;] = &quot;/var/opt/gitlab/gitlab-rails/shared/pages&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## GitLab CI</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##! Docs: https://docs.gitlab.com/ce/ci/quick_start/README.html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">################################################################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_ci[&#x27;gitlab_ci_all_broken_builds&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_ci[&#x27;gitlab_ci_add_pusher&#x27;] = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gitlab_ci[&#x27;builds_directory&#x27;] = &#x27;/var/opt/gitlab/gitlab-ci/builds&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3qZc">Copy</button></div></pre></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/notes/ops/service/matomo"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Matomo</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/notes/ops/service/gitlab-cicd"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">GitaLab持续集成持续交付 »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3z_-"><ul class="contents contents__left-border"><li><a href="#基础配置" class="contents__link">基础配置</a></li><li><a href="#授权配置" class="contents__link">授权配置</a><ul><li><a href="#ldap" class="contents__link">LDAP</a></li><li><a href="#openid-connect" class="contents__link">OpenID Connect</a></li></ul></li><li><a href="#pages-配置" class="contents__link">Pages 配置</a></li><li><a href="#gitlabrb" class="contents__link">gitlab.rb</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">笔记</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/notes/java/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/ops/os/alpine/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes/k8s-intro">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip/voip-intro">VoIP</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Projects</h4><ul class="footer__items"><div>
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              - <a class="footer__link-item" href="https://travis-ci.com/wenerme/wener" title="wenerme/wener - travis-ci">
                <img style="vertical-align: middle;opacity: .4;" src="https://travis-ci.com/wenerme/wener.svg?branch=master">
                </a>
              - <a class="footer__link-item" href="https://github.com/wenerme/wenerme.github.io/deployments" title="GitHub Pages 部署">部署状态</a>
              </div>
              </div><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://apis.wener.me">Wener&#x27;s Apis</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/wenerme" href="https://github.com/wenerme">GitHub</a></li><li class="footer__item"><a class="footer__link-item" to="https://twitter.com/wenerme" href="https://twitter.com/wenerme">Twitter</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Wener Site" src="/img/wener-logo.svg"></div>Copyright © 1992-2020 Wener - 构建时间 2020-10-10 21:30</div></div></footer>
</div>

<script src="/styles.3bfef576.js"></script>

<script src="/runtime~main.21bc78aa.js"></script>

<script src="/main.995ead94.js"></script>

<script src="/1.ea46efd4.js"></script>

<script src="/2.9c5675ff.js"></script>

<script src="/1be78505.3520f6ae.js"></script>

<script src="/7f176b88.fd00c630.js"></script>

<script src="/17896441.cc0f7da5.js"></script>

<script src="/b79d56fa.839ee99c.js"></script>


</body>
</html>