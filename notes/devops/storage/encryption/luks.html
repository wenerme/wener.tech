<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-devops/storage/encryption/luks">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">LUKS | Wener Live &amp; Life</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wener.me/notes/devops/storage/encryption/luks"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LUKS | Wener Live &amp; Life"><meta data-rh="true" name="description" content="- LUKS - Linux Unified Key Setup"><meta data-rh="true" property="og:description" content="- LUKS - Linux Unified Key Setup"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wener.me/notes/devops/storage/encryption/luks"><link data-rh="true" rel="alternate" href="https://wener.me/notes/devops/storage/encryption/luks" hreflang="en"><link data-rh="true" rel="alternate" href="https://wener.me/notes/devops/storage/encryption/luks" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://37P8DMWBKF-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/story/rss.xml" title="Wener Live &amp; Life RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/story/atom.xml" title="Wener Live &amp; Life Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Wener Live &amp; Life" href="/opensearch.xml">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css">
<script src="https://static.cloudflareinsights.com/beacon.min.js" async data-cf-beacon="{&quot;token&quot;: &quot;e9a1b931103044f3940ee67b78c7df70&quot;}" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.1c5a76d0.css">
<link rel="preload" href="/assets/js/runtime~main.8ff58aef.js" as="script">
<link rel="preload" href="/assets/js/main.29284908.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_GBuj" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_QM0D themedImage--light_s8Fn"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_QM0D themedImage--dark_Yfiw"></div><b class="navbar__title text--truncate">Wener</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes">笔记</a><a class="navbar__item navbar__link" href="/story">故事</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QEvt"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_VZCd colorModeToggle_s_tJ"><button class="clean-btn toggleButton_ubpP toggleButtonDisabled_Okf9" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Koy5"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_vW2_"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_FlUR"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_Ewau docsWrapper_woa9"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_T0sX" type="button"></button><div class="docPage_e5SA"><aside class="theme-doc-sidebar-container docSidebarContainer_u9sz"><div class="sidebar_yFJp"><nav class="menu thin-scrollbar menu__KhU"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes">笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/ai">AI</a><button aria-label="Toggle the collapsible sidebar category &#x27;AI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/algorithm">算法</a><button aria-label="Toggle the collapsible sidebar category &#x27;算法&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/blockchain">区块链</a><button aria-label="Toggle the collapsible sidebar category &#x27;区块链&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/courses">课程</a><button aria-label="Toggle the collapsible sidebar category &#x27;课程&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/culture">文化</a><button aria-label="Toggle the collapsible sidebar category &#x27;文化&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/db">数据库</a><button aria-label="Toggle the collapsible sidebar category &#x27;数据库&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/design">设计</a><button aria-label="Toggle the collapsible sidebar category &#x27;设计&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/dev">开发</a><button aria-label="Toggle the collapsible sidebar category &#x27;开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/notes/devops">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/devops/concept/bitrate">concept</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/devops/container">容器</a><button aria-label="Toggle the collapsible sidebar category &#x27;容器&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/awesome">DevOps Awesome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/faq">DevOps 常见问题</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/devops/docker">Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/dotenv">dotenv</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/devops/infra">基础设施</a><button aria-label="Toggle the collapsible sidebar category &#x27;基础设施&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/devops/kubernetes">Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/devops/service">服务</a><button aria-label="Toggle the collapsible sidebar category &#x27;服务&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/sre">SRE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/status">Status</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/notes/devops/storage">Storage</a><button aria-label="Toggle the collapsible sidebar category &#x27;Storage&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/devops/storage/block/fc">block</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/notes/devops/storage/encryption">Encryption</a><button aria-label="Toggle the collapsible sidebar category &#x27;Encryption&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes/devops/storage/encryption/luks">LUKS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/devops/storage/fs">Filesystem</a><button aria-label="Toggle the collapsible sidebar category &#x27;Filesystem&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/devops/storage/network/ftp">network</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/storage/glossary">存储相关名词</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/telementry">Telementry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/devops/upgrade">系统升级</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/devops/web">Web</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/devops/xaas/db-schema">xaas</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/economics">经济学</a><button aria-label="Toggle the collapsible sidebar category &#x27;经济学&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/electrical/glossary">electrical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/embedded/awesome">embedded</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/evolve">自我成长</a><button aria-label="Toggle the collapsible sidebar category &#x27;自我成长&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/game">游戏</a><button aria-label="Toggle the collapsible sidebar category &#x27;游戏&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/hardware">硬件</a><button aria-label="Toggle the collapsible sidebar category &#x27;硬件&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/healthcare">健康</a><button aria-label="Toggle the collapsible sidebar category &#x27;健康&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/howto/network/dns-prevent-spoofing">howto</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/java">Java</a><button aria-label="Toggle the collapsible sidebar category &#x27;Java&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/languages">语言</a><button aria-label="Toggle the collapsible sidebar category &#x27;语言&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/mgmt">管理</a><button aria-label="Toggle the collapsible sidebar category &#x27;管理&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/network/application/dns">network</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/ops">运维</a><button aria-label="Toggle the collapsible sidebar category &#x27;运维&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/os">操作系统</a><button aria-label="Toggle the collapsible sidebar category &#x27;操作系统&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/philosophy/faq">philosophy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/photography">摄影</a><button aria-label="Toggle the collapsible sidebar category &#x27;摄影&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/platform">平台</a><button aria-label="Toggle the collapsible sidebar category &#x27;平台&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/queue">Queue</a><button aria-label="Toggle the collapsible sidebar category &#x27;Queue&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/reference/cook/glossary">reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/security">安全</a><button aria-label="Toggle the collapsible sidebar category &#x27;安全&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/service">服务</a><button aria-label="Toggle the collapsible sidebar category &#x27;服务&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/tool">工具</a><button aria-label="Toggle the collapsible sidebar category &#x27;工具&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/voip">VoIP</a><button aria-label="Toggle the collapsible sidebar category &#x27;VoIP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/web">Web</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_jgTA"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_tDu3"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_jz8z"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_CixA"><div class="docItemContainer_zckq"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_FBYY" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_jnrL"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/notes/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/notes/devops/storage"><span itemprop="name">Storage</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/notes/devops/storage/encryption"><span itemprop="name">Encryption</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LUKS</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_MiWk theme-doc-toc-mobile tocMobile_dcUs"><button type="button" class="clean-btn tocCollapsibleButton_Bqtn">On this page</button></div><div class="theme-doc-markdown markdown"><h1>LUKS</h1><ul><li>LUKS - <a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup" target="_blank" rel="noopener noreferrer">Linux Unified Key Setup</a><ul><li><a href="https://en.wikipedia.org/wiki/Dm-crypt" target="_blank" rel="noopener noreferrer">dm-crypt</a></li></ul></li><li><a href="https://www.kernel.org/doc/html/latest/admin-guide/device-mapper/dm-crypt.html" target="_blank" rel="noopener noreferrer">admin-guide/device-mapper/dm-crypt</a></li><li>注意<ul><li>每个块设备密码独立<ul><li>可以考虑使用 keyfile 然后使用 crypttab 挂载</li></ul></li></ul></li><li>加密方案<ul><li>ROOT 加密</li><li>非 ROOT 加密</li></ul></li><li>kernel<ul><li>AlpineLinux 配置方式 <code>cryptroot=UUID=&lt;UUID&gt; cryptdm=cryptroot</code><ul><li>cryptdm - mapper 名字</li><li>实际处理脚本 <a href="https://github.com/alpinelinux/mkinitfs/blob/961726b6aeb8e12176009675f22ed0ffc2b26e14/initramfs-init.in#L443-L482" target="_blank" rel="noopener noreferrer">initramfs-init.in#L443-L482</a></li></ul></li><li><code>cryptdevice=UUID=&lt;UUID&gt;:cryptroot</code></li><li><code>root=UUID={unencrypted} rw cryptdevice=/dev/disk/by-uuid/{encrypted}:root quiet</code>
nomodeset quiet rootfstype=ext4 cryptroot=UUID=3cb7aacf-4975-466b-bb6d-92a13ad60496 cryptdm=rootCrypt cryptdiscards cryptkey</li></ul></li><li>参考<ul><li>ArchLinux <a href="https://wiki.archlinux.org/index.php/Dm-crypt" target="_blank" rel="noopener noreferrer">dm-crypt</a></li><li><a href="https://blog.csdn.net/isclouder/article/details/80731388" target="_blank" rel="noopener noreferrer">qemu luks</a></li></ul></li></ul><div class="language-bash codeBlockContainer_eErV theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_UzAP"><pre tabindex="0" class="prism-code language-bash codeBlock_CYhB thin-scrollbar"><code class="codeBlockLines__AHC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apk </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> cryptsetup util-linux</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># userspace DM 管理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># dmsetup dmstats</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apk </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> device-mapper</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">blkid -t </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">TYPE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">crypto_LUKS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 修改密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksChangeKey /dev/sdb2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uuidgen </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tr</span><span class="token plain"> -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;\n&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> new-key.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksAddKey /dev/sdb2 new-key.txt -d key.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 查看上级设备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dmsetup deps -o devname /dev/mapper/decrypted</span><br></span></code></pre><div class="buttonGroup_tnuT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_tmcC" aria-hidden="true"><svg class="copyButtonIcon_Azkd" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_pt5v" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_KJCY" id="密钥管理">密钥管理<a class="hash-link" href="#密钥管理" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_eErV theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_UzAP"><pre tabindex="0" class="prism-code language-bash codeBlock_CYhB thin-scrollbar"><code class="codeBlockLines__AHC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 所有 slot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksDump /dev/sdb2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 判断 slot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 一个个尝试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> --test-passphrase --key-slot </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> /dev/sda2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 测试密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># --verbose 会显示 key slot 信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> --verbose --test-passphrase /dev/sda2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> --verbose --test-passphrase /dev/sda2 -d key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 移除未知的 key slot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup -v luksKillSlot /dev/sdb2 </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 查看当前的 DM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dmsetup table --showkeys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 导出 master key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksDump --dump-master-key /dev/loop0p2 -d key.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">xxd -r -p masker-key.txt masker-key.bin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 使用 master key 则不需要密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksAddKey /dev/sdb1 --master-key-file </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> masker-key.bin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksAddKey /dev/sdb2 -d key.txt </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> new-key.txt</span><br></span></code></pre><div class="buttonGroup_tnuT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_tmcC" aria-hidden="true"><svg class="copyButtonIcon_Azkd" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_pt5v" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_KJCY" id="root-分区加密安装">Root 分区加密安装<a class="hash-link" href="#root-分区加密安装" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_eErV theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_UzAP"><pre tabindex="0" class="prism-code language-bash codeBlock_CYhB thin-scrollbar"><code class="codeBlockLines__AHC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apk </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> cryptsetup util-linux</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 分区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">dev</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/dev/sdb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">boot_dev</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">${dev}</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">root_dev</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">${dev}</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># +128M - boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># rest  - root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token string" style="color:rgb(195, 232, 141)">CONF</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> </span><span class="token string bash punctuation operator" style="color:rgb(137, 221, 255)">|</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> sfdisk --wipe always </span><span class="token string bash punctuation variable" style="color:rgb(191, 199, 213)">${dev}</span><span class="token string" style="color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">label: dos</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">unit: sectors</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">sector-size: 512</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="display:inline-block;color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">/dev/sdb1 : size=+128M, type=83, bootable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">/dev/sdb2 : type=83</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">CONF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ======</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 格式化 - 设置密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 设置密码文件 - 或者使用 cryptsetup 生成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uuidgen </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> key.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">yes</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> cryptsetup -y -v luksFormat </span><span class="token variable" style="color:rgb(191, 199, 213)">$root_dev</span><span class="token plain"> -d key.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 打开 - 挂载为 mapper</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$root_dev</span><span class="token plain"> cryptroot -d key.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 格式化 fs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkfs.ext4 /dev/mapper/cryptroot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 挂载到目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mount</span><span class="token plain"> /dev/mapper/cryptroot /mnt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 卸载再次挂载确保生效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">umount</span><span class="token plain"> /mnt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup close cryptroot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># format bootfs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkfs.ext4 </span><span class="token variable" style="color:rgb(191, 199, 213)">$boot_dev</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$root_dev</span><span class="token plain"> cryptroot -d key.txt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mount</span><span class="token plain"> /dev/mapper/cryptroot /mnt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> -p /mnt/boot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mount</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$boot_dev</span><span class="token plain"> /mnt/boot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># install system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">setup-disk -m sys -o sysfs.apkvol.tar.gz -s </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> -v -k virt $/mnt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apk --root /mnt </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> syslinux</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># setup luks support</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apk --root /mnt </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> cryptsetup util-linux</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;features=&quot;ata base ide scsi usb virtio ext4 cryptsetup cryptkey&quot;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> /mnt/etc/mkinitfs/mkinitfs.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkinitfs -c /mnt/etc/mkinitfs/mkinitfs.conf -b /mnt/ </span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable function" style="color:rgb(130, 170, 255)">ls</span><span class="token variable" style="color:rgb(191, 199, 213)"> /mnt/lib/modules/</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># add cryptroot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># cryptroot=UUID=&lt;UUID&gt; cryptdm=cryptroot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># other options - https://github.com/alpinelinux/mkinitfs/blob/961726b6aeb8e12176009675f22ed0ffc2b26e14/initramfs-init.in#L443-L482</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sed</span><span class="token plain"> -i -r </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;s/^(default_kernel_opts)=</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">([^</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">]*)</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">/</span><span class="token string entity" style="color:rgb(195, 232, 141)">\1</span><span class="token string" style="color:rgb(195, 232, 141)">=</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string entity" style="color:rgb(195, 232, 141)">\2</span><span class="token string" style="color:rgb(195, 232, 141)"> cryptroot=UUID=</span><span class="token string variable" style="color:rgb(191, 199, 213)">$(</span><span class="token string variable" style="color:rgb(191, 199, 213)">blkid $</span><span class="token string variable punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string variable" style="color:rgb(191, 199, 213)">ROOT_DEV</span><span class="token string variable punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string variable" style="color:rgb(191, 199, 213)"> -o value </span><span class="token string variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token string variable" style="color:rgb(191, 199, 213)"> </span><span class="token string variable function" style="color:rgb(130, 170, 255)">head</span><span class="token string variable" style="color:rgb(191, 199, 213)"> -n </span><span class="token string variable number" style="color:rgb(247, 140, 108)">1</span><span class="token string variable" style="color:rgb(191, 199, 213)">)</span><span class="token string" style="color:rgb(195, 232, 141)"> cryptdm=cryptroot</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">/&quot;</span><span class="token plain"> /mnt/etc/update-extlinux.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">chroot</span><span class="token plain"> /mnt update-extlinux</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># done - close</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">umount</span><span class="token plain"> -R /mnt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup close cryptroot</span><br></span></code></pre><div class="buttonGroup_tnuT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_tmcC" aria-hidden="true"><svg class="copyButtonIcon_Azkd" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_pt5v" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>FAQ</h1><h2 class="anchor anchorWithStickyNavbar_KJCY" id="warning-locking-directory-runcryptsetup-is-missing">WARNING: Locking directory /run/cryptsetup is missing!<a class="hash-link" href="#warning-locking-directory-runcryptsetup-is-missing" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_KJCY" id="luks-vs-luks2">LUKS vs LUKS2<a class="hash-link" href="#luks-vs-luks2" title="Direct link to heading">​</a></h2><ul><li><p>LUKS2</p><ul><li>Full disk authenticated (FDA) 提供数据 confidentiality 和 data integrity protection<ul><li>Integrity cannot prevent a replay attack</li></ul></li><li><code>cryptsetup luksFormat --type luks2 &lt;device&gt;</code></li><li>新的格式，与 LUKS1 不兼容</li><li>sector 级别完整性校验 - Linux 4.12 - dm-integrity<ul><li><code>integritysetup</code> - 命令</li></ul></li><li>veritysetup 支持设备 FEC（Forward Error Correction） - 安装 Linux 4.5 已有在使用</li><li>sector 最大支持 4096<ul><li>确保硬件使用相同大小，如果硬件 sector 更小可能导致数据损坏 - 部分 sector 写入</li></ul></li><li>使用 Argon2i 和 Argon2id 作为 PBKDF<ul><li>memory-hard - 增加内存使用 - 是的 GPU 攻击更难 - 因为 GPU 内存成本高</li><li>赢得 Password Hashing Competition 的算法</li></ul></li><li>默认 Argon2i (data independent variant) - 内存 cost 128MB，时间 cost 800ms，并行取决于 CPU &lt;= 4<ul><li>单独配置 --pbkdf, --pbkdf-memory, --pbkdf-parallel, --iter-time</li><li>迭代周期 --pbkdf-force-iterations</li></ul></li><li>使用 Token 独立抽象 cryptsetup 硬件部分</li><li><code>--persistent</code> - 持久打开，之后打开不需要密钥</li><li>Linux kernel keyring<ul><li>避免每次 ioctl 发送密钥</li><li>自动解锁 - 例如使用 TMP 存储用户密钥</li><li><a href="https://www.man7.org/linux/man-pages/man7/keyrings.7.html" target="_blank" rel="noopener noreferrer">keyrings.7</a><ul><li><code>apk add keyutils</code></li></ul></li><li><a href="https://www.kernel.org/doc/Documentation/security/keys.txt" target="_blank" rel="noopener noreferrer">KERNEL KEY RETENTION SERVICE</a></li></ul></li><li>Keyslot priorities<ul><li>normal,prefer,ignore</li><li><code>cryptsetup config &lt;device&gt; --key-slot 1 --priority prefer</code></li></ul></li><li>LUKS2 label and subsystem<ul><li><code>cryptsetup config &lt;device&gt; --label my_device --subsystem &quot;&quot;</code></li></ul></li><li>支持转换<ul><li><code>cryptsetup convert &lt;device&gt; --type luks2</code></li><li><code>cryptsetup convert &lt;device&gt; --type luks1</code></li><li>验证 <code>cryptsetup luksDump &lt;device&gt;</code></li></ul></li></ul></li><li><p>LUKS1</p><ul><li>Full disk encryption (FDE)</li><li>保留长度加密 - length-preserving - encryption - 明文密文长度相同<ul><li>提供数据可信 （confidentiality），但不保证数据完整性</li></ul></li><li>使用 PBKDF (Password-Based Key Derivation Function) 增加攻击者耗时</li><li>PBKDF2 增加迭代次数<ul><li>目前 GPU 已经可以并行执行</li></ul></li></ul></li><li><p>参考</p><ul><li><a href="https://gitlab.com/cryptsetup/cryptsetup/blob/master/docs/v2.0.0-ReleaseNotes" target="_blank" rel="noopener noreferrer">Cryptsetup 2.0.0 Release Notes</a></li></ul></li></ul><div class="language-bash codeBlockContainer_eErV theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_UzAP"><pre tabindex="0" class="prism-code language-bash codeBlock_CYhB thin-scrollbar"><code class="codeBlockLines__AHC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># aes-xts-plain64 + hmac-sha256 / hmac-sha512 作为 authentication tag - IEEE 1619.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># (Common FDE mode + independent authentication tag. Authentication key for HMAC is independently generated. This mode is very slow.)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksFormat --type luks2 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">device</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --cipher aes-xts-plain64 --integrity hmac-sha256</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># aes-gcm-random (native AEAD mode) - IEEE 1619.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 不要用于生产 - GCM 使用 96-bit nonce - GCM 硬件支持好 - AES-NI - 可以用于性能测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksFormat --type luks2 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">device</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --cipher aes-gcm-random --integrity aead</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ChaCha20 with Poly1305 authenticator (according to RFC7539)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup luksFormat --type luks2 </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">device</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --cipher chacha20-random --integrity poly1305</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># LUKS2 Token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 添加 Token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup token </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> --key-description </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my_token&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">device</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 添加密码到 keyring user sessing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -n </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">passphrase</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> keyctl padd user my_token @u</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 如果找到了密码则自动会打开</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">device</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup_tnuT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_tmcC" aria-hidden="true"><svg class="copyButtonIcon_Azkd" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_pt5v" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_KJCY" id="调整分区大小">调整分区大小<a class="hash-link" href="#调整分区大小" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_eErV theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_UzAP"><pre tabindex="0" class="prism-code language-bash codeBlock_CYhB thin-scrollbar"><code class="codeBlockLines__AHC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apk </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> util-linux</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 确保 luks 分区已经填满</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;d\n\nn\n\n\n\n\n\np\nw\n&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fdisk</span><span class="token plain"> /dev/sdb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 调整大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> /dev/sdb2 root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup resize root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 扩展文件系统</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apk </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> e2fsprogs-extra</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resize2fs /dev/mapper/root</span><br></span></code></pre><div class="buttonGroup_tnuT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_tmcC" aria-hidden="true"><svg class="copyButtonIcon_Azkd" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_pt5v" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_KJCY" id="help">help<a class="hash-link" href="#help" title="Direct link to heading">​</a></h2><table><thead><tr><th>action</th><th>desc</th></tr></thead><tbody><tr><td>open <code>&lt;device&gt; [--type &lt;type&gt;][&lt;name&gt;]</code></td><td>打开设备，映射为 <code>&lt;name&gt;</code></td></tr><tr><td>close <code>&lt;name&gt;</code></td><td>关闭设备，移除映射</td></tr><tr><td>resize <code>&lt;name&gt;</code></td><td>resize active device</td></tr><tr><td>status <code>&lt;name&gt;</code></td><td>show device status</td></tr><tr><td>benchmark <code>[--cipher &lt;cipher&gt;]</code></td><td>压测编码解码性能</td></tr><tr><td>repair <code>&lt;device&gt;</code></td><td>修复元数据</td></tr><tr><td>reencrypt <code>&lt;device&gt;</code></td><td>LUKS2 从新加密</td></tr><tr><td>erase <code>&lt;device&gt;</code></td><td>擦除所有 key，移除加密密钥</td></tr><tr><td>convert <code>&lt;device&gt;</code></td><td>LUKS、LUKS2 格式转换</td></tr><tr><td>config <code>&lt;device&gt;</code></td><td>LUKS2 配置</td></tr><tr><td>luksFormat <code>&lt;device&gt; [&lt;new key file&gt;]</code></td><td>LUKS 格式化</td></tr><tr><td>luksAddKey <code>&lt;device&gt; [&lt;new key file&gt;]</code></td><td>添加密钥</td></tr><tr><td>luksRemoveKey <code>&lt;device&gt; [&lt;key file&gt;]</code></td><td>移除密钥</td></tr><tr><td>luksChangeKey <code>&lt;device&gt; [&lt;key file&gt;]</code></td><td>修改密钥</td></tr><tr><td>luksConvertKey <code>&lt;device&gt; [&lt;key file&gt;]</code></td><td>修改密钥为新的 pbkdf 参数</td></tr><tr><td>luksKillSlot <code>&lt;device&gt; &lt;key slot&gt;</code></td><td>移除 key</td></tr><tr><td>luksUUID <code>&lt;device&gt;</code></td><td>UUID</td></tr><tr><td>isLuks <code>&lt;device&gt;</code></td><td>检测 luks 分区头</td></tr><tr><td>luksDump <code>&lt;device&gt;</code></td><td>分区信息</td></tr><tr><td>tcryptDump <code>&lt;device&gt;</code></td><td>TCRYPT 信息</td></tr><tr><td>bitlkDump <code>&lt;device&gt;</code></td><td>BITLK 信息</td></tr><tr><td>luksSuspend <code>&lt;device&gt;</code></td><td>停止 LUKS 设备，移除 key，终止所有 IO</td></tr><tr><td>luksResume <code>&lt;device&gt;</code></td><td>恢复</td></tr><tr><td>luksHeaderBackup <code>&lt;device&gt;</code></td><td>备份头</td></tr><tr><td>luksHeaderRestore <code>&lt;device&gt;</code></td><td>恢复头</td></tr><tr><td>token `&lt;add</td><td>remove</td></tr></tbody></table><div class="codeBlockContainer_eErV theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_UzAP"><pre tabindex="0" class="prism-code language-text codeBlock_CYhB thin-scrollbar"><code class="codeBlockLines__AHC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cryptsetup --help</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cryptsetup 2.3.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Usage: cryptsetup [OPTION...] &lt;action&gt; &lt;action-specific&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -v, --verbose                         Shows more detailed error messages</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --debug                           Show debug messages</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --debug-json                      Show debug messages including JSON metadata</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -c, --cipher=STRING                   The cipher used to encrypt the disk (see /proc/crypto)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -h, --hash=STRING                     The hash used to create the encryption key from the passphrase</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -y, --verify-passphrase               Verifies the passphrase by asking for it twice</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -d, --key-file=STRING                 Read the key from a file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --master-key-file=STRING          Read the volume (master) key from file.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --dump-master-key                 Dump volume (master) key instead of keyslots info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -s, --key-size=BITS                   The size of the encryption key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -l, --keyfile-size=bytes              Limits the read from keyfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --keyfile-offset=bytes            Number of bytes to skip in keyfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --new-keyfile-size=bytes          Limits the read from newly added keyfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --new-keyfile-offset=bytes        Number of bytes to skip in newly added keyfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -S, --key-slot=INT                    Slot number for new key (default is first free)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -b, --size=SECTORS                    The size of the device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --device-size=bytes               Use only specified device size (ignore rest of device). DANGEROUS!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -o, --offset=SECTORS                  The start offset in the backend device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -p, --skip=SECTORS                    How many sectors of the encrypted data to skip at the beginning</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -r, --readonly                        Create a readonly mapping</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -q, --batch-mode                      Do not ask for confirmation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -t, --timeout=secs                    Timeout for interactive passphrase prompt (in seconds)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --progress-frequency=secs         Progress line update (in seconds)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -T, --tries=INT                       How often the input of the passphrase can be retried</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --align-payload=SECTORS           Align payload at &lt;n&gt; sector boundaries - for luksFormat</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --header-backup-file=STRING       File with LUKS header and keyslots backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --use-random                      Use /dev/random for generating volume key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --use-urandom                     Use /dev/urandom for generating volume key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --shared                          Share device with another non-overlapping crypt segment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --uuid=STRING                     UUID for device to use</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --allow-discards                  Allow discards (aka TRIM) requests for device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --header=STRING                   Device or file with separated LUKS header</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --test-passphrase                 Do not activate device, just check passphrase</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --tcrypt-hidden                   Use hidden header (hidden TCRYPT device)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --tcrypt-system                   Device is system TCRYPT drive (with bootloader)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --tcrypt-backup                   Use backup (secondary) TCRYPT header</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --veracrypt                       Scan also for VeraCrypt compatible device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --veracrypt-pim=INT               Personal Iteration Multiplier for VeraCrypt compatible device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --veracrypt-query-pim             Query Personal Iteration Multiplier for VeraCrypt compatible device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -M, --type=STRING                     Type of device metadata: luks, luks1, luks2, plain, loopaes, tcrypt,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                        bitlk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --force-password                  Disable password quality check (if enabled)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --perf-same_cpu_crypt             Use dm-crypt same_cpu_crypt performance compatibility option</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --perf-submit_from_crypt_cpus     Use dm-crypt submit_from_crypt_cpus performance compatibility option</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --deferred                        Device removal is deferred until the last user closes it</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --serialize-memory-hard-pbkdf     Use global lock to serialize memory hard PBKDF (OOM workaround)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -i, --iter-time=msecs                 PBKDF iteration time for LUKS (in ms)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --pbkdf=STRING                    PBKDF algorithm (for LUKS2): argon2i, argon2id, pbkdf2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --pbkdf-memory=kilobytes          PBKDF memory cost limit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --pbkdf-parallel=threads          PBKDF parallel cost</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --pbkdf-force-iterations=LONG     PBKDF iterations cost (forced, disables benchmark)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --priority=STRING                 Keyslot priority: ignore, normal, prefer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --disable-locks                   Disable locking of on-disk metadata</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --disable-keyring                 Disable loading volume keys via kernel keyring</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -I, --integrity=STRING                Data integrity algorithm (LUKS2 only)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --integrity-no-journal            Disable journal for integrity device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --integrity-no-wipe               Do not wipe device after format</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --integrity-legacy-padding        Use inefficient legacy padding (old kernels)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --token-only                      Do not ask for passphrase if activation by token fails</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --token-id=INT                    Token number (default: any)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --key-description=STRING          Key description</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --sector-size=INT                 Encryption sector size (default: 512 bytes)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --persistent                      Set activation flags persistent for device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --label=STRING                    Set label for the LUKS2 device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --subsystem=STRING                Set subsystem label for the LUKS2 device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --unbound                         Create or dump unbound (no assigned data segment) LUKS2 keyslot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --json-file=STRING                Read or write the json from or to a file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --luks2-metadata-size=bytes       LUKS2 header metadata area size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --luks2-keyslots-size=bytes       LUKS2 header keyslots area size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --refresh                         Refresh (reactivate) device with new parameters</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --keyslot-key-size=BITS           LUKS2 keyslot: The size of the encryption key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --keyslot-cipher=STRING           LUKS2 keyslot: The cipher used for keyslot encryption</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --encrypt                         Encrypt LUKS2 device (in-place encryption).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --decrypt                         Decrypt LUKS2 device (remove encryption).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --init-only                       Initialize LUKS2 reencryption in metadata only.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --resume-only                     Resume initialized LUKS2 reencryption only.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --reduce-device-size=bytes        Reduce data device size (move data offset). DANGEROUS!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --hotzone-size=bytes              Maximal reencryption hotzone size.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --resilience=STRING               Reencryption hotzone resilience type (checksum,journal,none)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --resilience-hash=STRING          Reencryption hotzone checksums hash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --active-name=STRING              Override device autodetection of dm device to be reencrypted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Help options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -?, --help                            Show this help message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      --usage                           Display brief usage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -V, --version                         Print package version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;action&gt; is one of:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    open &lt;device&gt; [--type &lt;type&gt;] [&lt;name&gt;] - open device as &lt;name&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    close &lt;name&gt; - close device (remove mapping)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    resize &lt;name&gt; - resize active device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    status &lt;name&gt; - show device status</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    benchmark [--cipher &lt;cipher&gt;] - benchmark cipher</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    repair &lt;device&gt; - try to repair on-disk metadata</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reencrypt &lt;device&gt; - reencrypt LUKS2 device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    erase &lt;device&gt; - erase all keyslots (remove encryption key)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    convert &lt;device&gt; - convert LUKS from/to LUKS2 format</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config &lt;device&gt; - set permanent configuration options for LUKS2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksFormat &lt;device&gt; [&lt;new key file&gt;] - formats a LUKS device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksAddKey &lt;device&gt; [&lt;new key file&gt;] - add key to LUKS device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksRemoveKey &lt;device&gt; [&lt;key file&gt;] - removes supplied key or key file from LUKS device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksChangeKey &lt;device&gt; [&lt;key file&gt;] - changes supplied key or key file of LUKS device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksConvertKey &lt;device&gt; [&lt;key file&gt;] - converts a key to new pbkdf parameters</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksKillSlot &lt;device&gt; &lt;key slot&gt; - wipes key with number &lt;key slot&gt; from LUKS device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksUUID &lt;device&gt; - print UUID of LUKS device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    isLuks &lt;device&gt; - tests &lt;device&gt; for LUKS partition header</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksDump &lt;device&gt; - dump LUKS partition information</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcryptDump &lt;device&gt; - dump TCRYPT device information</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bitlkDump &lt;device&gt; - dump BITLK device information</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksSuspend &lt;device&gt; - Suspend LUKS device and wipe key (all IOs are frozen)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksResume &lt;device&gt; - Resume suspended LUKS device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksHeaderBackup &lt;device&gt; - Backup LUKS device header and keyslots</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    luksHeaderRestore &lt;device&gt; - Restore LUKS device header and keyslots</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    token &lt;add|remove|import|export&gt; &lt;device&gt; - Manipulate LUKS2 tokens</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You can also use old &lt;action&gt; syntax aliases:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    open: create (plainOpen), luksOpen, loopaesOpen, tcryptOpen, bitlkOpen</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    close: remove (plainClose), luksClose, loopaesClose, tcryptClose, bitlkClose</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;name&gt; is the device to create under /dev/mapper</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;device&gt; is the encrypted device</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;key slot&gt; is the LUKS key slot number to modify</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;key file&gt; optional key file for the new key for luksAddKey action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Default compiled-in metadata format is LUKS2 (for luksFormat action).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Default compiled-in key and passphrase parameters:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Maximum keyfile size: 8192kB, Maximum interactive passphrase length 512 (characters)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Default PBKDF for LUKS1: pbkdf2, iteration time: 2000 (ms)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Default PBKDF for LUKS2: argon2i</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Iteration time: 2000, Memory required: 1048576kB, Parallel threads: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Default compiled-in device cipher parameters:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    loop-AES: aes, Key 256 bits</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    plain: aes-cbc-essiv:sha256, Key: 256 bits, Password hashing: ripemd160</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LUKS: aes-xts-plain64, Key: 256 bits, LUKS header hashing: sha256, RNG: /dev/urandom</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LUKS: Default keysize with XTS mode (two internal keys) will be doubled.</span><br></span></code></pre><div class="buttonGroup_tnuT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_tmcC" aria-hidden="true"><svg class="copyButtonIcon_Azkd" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_pt5v" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wenerme/wener/edit/master/notes/../notes/devops/storage/encryption/luks.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_BDD2" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_qlge"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-08-31T06:27:49.000Z">Aug 31, 2023</time></b> by <b>wener</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes/devops/storage/encryption"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Encryption</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes/devops/storage/fs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Filesystem</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_pluA thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#密钥管理" class="table-of-contents__link toc-highlight">密钥管理</a></li><li><a href="#root-分区加密安装" class="table-of-contents__link toc-highlight">Root 分区加密安装</a></li><li><a href="#warning-locking-directory-runcryptsetup-is-missing" class="table-of-contents__link toc-highlight">WARNING: Locking directory /run/cryptsetup is missing!</a></li><li><a href="#luks-vs-luks2" class="table-of-contents__link toc-highlight">LUKS vs LUKS2</a></li><li><a href="#调整分区大小" class="table-of-contents__link toc-highlight">调整分区大小</a></li><li><a href="#help" class="table-of-contents__link toc-highlight">help</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">笔记</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/notes/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/os/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip">VoIP</a></li></ul></div><div class="col footer__col"><div class="footer__title">Projects</div><ul class="footer__items clean-list"><li class="footer__item">
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              -
              <a class="footer__link-item" href="https://github.com/wenerme/wener/actions" title="wenerme/wener - ci">
              <img style="vertical-align: middle;opacity: .4;" src="https://github.com/wenerme/wener/workflows/Build/badge.svg">
              </a>
              </div>
              </li><li class="footer__item"><a href="https://apis.wener.me" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wener&#x27;s Apis<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QEvt"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/story">Blog</a></li><li class="footer__item"><a href="https://github.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/wener-logo.svg" alt="Wener Site" class="themedImage_QM0D themedImage--light_s8Fn footer__logo"><img src="/img/wener-logo.svg" alt="Wener Site" class="themedImage_QM0D themedImage--dark_Yfiw footer__logo"></div><div class="footer__copyright">Copyright © 1992-2023 Wener - <img alt="cc-by-sa-4.0" src="https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg"> - Build @2023-09-11 11:24</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8ff58aef.js"></script>
<script src="/assets/js/main.29284908.js"></script>
</body>
</html>