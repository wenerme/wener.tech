<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Wener Live & Life" href="/opensearch.xml"><title data-react-helmet="true">私有虚拟网络常见问题 | Wener Live &amp; Life</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="私有虚拟网络常见问题 | Wener Live &amp; Life"><meta data-react-helmet="true" name="description" content="私有虚拟网络常见问题"><meta data-react-helmet="true" property="og:description" content="私有虚拟网络常见问题"><meta data-react-helmet="true" property="og:url" content="https://wener.me/notes/service/network/vpn-faq"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://wener.me/notes/service/network/vpn-faq"><link rel="stylesheet" href="/styles.98d7e791.css">
<link rel="preload" href="/styles.db3b5a0e.js" as="script">
<link rel="preload" href="/runtime~main.87f26d14.js" as="script">
<link rel="preload" href="/main.789b3811.js" as="script">
<link rel="preload" href="/1.3005fa76.js" as="script">
<link rel="preload" href="/2.2da49506.js" as="script">
<link rel="preload" href="/3.04b4fc33.js" as="script">
<link rel="preload" href="/1be78505.25c0fe16.js" as="script">
<link rel="preload" href="/690.c6d1a65d.js" as="script">
<link rel="preload" href="/935f2afb.afdd9a39.js" as="script">
<link rel="preload" href="/17896441.5a9d5f62.js" as="script">
<link rel="preload" href="/2c32dad8.444e9c24.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong class="navbar__title">Wener</strong></a><a class="navbar__item navbar__link" href="/notes/java/java">笔记</a><a class="navbar__item navbar__link" href="/story">故事</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a><a class="navbar__item navbar__link" href="/notes/tool/network/ip-lookup">工具</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/wener-logo-head.svg" alt="Wener Logo"><strong class="navbar__title">Wener</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/java">笔记</a></li><li class="menu__list-item"><a class="menu__link" href="/story">故事</a></li><li class="menu__list-item"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/tool/network/ip-lookup">工具</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">私有虚拟网络常见问题</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="私有虚拟网络常见问题"></a>私有虚拟网络常见问题<a aria-hidden="true" tabindex="-1" class="hash-link" href="#私有虚拟网络常见问题" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="socks-vs-http-vs-https"></a>SOCKS vs HTTP vs HTTPS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#socks-vs-http-vs-https" title="Direct link to heading">#</a></h2><ul><li>HTTP<ul><li>支持最广泛的协议</li><li>基于 HTTP 的 CONNECT 方法 - 7 层协议</li><li>wget 只支持 http</li><li>一般支持 Basic 鉴权</li><li>请求是明文感知更多细节</li><li>支持复杂转发逻辑 - privoxy<ul><li>路径, 域名, 头</li><li>更加智能的转发</li></ul></li><li>可以配合缓存服务使用<ul><li>例如 squid - 需结合 tls 使用</li></ul></li><li>可以做 TCP 通道</li></ul></li><li>SOCKS<ul><li>支持程度仅次于 HTTP</li><li>TCP 协议 - 5 层协议</li><li>支持 UDP</li><li>最容易的协议 - <code>ssh -d 1080</code></li><li>基于握手进行协商，一个地址一个端口进行映射</li><li>DNS 在远程进行解析</li></ul></li><li>HTTPS<ul><li>使用少</li><li>HTTP + TLS</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="tinc-vs-zerotier-vs-wireguard-vs-ipsec-vs-softether"></a>Tinc vs ZeroTier vs Wireguard vs IPSec vs SoftEther<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tinc-vs-zerotier-vs-wireguard-vs-ipsec-vs-softether" title="Direct link to heading">#</a></h2><ul><li>共同点<ul><li>P2P 协议</li><li>支持加密</li></ul></li><li>Tinc 完全中心化，无控制器，网络连接性会更好，tinc 1.1pre 使用非常简单<ul><li>开源的 Android 和 iOS 应用，但未维护了</li><li>支持 UDP</li><li>支持 Switch 模式 - 2 层网络 - MAC 寻址</li><li>默认 Router 模式 - TCP/IP 寻址</li><li>单线程 - 性能有一定瓶颈 - 例如 1Gb 网卡可能只能跑满 300-600 Mb</li><li>用户空间</li><li>安装使用配置方便 - 1.1 版本</li><li>实现简单 LOC ~ 3k</li></ul></li><li>ZeroTier 有中心控制器，能够进行验证授权，使用简单，有管理接口和页面<ul><li>闭源 Android 和 iOS 应用 - 可在应用商店安装</li><li>对于 SelfHost 中心节点不友好 - 简单配置是基于使用 ZeroTier 的服务之上</li><li>QoS 控制</li><li>基于 TCP</li><li>支持文本配置路由</li><li>网络连接性 &lt; TINC、配置性 &gt; TINC</li></ul></li><li>Wireguard<ul><li>目前没有比较好的 mesh 方案 - 需要所有节点配置</li><li>节点不能自动发现</li><li>需要节点之间直连 - 不能通过中继访问</li><li>只支持 Layer 3 - 不能 DHCP 或桥接 - 使用 IP 寻址</li><li>使用 UDP 通信</li><li>替代 OpenVPN 和 IPsec</li><li>实现简单 LOC ~ 4k</li><li>开源可用的 Android 和 iOS 应用</li><li>客户端支持广泛</li><li>Linux 内核支持</li></ul></li><li>IPSec<ul><li>开源成熟的标准</li><li>客户端使用相对没那么友好</li><li>服务端初次配置相对复杂</li><li>高性能 - 如果只在服务端使用需要很高的性能则优先选择 IPSec - 1Gb 网络基本能达到 900+Mb</li><li>Android 和 iOS 原生支持</li></ul></li><li><a href="https://en.wikipedia.org/wiki/SoftEther_VPN" target="_blank" rel="noopener noreferrer">SoftEther</a><ul><li>支持多路负载</li><li>权限控制</li></ul></li></ul><p><strong>性能对比</strong></p><table><thead><tr><th>iperf3\10s</th><th>Transfer</th><th>Bitrate</th></tr></thead><tbody><tr><td>Native</td><td>1.10 GBytes</td><td>943 Mbits/sec</td></tr><tr><td>TINC</td><td>385 MBytes</td><td>323 Mbits/sec</td></tr><tr><td>WireGuard</td><td>1.05 GBytes</td><td>898 Mbits/sec</td></tr></tbody></table><blockquote><p>TINC 最弱 - 因为服务器单核较弱 - 单核 CPU 100%
Intel(R) Xeon(R) CPU E5-2651 v2 @ 1.80GHz</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="tinc-vs-zerotier"></a>Tinc vs ZeroTier<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tinc-vs-zerotier" title="Direct link to heading">#</a></h2><ul><li>相同点<ul><li>都是 Mesh 网络</li></ul></li><li>Tinc<ul><li>无中心节点，但有核心 meta 节点<ul><li>保证链接，不负责 IP 分配 - 可利用 DHCP 控制</li><li>host 支持配置 subnet - 路由</li><li>无法控制权限，可通过 meta 控制节点密钥来控制接入</li></ul></li><li>需要 meta 节点能被其他节点直接访问<ul><li>基本等同于需要公网 IP</li></ul></li><li>连接性好<ul><li>因为是直接配置 meta 地址，所以很容易判断</li></ul></li><li>问题易于排查，透明 IP</li><li>稳定性问题<ul><li>1.17 出现 crash 问题 - 通过 openrc 设置自动重启解决</li></ul></li></ul></li><li>ZeroTier<ul><li>依赖 ZT 控制器 - 可自行维护，但发现依赖 ZT 网络<ul><li>IP 分配</li><li>路由下发</li><li>权限控制</li></ul></li><li>连接性弱<ul><li>依赖 ZT 启动慢 - 特别在国内</li><li>可能无法请求到配置</li><li>无法直接提供中转发现节点</li><li>Nat 穿透性弱于 Tinc</li></ul></li><li>问题难排查<ul><li>每个节点有唯一 ID</li><li>每个网络有唯一 ID</li><li>信息不透明</li></ul></li><li>稳定性问题<ul><li>偶现 daemon 异常 cpu 100% - 一段时间后恢复或重启 ZeroTier One</li><li>出现节点一直处于 REQUESTING_CONFIGURATION 状态<ul><li><strong>目前无解</strong></li></ul></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="strongswan-vs-openswan-vs-libreswan-vs-freeswan"></a>StrongSwan vs Openswan vs Libreswan vs Freeswan<a aria-hidden="true" tabindex="-1" class="hash-link" href="#strongswan-vs-openswan-vs-libreswan-vs-freeswan" title="Direct link to heading">#</a></h2><ul><li>FreeS/WAN</li><li>Libreswan 即 Openswan<ul><li>2003 fork freeswan 命名为 openswan</li><li>2011 被强制要求更名 - 命名为 libreswan</li><li>支持更多<a href="https://libreswan.org/wiki/OCF_Hardware_crypto_acceleration" target="_blank" rel="noopener noreferrer">硬件加密</a> - 可能需要内核补丁</li></ul></li><li>StrongSwan<ul><li>相较 Libreswan 做了更多的提升和文档</li><li>支持 EAP - 更易于集成</li><li>支持<a href="https://wiki.strongswan.org/projects/strongswan/wiki/HighAvailability" target="_blank" rel="noopener noreferrer">集群</a></li><li><strong>不支持</strong> <a href="https://wiki.strongswan.org/issues/2160" target="_blank" rel="noopener noreferrer">OE</a></li></ul></li></ul><blockquote><p><em>参考</em></p><ol><li><a href="https://libreswan.org/wiki/History" target="_blank" rel="noopener noreferrer">Libreswan History</a></li><li><a href="https://serverfault.com/a/655752/190601" target="_blank" rel="noopener noreferrer">strongswan vs openswan</a></li></ol></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="site-to-site站点对站点-vpn"></a>Site to Site/站点对站点 VPN<a aria-hidden="true" tabindex="-1" class="hash-link" href="#site-to-site站点对站点-vpn" title="Direct link to heading">#</a></h2><ul><li>连接两个子网</li><li>连接地域上分离的两个网络</li><li>例如<ul><li>开发人员 -VPN-&gt; Site to Site VPN --&gt; 阿里云内网</li></ul></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wenerme/wener/edit/master/notes/service/network/vpn-faq.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#socks-vs-http-vs-https" class="table-of-contents__link">SOCKS vs HTTP vs HTTPS</a></li><li><a href="#tinc-vs-zerotier-vs-wireguard-vs-ipsec-vs-softether" class="table-of-contents__link">Tinc vs ZeroTier vs Wireguard vs IPSec vs SoftEther</a></li><li><a href="#tinc-vs-zerotier" class="table-of-contents__link">Tinc vs ZeroTier</a></li><li><a href="#strongswan-vs-openswan-vs-libreswan-vs-freeswan" class="table-of-contents__link">StrongSwan vs Openswan vs Libreswan vs Freeswan</a></li><li><a href="#site-to-site站点对站点-vpn" class="table-of-contents__link">Site to Site/站点对站点 VPN</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">笔记</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/notes/java/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/os/alpine/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes/kubernetes">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip/voip">VoIP</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Projects</h4><ul class="footer__items"><li class="footer__item">
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              - <a class="footer__link-item" href="https://github.com/wenerme/wener/actions" title="wenerme/wener - ci">
                <img style="vertical-align: middle;opacity: .4;" src="https://github.com/wenerme/wener/workflows/Build/badge.svg">
                </a>
              </div>
              </li><li class="footer__item"><a href="https://apis.wener.me" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wener&#x27;s Apis</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/story">Blog</a></li><li class="footer__item"><a href="https://github.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Wener Site" src="/img/wener-logo.svg"></div><div>Copyright © 1992-2021 Wener - 构建时间 2021-03-03 15:43</div></div></div></footer></div>
<script src="/styles.db3b5a0e.js"></script>
<script src="/runtime~main.87f26d14.js"></script>
<script src="/main.789b3811.js"></script>
<script src="/1.3005fa76.js"></script>
<script src="/2.2da49506.js"></script>
<script src="/3.04b4fc33.js"></script>
<script src="/1be78505.25c0fe16.js"></script>
<script src="/690.c6d1a65d.js"></script>
<script src="/935f2afb.afdd9a39.js"></script>
<script src="/17896441.5a9d5f62.js"></script>
<script src="/2c32dad8.444e9c24.js"></script>
</body>
</html>