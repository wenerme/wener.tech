<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-service/api/grpc">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/story/rss.xml" title="Wener Live &amp; Life RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/story/atom.xml" title="Wener Live &amp; Life Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Wener Live &amp; Life" href="/opensearch.xml">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css"><title data-rh="true">gRPC | Wener Live &amp; Life</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wener.me/notes/service/api/grpc"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="gRPC | Wener Live &amp; Life"><meta data-rh="true" name="description" content="- gRPC"><meta data-rh="true" property="og:description" content="- gRPC"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wener.me/notes/service/api/grpc"><link data-rh="true" rel="alternate" href="https://wener.me/notes/service/api/grpc" hreflang="en"><link data-rh="true" rel="alternate" href="https://wener.me/notes/service/api/grpc" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://37P8DMWBKF-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a5b87add.css">
<link rel="preload" href="/assets/js/runtime~main.07b4d16f.js" as="script">
<link rel="preload" href="/assets/js/main.92dfd685.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_WawS">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_sWQn themedImage--light_HlbN"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_sWQn themedImage--dark__4Lo"></div><b class="navbar__title text--truncate">Wener</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes">笔记</a><a class="navbar__item navbar__link" href="/story">故事</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_pUOn"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_N_jk colorModeToggle_wwB5"><button class="clean-btn toggleButton_gcuK toggleButtonDisabled_AJhd" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Eiwc"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_a3UO"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_Ymm7"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_uXRe docsWrapper_AGYY"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_aXSw" type="button"></button><div class="docPage_Q_rn"><aside class="theme-doc-sidebar-container docSidebarContainer_GlFK"><div class="sidebar_ogDj"><nav class="menu thin-scrollbar menu_fqy9"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes">笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/algorithm">算法</a><button aria-label="Toggle the collapsible sidebar category &#x27;算法&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/blockchain">区块链</a><button aria-label="Toggle the collapsible sidebar category &#x27;区块链&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/culture/anime/anime-awesome">culture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/db">数据库</a><button aria-label="Toggle the collapsible sidebar category &#x27;数据库&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/design/ip">design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/dev/build/bazel">dev</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/devops">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/economics">经济学</a><button aria-label="Toggle the collapsible sidebar category &#x27;经济学&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/elastic/elasticsearch-v2">elastic</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/electrical/multimeter">electrical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/embedded/embedded-awesome">embedded</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/evolve">自我成长</a><button aria-label="Toggle the collapsible sidebar category &#x27;自我成长&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/game/mhr">game</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/hardware/arm">hardware</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/healthcare">健康</a><button aria-label="Toggle the collapsible sidebar category &#x27;健康&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/howto/network/dns-prevent-spoofing">howto</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/java">Java</a><button aria-label="Toggle the collapsible sidebar category &#x27;Java&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/languages">语言</a><button aria-label="Toggle the collapsible sidebar category &#x27;语言&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/mgmt/pm-awesome">mgmt</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/network/application/dns">network</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/ops/admin/augeas">ops</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/os/alpine">os</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/photography/camera-awesome">photography</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/platform">平台</a><button aria-label="Toggle the collapsible sidebar category &#x27;平台&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/queue">Queue</a><button aria-label="Toggle the collapsible sidebar category &#x27;Queue&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/reference/cook/glossary">reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/notes/security/acme-awesome">security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/notes/service/analytics/analytics-awesome">service</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/analytics/analytics-awesome">analytics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/notes/service/api/api-awesome">api</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/api-awesome">API Awesome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/api-design">API Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/apollo-federation">Apollo Federation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/bramble">bramble</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/buf">buf</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/cbor">CBOR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/connect">Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/dubbo">Dubbo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/graphql-awesome">GraphQL Awesome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/graphql-code-generator">graphql-code-generator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/graphql-faq">GraphQL FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/graphql">GraphQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-awesome">gRPC Awesome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-channelz">channelz</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-faq">gRPC FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-gateway">grpc-gateway</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-go">gRPC Go</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-node">grpc-node</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-spec">grpc spec</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpc-web">grpc web</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes/service/api/grpc">gRPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/grpcurl">grpcurl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/openapi">OpenAPI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/protobuf-faq">Protobuf</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/protobuf-go">Protobuf Go</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/protobuf-web">protobuf-web</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/protobuf">protobuf</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/protoc-gen-validate">protoc-gen-validate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/protoc">protoc</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/serialization-awesome">Serialization Awesome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/smithy">smithy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/twirp">twirp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/urql">URQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/api/xds">xds</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/auth">Auth</a><button aria-label="Toggle the collapsible sidebar category &#x27;Auth&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/baas">Backend as a Service</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backend as a Service&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/bi/apache-superset">bi</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/cms">CMS 概览</a><button aria-label="Toggle the collapsible sidebar category &#x27;CMS 概览&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/cn">CN</a><button aria-label="Toggle the collapsible sidebar category &#x27;CN&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/collaboration">协同软件</a><button aria-label="Toggle the collapsible sidebar category &#x27;协同软件&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/crm/crm-awesome">crm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/data">数据</a><button aria-label="Toggle the collapsible sidebar category &#x27;数据&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/dns">DNS Service</a><button aria-label="Toggle the collapsible sidebar category &#x27;DNS Service&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/download">下载器</a><button aria-label="Toggle the collapsible sidebar category &#x27;下载器&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/e-commerce">E-Commerce</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/email">EMail</a><button aria-label="Toggle the collapsible sidebar category &#x27;EMail&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/file/filebrowser">file</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/forge">Forge</a><button aria-label="Toggle the collapsible sidebar category &#x27;Forge&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/forum/forum-awesome">forum</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/im/im-awesome">im</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/media/audio-codec">media</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/network">网络服务</a><button aria-label="Toggle the collapsible sidebar category &#x27;网络服务&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/notion">Notion</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/observability">可观察性</a><button aria-label="Toggle the collapsible sidebar category &#x27;可观察性&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/office">办公套件</a><button aria-label="Toggle the collapsible sidebar category &#x27;办公套件&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/printing/printing-awesome">printing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/realtime/realtime-awesome">realtime</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/selfhost">SelfHost</a><button aria-label="Toggle the collapsible sidebar category &#x27;SelfHost&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/service/service-awesome">Service Awesome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/storage/ceph">storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/telecom/device">telecom</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/torrent">Torrent</a><button aria-label="Toggle the collapsible sidebar category &#x27;Torrent&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/notes/service/workflow">Workflow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Workflow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/notes/service/xaas/xaas-awesome">xaas</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/tool">工具</a><button aria-label="Toggle the collapsible sidebar category &#x27;工具&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/voip">VoIP</a><button aria-label="Toggle the collapsible sidebar category &#x27;VoIP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/notes/web">Web</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_BKoE"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_EYvA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RaEK"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_nrhp"><div class="docItemContainer_EkVX"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_GKCt" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OL5o"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">service</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">api</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">gRPC</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_oqr9 theme-doc-toc-mobile tocMobile_5aMT"><button type="button" class="clean-btn tocCollapsibleButton_CjyO">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>gRPC</h1></header><ul><li><a href="https://github.com/grpc/">gRPC</a></li><li><a href="https://github.com/grpc-ecosystem">gRPC Ecosystem</a></li><li><a href="https://github.com/google/protobuf/blob/master/docs/third_party.md">Third-Party Add-ons for Protocol Buffers</a></li><li>服务端暂不支持 PHP<ul><li>可以跟踪该帖子 <a href="https://groups.google.com/forum/#!topic/grpc-io/F3IyYaI_6S0">Servers in PHP?</a></li></ul></li><li>google.protobuf<ul><li>默认定义</li><li>api.proto<ul><li>对服务的轻量级定义</li></ul></li></ul></li><li>相关服务<ul><li><a href="https://github.com/mwitkow/grpc-proxy">mwitkow/grpc-proxy</a><ul><li>grpc 反向代理</li></ul></li><li><a href="https://github.com/improbable-eng/grpc-web">improbable-eng/grpc-web</a><ul><li>gRPC Web implementation for Golang and TypeScript</li></ul></li></ul></li><li>案例参考<ul><li><a href="https://github.com/grpc/grpc-proto">grpc/grpc-proto</a><ul><li>常用协议</li></ul></li><li>k8s 使用 go-to-protobuf 从 go 生成的 proto</li></ul></li><li>参考<ul><li><a href="https://github.com/mfornos/awesome-microservices">mfornos/awesome-microservices</a></li><li><a href="https://goel.io/grpc-100/">gRPC Practical Tutorial - Magic That Generates Code</a></li><li><a href="https://github.com/LogNet/grpc-spring-boot-starter">LogNet/grpc-spring-boot-starter</a></li></ul></li></ul><admonition title="痛点" type="caution"><ul><li>官方 gRPC 实现非常复杂<ul><li>因为同时考虑 Google 内部使用和 开源社区 使用</li><li>grpc-go 使用自己的 net/http</li></ul></li><li>gRPC 必须要求 HTTP2 trailer - 门槛相当高</li><li>gRPC Web 需要引入一层额外代理</li></ul></admonition><h2 id="note">Note</h2><ul><li>guides/<a href="https://grpc.io/docs/guides/concepts.html">concepts</a><ul><li>服务定义</li><li>使用方式</li><li>RPC 生命周期<ul><li>单向 RPC</li><li>服务端流</li><li>客户端流</li><li>双向流</li><li>超时</li><li>终端</li><li>取消</li><li>元数据</li><li>通道</li></ul></li></ul></li><li>实现<ul><li>使用 HTTP2 协议</li><li>使用 HTTP2 Trailler 来标识是否还有后续包<ul><li>Web 无法获取到该信息, 所以无法实现和使用 gRPC</li></ul></li></ul></li></ul><h2 id="docker">Docker</h2><ul class="contains-task-list"><li>避免安装编译等繁杂的过程</li><li><a href="https://github.com/wenerme/dockerfiles/tree/master/grpc">Dockerfile</a></li><li>AlpineLinux Packages <a href="https://github.com/wenerme/statics/tree/master/abuild">grpc</a></li><li>grpc</li><li>grpc-java</li><li>grpc-go<ul><li>protowrap</li></ul></li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->grpc-swift</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->grpc-slate</li></ul><pre><code class="language-bash"># 假设 api 位于当前目录下的 apis
docker run --rm -it -v $PWD:/host --workdir /host wener/grpc
# 创建目标目录
# 注意: 如果删除了 proto 文件, 目录下之前生成的的文件不会被删除, 此时建议删除目录从新生成
# 注意: 文件生成在了当前目录, 需要同步到项目中. 也可以直接生成到项目中
mkdir java javanano php go objc js ruby python csharp node slatedoc
# 定义常用参数
# 注意: 如果文件列表发生了变化需要从新执行
COMMON_ARGS=&quot;$(echo -I . apis/**/*.proto)&quot;

# Generate Java
protoc $COMMON_ARGS --plugin=$(which protoc-gen-grpc-java) --java_out=./java --grpc-java_out=./java
# Generate Java Nano
protoc $COMMON_ARGS --plugin=$(which protoc-gen-grpc-java) --java_out=nano:./javanano --grpc-java_out=./javanano
# Generate Go by protowrap
# The last -I apis is required
protowrap $COMMON_ARGS --go_out=plugins=grpc:$HOME/go/src -I apis/
# Generate slate document
protowrap $COMMON_ARGS --slate_out=./slatedoc -I apis/

# Generate Swift
protoc $COMMON_ARGS --swift_out=./swift --swiftgrpc_out=./swift

# Generate PHP
protoc $COMMON_ARGS --plugin=protoc-gen-grpc=$(which grpc_php_plugin) --php_out=./php --grpc_out=./php
# Generate CXX
protoc $COMMON_ARGS --plugin=protoc-gen-grpc=$(which grpc_cpp_plugin) --cpp_out=./cpp --grpc_out=./cpp
# Generate C#
protoc $COMMON_ARGS --plugin=protoc-gen-grpc=$(which grpc_csharp_plugin) --csharp_out=./csharp --grpc_out=./csharp
# Generate ObjC
protoc $COMMON_ARGS --plugin=protoc-gen-grpc=$(which grpc_objective_c_plugin) --objc_out=./objc --grpc_out=./objc
# Generate Ruby
protoc $COMMON_ARGS --plugin=protoc-gen-grpc=$(which grpc_ruby_plugin) --ruby_out=./ruby --grpc_out=./ruby
# Generate Python
protoc $COMMON_ARGS --plugin=protoc-gen-grpc=$(which grpc_python_plugin) --python_out=./objc --grpc_out=./python
# Generate Node
protoc $COMMON_ARGS --plugin=protoc-gen-grpc=$(which grpc_node_plugin) --js_out=import_style=commonjs,binary:./node --grpc_out=./node
</code></pre><h2 id="安装">安装</h2><ul><li><a href="https://github.com/grpc/grpc/blob/master/INSTALL.md">https://github.com/grpc/grpc/blob/master/INSTALL.md</a></li><li><a href="https://hub.docker.com/u/grpc/">https://hub.docker.com/u/grpc/</a></li><li>生成主要依赖插件<ul><li>protoc-gen-go</li><li>protoc-gen-grpc-gateway</li><li>protoc-gen-swagger</li><li>protoc-gen-grpc-java</li></ul></li><li><a href="https://github.com/Juniper/grpc-c">Juniper/grpc-c</a><ul><li>支持 C</li></ul></li><li><a href="https://github.com/grpc/grpc-java/tree/master/compiler">https://github.com/grpc/grpc-java/tree/master/compiler</a></li></ul><pre><code class="language-bash"># grpc_cli
# grpc_cpp_plugin
# grpc_csharp_plugin
# grpc_node_plugin
# grpc_objective_c_plugin
# grpc_php_plugin
# grpc_python_plugin
# grpc_ruby_plugin
brew install grpc
# 不 link 则使用绝对路径
brew link grpc

# 变量定义简化操作
# =========
# 安装 gRPC 后会包含很多插件
# # 生成 cpp, node, php, c#, ruby, python, objc 的方式是一样的
GRPC_BIN=$(brew --prefix grpc)/bin
# 定义 pb 路径
PROTO_PATH=./apis/
# 对路径进行展开
PROTO_FILES=(apis/**/*.proto)
PROTO_ARGS=&quot;-I $PROTO_PATH  ${PROTO_FILES[*]}&quot;
# 覆盖 protoc
alias protoc=&quot;protoc $PROTO_ARGS&quot;

# gRPC 生成
# =========
# --js_out=./node 生成 protobuf
# --grpc_out=./node 生成 grpc
# --plugin=protoc-gen-grpc=$GRPC_BIN/grpc_node_plugin 使用 grpc_node_plugin 来生成 node 的 grpc
# -I . 包从当前目录查找
# apis/**/*.proto 生成所有 apis 下的 proto
protoc --js_out=./node --grpc_out=./node --plugin=protoc-gen-grpc=$GRPC_BIN/grpc_node_plugin -I . apis/**/*.proto

# Golang
# =========
# 不支持一次性生成多个包
# https://github.com/golang/protobuf/pull/40
# 可以使用 https://github.com/square/goprotowrap 规避
go get -u github.com/golang/protobuf/{proto,protoc-gen-go}
go get -u google.golang.org/grpc
# Golang 可直接生成 gRPC 和 Protobuf
protoc --go_out=plugins=grpc:$HOME/go/src -I . apis/**/*.proto

# 使用 protowrap
go get -u github.com/square/goprotowrap/cmd/protowrap
# -I apis/ 是必须的, 要有有一个前缀
protowrap --go_out=plugins=grpc:$HOME/go/src -I . -I apis/ apis/**/*.proto

# https://github.com/gogo/protobuf
# gogoprotobuf is a fork of golang/protobuf with extra code generation features.
# 扩展 https://github.com/gogo/protobuf/blob/master/extensions.md
#
# protoc-gen-gogofast (same as gofast, but imports gogoprotobuf)
# protoc-gen-gogofaster (same as gogofast, without XXX_unrecognized, less pointer fields)
# protoc-gen-gogoslick (same as gogofaster, but with generated string, gostring and equal methods)
go get -u github.com/gogo/protobuf/protoc-gen-gofast
protowrap --gofast_out=plugins=grpc:$HOME/go/src -I . -I apis/ apis/**/*.proto

# Java
# =========
# Java 插件需要自己编译
git clone https://github.com/grpc/grpc-java
cd grpc-java/compiler
../gradlew java_pluginExecutable
# 插件完整路径
realpath build/exe/java_plugin/protoc-gen-grpc-java
GEN_JAVA=&quot;$(realpath build/exe/java_plugin/protoc-gen-grpc-java)&quot;

# 生成 gRPC
protoc --plugin=protoc-gen-grpc-java=$GEN_JAVA --grpc-java_out=$PWD/java -I . proto/**/*.proto
# 生成 protobuf
protoc -I . --java_out=./java proto/**/*.proto
# 生成 nano 的 pb
protoc -I . --javanano_out=./java proto/**/*.proto
# 生成 gRPC lite
protoc --plugin=protoc-gen-grpc-java=$GEN_JAVA --grpc-java_out=lite:$PWD/java -I . proto/**/*.proto
# 生成 gRPC nano
protoc --plugin=protoc-gen-grpc-java=$GEN_JAVA --grpc-java_out=nano:$PWD/java -I . proto/**/*.proto

# Swift
# =========
# https://github.com/grpc/grpc-swift
git clone https://github.com/grpc/grpc-swift
cd grpc-swift/Plugin
make
GEN_SWIFT=$(realpath .)
# 生成 pb 和 grpc
protoc --plugin=$GEN_SWIFT/protoc-gen-swift --swift_out=./swift -I . proto/**/*.proto
protoc --plugin=$GEN_SWIFT/protoc-gen-swiftgrpc --swiftgrpc_out=./swift -I . proto/**/*.proto

# Node
# =========
protoc --js_out=./node --grpc_out=./node --plugin=protoc-gen-grpc=$GRPC_BIN/grpc_node_plugin -I . proto/**/*.proto

# 使用 grpc-tools 生成
yarn global add grpc-tools
protoc -I=. ./protos/product.proto \
  --js_out=import_style=commonjs,binary:./server \
  --grpc_out=./server \
  --plugin=protoc-gen-grpc=$(which grpc_tools_node_protoc_plugin)

# ts-protoc-gen
# =========
# https://github.com/improbable-eng/ts-protoc-gen
# 生成 Typescript 定义 .d.ts

# Gateway
# =========
# Web &lt;-&gt; gRPC
# 生成网关代码和 Swagger 配置
go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway
go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger

# 生成 stub
protoc --go_out=plugins=grpc:. -I proto/ proto/hello.proto
# 生成反向代理
protoc --grpc-gateway_out=logtostderr=true:. -I proto/ proto/hello.proto
# 生成 swagger
protoc --swagger_out=logtostderr=true:. -I proto/ proto/hello.proto

# prototools
# =========
# 生成文档, json, dump
# https://github.com/sourcegraph/prototools
go get -u sourcegraph.com/sourcegraph/prototools/cmd/protoc-gen-doc
# 如果找不到文件可以考虑指定 filemap=./tmpl/filemap.xml
protowrap --doc_out=./apidoc -I . -I apis/ apis/**/*.proto

# pseudomuto/protoc-gen-doc
# =========
# 生成文档, 支持生成 HTML, JSON, DocBook, Markdown
# 默认模板比 prototools 好看
# https://github.com/pseudomuto/protoc-gen-doc
go get -u github.com/pseudomuto/protoc-gen-doc/cmd/...
</code></pre><h2 id="java">Java</h2><ul><li><a href="https://github.com/grpc/grpc-java/issues/3458">grpc/grpc-java#3458</a> - FR: Port sharing with traditional HTTP services<ul><li><a href="https://github.com/netty/netty/issues/3667">netty/netty#3667</a> - h2childchan: Model streams in HTTP/2 as child channels</li></ul></li></ul><pre><code class="language-java">class Tests{
  // TLS 服务端
  @Test
  public void testTLSSvr() throws IOException, InterruptedException {
    java.security.Security.addProvider(
        new org.bouncycastle.jce.provider.BouncyCastleProvider()
    );

    int port = 8443;
    Server server = NettyServerBuilder
        .forPort(port)
        .sslContext(GrpcSslContexts
            .forServer(new File(&quot;localhost.pem&quot;),new File(&quot;localhost-key.pem&quot;))
            .trustManager(new File(&quot;ca.pem&quot;))
            // 要求客户端认证
            .clientAuth(ClientAuth.REQUIRE).build())
        .addService(new MyServiceImpl())
        .build();
    log.info(&quot;Server started, listening on &quot; + port);
    server.start().awaitTermination();
  }

  // TLS 客户端
  @Test
  public void testTLSCli() throws Exception {
    java.security.Security.addProvider(
        new org.bouncycastle.jce.provider.BouncyCastleProvider()
    );
    // 使用 Netty 实现, 也可以使用 OkHttp 实现
    ManagedChannel channel = NettyChannelBuilder
        .forAddress(&quot;localhost&quot;, 8443)
        .sslContext(GrpcSslContexts
            .forClient()
            .trustManager(new File(&quot;ca.pem&quot;))
            // 双向认证才需要
            .keyManager(
                new File(&quot;cli.pem&quot;),
                new File(&quot;cli-key.pem&quot;)
            )
            .build())
        .build();
    // 创建阻塞客户端
    MyServiceGrpcBlockingStub stub = MyServiceGrpc.newBlockingStub(channel);
    GetInfoResponse info = stub.getInfo(GetInfoRequest.newBuilder().build());
    System.out.println(info.getName());
  }
}
</code></pre><h2 id="php">PHP</h2><pre><code class="language-php">&lt;?php
require __DIR__ . &#x27;/vendor/autoload.php&#x27;;

$creds =
  // 无 TLS
  Grpc\ChannelCredentials::createInsecure()
  // 只配置 CA 如果服务端不要求客户端认证
  // \Grpc\ChannelCredentials::createSsl(file_get_contents(&quot;ca.pem&quot;))
  // 双向认证, 服务端要求客户端认证
  // \Grpc\ChannelCredentials::createSsl(file_get_contents(&quot;ca.pem&quot;),file_get_contents(&quot;cli-key.pem&quot;),file_get_contents(&quot;cli.pem&quot;))
;
$client = new \Wener\Service\V1\InfoServiceClient(&quot;localhost:5002&quot;, [
    &#x27;credentials&#x27; =&gt; $creds,
]);

/**
 * @var \Wener\Service\V1\GetInfoResponse $reply
 * @var \Wener\Api\GrpcStatus $status Customized type for ide to hint type
 */
list($reply, $status) = $client-&gt;GetInfo(new \Wener\Service\V1\GetInfoRequest())-&gt;wait();

echo $status-&gt;code . PHP_EOL;
echo $reply-&gt;getName() . PHP_EOL;

// All Status
print_r($status);
// JSON
// 再次解码编码是为了方便调试
echo json_encode(json_decode($reply-&gt;serializeToJsonString()), JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . PHP_EOL;
</code></pre><h2 id="node">Node</h2><ul><li><a href="https://github.com/grpc/grpc/issues/8233">#8233 Typescript typings for node package</a></li></ul><pre><code class="language-bash"># 最基本的只需要这两个依赖
yarn add google-protobuf
yarn add grpc

# 调试相关的环境变量
GRPC_TRACE=all
GRPC_VERBOSITY=DEBUG
</code></pre><pre><code class="language-js">const grpc = require(&#x27;grpc&#x27;);
const fs = require(&#x27;fs&#x27;);

// 生成的 pb 对象
const messages = require(&#x27;./service_pb&#x27;);
// 生成 grpc 客户端和服务端
const services = require(&#x27;./service_grpc_pb&#x27;);

let client = new services.ServiceClient(
  &#x27;service.wener.me:443&#x27;,
  // 无 TLS
  // grpc.credentials.createInsecure(),
  // 使用 self-signed 证书
  grpc.credentials.createSsl(fs.readFileSync(&#x27;ca.pem&#x27;), fs.readFileSync(&#x27;cli-key.pem&#x27;), fs.readFileSync(&#x27;cli.pem&#x27;)),
);

// 发起请求
let request = new messages.GetInfoRequest();
client.getInfo(request, (err, response) =&gt; {
  console.log(&#x27;Service name&#x27;, response.getName());
});
</code></pre><h2 id="golang">Golang</h2><pre><code class="language-bash"># http2 相关的环境变量
GODEBUG=http2client=0 # disable HTTP/2 client support
GODEBUG=http2server=0 # disable HTTP/2 server support
GODEBUG=http2debug=1  # enable verbose HTTP/2 debug logs
GODEBUG=http2debug=2  # ... even more verbose, with frame dumps
</code></pre><h3 id="client">Client</h3><pre><code class="language-golang">package main

func main(){

}
</code></pre><h3 id="server">Server</h3><pre><code class="language-golang">package main

var (
    ServerCert string
    ServerKey  string
    RootCA     string
    Addr       string
)

func main() {
    flag.StringVar(&amp;ServerCert, &quot;cert&quot;, &quot;&quot;, &quot;&quot;)
    flag.StringVar(&amp;ServerKey, &quot;key&quot;, &quot;&quot;, &quot;&quot;)
    flag.StringVar(&amp;RootCA, &quot;ca&quot;, &quot;&quot;, &quot;&quot;)
    flag.StringVar(&amp;Addr, &quot;addr&quot;, &quot;&quot;, &quot;&quot;)

    flag.Parse()
    var srv *grpc.Server
    lis, err := net.Listen(&quot;tcp&quot;, Addr)
    if err != nil {
        panic(fmt.Errorf(&quot;could not list on %s: %s&quot;, Addr, err))
    }

    if ServerCert == &quot;&quot; {
        srv = grpc.NewServer()
    } else {
        logrus.WithField(&quot;cert&quot;, ServerCert).Info(&quot;With TLS&quot;)
        // 读取证书信息
        certificate, err := tls.LoadX509KeyPair(ServerCert, ServerKey)
        if err != nil {
            panic(fmt.Errorf(&quot;could not load client key pair: %s&quot;, err))
        }

        // Create a certificate pool from the certificate authority
        certPool := x509.NewCertPool()
        ca, err := ioutil.ReadFile(RootCA)
        if err != nil {
            panic(fmt.Errorf(&quot;could not read ca certificate: %s&quot;, err))
        }

        // Append the certificates from the CA
        if ok := certPool.AppendCertsFromPEM(ca); !ok {
            panic(errors.New(&quot;failed to append ca certs&quot;))
        }

        creds := credentials.NewTLS(&amp;tls.Config{
      // 如何对客户端进行认证, 可进行双向认证
            ClientAuth:   tls.VerifyClientCertIfGiven,
            Certificates: []tls.Certificate{certificate},
            ClientCAs:    certPool,
        })
        srv = grpc.NewServer(grpc.Creds(creds))
    }

    // Create the gRPC server with the credentials
    service.RegisterInfoServiceServer(srv, &amp;DemoStatus{})

    logrus.WithField(&quot;addr&quot;, Addr).Info(&quot;Serving&quot;)
    // Serve and Listen
    if err := srv.Serve(lis); err != nil {
        panic(fmt.Errorf(&quot;grpc serve error: %s&quot;, err))
    }
}

type DemoStatus struct {
    service.InfoServiceServer
}

func (DemoStatus) GetInfo(context.Context, *service.GetInfoRequest) (*service.GetInfoResponse, error) {
    logrus.Info(&quot;Handle request&quot;)
    return &amp;service.GetInfoResponse{Name: &quot;Demo Service&quot;}, nil
}
</code></pre><h2 id="web">Web</h2><ul><li><a href="https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md">gRPC Web</a></li><li><a href="https://github.com/dcodeIO/ProtoBuf.js/">https://github.com/dcodeIO/ProtoBuf.js/</a></li></ul><h2 id="typescript">Typescript</h2><p><a href="https://www.npmjs.com/package/ts-protoc-gen">https://www.npmjs.com/package/ts-protoc-gen</a></p><h2 id="grpc-gateway">grpc-gateway</h2><ul><li><a href="https://github.com/grpc-ecosystem/grpc-gateway">grpc-gateway</a><ul><li>gRPC to JSON proxy generator</li></ul></li><li>支持 googleapis 中的 http 定义</li><li>Features<ul><li>Generating JSON API handlers</li><li>Method parameters in request body</li><li>Method parameters in request path</li><li>Method parameters in query string</li><li>Enum fields in path parameter (including repeated enum fields).</li><li>Mapping streaming APIs to newline-delimited JSON streams</li><li>Mapping HTTP headers with Grpc-Metadata- prefix to gRPC metadata (prefixed with grpcgateway-)</li><li>Optionally emitting API definition for Swagger.</li><li>Setting gRPC timeouts through inbound HTTP Grpc-Timeout header.</li></ul></li><li>可以只拷贝需要的导入文件<ul><li><code>google/api/annotations.proto</code></li><li><code>google/api/http.proto</code></li></ul></li><li>然后在 rpc 中添加 http 定义即可</li></ul><pre><code>rpc SayHello (HelloRequest) returns (HelloReply) {
  option (google.api.http) = {
      post:&quot;/v1/greeter/hello&quot;
      body:&quot;*&quot;
  };
}
</code></pre><pre><code class="language-bash"># 安装
go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway
go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger
go get -u github.com/golang/protobuf/protoc-gen-go

# 生成 stub
protoc --go_out=plugins=grpc:. -I proto/ proto/hello.proto
# 生成反向代理
protoc --grpc-gateway_out=logtostderr=true:. -I proto/ proto/hello.proto
# 生成 swagger
protoc --swagger_out=logtostderr=true:. -I proto/ proto/hello.proto

# 拉取相关依赖
go get .

# 添加 main, 启动时调用注册
</code></pre><h2 id="auth">Auth</h2><ul><li><a href="https://github.com/grpc/grpc-java/blob/master/SECURITY.md">grpc/grpc-java/SECURITY.md</a></li><li>guides/<a href="https://grpc.io/docs/guides/auth.html">auth</a><ul><li>SSL/TLS 双向认证</li><li>基于 Token</li></ul></li><li>授权分为整个通道和单次请求</li><li>gRPC 可以自带元数据头, 因此也可以自定义授权</li></ul><h2 id="案例">案例</h2><ul><li><a href="https://github.com/cockroachdb/cockroach/tree/master/pkg/roachpb">cockroachdb/cockroach</a></li><li><a href="https://github.com/docker/swarmkit/tree/master/api">docker/swarmkit</a></li><li><a href="https://github.com/gogo/protobuf#users">https://github.com/gogo/protobuf#users</a></li></ul><h3 id="gcp">GCP</h3><ul><li><p><a href="https://github.com/googleapis/googleapis">googleapis/googleapis</a></p></li><li><p><a href="https://github.com/googleapis/toolkit">googleapis/toolkit</a></p></li><li><p><a href="https://github.com/googleapis/artman">googleapis/artman</a></p></li><li><p>GAPIC</p></li><li><p>selector</p><ul><li>逗号分隔</li><li>可以使用 <code>*</code> 做匹配, 但是只能放在最后<ul><li>例如 <code>foo.*</code>, 但不能写 <code>foo.*b</code>, <code>foo.*.abc</code></li><li>可以使用 <code>*</code> 匹配所有</li></ul></li></ul></li><li><p>服务结构</p><ul><li>api<ul><li>接口相关的定义</li><li>backend.proto<ul><li>定义服务的后端</li></ul></li><li>service.proto<ul><li>对服务的定义</li></ul></li><li>servicecontrol<ul><li>服务控制</li><li>对服务的检查报告</li></ul></li><li>servicemanagement<ul><li>服务管理</li><li>对服务的 CRUD, 启用停用</li></ul></li></ul></li><li>appengine</li></ul></li></ul><pre><code class="language-bash"># artman
# 包含了 grpc 生成个个语言的环境
docker pull googleapis/artman

docker run -it --rm -v $PWD/googleapis:/googleapis -v $PWD/artman:/artman -w /googleapis googleapis/artman
# artman --api pubsub --language python
</code></pre><h4 id="service-control">Service Control</h4><ul><li><a href="https://cloud.google.com/service-control/overview">Google Service Control</a></li><li>How to control access to your service.</li><li>How to validate API keys.</li><li>How to send logging and monitoring data to both consumers and producers.</li><li>How to create and manage dashboards to visualize such data.</li><li>How to scale the control plane components with your service.</li></ul><p><img src="https://cloud.google.com/service-control/images/arch.svg" alt="Architecture"></p><ul><li>Managed services<ul><li>Google Service Management 管理每个服务和其配置, 用于定制化 Google Service Control 的行为. 服务配置也被用于 Google Cloud Platform Console 显示其配置, 启用/禁用 等.</li><li>For example:<ul><li>Google Cloud Pub/Sub (pubsub.googleapis.com)</li><li>Google Cloud Vision (vision.googleapis.com)</li><li>Google Cloud Bigtable (bigtable.googleapis.com)</li><li>Google Cloud Datastore (datastore.googleapis.com)</li></ul></li></ul></li><li>Operations<ul><li>表示被管理服务的活动, 例如接口调用或资源使用</li><li>每个操作都关联一个被管理的服务,和调用者, 也包含调用的相关信息, 例如调用方法, 资源使用量等</li></ul></li><li>Check<ul><li>Check if the consumer is still active.</li><li>Check if the consumer has enabled the service.</li><li>Check if the API key is still valid.</li><li>对接口进行检测以保证更好的性能, 更高的可用性</li></ul></li><li>Report</li></ul><h4 id="service-management">Service Management</h4><ul><li>Google <a href="https://cloud.google.com/service-management/overview">Service Management</a></li><li>Service producer<ul><li>由谷歌开发者负责发布维护被管理的服务. 每个被管理的服务都由一个服务生产者所有</li></ul></li><li>Service consumers<ul><li>启用了接口调用的管理服务, 一个被管理的服务可以有很多服务消费者</li></ul></li><li>Service configurations<ul><li>每个被管理的服务都有自己的配置描述, 包括名字, 标题, RPC 接口定义, REST 接口定义, 文档, 授权等</li></ul></li><li>Service rollouts<ul><li>流量控制</li></ul></li></ul><h2 id="源码和使用分析">源码和使用分析</h2><ul><li>PB 附带了所有解析后的消息格式定义</li><li>PB 3 增加了 java-util, 可以进行 JSON 序列化<ul><li><code>JsonFormat</code> 打印时需要使用 <code>com.google.protobuf.util.JsonFormat.TypeRegistry</code> 来反查具体类</li></ul></li><li>优化模式<ul><li>SPEED<ul><li>Generate complete code for parsing, serialization, etc.</li></ul></li><li>CODE_SIZE<ul><li>Use ReflectionOps to implement these methods.</li></ul></li><li>LITE_RUNTIME<ul><li>Generate code using MessageLite and the lite runtime.</li></ul></li></ul></li><li>命名空间<ul><li>与 Java 命名空间的概念相似</li><li>生成的类的包名可以不同于 proto 的包</li><li>所有定义的消息都有自己的类型和命名空间</li><li>因此 Any 消息才能根据一个 url 和数据来还原消息</li><li>类型的引用也是基于该命名空间</li></ul></li></ul><h3 id="java-1">Java</h3><ul><li>服务端支持 Netty</li><li>客户端支持 OkHttp 和 Netty</li><li>传输层解析出请求的方法<ul><li>方法名实际包含了请求类 <code>foo.bar.Greeter/SayHello</code></li></ul></li><li>实际方法触发位置为 <code>io.grpc.ServerCall.Listener</code> 的不同实现</li><li><code>ServerServiceDefinition</code><ul><li>服务定义</li></ul></li><li><code>ServiceDescriptor</code><ul><li>服务描述</li></ul></li><li><code>MethodDescriptor</code><ul><li>方法描述</li><li>类型<ul><li>UNARY - 请求 -&gt; 响应</li><li>CLIENT_STREAMING - 流请求 -&gt; 响应</li><li>SERVER_STREAMING - 请求 -&gt; 流响应</li><li>BIDI_STREAMING - 流请求 -&gt; 流响应</li></ul></li></ul></li><li><code>HandlerRegistry</code><ul><li>服务注册中心</li></ul></li><li><code>ServerInterceptor</code><ul><li>服务端拦截器</li><li>常见用例<ul><li>授权认证</li><li>日志监控</li><li>代理</li></ul></li></ul></li><li><code>ServerCallHandler</code><ul><li>实际请求处理的方法</li></ul></li><li><code>Stream</code><ul><li>客户端和服务端的通讯流</li></ul></li><li><code>io.grpc.Context</code><ul><li>跨线程的处理上下文</li></ul></li><li>速度优化<ul><li>会生成 <code>MethodHandlers</code></li><li>统一方法调用</li><li>实现所有类型的方法调用接口<ul><li><code>io.grpc.stub.ServerCalls.UnaryMethod</code></li><li><code>io.grpc.stub.ServerCalls.ServerStreamingMethod</code></li><li><code>io.grpc.stub.ServerCalls.ClientStreamingMethod</code></li><li><code>io.grpc.stub.ServerCalls.BidiStreamingMethod</code></li></ul></li><li>实际调用时使用 <code>switch</code> 和事先给定的方法 id 进行请求, 避免使用反射</li></ul></li><li><code>io.grpc.Server</code><ul><li>服务端</li><li><code>InternalServer</code><ul><li>用于不同链接层实现的接口</li><li>建立新的链接时回调 <code>ServerListener#transportCreated</code></li></ul></li></ul></li><li><code>io.grpc.Status</code><ul><li>表达异常和状态</li></ul></li><li>基础<ul><li><code>Stream</code></li><li><code>StreamListener</code></li><li>基本流程<ul><li>方法 -&gt; Call -&gt; Stream</li><li>生成 Call 时会创建对应的 Feature</li><li>同步请求是循环等待 Feature 完成</li></ul></li><li>完整方法名的命名规则为<ul><li><code>完整的服务名/方法名</code></li><li><code>wener.scel.v1.Scel/Search</code></li></ul></li></ul></li><li>客户端<ul><li><code>ClientCall</code><ul><li><code>ClientCall.Listener</code><ul><li><code>onHeaders(Metadata)</code></li><li><code>onMessage(RespT)</code></li><li><code>onClose(Status,Metadata)</code></li></ul></li><li>处理流程</li><li>职责</li></ul></li><li><code>ManagedChannelBuilder</code></li><li><code>ClientTransport</code><ul><li><code>ManagedClientTransport</code><ul><li>有生命周期管理</li><li><code>ConnectionClientTransport</code><ul><li>基于链接</li><li>有属性</li></ul></li></ul></li></ul></li><li><code>ClientStream</code></li><li><code>ClientStreamListener</code></li><li>生成的客户端分为三种类型<ul><li>Stub<ul><li>有所有的方法</li><li>响应均为 <code>io.grpc.stub.StreamObserver</code></li></ul></li><li>BlockingStub<ul><li>阻塞接口</li><li>响应为直接的对象</li><li>流响应为 Iterator</li><li>不生成流请求</li></ul></li><li>FeatureStub<ul><li>以 Feature 作为返回状态</li></ul></li></ul></li></ul></li><li>服务端<ul><li><code>ServerCall</code><ul><li>处理流程<ul><li><code>ServerStream</code> -&gt; <code>ServerStreamListener</code></li><li><code>ServerStreamListener#messageRead</code><ul><li>会对请求对象进行解析</li></ul></li><li><code>ServerCall.Listener#onMessage</code><ul><li>拦截处理在这一层发生</li><li><code>ServerCallHandler</code> 负责从 <code>ServerCall</code> 创建 <code>ServerCall.Listener</code></li><li>即实际的方法处理发生在这里</li></ul></li></ul></li><li><code>ServerCalls</code><ul><li>提供 <code>ServerCall</code> 到 <code>ServerCallHandler</code> 的适配</li><li>主要用于简化实现</li><li><code>ServerCall</code> -&gt; <code>ServerCall.Listener</code></li><li>一个方法 <code>MethodDescriptor</code> 对应一个 <code>ServerCallHandler</code></li></ul></li><li>职责<ul><li><code>ServerCall.Listener</code> 用于接收消息</li><li><code>ServerCall</code> 用于发送和向客户端请求消息</li><li><code>ServerCallHandler</code> 方法处理</li></ul></li></ul></li><li><code>ServerBuilder</code></li><li><code>ServerTransport</code></li><li><code>ServerStream</code></li><li><code>ServerStreamListener</code></li></ul></li><li>Netty<ul><li><code>NettyServerProvider</code></li><li><code>NettyChannelProvider</code></li><li><code>NettyServer</code></li><li><code>NettyServerHandler</code><ul><li>服务端 GRPC 处理</li><li>执行上下文</li></ul></li><li>服务端<ul><li><code>NettyServerTransport</code></li><li><code>NettyServerStream</code></li></ul></li><li>客户端<ul><li><code>NettyClientTransport</code></li><li><code>NettyClientStream</code></li></ul></li></ul></li></ul><p><strong>protoc --help</strong></p><pre><code>$ protoc --help
Usage: protoc [OPTION] PROTO_FILES
Parse PROTO_FILES and generate output based on the options given:
  -IPATH, --proto_path=PATH   Specify the directory in which to search for
                              imports.  May be specified multiple times;
                              directories will be searched in order.  If not
                              given, the current working directory is used.
  --version                   Show version info and exit.
  -h, --help                  Show this text and exit.
  --encode=MESSAGE_TYPE       Read a text-format message of the given type
                              from standard input and write it in binary
                              to standard output.  The message type must
                              be defined in PROTO_FILES or their imports.
  --decode=MESSAGE_TYPE       Read a binary message of the given type from
                              standard input and write it in text format
                              to standard output.  The message type must
                              be defined in PROTO_FILES or their imports.
  --decode_raw                Read an arbitrary protocol message from
                              standard input and write the raw tag/value
                              pairs in text format to standard output.  No
                              PROTO_FILES should be given when using this
                              flag.
  -oFILE,                     Writes a FileDescriptorSet (a protocol buffer,
    --descriptor_set_out=FILE defined in descriptor.proto) containing all of
                              the input files to FILE.
  --include_imports           When using --descriptor_set_out, also include
                              all dependencies of the input files in the
                              set, so that the set is self-contained.
  --include_source_info       When using --descriptor_set_out, do not strip
                              SourceCodeInfo from the FileDescriptorProto.
                              This results in vastly larger descriptors that
                              include information about the original
                              location of each decl in the source file as
                              well as surrounding comments.
  --dependency_out=FILE       Write a dependency output file in the format
                              expected by make. This writes the transitive
                              set of input file paths to FILE
  --error_format=FORMAT       Set the format in which to print errors.
                              FORMAT may be &#x27;gcc&#x27; (the default) or &#x27;msvs&#x27;
                              (Microsoft Visual Studio format).
  --print_free_field_numbers  Print the free field numbers of the messages
                              defined in the given proto files. Groups share
                              the same field number space with the parent
                              message. Extension ranges are counted as
                              occupied fields numbers.

  --plugin=EXECUTABLE         Specifies a plugin executable to use.
                              Normally, protoc searches the PATH for
                              plugins, but you may specify additional
                              executables not in the path using this flag.
                              Additionally, EXECUTABLE may be of the form
                              NAME=PATH, in which case the given plugin name
                              is mapped to the given executable even if
                              the executable&#x27;s own name differs.
  --cpp_out=OUT_DIR           Generate C++ header and source.
  --csharp_out=OUT_DIR        Generate C# source file.
  --java_out=OUT_DIR          Generate Java source file.
  --javanano_out=OUT_DIR      Generate Java Nano source file.
  --js_out=OUT_DIR            Generate JavaScript source.
  --objc_out=OUT_DIR          Generate Objective C header and source.
  --php_out=OUT_DIR           Generate PHP source file.
  --python_out=OUT_DIR        Generate Python source file.
  --ruby_out=OUT_DIR          Generate Ruby source file.
</code></pre><h3 id="聊天">聊天</h3><pre><code>syntax = &quot;proto3&quot;;

// https://github.com/yafithekid/grpc-chat/blob/master/src/main/proto/rpcchat.proto
option java_package = &quot;com.if4031.proto&quot;;
option objc_class_prefix = &quot;HLW&quot;;

service ChatService {
    rpc join (JoinRequest) returns (Response);
    rpc leave (LeaveRequest) returns (Response);
    rpc send (SendRequest) returns (Response);
    rpc sendAll (SendAllRequest) returns (Response);
    rpc recvAll (RecvAllRequest) returns (ChatResponse);
}

message Message {
    string nickname = 1;
    string channel = 2;
    string content = 3;
    int64 timestamp = 4;
}

message Response {
    string status = 1;
    string message = 2;
}

message ChatResponse {
    string status = 1;
    string message = 2;
    repeated Message chats = 3;
}

message JoinRequest {
    string nickname = 1;
    string channel = 2;
}

message LeaveRequest {
    string nickname = 1;
    string channel = 2;
}

message SendRequest {
    string nickname = 1;
    string channel = 2;
    string message = 3;
}

message SendAllRequest {
    string nickname = 1;
    string message = 2;
}

message RecvAllRequest {
    string nickname = 1;
}
</code></pre><pre><code>syntax = &quot;proto3&quot;;

service Chat {
  rpc Authorize(RequestAuthorize) returns (ResponseAuthorize);
  rpc Connect(RequestConnect) returns (stream Event);
  rpc Say(CommandSay) returns (None);
}

message None {}

message RequestAuthorize {
  string name = 1;
}

message ResponseAuthorize {
  bytes session_id = 1;
}

message RequestConnect {
  bytes session_id = 1;
}

message CommandSay {
  bytes session_id = 1;
  string message = 2;
}

message Event {
  oneof event {
    EventNone none = 1;
    EventJoin join = 2;
    EventLeave leave = 3;
    EventLog log = 4;
  }
}

message EventNone {}

message EventJoin {
  string name = 1;
}

message EventLeave {
  string name = 1;
}

message EventLog {
  string name = 1;
  string message = 2;
}
</code></pre><pre><code>syntax = &quot;proto3&quot;;

option java_package = &quot;com.chat&quot;;

package Chat;

service MyChat{
    rpc login (Username) returns (LoginSuccess){}
    rpc join (ChannelName) returns (IsSuccess){}
    rpc leave (ChannelName) returns (IsSuccess){}
    rpc sendMessage (Message) returns (IsSuccess) {}
    rpc broadcastMessage (BroadcastMsg) returns (IsSuccess) {}
    rpc getMessages (Username) returns (Messages) {}
}

message Username {
    string username = 1;
}

message LoginSuccess{
    bool success = 1;
    string username = 2;
}

message ChannelName {
    string username = 1;
    string channel = 2;
}

message IsSuccess {
    bool success = 1;
}

message Message {
    string username = 1;
    string channel = 2;
    string msg = 3;
}

message Messages {
    bool success = 1;
    repeated string messages = 2;
}

message BroadcastMsg {
    string username = 1;
    string msg = 2;
}
</code></pre><h2 id="faq">FAQ</h2><h3 id="all-subconns-are-in-transientfailure">all SubConns are in TransientFailure</h3><ul><li><a href="https://groups.google.com/forum/#!topic/grpc-io/yCUwuHycNWk">https://groups.google.com/forum/#!topic/grpc-io/yCUwuHycNWk</a></li><li>超时后会恢复</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wenerme/wener/edit/master/notes/service/api/grpc.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_icZ1" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_IDPb"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes/service/api/grpc-web"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">grpc web</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes/service/api/grpcurl"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">grpcurl</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Rbtr thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#note" class="table-of-contents__link toc-highlight">Note</a></li><li><a href="#docker" class="table-of-contents__link toc-highlight">Docker</a></li><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a></li><li><a href="#java" class="table-of-contents__link toc-highlight">Java</a></li><li><a href="#php" class="table-of-contents__link toc-highlight">PHP</a></li><li><a href="#node" class="table-of-contents__link toc-highlight">Node</a></li><li><a href="#golang" class="table-of-contents__link toc-highlight">Golang</a><ul><li><a href="#client" class="table-of-contents__link toc-highlight">Client</a></li><li><a href="#server" class="table-of-contents__link toc-highlight">Server</a></li></ul></li><li><a href="#web" class="table-of-contents__link toc-highlight">Web</a></li><li><a href="#typescript" class="table-of-contents__link toc-highlight">Typescript</a></li><li><a href="#grpc-gateway" class="table-of-contents__link toc-highlight">grpc-gateway</a></li><li><a href="#auth" class="table-of-contents__link toc-highlight">Auth</a></li><li><a href="#案例" class="table-of-contents__link toc-highlight">案例</a><ul><li><a href="#gcp" class="table-of-contents__link toc-highlight">GCP</a></li></ul></li><li><a href="#源码和使用分析" class="table-of-contents__link toc-highlight">源码和使用分析</a><ul><li><a href="#java-1" class="table-of-contents__link toc-highlight">Java</a></li><li><a href="#聊天" class="table-of-contents__link toc-highlight">聊天</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a><ul><li><a href="#all-subconns-are-in-transientfailure" class="table-of-contents__link toc-highlight">all SubConns are in TransientFailure</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">笔记</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/notes/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/os/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip">VoIP</a></li></ul></div><div class="col footer__col"><div class="footer__title">Projects</div><ul class="footer__items clean-list"><li class="footer__item">
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              - <a class="footer__link-item" href="https://github.com/wenerme/wener/actions" title="wenerme/wener - ci">
                <img style="vertical-align: middle;opacity: .4;" src="https://github.com/wenerme/wener/workflows/Build/badge.svg">
                </a>
              </div>
              </li><li class="footer__item"><a href="https://apis.wener.me" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wener&#x27;s Apis<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_pUOn"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/story">Blog</a></li><li class="footer__item"><a href="https://github.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/wener-logo.svg" alt="Wener Site" class="themedImage_sWQn themedImage--light_HlbN footer__logo"><img src="/img/wener-logo.svg" alt="Wener Site" class="themedImage_sWQn themedImage--dark__4Lo footer__logo"></div><div class="footer__copyright">Copyright © 1992-2022 Wener - <img alt="cc-by-sa-4.0" src="https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg"> - Build @2022-09-22 04:38</div></div></div></footer></div>
<script src="/assets/js/runtime~main.07b4d16f.js"></script>
<script src="/assets/js/main.92dfd685.js"></script>
</body>
</html>