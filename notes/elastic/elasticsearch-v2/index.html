<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/story/rss.xml" title="Wener Live & Life Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/story/atom.xml" title="Wener Live & Life Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Wener Live & Life" href="/opensearch.xml"><title data-react-helmet="true">Elasticsearch v2.x | Wener Live &amp; Life</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Elasticsearch v2.x | Wener Live &amp; Life"><meta data-react-helmet="true" name="description" content="Elasticsearch"><meta data-react-helmet="true" property="og:description" content="Elasticsearch"><meta data-react-helmet="true" property="og:url" content="https://wener.me/notes/elastic/elasticsearch-v2"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://wener.me/notes/elastic/elasticsearch-v2"><link rel="stylesheet" href="/styles.f53ced8f.css">
<link rel="preload" href="/styles.539e90aa.js" as="script">
<link rel="preload" href="/runtime~main.adbca279.js" as="script">
<link rel="preload" href="/main.305ce40c.js" as="script">
<link rel="preload" href="/1.e5403ab0.js" as="script">
<link rel="preload" href="/2.52ee678d.js" as="script">
<link rel="preload" href="/3.d21b50fe.js" as="script">
<link rel="preload" href="/1be78505.195536f9.js" as="script">
<link rel="preload" href="/1035.68fde79d.js" as="script">
<link rel="preload" href="/935f2afb.aed184d9.js" as="script">
<link rel="preload" href="/17896441.d559942d.js" as="script">
<link rel="preload" href="/685b3299.63c7dfb3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Wener</strong></a><a class="navbar__item navbar__link" href="/notes/java/java">ç¬”è®°</a><a class="navbar__item navbar__link" href="/story">æ•…äº‹</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">æŒ‡å—</a><a class="navbar__item navbar__link" href="/notes/tool/network/ip-lookup">å·¥å…·</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Wener</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/java">ç¬”è®°</a></li><li class="menu__list-item"><a class="menu__link" href="/story">æ•…äº‹</a></li><li class="menu__list-item"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/howto/network/dns-prevent-spoofing">æŒ‡å—</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/tool/network/ip-lookup">å·¥å…·</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Elasticsearch v2.x</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="elasticsearch"></a>Elasticsearch<a class="hash-link" href="#elasticsearch" title="Direct link to heading">#</a></h1><ul><li>2016.2 ELK äº¤æµ. è®²ä¹‰æ–‡ç¨¿ <a href="https://docs.google.com/presentation/d/1UNycijD8JrkfspY87NAt9vFlJBe6drcsgF93rr_3Hn4/edit?usp=sharing" target="_blank" rel="noopener noreferrer">GoogleDoc</a>/<a href="http://www.slideshare.net/3160586/elk-59003177" target="_blank" rel="noopener noreferrer">Slideshare</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="tips"></a>Tips<a class="hash-link" href="#tips" title="Direct link to heading">#</a></h2><ul><li>æ–‡æ¡£ä¸ä¼šè¢«åˆ é™¤,åªä¼šè¢«æ ‡è®°åˆ é™¤</li><li>ç´¢å¼•åœ¨å†…å­˜ä¸­æ„å»º, ç„¶ååˆ·åˆ°ç£ç›˜</li><li>ä¸€ä¸ªç´¢å¼•ç”±å¤šä¸ªæ®µ(segment)ç»„æˆ,æœç´¢ä¼šåœ¨æ‰€æœ‰æ®µæ‰§è¡Œ,æœ€ç»ˆåˆå¹¶ç»“æœ</li><li>æ®µä¼šå®šæœŸåˆå¹¶</li><li>æ¯ä¸ªæ®µéƒ½ä¼šç¼“å­˜ Field å’Œ Filter</li><li>Elasticsearch ä¸æ”¯æŒäº‹åŠ¡</li><li>æ¯ä¸ªåˆ†ç‰‡ä¸ºä¸€ä¸ª Lucene ç´¢å¼•</li><li>è¿‘å®æ—¶ç¨‹åº¦ä¸æ€§èƒ½æœ‰å…³,é»˜è®¤ä¸º 1 ç§’</li><li>Lucene è‡ªèº«æ˜¯å¢é‡ç´¢å¼•</li><li>æ¯ä¸ªæ®µè‡ªèº«ä¸ºä¸€ä¸ªå°ç´¢å¼•</li><li>1.4 ä¹‹å‰é»˜è®¤ä½¿ç”¨ UUID, ä¹‹åä½¿ç”¨ Flask ID</li><li>æ— æ³•é€šè¿‡æŸ¥è¯¢æ¥åˆ é™¤<ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/plugins/2.2/delete-by-query-usage.html" target="_blank" rel="noopener noreferrer">delete-by-query</a></li></ul></li><li>æ— æ³•é€šè¿‡æŸ¥è¯¢æ¥æ›´æ–°<ul><li><a href="https://github.com/yakaz/elasticsearch-action-updatebyquery" target="_blank" rel="noopener noreferrer">yakaz/elasticsearch-action-updatebyquery</a>
è¯¥æ’ä»¶ç›®å‰å·²ç»ä¸å¯ç”¨</li><li>æè®®æ·»åŠ è¯¥åŠŸèƒ½ <a href="https://github.com/elastic/elasticsearch/issues/2230" target="_blank" rel="noopener noreferrer">#2230</a></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="best-practice"></a>Best practice<a class="hash-link" href="#best-practice" title="Direct link to heading">#</a></h2><ul><li>åªç´¢å¼•ä¸æ›´æ–°</li><li>æ—¥å¿—ç´¢å¼•åˆ†æ—¥æœŸ</li><li>å®šä¹‰å¥½ Mapping</li><li>æŒ‚è½½å¤šä¸ªç£ç›˜ä½¿ç”¨å¤šä¸ª path.data<ul><li>æå‡ç´¢å¼•é€Ÿåº¦</li><li>å‡å°‘æ•°æ®ä¸¢å¤±</li></ul></li><li>å¦‚æœå…è®¸, å¢å¤§åˆ·æ–°é—´éš”</li><li>æœ€å¤§ä½¿ç”¨ 32G å†…å­˜, åˆ©ç”¨ JVM å‹ç¼©æŒ‡é’ˆ<ul><li>æµ‹è¯•æœ€å¤§å†…å­˜é‡</li></ul></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">java -Xmx32600m -XX:+PrintFlagsFinal </span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">2</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> UseCompressedOops</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">bool UseCompressedOops   :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>1.7 32600m, 1.8 32766m</li><li>å…³é—­å†…å­˜ swap<ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/heap-sizing.html" target="_blank" rel="noopener noreferrer">å½±å“ GC</a></li></ul></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">swapoff -a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># æˆ–è€…</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sysctl vm.swappiness</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># åœ¨ Elasticsearch é…ç½®ä¸­æ·»åŠ  bootstrap.mlockall: true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>å¦‚æœè‡ªå®šä¹‰ ID, é€‰æ‹©ä¸€ä¸ªè¾ƒå¥½çš„ ID<ul><li>å‰ç¼€ç›¸åŒ</li><li>é•¿åº¦ç›¸åŒ</li><li><a href="http://blog.mikemccandless.com/2014/05/choosing-fast-unique-identifier-uuid.html" target="_blank" rel="noopener noreferrer">Choosing fast unique id</a></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><ul><li><a href="https://benchmarks.elastic.co" target="_blank" rel="noopener noreferrer">Elasticsearch nightly benchmarks</a></li><li><a href="https://people.apache.org/~mikemccand/lucenebench/" target="_blank" rel="noopener noreferrer">Lucene nightly benchmarks</a></li><li>Articles
<em> <a href="https://www.elastic.co/blog/found-elasticsearch-from-the-bottom-up" target="_blank" rel="noopener noreferrer">Elasticsearch from the bottom up</a></em> <a href="https://www.elastic.co/blog/performance-considerations-elasticsearch-indexing" target="_blank" rel="noopener noreferrer">Performance consideration</a> * <a href="https://www.elastic.co/blog/performance-indexing-2-0" target="_blank" rel="noopener noreferrer">Performance consideration 2.0</a><ul><li><a href="https://www.loggly.com/blog/nine-tips-configuring-elasticsearch-for-high-performance/" target="_blank" rel="noopener noreferrer">9 Tips on ElasticSearch Configuration for High Performance</a></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ<a class="hash-link" href="#å¸¸ç”¨æ“ä½œ" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ‰¹é‡å¯¼å…¥"></a>æ‰¹é‡å¯¼å…¥<a class="hash-link" href="#æ‰¹é‡å¯¼å…¥" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å¯¼å…¥å‰å…³é—­åˆ·æ–°</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPUT localhost:9200/test/_settings -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;index&quot; : {&quot;refresh_interval&quot; : &quot;-1&quot;} }&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å¯¼å…¥å‰å–æ¶ˆå‰¯æœ¬</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPUT </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/test/_settings&#x27;</span><span class="token plain"> -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;index&quot; : {&quot;number_of_replicas&quot; : 0}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å¯¼å…¥å®Œæˆå¼ºåˆ¶åˆå¹¶</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPOST </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/test/_forcemerge?max_num_segments=5&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ›´æ”¹è§£æå™¨"></a>æ›´æ”¹è§£æå™¨<a class="hash-link" href="#æ›´æ”¹è§£æå™¨" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># æ›´æ”¹å‰éœ€è¦å…ˆå…³é—­æ‰€æœ‰</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPOST </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/test/_close&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPUT </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/test/_settings&#x27;</span><span class="token plain"> -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;analysis&quot; : {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;analyzer&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">      &quot;content&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;type&quot;:&quot;custom&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;tokenizer&quot;:&quot;whitespace&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å®Œæˆåæ‰“å¼€ç´¢å¼•</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPOST </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/test/_open&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="è¯Šæ–­"></a>è¯Šæ–­<a class="hash-link" href="#è¯Šæ–­" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># æŸ¥çœ‹ jvm å†…å­˜çŠ¶æ€</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> localhost:9200/_nodes/stats</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> jq </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.nodes[].jvm.mem&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å•ä¸ªèŠ‚ç‚¹å†…å­˜çŠ¶æ€</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> localhost:9210/_nodes/stats</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> jq </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[.nodes[]]|.[1].jvm.mem&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å¿«é€Ÿä¿¡æ¯æŸ¥çœ‹ç«¯å£, ?help æ˜¾ç¤ºåˆ—çš„å«ä¹‰</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> localhost:9200/_cat</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># æŸ¥çœ‹æ¢å¤è¿›åº¦</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> localhost:9200/_cat/recovery</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ¨¡å—"></a>æ¨¡å—<a class="hash-link" href="#æ¨¡å—" title="Direct link to heading">#</a></h2><p>Elasticsearch çš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯ç”±å„ä¸ªæ¨¡å—ç»„æˆçš„.</p><p>æ¨¡å—é…ç½®åˆ†ä¸ºé™æ€é…ç½®å’ŒåŠ¨æ€é…ç½®,é™æ€é…ç½®éœ€è¦åœ¨ç›¸å…³èŠ‚ç‚¹çš„ <code>elasticsearch.yml</code> ä¸­æŒ‡å®š,åŠ¨æ€èŠ‚ç‚¹å¯é€šè¿‡<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html" target="_blank" rel="noopener noreferrer">ç›¸å…³æ¥å£</a> è¿›è¡Œæ›´æ”¹.</p><table><thead><tr><th>æ¨¡å—</th><th>è´£ä»»</th></tr></thead><tbody><tr><td>Cluster</td><td>æ§åˆ¶å¦‚ä½•ä¸ºèŠ‚ç‚¹ç”³è¯·åˆ†ç‰‡.</td></tr><tr><td>Discovery</td><td>èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­å¦‚ä½•ç›¸äº’å‘ç°</td></tr><tr><td>Gateway</td><td>é›†ç¾¤ä¸­éœ€è¦å¤šå°‘èŠ‚ç‚¹æ‰èƒ½å¼€å§‹æ¢å¤</td></tr><tr><td>HTTP</td><td>æ§åˆ¶ HTTP REST æ¥å£</td></tr><tr><td>Indices</td><td>å…¨å±€ç´¢å¼•ç›¸å…³é…ç½®</td></tr><tr><td>Network</td><td>æ§åˆ¶é»˜è®¤ç½‘ç»œè®¾ç½®</td></tr><tr><td>Node client</td><td>åŠ å…¥åˆ°é›†ç¾¤ä¸­çš„ Java å®¢æˆ·ç«¯,ä¸ä¼šæŒæœ‰æ•°æ®å’Œæ‰¿æ‹…ä¸»èŠ‚ç‚¹çš„è´£ä»».</td></tr><tr><td>Plugins</td><td>ä½¿ç”¨æ’ä»¶æ¥æ‰©å±• Elasticsearch</td></tr><tr><td>Scripting</td><td>å®šåˆ¶åŒ–çš„ Lucene Expressions, Groovy, Python, å’Œ Javascript è„šæœ¬.</td></tr><tr><td>Snapshot/Restore</td><td>å¤‡ä»½å’Œæ¢å¤æ•°æ®</td></tr><tr><td>Thread pools</td><td>Elasticsearch ä¸­çš„çº¿ç¨‹æ± ä¿¡æ¯</td></tr><tr><td>Transport</td><td>ä¼ è¾“å±‚æ§åˆ¶,èŠ‚ç‚¹å†…éƒ¨é€šä¿¡</td></tr><tr><td>Tribe nodes</td><td>A tribe node joins one or more clusters and acts as a federated client across them.</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="query-dsl"></a>Query DSL<a class="hash-link" href="#query-dsl" title="Direct link to heading">#</a></h2><p>ES çš„æ‰€æœ‰æ¥å£éƒ½æ˜¯é€šè¿‡ RESTful æ¥å£æš´éœ²çš„,å› æ­¤æ‰€æœ‰å¯¹ ES çš„æ•°æ®æ“ä½œå‡å¯ä»¥é€šè¿‡ REST Api å®Œæˆ.æ‰€æœ‰çš„æ¥å£ä¹Ÿéƒ½éµå¾ª HTTP è¯·æ±‚æ–¹æ³•è¯­ä¹‰.</p><p>ES æä¾›äº†ä¸€å¥—é€šè¿‡ JSON è¡¨ç¤ºçš„æŸ¥è¯¢æ¥å£.æŸ¥è¯¢è¯­å¥ä¸»è¦åŒ…å«</p><p>å¶æŸ¥è¯¢è¯­å¥/Leaf query clauses
: ç”¨äºæ•°æ®çš„æŒ‡å®šå­—æ®µ,ä¾‹å¦‚å­—æ®µåŒ¹é…,å­—æ®µèŒƒå›´ç­‰æŸ¥è¯¢.</p><p>ç»„åˆæŸ¥è¯¢è¯­å¥/Compound query clauses
: ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦æ¥ç»„åˆä¸€ä¸ªæˆ–å¤šä¸ªå¶æŸ¥è¯¢æˆ–ç»„åˆæŸ¥è¯¢è¯­å¥.</p><p>æŸ¥è¯¢è¯­å¥çš„è¡Œä¸ºå¯èƒ½ä¼šéšä½¿ç”¨çš„ä¸Šä¸‹æ–‡è€Œå‘ç”Ÿæ”¹å˜.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æŸ¥è¯¢å’Œè¿‡æ»¤ä¸Šä¸‹æ–‡"></a>æŸ¥è¯¢å’Œè¿‡æ»¤ä¸Šä¸‹æ–‡<a class="hash-link" href="#æŸ¥è¯¢å’Œè¿‡æ»¤ä¸Šä¸‹æ–‡" title="Direct link to heading">#</a></h3><p>æŸ¥è¯¢ä¸Šä¸‹æ–‡
: æŸ¥è¯¢è¯­å¥åœ¨æŸ¥è¯¢ä¸Šä¸‹æ–‡ä¸­ç”¨äºå›ç­” &quot;è¯¥æ–‡æ¡£ä¸æŸ¥è¯¢è¯­å¥æœ‰å¤šä¹ˆåŒ¹é…&quot; çš„é—®é¢˜,åœ¨åˆ¤æ–­ä¸€ä¸ªæ–‡æ¡£æ˜¯å¦åŒ¹é…çš„åŒæ—¶,ä¹Ÿä¼šè®¡ç®—å‡ºæ¯ä¸ªæ–‡æ¡£çš„åŒ¹é…ç¨‹åº¦(åˆ†æ•° <code>_score</code>),ç”¨äºè¡¨ç¤ºè¯¥æ–‡æ¡£ä¸æŸ¥è¯¢çš„çš„åŒ¹é…å’Œç›¸å…³ç¨‹åº¦.</p><p>è¿‡æ»¤ä¸Šä¸‹æ–‡
: åœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­æŸ¥è¯¢è¯­å¥ç”¨äºå›ç­” &quot;è¯¥æ–‡æ¡£æ˜¯å¦åŒ¹é…è¯¥æŸ¥è¯¢è¯­å¥&quot;,å…¶ç»“æœåªæœ‰åŒ¹é…æˆ–ä¸åŒ¹é….</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GET _search</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;query&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;bool&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;must&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        { &quot;match&quot;: { &quot;title&quot;:   &quot;Search&quot;        }},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        { &quot;match&quot;: { &quot;content&quot;: &quot;Elasticsearch&quot; }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;filter&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        { &quot;term&quot;:  { &quot;status&quot;: &quot;published&quot; }},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        { &quot;range&quot;: { &quot;publish_date&quot;: { &quot;gte&quot;: &quot;2015-01-01&quot; }}}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æŸ¥è¯¢åœ°å€"></a>æŸ¥è¯¢åœ°å€<a class="hash-link" href="#æŸ¥è¯¢åœ°å€" title="Direct link to heading">#</a></h3><p>æ‰€æœ‰ Elasticsearch çš„ API å‡ä»¥ RESTful çš„å½¢å¼æš´éœ², åŸºæœ¬æŸ¥è¯¢çš„æ ¼å¼å¦‚ä¸‹</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[/ç´¢å¼•å[,ç´¢å¼•å...]][/ç±»å‹å[,ç±»å‹å...]]/_search</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>æŸ¥è¯¢ä¸­çš„ç´¢å¼•åå’Œç±»å‹åæ˜¯å¯ä»¥ç¼ºçœçš„,å¹¶ä¸”ä¹Ÿæ”¯æŒé€šé…ç¬¦,ä¾‹å¦‚å¦‚ä¸‹è¯·æ±‚:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST localhost:9200/mq-*/meta,body/_search -d &#x27;{&quot;query&quot;:{&quot;match_all&quot;:{}}}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Elasticsearch çš„æŸ¥è¯¢é™¤äº†æ”¯æŒ GET ä¹Ÿæ”¯æŒä½¿ç”¨ POST, å› ä¸ºåœ¨ç°æœ‰çš„éƒ¨åˆ†ç³»ç»Ÿé‡Œ, GET ä¸å…è®¸æºå¸¦è¯·æ±‚ä½“.ä¾‹å¦‚ä»¥ä¸‹è¯·æ±‚æ˜¯ç›¸åŒçš„:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XGET localhost:9200/_search -d &#x27;{&quot;query&quot;:{&quot;match_all&quot;:{}}}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST localhost:9200/_search -d &#x27;{&quot;query&quot;:{&quot;match_all&quot;:{}}}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>é™¤æ­¤ä¹‹å¤–, Elasticsearch ä¹Ÿæ”¯æŒé’ˆå¯¹å•ä¸ªæ–‡æ¡£çš„æ ‡ç¤ºç¬¦è¿›è¡ŒæŸ¥è¯¢,ä¾‹å¦‚:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XGET localhost:9200/mq-meta-local/meta/THIS_IS_MY_DOCUMENT_ID</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æŸ¥è¯¢ç±»å‹"></a>æŸ¥è¯¢ç±»å‹<a class="hash-link" href="#æŸ¥è¯¢ç±»å‹" title="Direct link to heading">#</a></h3><p>Elasticsearch çš„åº•å±‚æœç´¢æ˜¯ Lucene, å…¶æä¾›çš„æŸ¥è¯¢ä¹Ÿä¸»è¦æ˜¯å¯¹ Lucene æŸ¥è¯¢çš„å°è£….</p><table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>match_all</td><td>åŒ¹é…æ‰€æœ‰æ–‡æ¡£,<code>_score</code> ä¸º <code>1.0</code><br>å¯é€šè¿‡ <code>boost</code> æ›´æ”¹åˆ†æ•°å€¼</td></tr><tr><td>match</td><td>æ¨¡ç³Šè¿‘ä¼¼åŒ¹é…</td></tr><tr><td>multi_match</td><td>ä¸ match ç›¸åŒ,å¯æŒ‡å®šå¤šä¸ªå­—æ®µ</td></tr><tr><td>common_terms</td><td>ä¸€ä¸ªæ›´ç‰¹æ®Šçš„æŸ¥è¯¢,ä¼šæ›´è¶‹å‘äºé€‰æ‹©ä¸å¸¸è§çš„è¯</td></tr><tr><td>query_string</td><td>æ”¯æŒ Lucene æŸ¥è¯¢è¯­æ³•,å¯ä½¿ç”¨ <code>AND,OR,NOT</code> æ¡ä»¶,å¯åœ¨å•ä¸ªæŸ¥è¯¢ä¸­æ ‡ç¤ºå¤šä¸ªå­—æ®µçš„æœç´¢<br><strong>éœ€è°¨æ…ä½¿ç”¨</strong></td></tr><tr><td>simple_query_string</td><td>ä¸€ä¸ªæ›´é«˜æ•ˆçš„ query_string ç‰ˆæœ¬,é€‚åˆæ™®é€šç”¨æˆ·ä½¿ç”¨</td></tr><tr><td>term</td><td>åŒ¹é…å­—æ®µåŒ…å«çš„è¯</td></tr><tr><td>terms</td><td>åŒ¹é…å­—æ®µåŒ…å«çš„è¯</td></tr><tr><td>range</td><td>ä½¿ç”¨èŒƒå›´åŒ¹é…å­—æ®µçš„å€¼(æ—¥æœŸ,æ•°å­—,å­—ç¬¦ä¸²ç­‰)</td></tr><tr><td>exists</td><td>åŒ¹é…éç©ºå­—æ®µ</td></tr><tr><td>missing</td><td>åŒ¹é…ä¸å­˜åœ¨å­—æ®µæˆ–ä¸ºç©ºçš„å­—æ®µ</td></tr><tr><td>prefix</td><td>åŒ¹é…å­—æ®µå€¼å‰ç¼€</td></tr><tr><td>wildcard</td><td>ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…å­—æ®µçš„å€¼<br><code>?</code> å•ä¸ªå­—ç¬¦,<code>*</code> å¤šä¸ªå­—ç¬¦</td></tr><tr><td>regexp</td><td>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å­—æ®µçš„å€¼</td></tr><tr><td>fuzzy</td><td>æ¨¡ç³ŠåŒ¹é…å­—æ®µçš„å€¼,ä½¿ç”¨<a href="https://zh.wikipedia.org/wiki/%E8%8E%B1%E6%96%87%E6%96%AF%E5%9D%A6%E8%B7%9D%E7%A6%BB" target="_blank" rel="noopener noreferrer">è±æ–‡æ–¯å¦è·ç¦»</a>è¿›è¡Œåº¦é‡.</td></tr><tr><td>type</td><td>åŒ¹é…æ–‡æ¡£ç±»å‹</td></tr><tr><td>ids</td><td>æŸ¥æ‰¾æ–‡æ¡£ ID</td></tr><tr><td>constant_score</td><td>è¯¥æŸ¥è¯¢ä¼šåŒ…è£…å¦å¤–ä¸€ä¸ªæŸ¥è¯¢,å¹¶åœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ.æ‰€æœ‰åŒ¹é…çš„æ–‡æ¡£éƒ½ä¼šç»™äºˆä¸€ä¸ªå›ºå®šçš„åˆ†æ•°(<code>_score</code>)</td></tr><tr><td>bool</td><td>ç”¨äºç»„åˆå¤šä¸ª must, should, must_not, å’Œ filter æŸ¥è¯¢.must å’Œ should è¯­å¥ç»“æœçš„åˆ†æ•°ä¼šåˆå¹¶, must_not å’Œ filter ä¼šåœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ.</td></tr><tr><td>dis_max</td><td>ç”Ÿæˆå¤šä¸ªå­æŸ¥è¯¢çš„å¹¶é›†,å¹¶ä¸ºå•ä¸ªæŸ¥è¯¢ç»“æœä¸­åˆ†æ•°æœ€é«˜çš„æ–‡æ¡£è¿›è¡Œå¢å¼º.</td></tr><tr><td>function_score</td><td>ä½¿ç”¨æŒ‡å®šçš„å‡½æ•°å¯¹æŸ¥è¯¢ç»“æœçš„åˆ†æ•°è¿›è¡Œä»æ–°è®¡ç®—.</td></tr><tr><td>boosting</td><td>å¯ä½¿ç”¨æŒ‡å®šçš„æŸ¥è¯¢è¯­å¥æ¥å¢å¼ºå’Œå‰Šå¼±ç»“æœåˆ†æ•°.</td></tr><tr><td>indices</td><td>åœ¨æŒ‡å®šç´¢å¼•ä¸­è¿›è¡ŒæŸ¥è¯¢</td></tr><tr><td>and, or, not</td><td>ç­‰åŒäº bool</td></tr><tr><td>filtered</td><td>äº 2.0.0-beta1 é—å¼ƒ,ä½¿ç”¨ bool æŸ¥è¯¢æ›¿ä»£.</td></tr><tr><td>limit</td><td>é™åˆ¶æ¯ä¸ªåˆ†ç‰‡æŸ¥è¯¢çš„æ–‡æ¡£æ•°</td></tr><tr><td>nested</td><td>ç”¨äºæœç´¢ nested ç±»å‹çš„å­—æ®µ.</td></tr><tr><td>has_child,has_parent</td><td>ç”¨äºæœç´¢çˆ¶å­å…³ç³»çš„æ–‡æ¡£.</td></tr><tr><td>more_like_this</td><td>æŸ¥è¯¢ç±»ä¼¼äºç»™å®šçš„å­—ç¬¦ä¸²,æ–‡æ¡£æˆ–æ–‡æ¡£é›†åˆ.</td></tr><tr><td>template</td><td>æ¨¡æ¿æŸ¥è¯¢</td></tr><tr><td>script</td><td>è„šæœ¬æŸ¥è¯¢</td></tr><tr><td>geo_shape</td><td>æŸ¥æ‰¾å½¢çŠ¶äº¤å‰çš„æ–‡æ¡£</td></tr><tr><td>geo_bounding_box</td><td>æŸ¥æ‰¾ç‚¹åœ¨è¯¥çŸ©å½¢å†…æ–‡æ¡£</td></tr><tr><td>geo_distance</td><td>æŸ¥æ‰¾ç‚¹è·ä¹‹å†…çš„æ–‡æ¡£</td></tr><tr><td>geo_distance_range</td><td>æŸ¥æ‰¾ç‚¹è·åœ¨æŒ‡å®šèŒƒå›´å†…çš„æ–‡æ¡£</td></tr><tr><td>geo_polygon</td><td>æŸ¥æ‰¾ç‚¹åœ¨è¯¥å¤šè¾¹å½¢å†…çš„æ–‡æ¡£</td></tr><tr><td>geohash_cell</td><td>æŸ¥æ‰¾ç‚¹ä¸æŒ‡å®šç‚¹ geohash äº¤å‰çš„æ–‡æ¡£</td></tr><tr><td>span_term</td><td>ä¸ term æŸ¥è¯¢ç›¸åŒ,ç”¨äºä¸å…¶ä»–è·¨åº¦æŸ¥è¯¢ç»“åˆä½¿ç”¨</td></tr><tr><td>span_multi</td><td>ç”¨äºåŒ…è£… term, range, prefix, wildcard, regexp, æˆ– fuzzy æŸ¥è¯¢</td></tr><tr><td>span_first</td><td>åŒ¹é…å­—æ®µæ»¡è¶³æŸ¥è¯¢,å¹¶ä¸”åœ¨å‰ N ä½ç½®</td></tr><tr><td>span_near</td><td>åŒ¹é…æ»¡è¶³å¤šä¸ªæŸ¥è¯¢,å¹¶ä¸”æŸ¥è¯¢è·¨åº¦åœ¨ä¸€å®šè·ç¦»å†…,ä¹Ÿå¯æŒ‡å®šæ˜¯å¦ä¿æŒåŒæ ·çš„é¡ºåº</td></tr><tr><td>span_or</td><td>å¤šä¸ªè·¨åº¦æŸ¥è¯¢çš„é€»è¾‘æˆ–</td></tr><tr><td>span_not</td><td>æ’é™¤ä¸€ä¸ªè·¨åº¦æŸ¥è¯¢</td></tr><tr><td>span_containing</td><td>æŒ‡å®šä¸€åˆ—è·¨åº¦æŸ¥è¯¢,ä½†åªè¿”å›è·¨åº¦æ»¡è¶³ç¬¬äºŒä¸ªè·¨åº¦æŸ¥è¯¢çš„ç»“æœ</td></tr><tr><td>span_within</td><td>æŒ‡å®šä¸€ä¸ªè·¨åº¦æŸ¥è¯¢,è¿”å›è·¨åº¦æ»¡è¶³å¦å¤–ä¸€åˆ—è·¨åº¦æŸ¥è¯¢çš„ç»“æœ</td></tr></tbody></table><p>å…¨æ–‡æŸ¥è¯¢
: match,multi_match,common_terms,query_string,simple_query_string
: æŸ¥è¯¢å­—æ®µå¿…é¡»æ˜¯ analyzed
: åœ¨æŸ¥è¯¢å‰ä¼šå¯¹æŸ¥è¯¢å­—ç¬¦ä¸²åº”ç”¨å­—æ®µçš„è§£æå™¨(analyzer,search_analyzer)</p><p>è¯çº§æŸ¥è¯¢
: term,terms,range,exists,missing,prefix,wildcard,regexp,fuzzy,type,ids
: ä¸åŒäºå…¨æ–‡æŸ¥è¯¢,åœ¨ä¹‹å‰éœ€è¦å¯¹æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œè§£æ.è¯çº§æŸ¥è¯¢ç”¨äºæŸ¥è¯¢å­—æ®µç¡®åˆ‡çš„å€¼.</p><p>ç»„åˆæŸ¥è¯¢
: constant_score,bool,filter,dis_max,function_score,boosting,indices,and,or,not,filtered,limit</p><p>å…³è”æŸ¥è¯¢
: nested,has_child,has_parent</p><p>GEO æŸ¥è¯¢
: geo_shape,geo_bounding_box,geo_distance,geo_distance_range,geo_polygon,geohash_cell</p><p>è·¨åº¦æŸ¥è¯¢
: span_term,span_multi,span_first,span_near,span_or,span_not,span_containing,span_within
: é™¤äº† span_multi ä»¥å¤–,è·¨åº¦æŸ¥è¯¢ä¸èƒ½ä¸éè·¨åº¦æŸ¥è¯¢æ··åˆä½¿ç”¨
: <a href="https://lucidworks.com/blog/2009/07/18/the-spanquery/" target="_blank" rel="noopener noreferrer">https://lucidworks.com/blog/2009/07/18/the-spanquery/</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="query-string"></a>Query String<a class="hash-link" href="#query-string" title="Direct link to heading">#</a></h4><p>Elasticsearch å¯ä»¥åˆ©ç”¨ Lucene ä¸­å¼ºå¤§çš„ query_string æŸ¥è¯¢è¯­æ³•,å…¶åŠŸèƒ½å¼ºå¤§å¹¶ä¸”ä¹¦å†™ç®€å•,ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ url ä¸­è¿›è¡ŒæŸ¥è¯¢.
ä¾‹å¦‚:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Query string syntax</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XGET </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/index/type/_search?q=name:wener AND age:&gt;10&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¦‚æœå°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºåŸºäº DSL çš„æŸ¥è¯¢åˆ™æ˜¯</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># DSL syntax</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPOST </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/index/type/_search&#x27;</span><span class="token plain"> -d</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;query&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;bool&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">            &quot;must&quot;:[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">                &quot;term&quot;:{&quot;name&quot;:&quot;wener&quot;},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">                &quot;range&quot;:{&quot;age&quot;:{&quot;gt&quot;:10}}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">            ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>å¯è§å–„ç”¨ query_string æŸ¥è¯¢æ˜¯éå¸¸æœ‰ç”¨çš„.åœ¨ Kibana çš„è§†å›¾æŸ¥è¯¢ç•Œé¢å‡æ˜¯ query_string æŸ¥è¯¢.</p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer">Query String è¯­æ³•</a></li><li><a href="http://lucene.apache.org/core/5_5_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description" target="_blank" rel="noopener noreferrer">Lucene æŸ¥è¯¢è§£æè¯­æ³•</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ€»ç»“"></a>æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">#</a></h3><p>Elasticsearch å¯¹äºåŸºç¡€çš„æŸ¥è¯¢æä¾›äº†éå¸¸å¤šçš„æŸ¥è¯¢æ–¹å¼,ä½†å¯¹äºå…³ç³»å‹çš„æ”¯æŒè¾ƒå°‘,å®˜æ–¹å»ºè®®æ˜¯åœ¨åº”ç”¨ç«¯åšæ•°æ®å…³è”,å¯¹å…³ç³»å‹çš„å¤„ç†æœ‰ä¸€å®šçš„å¤æ‚åº¦.å†…ç½®äº†ä¸¤ç§å¯¹å…³ç³»å‹æ•°æ®çš„æ”¯æŒ(Nested Object, Parent-Child),ä½†æ”¯æŒéƒ½ç›¸å¯¹è¾ƒä¸ºè–„å¼±,éš¾ä»¥å¤„ç†å¤æ‚çš„åœºæ™¯,è¿˜ä¸å¦‚ä½¿ç”¨é€šå¸¸çš„æ–‡æ¡£,è¿™æ ·å¯¹æ–‡æ¡£çš„æ§åˆ¶æ›´å…¨é¢.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="å‚è€ƒ"></a>å‚è€ƒ<a class="hash-link" href="#å‚è€ƒ" title="Direct link to heading">#</a></h3><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html" target="_blank" rel="noopener noreferrer">Query DSL</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="é«˜å¯ç”¨æœºåˆ¶"></a>é«˜å¯ç”¨æœºåˆ¶<a class="hash-link" href="#é«˜å¯ç”¨æœºåˆ¶" title="Direct link to heading">#</a></h2><p>Elasticsearch çš„é«˜å¯ç”¨æ˜¯é€šè¿‡åˆ†ç‰‡çš„å¤šå‰¯æœ¬ä¿éšœçš„.å¯¹äºæ¯ä¸ªç´¢å¼•æŒ‡å®šä¸€å®šçš„åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬æ•°é‡.æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡ç¤º,é€šè¿‡è¯¥æ ‡ç¤ºç¬¦æ¥å¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç‰‡è·¯ç”±.å¦‚æœæ¥å—åˆ°è¯·æ±‚çš„èŠ‚ç‚¹æ²¡æœ‰è¯¥åˆ†é…,åˆ™ä¼šç”±è¯¥åˆ†ç‰‡è½¬å‘åˆ°è¯¥åˆ†ç‰‡ä¸»åˆ†ç‰‡çš„ä¸»èŠ‚ç‚¹.</p><p>ELasticsearch çš„é«˜å¯ç”¨å½¢å¼å’Œ Kafak, Hazelcast çš„é«˜å¯ç”¨å‡ ä¹ç›¸åŒ,å‡æ˜¯å›ºå®šåˆ†ç‰‡å’Œå‰¯æœ¬.</p><p>Elasticsearch é›†ç¾¤ä¸­èŠ‚ç‚¹è§’è‰²åˆ†ä¸ºä¸»èŠ‚ç‚¹,æ•°æ®èŠ‚ç‚¹,å®¢æˆ·ç«¯èŠ‚ç‚¹, Tribe èŠ‚ç‚¹.</p><p>æ‰€æœ‰çš„ç´¢å¼•æ“ä½œéƒ½ä¼šå¯¹ç£ç›˜è¿›è¡Œè¿½åŠ æ“ä½œ,è€Œä¸æ˜¯ç›´æ¥çš„å¯¹æ–‡æ¡£è¿›è¡Œä¿®æ”¹,åå°æœ‰å›ºå®šçš„çº¿ç¨‹çš„è¿½åŠ çš„æ•°æ®è¿›è¡Œåˆå¹¶.</p><ul><li>åŒæ­¥æœºåˆ¶</li><li>æ•°æ®åˆ·ç›˜æ–¹å¼</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ä¸»å‰¯æœ¬åˆ†ç‰‡äº¤äº’è¿‡ç¨‹"></a>ä¸»å‰¯æœ¬åˆ†ç‰‡äº¤äº’è¿‡ç¨‹<a class="hash-link" href="#ä¸»å‰¯æœ¬åˆ†ç‰‡äº¤äº’è¿‡ç¨‹" title="Direct link to heading">#</a></h3><ul><li>ä¸»å‰¯æœ¬åˆ†ç‰‡ç»“æ„
<img src="https://www.elastic.co/guide/en/elasticsearch/guide/current/images/elas_0401.png"></li><li>åˆ›å»º,ç´¢å¼•æˆ–åˆ é™¤æ–‡æ¡£
<img src="https://www.elastic.co/guide/en/elasticsearch/guide/current/images/elas_0402.png"></li><li>è·å–å•ä¸ªæ–‡æ¡£
<img src="https://www.elastic.co/guide/en/elasticsearch/guide/current/images/elas_0403.png"></li><li>éƒ¨åˆ†æ›´æ–°
<img src="https://www.elastic.co/guide/en/elasticsearch/guide/current/images/elas_0404.png"><ul><li>å³ä¾¿æ˜¯éƒ¨åˆ†æ›´æ–°,æ¯æ¬¡å‘é€ç»™å‰¯æœ¬çš„éƒ½æ˜¯ä¸€ä¸ªå…¨é‡çš„æ–‡æ¡£</li><li>æ­¤æ—¶çš„æ–‡æ¡£åˆ†å‘æ˜¯å¼‚æ­¥çš„,ä¸ä¿è¯å…¶é¡ºåº</li></ul></li><li>åŒæ—¶æ“ä½œå¤šä¸ªæ–‡æ¡£<ul><li>mget
<img src="https://www.elastic.co/guide/en/elasticsearch/guide/current/images/elas_0405.png"></li><li>bulk
<img src="https://www.elastic.co/guide/en/elasticsearch/guide/current/images/elas_0406.png"></li></ul></li></ul><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_how_primary_and_replica_shards_interact.html" target="_blank" rel="noopener noreferrer">How Primary and Replica Shards Interact</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="discovery"></a>Discovery<a class="hash-link" href="#discovery" title="Direct link to heading">#</a></h3><p>Master
: å”¯ä¸€å¯ä»¥å‘å¸ƒæ–°çš„é›†ç¾¤çŠ¶æ€çš„èŠ‚ç‚¹
: ç”¨äºå“åº”é›†ç¾¤æ“ä½œ,ä¿®æ”¹èŠ‚ç‚¹,å¢åˆ æ”¹ç´¢å¼•ä¿¡æ¯,ä¸ºèŠ‚ç‚¹åˆ†é…åˆ†ç‰‡
: ç´¢å¼•å’Œæœç´¢ç­‰ä¸éœ€è¦ç‰µæ¶‰åˆ°ä¸»èŠ‚ç‚¹</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">discovery.zen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">minimum_master_nodes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> é€‰ä¸¾ä¸»èŠ‚ç‚¹çš„æœ€å° master eligible èŠ‚ç‚¹æ•°</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ç±»ä¼¼äº Zookeeper é‡Œçš„å¤§å¤šæ•°</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">ping.unicast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> å•æ’­æ—¶è¿›è¡Œå‘ç°çš„ä¸»æœºä¿¡æ¯</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">master_election</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">filter_client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> é»˜è®¤ true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">filter_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> é»˜è®¤ false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">fd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Fault Detection</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ping_interval</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ping_timeout</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 30s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ping_retries</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">publish_timeout</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 30s å‘å¸ƒé›†ç¾¤çŠ¶æ€çš„è¶…æ—¶æ—¶é—´</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">no_master_block</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> å½“æ²¡æœ‰ Master æ—¶éœ€è¦æ‹’ç»çš„æ“ä½œ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">ä¸ä¼šé˜»æ­¢å’ŒèŠ‚ç‚¹ç›¸å…³çš„ API</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    all</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    write é»˜è®¤.å¯èƒ½ä¼šè¯»å–åˆ°è¿‡æœŸæ•°æ®.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="local-gateway"></a>Local Gateway<a class="hash-link" href="#local-gateway" title="Direct link to heading">#</a></h3><ul><li>ç”¨äºæœ¬åœ°å­˜å‚¨é›†ç¾¤èŠ‚ç‚¹å’Œåˆ†ç‰‡ä¿¡æ¯.å³ä¾¿åœ¨é›†ç¾¤å®Œå…¨é‡å¯åä¹Ÿä¼šä¿æŒ.</li><li>å­˜å‚¨çš„èŠ‚ç‚¹å’Œé›†ç¾¤ä¿¡æ¯ä¼šç”¨äºç¡®å®šä½•æ—¶è¿›è¡Œæ•°æ®æ¢å¤è°ƒåº¦.</li><li>é…ç½®é¡¹çš„æ›´æ”¹åªæœ‰åœ¨é›†ç¾¤å®Œå…¨é‡å¯åæ‰ä¼šç”Ÿæ•ˆ.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="å‚è€ƒ-1"></a>å‚è€ƒ<a class="hash-link" href="#å‚è€ƒ-1" title="Direct link to heading">#</a></h3><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/resiliency/current/index.html" target="_blank" rel="noopener noreferrer">å¼¹æ€§æ‰©å®¹çš„é—®é¢˜</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ¢å¤å¤‡ä»½"></a>æ¢å¤å¤‡ä»½<a class="hash-link" href="#æ¢å¤å¤‡ä»½" title="Direct link to heading">#</a></h2><p>Elasticsearch æ”¯æŒå¿«ç…§å’Œæ¢å¤</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># éœ€è¦é…ç½® path.repo: /home/data/es-backup</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Snapshot repository</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPUT </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/_snapshot/backup&#x27;</span><span class="token plain"> -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;type&quot;: &quot;fs&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;settings&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">      &quot;compress&quot;: &quot;true&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">      &quot;location&quot;: &quot;/home/data/es-backup/backup&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XGET localhost:9200/_snapshot/backup?pretty</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XGET localhost:9200/_snapshot/_all?pretty</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Backup</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPUT </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/_snapshot/backup/bckp1&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPUT </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/_snapshot/backup/bckp2?wait_for_completion=true&amp;pretty&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPUT </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/_snapshot/backup/bckp?wait_for_completion=true&amp;pretty&#x27;</span><span class="token plain"> -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;indices&quot;: &quot;mq-*&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;ignore_unavailable&quot;: &quot;true&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;include_global_state&quot;: false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;partial&quot;:false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Restore</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPOST </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/_snapshot/backup/bckp1/_restore&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XPOST </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/_snapshot/backup/bck1/_restore?pretty&#x27;</span><span class="token plain"> -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;indices&quot;: &quot;c*&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Cancel/Delete</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -XDELETE </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:9200/_snapshot/backup/bckp1/_restore&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="å‚è€ƒ-2"></a>å‚è€ƒ<a class="hash-link" href="#å‚è€ƒ-2" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ•°æ®å»ºæ¨¡"></a>æ•°æ®å»ºæ¨¡<a class="hash-link" href="#æ•°æ®å»ºæ¨¡" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="parent-child"></a>Parent-Child<a class="hash-link" href="#parent-child" title="Direct link to heading">#</a></h3><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/parent-child.html" target="_blank" rel="noopener noreferrer">Parent Child Relationship</a></li><li>é€‚åˆäºå­æ–‡æ¡£ç‰¹åˆ«å¤š,çˆ¶æ–‡æ¡£è¾ƒå°‘çš„æƒ…å†µ</li><li>çˆ¶å­å…³ç³»çš„æ˜ å°„ä¼šå­˜å‚¨åœ¨å†…å­˜ä¸­</li><li>æ›´æ–°çˆ¶æ–‡æ¡£ä¸å½±å“å­æ–‡æ¡£</li><li>å¢åˆ æ”¹å­æ–‡æ¡£ä¸å½±å“çˆ¶æ–‡æ¡£</li><li>å‡å°‘çˆ¶æ–‡æ¡£ ID é•¿åº¦</li><li>çˆ¶å­éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªåˆ†ç‰‡</li><li>å¯ä»¥å®ç°ç¥–å­™å…³ç³»,å¢åŠ æ—¶éœ€è¦ä½¿ç”¨ routing æ¥æŒ‡å®šåˆ†ç‰‡</li><li>has_child filter ä¸ä¼šç¼“å­˜</li><li>æœç´¢å­æ–‡æ¡£æ—¶,é¿å…ä½¿ç”¨ score_mode</li><li><code>GET /_nodes/stats/indices/id_cache?human</code> å¯æŸ¥çœ‹ç”¨äºç¼“å­˜çˆ¶å­å ç”¨çš„å†…å­˜</li><li>æ¯æ¬¡ç´¢å¼•æ›´æ”¹éœ€è¦é‡å»º Global Ordinals,å½“çˆ¶æ–‡æ¡£è¾ƒå¤šæ—¶,éœ€è¦å ç”¨å¤§é‡çš„æ—¶é—´,å¯é€šè¿‡ä¿®æ”¹ fielddata çš„ loading æ¥ä½¿å…¶å‘ç”Ÿåœ¨ refresh æ—¶è€Œä¸æ˜¯ query æ—¶.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="nested-object"></a>Nested Object<a class="hash-link" href="#nested-object" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="èšåˆ"></a>èšåˆ<a class="hash-link" href="#èšåˆ" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="å†…å­˜æ§åˆ¶"></a>å†…å­˜æ§åˆ¶<a class="hash-link" href="#å†…å­˜æ§åˆ¶" title="Direct link to heading">#</a></h3><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/controlling-memory.html" target="_blank" rel="noopener noreferrer">Controlling Memory</a></li><li>\$ES_HEAP_SIZE å¯ç”¨äºæ§åˆ¶å †å¤§å°,å°äºå¯ç”¨çš„ä¸€åŠ,å°äº 32G</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fielddata"></a>Fielddata<a class="hash-link" href="#fielddata" title="Direct link to heading">#</a></h4><ul><li>ä¼šå°†æ‰€æœ‰æ–‡æ¡£çš„ fielddata åŠ è½½åˆ°å†…å­˜,ä¸»è¦æ˜¯ uinvert index</li><li>ç¼“å­˜ä»¥æ®µä½å•ä½</li><li>ä¸»è¦ç”¨äºæ’åº,èšåˆå’Œéƒ¨åˆ†è¿‡æ»¤åŠè„šæœ¬</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ’ä»¶"></a>æ’ä»¶<a class="hash-link" href="#æ’ä»¶" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="å¸¸ç”¨æ’ä»¶"></a>å¸¸ç”¨æ’ä»¶<a class="hash-link" href="#å¸¸ç”¨æ’ä»¶" title="Direct link to heading">#</a></h3><ul><li><a href="https://github.com/mobz/elasticsearch-head" target="_blank" rel="noopener noreferrer">mobz/elasticsearch-head</a>
A web front end for an elastic search cluster</li><li><a href="https://github.com/lmenezes/elasticsearch-kopf" target="_blank" rel="noopener noreferrer">lmenezes/elasticsearch-kopf</a>
web admin interface for elasticsearch</li><li><a href="https://github.com/royrusso/elasticsearch-HQ" target="_blank" rel="noopener noreferrer">royrusso/elasticsearch-HQ</a>/<a href="http://www.elastichq.org/" target="_blank" rel="noopener noreferrer">online</a>
Monitoring and Management Web Application for ElasticSearch instances and clusters.</li><li><a href="https://www.elastic.co/guide/en/elasticsearch/plugins/2.2/delete-by-query-usage.html" target="_blank" rel="noopener noreferrer">delete-by-query</a></li><li>Update by query<ul><li><a href="https://github.com/yakaz/elasticsearch-action-updatebyquery" target="_blank" rel="noopener noreferrer">yakaz/elasticsearch-action-updatebyquery</a>
è¯¥æ’ä»¶ç›®å‰å·²ç»ä¸å¯ç”¨</li><li><a href="https://github.com/elastic/elasticsearch/issues/2230" target="_blank" rel="noopener noreferrer">#2230</a>
æ·»åŠ  Update by query è¯·æ±‚,ç›®å‰å·²ç»åˆå¹¶è¿˜æœªå‘å¸ƒ</li></ul></li><li>bigdesk</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ’ä»¶å¼€å‘"></a>æ’ä»¶å¼€å‘<a class="hash-link" href="#æ’ä»¶å¼€å‘" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æ›´æ–°"></a>æ›´æ–°<a class="hash-link" href="#æ›´æ–°" title="Direct link to heading">#</a></h2><p>æ›´æ–°ä¸»è¦æŒ‡éƒ¨åˆ†æ›´æ–°,éƒ¨åˆ†æ›´æ–°åœ¨å¤æ‚åœºæ™¯ä¸‹æ˜¯éå¸¸å¸¸è§çš„å¸¸è§.éƒ¨åˆ†æ›´æ–°åˆ†ä¸ºè„šæœ¬å’Œæ–‡æ¡£åˆå¹¶ä¸¤ç§æ–¹å¼.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPUT &quot;localhost:9200/test/test/1&quot; -d &#x27;{&quot;name&quot;:&quot;wener&quot;,&quot;age&quot;:15}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># éœ€è¦</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># script.inline: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST &quot;localhost:9200/test/test/1/_update&quot; -d &#x27;{&quot;script&quot; : &quot;ctx._source.age=16&quot;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST &quot;localhost:9200/test/test/1/_update&quot; -d &#x27;{&quot;script&quot; : &quot;ctx._source.sex=&#x27;ç”·&#x27;&quot;}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># params for script</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST &quot;localhost:9200/test/test/1/_update&quot; -d &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;script&quot; : &quot;ctx._source.age=age&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;params&quot; : {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;age&quot; : 20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># upsert for missing</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST &quot;localhost:9200/test/test/1/_update&quot; -d &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;script&quot; : &quot;ctx._source.score+=1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;upsert&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;score&quot;: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># doc for partial update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST &quot;localhost:9200/test/test/1/_update&quot; -d &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;doc&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;friends&quot;:[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;XXX&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># doc_as_upsert will insert this doc if missing</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST &quot;localhost:9200/test/test/2/_update&quot; -d &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;doc&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;friends&quot;:[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;CCC&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;doc_as_upsert&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># remove field</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -XPOST &quot;localhost:9200/test/test/1/_update&quot; -d &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;script&quot; : &quot;ctx._source.remove(&#x27;friends&#x27;)&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ç¿»é¡µ"></a>ç¿»é¡µ<a class="hash-link" href="#ç¿»é¡µ" title="Direct link to heading">#</a></h2><p>é»˜è®¤ç¿»é¡µå†…å®¹æœ€å¤š 10000 æ¡(é…ç½®é¡¹ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html" target="_blank" rel="noopener noreferrer">index.max_result_window</a>),</p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_fetch_phase.html" target="_blank" rel="noopener noreferrer">Fetch phase</a></li><li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/pagination.html" target="_blank" rel="noopener noreferrer">Pagination</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="vs-others"></a>vs Others<a class="hash-link" href="#vs-others" title="Direct link to heading">#</a></h3><p>å°† Elasticsearch å’Œå…¶ä»–äº§å“åšæ¯”è¾ƒæ—¶,éœ€è¦å…ˆè€ƒè™‘å®ƒçš„è®¾è®¡åˆè¡·</p><ul><li>ä¸€æ¬¡å†™å¤šæ¬¡è¯»<ul><li>ç¬¦åˆæ—¥å¿—çš„ç‰¹æ€§</li><li>èƒ½å¤Ÿåšå¤§é‡ç¼“å­˜</li></ul></li><li>æœç´¢</li><li>ç»Ÿè®¡åˆ†æ</li></ul><p>Elasticsearch è‡ªèº«æœ¬å¯ä»¥ä½œä¸ºä¸»æ•°æ®åº“ä½¿ç”¨, ä½†ç›®å‰å¸¸ç”¨çš„åšæ³•éƒ½æ˜¯ä½œä¸ºä¸€ä¸ªé™„å±åº“,å½“æ•°æ®è¢«å†™å…¥åˆ°ä¸€ä¸ªæ”¯æŒäº‹åŠ¡çš„é«˜ä¸€è‡´æ€§çš„å­˜å‚¨(HBase,PostgreSQL)å,å†å¼‚æ­¥æ¨é€åˆ° Elasticsearch è¿›è¡Œç´¢å¼•,ä»¥å®ç°å¯¹å­˜å‚¨çš„æ•°æ®è¿›è¡Œé«˜æ€§èƒ½çš„æ£€ç´¢å’Œåˆ†æ.</p><ul><li><a href="https://www.elastic.co/blog/found-elasticsearch-as-nosql" target="_blank" rel="noopener noreferrer">Elasticsearch as NoSQL</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="mongodb"></a>MongoDB<a class="hash-link" href="#mongodb" title="Direct link to heading">#</a></h4><p>MongoDB æ˜¯ç”¨äºä¼ ç»Ÿç”¨é€”(CRUD) çš„åŸºäºæ–‡æ¡£çš„æ•°æ®åº“,å…¶ä¸»è¦ç‰¹è‰²ä¸æ˜¯æœç´¢æˆ–è€…ç»Ÿè®¡åˆ†æ,è€Œæ˜¯èƒ½å¤Ÿä»¥æ•°æ®æœ¬èº«çš„æ–‡æ¡£ç»“æ„è¿›è¡Œå­˜å‚¨.</p><p>MongoDB ä¸ Elasticsearch ä¸¤è€…å¹¶ä¸è¿èƒŒ,å¯ä»¥åŒæ—¶ä½¿ç”¨.</p><p>è™½ç„¶ Elasticsearch ä¸éœ€è¦ Schema ,ä½†æ˜¯å› ä¸ºåº•å±‚ä¸º Lucene, æ‰€æœ‰çš„æ–‡æ¡£éƒ½ä¼šæ‰å¹³åŒ–å¤„ç†,å› æ­¤æ— æ³•çœŸæ­£çš„æŠŠ Elasticsearch ä½œä¸º Schemaless æ¥ä½¿ç”¨,åè€Œéœ€è¦æ…é‡çš„å¯¹å¾….è€Œ MongoDB å´èƒ½å¾ˆå¥½åœ°åšåˆ° Schemaless, å¯ä»¥ä» JavaScript çš„å¤„ç†è§’åº¦å‡ºå‘çœ‹å¾…èµ·å¤„ç†æ–‡æ¡£çš„æ–¹å¼.</p><p>Elasticsearch å¤§å¤šæƒ…å†µé€‚ç”¨äºå¤„ç†å°æ–‡æ¡£,å½“å¤„ç†ä¸éœ€è¦ç´¢å¼•çš„å¤§æ–‡æ¡£æ—¶,å…¶åŠŸèƒ½æœ‰é™.è€Œ MongoDB æ”¯æŒ <a href="https://docs.mongodb.org/manual/core/gridfs/" target="_blank" rel="noopener noreferrer">GridFS</a>, å¯ä»¥å¾ˆå¥½åœ°ä½¿ç”¨åŒä¸€å¥—æ¥å£æ¥å¤„ç†å¤§æ–‡æ¡£.</p><ul><li><a href="http://blog.quarkslab.com/mongodb-vs-elasticsearch-the-quest-of-the-holy-performances.html" target="_blank" rel="noopener noreferrer">MongoDB vs. Elasticsearch: The Quest of the Holy Performances</a></li><li><a href="http://db-engines.com/en/system/Elasticsearch%3BMongoDB" target="_blank" rel="noopener noreferrer">Elasticsearch vs MongoDB : DB engines</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solar"></a>Solar<a class="hash-link" href="#solar" title="Direct link to heading">#</a></h4><ul><li><a href="http://solr-vs-elasticsearch.com/" target="_blank" rel="noopener noreferrer">Apache Solr vs Elasticsearch The Feature Smackdown</a></li><li><a href="http://db-engines.com/en/system/Elasticsearch%3BSolr" target="_blank" rel="noopener noreferrer">Elasticsearch vs Solr : DB engines</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="faq"></a>FAQ<a class="hash-link" href="#faq" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="æŒ‡å®šé…ç½®æ–‡ä»¶"></a>æŒ‡å®šé…ç½®æ–‡ä»¶<a class="hash-link" href="#æŒ‡å®šé…ç½®æ–‡ä»¶" title="Direct link to heading">#</a></h3><p>å¯åŠ¨æ—¶å¯é€šè¿‡ <code>path.conf</code> æ¥æŒ‡å®šé…ç½®æ–‡ä»¶ç›®å½•, è¯»å–çš„é…ç½®æ–‡ä»¶æ¥è¯¥ç›®å½•ä¸‹çš„ <code>elasticsearch.yml</code>, ä¸èƒ½ç›´æ¥æŒ‡å®šè¯¥é…ç½®æ–‡ä»¶,ä¹Ÿä¸èƒ½ä¿®æ”¹è¯¥é…ç½®æ–‡ä»¶å.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ç¡®ä¿ç›®å½•ä¸‹é…ç½®æ–‡ä»¶æ­£ç¡®</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> my-config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">elasticsearch.yml logging.yml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å¯åŠ¨æ—¶æŒ‡å®šé…ç½®ç›®å½•</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./bin/elasticsearch -Dpath.conf</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">my-config</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ä½¿ç”¨-root-å¯åŠ¨"></a>ä½¿ç”¨ ROOT å¯åŠ¨<a class="hash-link" href="#ä½¿ç”¨-root-å¯åŠ¨" title="Direct link to heading">#</a></h3><p>Elasticsearch é»˜è®¤æ˜¯ä¸å…è®¸ä½¿ç”¨ ROOT ç”¨æˆ·å¯åŠ¨çš„,å¯é€šè¿‡å¯åŠ¨æ—¶æ·»åŠ  <code>es.insecure.allow.root</code> å‚æ•°å…è®¸ä½¿ç”¨ ROOT å¯åŠ¨.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># å…è®¸ä½¿ç”¨ ROOT å¯åŠ¨</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./bin/elasticsearch -Des.insecure.allow.root</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="java-ç‰ˆæœ¬"></a>Java ç‰ˆæœ¬<a class="hash-link" href="#java-ç‰ˆæœ¬" title="Direct link to heading">#</a></h3><p>Elasticsearch å¯¹ Java ç‰ˆæœ¬æœ‰è¦æ±‚,è‡³å°‘éœ€è¦ 1.7, å¹¶ä¸”åœ¨ 1.7 çš„æŸäº›ç‰ˆæœ¬ä¸­çš„ Bug å¯èƒ½ä¼šå½±å“ Lucene çš„ä¸€è‡´æ€§,å› æ­¤ Elasticsearch åœ¨å¯åŠ¨æ—¶ä¼šç»™äºˆè­¦å‘Š.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Exception in thread &quot;main&quot; java.lang.RuntimeException: Java version: Oracle Corporation 1.7.0_45 [Java HotSpot(TM) 64-Bit Server VM 24.45-b08] suffers from critical bug https://bugs.openjdk.java.net/browse/JDK-8024830 which can cause data corruption.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Please upgrade the JVM, see http://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html for current recommendations.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">If you absolutely cannot upgrade, please add -XX:-UseSuperWord to the JAVA_OPTS environment variable.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Upgrading is preferred, this workaround will result in degraded performance.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    at org.elasticsearch.bootstrap.JVMCheck.check(JVMCheck.java:123)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:283)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Refer to the log for complete error details.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Use -XX:-UseSuperWord if you are running on 7u40 &lt;= JVM &lt; 7u55</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><a href="https://wiki.apache.org/lucene-java/JavaBugs" target="_blank" rel="noopener noreferrer">https://wiki.apache.org/lucene-java/JavaBugs</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ä½¿ç”¨-term-æŸ¥æ‰¾ä¸åˆ°æŒ‡å®šå†…å®¹"></a>ä½¿ç”¨ term æŸ¥æ‰¾ä¸åˆ°æŒ‡å®šå†…å®¹<a class="hash-link" href="#ä½¿ç”¨-term-æŸ¥æ‰¾ä¸åˆ°æŒ‡å®šå†…å®¹" title="Direct link to heading">#</a></h3><ul><li><p>å½“ä½¿ç”¨ term è¿›è¡Œå…¨æ–‡åŒ¹é…æ—¶,è¦æ±‚æŸ¥æ‰¾çš„å­—æ®µä¸ºéè§£æå­—æ®µ,å¦åˆ™æ— æ³•è¿›è¡Œå…¨æ–‡åŒ¹é….</p></li><li><p>å¤§å†™ä¼šå­˜å‚¨ä¸ºå°å†™,æŸ¥è¯¢æ—¶éœ€è¦æ‰‹åŠ¨è½¬ä¸ºå°å†™.</p></li><li><p><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_exact_values_versus_full_text.html" target="_blank" rel="noopener noreferrer">Exact values versus full text</a></p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/wenerme/wener/edit/master/notes/elastic/elasticsearch-v2.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tips" class="table-of-contents__link">Tips</a></li><li><a href="#best-practice" class="table-of-contents__link">Best practice</a></li><li><a href="#reference" class="table-of-contents__link">Reference</a></li><li><a href="#å¸¸ç”¨æ“ä½œ" class="table-of-contents__link">å¸¸ç”¨æ“ä½œ</a><ul><li><a href="#æ‰¹é‡å¯¼å…¥" class="table-of-contents__link">æ‰¹é‡å¯¼å…¥</a></li><li><a href="#æ›´æ”¹è§£æå™¨" class="table-of-contents__link">æ›´æ”¹è§£æå™¨</a></li><li><a href="#è¯Šæ–­" class="table-of-contents__link">è¯Šæ–­</a></li></ul></li><li><a href="#æ¨¡å—" class="table-of-contents__link">æ¨¡å—</a></li><li><a href="#query-dsl" class="table-of-contents__link">Query DSL</a><ul><li><a href="#æŸ¥è¯¢å’Œè¿‡æ»¤ä¸Šä¸‹æ–‡" class="table-of-contents__link">æŸ¥è¯¢å’Œè¿‡æ»¤ä¸Šä¸‹æ–‡</a></li><li><a href="#æŸ¥è¯¢åœ°å€" class="table-of-contents__link">æŸ¥è¯¢åœ°å€</a></li><li><a href="#æŸ¥è¯¢ç±»å‹" class="table-of-contents__link">æŸ¥è¯¢ç±»å‹</a></li><li><a href="#æ€»ç»“" class="table-of-contents__link">æ€»ç»“</a></li><li><a href="#å‚è€ƒ" class="table-of-contents__link">å‚è€ƒ</a></li></ul></li><li><a href="#é«˜å¯ç”¨æœºåˆ¶" class="table-of-contents__link">é«˜å¯ç”¨æœºåˆ¶</a><ul><li><a href="#ä¸»å‰¯æœ¬åˆ†ç‰‡äº¤äº’è¿‡ç¨‹" class="table-of-contents__link">ä¸»å‰¯æœ¬åˆ†ç‰‡äº¤äº’è¿‡ç¨‹</a></li><li><a href="#discovery" class="table-of-contents__link">Discovery</a></li><li><a href="#local-gateway" class="table-of-contents__link">Local Gateway</a></li><li><a href="#å‚è€ƒ-1" class="table-of-contents__link">å‚è€ƒ</a></li></ul></li><li><a href="#æ¢å¤å¤‡ä»½" class="table-of-contents__link">æ¢å¤å¤‡ä»½</a><ul><li><a href="#å‚è€ƒ-2" class="table-of-contents__link">å‚è€ƒ</a></li></ul></li><li><a href="#æ•°æ®å»ºæ¨¡" class="table-of-contents__link">æ•°æ®å»ºæ¨¡</a><ul><li><a href="#parent-child" class="table-of-contents__link">Parent-Child</a></li><li><a href="#nested-object" class="table-of-contents__link">Nested Object</a></li></ul></li><li><a href="#èšåˆ" class="table-of-contents__link">èšåˆ</a><ul><li><a href="#å†…å­˜æ§åˆ¶" class="table-of-contents__link">å†…å­˜æ§åˆ¶</a></li></ul></li><li><a href="#æ’ä»¶" class="table-of-contents__link">æ’ä»¶</a><ul><li><a href="#å¸¸ç”¨æ’ä»¶" class="table-of-contents__link">å¸¸ç”¨æ’ä»¶</a></li><li><a href="#æ’ä»¶å¼€å‘" class="table-of-contents__link">æ’ä»¶å¼€å‘</a></li></ul></li><li><a href="#æ›´æ–°" class="table-of-contents__link">æ›´æ–°</a></li><li><a href="#ç¿»é¡µ" class="table-of-contents__link">ç¿»é¡µ</a><ul><li><a href="#vs-others" class="table-of-contents__link">vs Others</a></li></ul></li><li><a href="#faq" class="table-of-contents__link">FAQ</a><ul><li><a href="#æŒ‡å®šé…ç½®æ–‡ä»¶" class="table-of-contents__link">æŒ‡å®šé…ç½®æ–‡ä»¶</a></li><li><a href="#ä½¿ç”¨-root-å¯åŠ¨" class="table-of-contents__link">ä½¿ç”¨ ROOT å¯åŠ¨</a></li><li><a href="#java-ç‰ˆæœ¬" class="table-of-contents__link">Java ç‰ˆæœ¬</a></li><li><a href="#ä½¿ç”¨-term-æŸ¥æ‰¾ä¸åˆ°æŒ‡å®šå†…å®¹" class="table-of-contents__link">ä½¿ç”¨ term æŸ¥æ‰¾ä¸åˆ°æŒ‡å®šå†…å®¹</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">ç¬”è®°</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/notes/java/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/os/alpine/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes/kubernetes">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip/voip">VoIP</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Projects</h4><ul class="footer__items"><li class="footer__item">
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              - <a class="footer__link-item" href="https://github.com/wenerme/wener/actions" title="wenerme/wener - ci">
                <img style="vertical-align: middle;opacity: .4;" src="https://github.com/wenerme/wener/workflows/Build/badge.svg">
                </a>
              </div>
              </li><li class="footer__item"><a href="https://apis.wener.me" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wener&#x27;s Apis</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/story">Blog</a></li><li class="footer__item"><a href="https://github.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Wener Site" src="/img/wener-logo.svg"></div><div class="footer__copyright">Copyright Â© 1992-2021 Wener - æ„å»ºæ—¶é—´ 2021-06-30 13:53</div></div></div></footer></div>
<script src="/styles.539e90aa.js"></script>
<script src="/runtime~main.adbca279.js"></script>
<script src="/main.305ce40c.js"></script>
<script src="/1.e5403ab0.js"></script>
<script src="/2.52ee678d.js"></script>
<script src="/3.d21b50fe.js"></script>
<script src="/1be78505.195536f9.js"></script>
<script src="/1035.68fde79d.js"></script>
<script src="/935f2afb.aed184d9.js"></script>
<script src="/17896441.d559942d.js"></script>
<script src="/685b3299.63c7dfb3.js"></script>
</body>
</html>