<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/story/rss.xml" title="Wener Live &amp; Life RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/story/atom.xml" title="Wener Live &amp; Life Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Wener Live &amp; Life" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css"><title data-react-helmet="true">Spring Data | Wener Live &amp; Life</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wener.me/notes/java/spring/data"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Spring Data | Wener Live &amp; Life"><meta data-react-helmet="true" name="description" content="Tips"><meta data-react-helmet="true" property="og:description" content="Tips"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wener.me/notes/java/spring/data"><link data-react-helmet="true" rel="alternate" href="https://wener.me/notes/java/spring/data" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wener.me/notes/java/spring/data" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7900c842.css">
<link rel="preload" href="/assets/js/runtime~main.30549a1d.js" as="script">
<link rel="preload" href="/assets/js/main.98857471.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/wener-logo-head.svg" alt="Wener Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Wener</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes">笔记</a><a class="navbar__item navbar__link" href="/story">故事</a><a class="navbar__item navbar__link" href="/notes/howto/network/dns-prevent-spoofing">指南</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wenerme/wener" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/evolve">自我成长</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/notes/java/java-awesome">Java</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/java-awesome">Java</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/java-concurrent">Concurrent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/java-faq">常见问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/java-native">Java Native</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/notes/java/version">版本</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/notes/java/spring">Spring</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spring/boot">Spring Boot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spring/cloud">Spring Cloud</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes/java/spring/data">Spring Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spring/data-rest">Spring Data REST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spring/releases">发布历史</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spring/security">Spring Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spring/security-oauth2">Spring Security OAuth2</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/notes/java/library/guava">Library</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/apache/kylin">Apache Kylin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/apache/wicket">Apache Wicket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/gradle">Gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/hot-qa">热门问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/maven">Maven</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java">Java</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/spec/servlet">Servlet</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/web/web-awesome">Web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/languages">语言</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/os/alpine/alpine-awesome">AlpineLinux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/devops/docker/docker-cookbook">Docker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/devops/kubernetes">Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/os/linux/linux-awesome">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/os/virt">虚拟化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/os/os-awesome">操作系统</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/voip">VoIP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/dev/dev-awesome">开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/devops/devops-faq">DevOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/db">数据库</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/queue">消息队列</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/security/security-awesome">安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/service/service-awesome">服务</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/ops/ops-awesome">运维</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/howto/ops/alpine-admin-ansible">指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/hardware/hardware-awesome">硬件</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/algorithm/algorithm-awesome">算法</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/healthcare/disease">健康</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/reference/software/glossary">参考</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/notes/tool">工具</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring Data</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="tips">Tips<a class="hash-link" href="#tips" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/spring-projects/spring-data-examples" target="_blank" rel="noopener noreferrer">Spring Data 示例</a></li><li><a href="http://docs.spring.io/spring-data/commons/docs/current/reference/html/" target="_blank" rel="noopener noreferrer">Spring Data Commons 文档</a></li><li>实现将 PathVariable 从主键转为实体的转换器为 DomainClassConverter<ul><li>主要使用: Repositories, RepositoryInformation, RepositoryInvoker 进行操作</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="note">Note<a class="hash-link" href="#note" title="Direct link to heading">​</a></h2><ul><li><p><code>RepositoryMetadata</code></p></li><li><p><code>RepositoryInformation</code></p></li><li><p><code>RepositoryQuery</code></p><ul><li>抽象接口, 用于执行所有数据仓库操作</li></ul></li><li><p><code>PartTree</code></p><ul><li>用于将方法名转换为查询方法</li><li><code>^(find|read|get|query|stream|count|exists|delete|remove)((\p{Lu}.*?))??By</code></li></ul></li><li><p><code>PersistenceExceptionTranslationInterceptor</code></p><ul><li>处理数据仓库调用过程中的异常</li></ul></li><li><p>查询方法处理链</p><ul><li><code>SurroundingTransactionDetectorMethodInterceptor</code><ul><li>事务设置</li></ul></li><li><code>ExposeInvocationInterceptor</code></li><li><code>DefaultMethodInvokingMethodInterceptor</code><ul><li>处理 <code>default</code> 方法</li></ul></li><li><code>RepositoryFactorySupport$QueryExecutorMethodInterceptor</code></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="映射---orgspringframeworkdatamapping">映射 - org.springframework.data.mapping<a class="hash-link" href="#映射---orgspringframeworkdatamapping" title="Direct link to heading">​</a></h3><ul><li>处理不同 SpringData 持久化的中间层映射</li><li><code>PersistentEntity&lt;T, P extends PersistentProperty&lt;P&gt;&gt; extends Iterable&lt;P&gt;</code><ul><li>一个持久化对象</li></ul></li><li><code>PersistentProperty</code><ul><li>一个持久化对象的属性</li><li><code>Association</code><ul><li>表示属性之间的关联</li></ul></li><li>主要实现<ul><li><code>JpaPersistentPropertyImpl</code><ul><li>JPA 持久化对象的属性</li></ul></li></ul></li></ul></li><li><code>MutablePersistentEntity&lt;T, P extends PersistentProperty&lt;P&gt;&gt; extends PersistentEntity&lt;T, P&gt;</code><ul><li>包含了修改方法</li></ul></li><li><code>IdentifierAccessor</code></li><li><code>PersistentPropertyAccessor</code></li><li><code>MappingContext</code><ul><li>映射上下文</li><li>记录了所有已知的实体类型</li><li><code>PersistentPropertyPath</code><ul><li>表示一个持久属性的路径</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mongodb">MongoDB<a class="hash-link" href="#mongodb" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// SpringData 查询日志</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">logging.level.org.springframework.data.mongodb.core.MongoTemplate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> DEBUG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MongoDB 的日志工具类 com.mongodb.diagnostics.logging.Loggers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 前缀 org.mongodb.driver 例如 操作 operation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">logging.level.org.mongodb.driver.operation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> INFO</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 或者打开全量的</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 注意</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 依然是看不到发送的查询</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">logging.level.org.mongodb.driver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> INFO</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>MongoDB 的 Repository 实现<ul><li><code>org.springframework.data.mongodb.repository.support.SimpleMongoRepository</code></li><li><code>org.springframework.data.mongodb.repository.support.QueryDslMongoRepository</code></li></ul></li><li><code>MongoQueryMethod</code><ul><li>解析 Mongo 的 Query 注解</li></ul></li><li><code>PartTreeMongoQuery</code><ul><li>通过方法解析后的 Query 实例</li></ul></li><li><code>org.springframework.data.mongodb.core.query.Query</code><ul><li>实际查询</li></ul></li><li><code>org.springframework.data.mongodb.repository.support.SpringDataMongodbQuery</code><ul><li>QueryDSL Mongo 的查询对象</li></ul></li></ul><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface MyRepo{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // 只返回 tags 字段</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // 注意: QueryDSL 的 Predicate 不会被使用</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @Query(fields = &quot;{&#x27;tags&#x27;:1}&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  List&lt;PageDocument&gt; findTagsBy(Predicate predicate);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // 建议基于 QueryDslMongoRepository 将查询对象上的 Path 参数暴露出来, 例如</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  List&lt;T&gt; findAll(Predicate predicate, Path&lt;?&gt;... paths);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="entity-versions">Entity Versions<a class="hash-link" href="#entity-versions" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/spring-projects/spring-data-envers" target="_blank" rel="noopener noreferrer">spring-projects/spring-data-envers</a></li><li>JPA 扩展, 基于 hibernate envers</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="spring-data-查询关键字">Spring Data 查询关键字<a class="hash-link" href="#spring-data-查询关键字" title="Direct link to heading">​</a></h2><table><thead><tr><th>逻辑关键词</th><th>关键词表达式</th></tr></thead><tbody><tr><td>AND</td><td>And</td></tr><tr><td>OR</td><td>Or</td></tr><tr><td>AFTER</td><td>After, IsAfter</td></tr><tr><td>BEFORE</td><td>Before, IsBefore</td></tr><tr><td>CONTAINING</td><td>Containing, IsContaining, Contains</td></tr><tr><td>BETWEEN</td><td>Between, IsBetween</td></tr><tr><td>ENDING_WITH</td><td>EndingWith, IsEndingWith, EndsWith</td></tr><tr><td>EXISTS</td><td>Exists</td></tr><tr><td>FALSE</td><td>False, IsFalse</td></tr><tr><td>GREATER_THAN</td><td>GreaterThan, IsGreaterThan</td></tr><tr><td>GREATER_THAN_EQUALS</td><td>GreaterThanEqual, IsGreaterThanEqual</td></tr><tr><td>IN</td><td>In, IsIn</td></tr><tr><td>IS</td><td>Is, Equals, (or no keyword)</td></tr><tr><td>IS_NOT_NULL</td><td>NotNull, IsNotNull</td></tr><tr><td>IS_NULL</td><td>Null, IsNull</td></tr><tr><td>LESS_THAN</td><td>LessThan, IsLessThan</td></tr><tr><td>LESS_THAN_EQUAL</td><td>LessThanEqual, IsLessThanEqual</td></tr><tr><td>LIKE</td><td>Like, IsLike</td></tr><tr><td>NEAR</td><td>Near, IsNear</td></tr><tr><td>NOT</td><td>Not, IsNot</td></tr><tr><td>NOT_IN</td><td>NotIn, IsNotIn</td></tr><tr><td>NOT_LIKE</td><td>NotLike, IsNotLike</td></tr><tr><td>REGEX</td><td>Regex, MatchesRegex, Matches</td></tr><tr><td>STARTING_WITH</td><td>StartingWith, IsStartingWith, StartsWith</td></tr><tr><td>TRUE</td><td>True, IsTrue</td></tr><tr><td>WITHIN</td><td>Within, IsWithin</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_y2LR" id="spring-data-返回结果类型">Spring Data 返回结果类型<a class="hash-link" href="#spring-data-返回结果类型" title="Direct link to heading">​</a></h2><table><thead><tr><th>返回类型</th><th>描述</th></tr></thead><tbody><tr><td>void</td><td>不返回值</td></tr><tr><td>原子类型</td><td>Java 原子类型值</td></tr><tr><td>包装类型</td><td>Java 包装类型值</td></tr><tr><td>T</td><td>An unique entity. Expects the query method to return one result at most. In case no result is found null is returned. More than one result will trigger an IncorrectResultSizeDataAccessException.</td></tr><tr><td>Iterator<!-- -->&lt;<!-- -->T&gt;</td><td>An Iterator.</td></tr><tr><td>Collection<!-- -->&lt;<!-- -->T&gt;</td><td>A Collection.</td></tr><tr><td>List<!-- -->&lt;<!-- -->T&gt;</td><td>A List.</td></tr><tr><td>Optional<!-- -->&lt;<!-- -->T&gt;</td><td>A Java 8 or Guava Optional. Expects the query method to return one result at most. In case no result is found Optional.empty()/Optional.absent() is returned. More than one result will trigger an IncorrectResultSizeDataAccessException.</td></tr><tr><td>Stream<!-- -->&lt;<!-- -->T&gt;</td><td>A Java 8 Stream.</td></tr><tr><td>Future<!-- -->&lt;<!-- -->T&gt;</td><td>A Future. Expects method to be annotated with @Async and requires Spring’s asynchronous method execution capability enabled.</td></tr><tr><td>CompletableFuture<!-- -->&lt;<!-- -->T&gt;</td><td>A Java 8 CompletableFuture. Expects method to be annotated with @Async and requires Spring’s asynchronous method execution capability enabled.</td></tr><tr><td>ListenableFuture</td><td>A org.springframework.util.concurrent.ListenableFuture. Expects method to be annotated with @Async and requires Spring’s asynchronous method execution capability enabled.</td></tr><tr><td>Slice</td><td>A sized chunk of data with information whether there is more data available. Requires a Pageable method parameter.</td></tr><tr><td>Page<!-- -->&lt;<!-- -->T&gt;</td><td>A Slice with additional information, e.g. the total number of results. Requires a Pageable method parameter.</td></tr><tr><td>GeoResult<!-- -->&lt;<!-- -->T&gt;</td><td>A result entry with additional information, e.g. distance to a reference location.</td></tr><tr><td>GeoResults<!-- -->&lt;<!-- -->T&gt;</td><td>A list of GeoResult<!-- -->&lt;<!-- -->T&gt; with additional information, e.g. average distance to a reference location.</td></tr></tbody></table><blockquote><p>空间坐标类型(GeoResult, GeoResults, GeoPage)只有在存储类型支持空间类型时返回</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="jpa-repository-方法语法">JPA Repository 方法语法<a class="hash-link" href="#jpa-repository-方法语法" title="Direct link to heading">​</a></h2><ul><li><a href="http://docs.spring.io/spring-data/data-jpa/docs/current/reference/html/#jpa.query-methods.query-creation" target="_blank" rel="noopener noreferrer">Repository 方法语法</a></li></ul><table><thead><tr><th>Keyword</th><th>Sample</th><th>JPQL snippet</th></tr></thead><tbody><tr><td>And</td><td>findByLastnameAndFirstname</td><td>… where x.lastname = ?1 and x.firstname = ?2</td></tr><tr><td>Or</td><td>findByLastnameOrFirstname</td><td>… where x.lastname = ?1 or x.firstname = ?2</td></tr><tr><td>Is,Equals</td><td>findByFirstname,findByFirstnameIs,findByFirstnameEquals</td><td>… where x.firstname = ?1</td></tr><tr><td>Between</td><td>findByStartDateBetween</td><td>… where x.startDate between ?1 and ?2</td></tr><tr><td>LessThan</td><td>findByAgeLessThan</td><td>… where x.age <!-- -->&lt;<!-- --> ?1</td></tr><tr><td>LessThanEqual</td><td>findByAgeLessThanEqual</td><td>… where x.age ⇐ ?1</td></tr><tr><td>GreaterThan</td><td>findByAgeGreaterThan</td><td>… where x.age &gt; ?1</td></tr><tr><td>GreaterThanEqual</td><td>findByAgeGreaterThanEqual</td><td>… where x.age &gt;= ?1</td></tr><tr><td>After</td><td>findByStartDateAfter</td><td>… where x.startDate &gt; ?1</td></tr><tr><td>Before</td><td>findByStartDateBefore</td><td>… where x.startDate <!-- -->&lt;<!-- --> ?1</td></tr><tr><td>IsNull</td><td>findByAgeIsNull</td><td>… where x.age is null</td></tr><tr><td>IsNotNull,NotNull</td><td>findByAge(Is)NotNull</td><td>… where x.age not null</td></tr><tr><td>Like</td><td>findByFirstnameLike</td><td>… where x.firstname like ?1</td></tr><tr><td>NotLike</td><td>findByFirstnameNotLike</td><td>… where x.firstname not like ?1</td></tr><tr><td>StartingWith</td><td>findByFirstnameStartingWith</td><td>… where x.firstname like ?1 (parameter bound with appended %)</td></tr><tr><td>EndingWith</td><td>findByFirstnameEndingWith</td><td>… where x.firstname like ?1 (parameter bound with prepended %)</td></tr><tr><td>Containing</td><td>findByFirstnameContaining</td><td>… where x.firstname like ?1 (parameter bound wrapped in %)</td></tr><tr><td>OrderBy</td><td>findByAgeOrderByLastnameDesc</td><td>… where x.age = ?1 order by x.lastname desc</td></tr><tr><td>Not</td><td>findByLastnameNot</td><td>… where x.lastname <!-- -->&lt;<!-- -->&gt; ?1</td></tr><tr><td>In</td><td>findByAgeIn(Collection<!-- -->&lt;<!-- -->Age&gt; ages)</td><td>… where x.age in ?1</td></tr><tr><td>NotIn</td><td>findByAgeNotIn(Collection<!-- -->&lt;<!-- -->Age&gt; age)</td><td>… where x.age not in ?1</td></tr><tr><td>True</td><td>findByActiveTrue()</td><td>… where x.active = true</td></tr><tr><td>False</td><td>findByActiveFalse()</td><td>… where x.active = false</td></tr><tr><td>IgnoreCase</td><td>findByFirstnameIgnoreCase</td><td>… where UPPER(x.firstame) = UPPER(?1)</td></tr></tbody></table><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Enables the distinct flag for the query</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List&lt;Person&gt; findDistinctPeopleByLastnameOrFirstname(String lastname, String firstname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List&lt;Person&gt; findPeopleDistinctByLastnameOrFirstname(String lastname, String firstname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 使用 Top 和 First</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">User findFirstByOrderByLastnameAsc();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">User findTopByOrderByAgeDesc();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Page&lt;User&gt; queryFirst10ByLastname(String lastname, Pageable pageable);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Slice&lt;User&gt; findTop3ByLastname(String lastname, Pageable pageable);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List&lt;User&gt; findFirst10ByLastname(String lastname, Sort sort);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List&lt;User&gt; findTop10ByLastname(String lastname, Pageable pageable);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 返回结果流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Query(&quot;select u from User u&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stream&lt;User&gt; findAllByCustomQueryAndStream();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 只返回结果片段</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Slice&lt;User&gt; findTop3ByLastname(String lastname, Pageable pageable);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 选择单个返回,可返回 Optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">User findFirstByOrderByLastnameAsc();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Optional&lt;User&gt; findTopByOrderByAgeDesc();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// 异步操作</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Async</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Future&lt;User&gt; findByFirstname(String firstname);               </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Async</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CompletableFuture&lt;User&gt; findOneByFirstname(String firstname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Async</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ListenableFuture&lt;User&gt; findOneByLastname(String lastname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Long countByLastname(String lastname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Long deleteByLastname(String lastname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">List&lt;User&gt; removeByLastname(String lastname);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="单独使用-repository">单独使用 Repository<a class="hash-link" href="#单独使用-repository" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">RepositoryFactorySupport factory = … // Instantiate factory here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UserRepository repository = factory.getRepository(UserRepository.class);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="实现自定义接口">实现自定义接口<a class="hash-link" href="#实现自定义接口" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface UserRepositoryCustom {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public void someCustomMethod(User user);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class UserRepositoryImpl implements UserRepositoryCustom {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public void someCustomMethod(User user) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Your custom implementation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface UserRepository extends CrudRepository&lt;User, Long&gt;, UserRepositoryCustom {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // Declare query methods here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="为所有-repository-添加自定义方法">为所有 Repository 添加自定义方法<a class="hash-link" href="#为所有-repository-添加自定义方法" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@NoRepositoryBean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface MyRepository&lt;T, ID extends Serializable&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  extends PagingAndSortingRepository&lt;T, ID&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  void sharedCustomMethod(ID id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class MyRepositoryImpl&lt;T, ID extends Serializable&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  extends SimpleJpaRepository&lt;T, ID&gt; implements MyRepository&lt;T, ID&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  private final EntityManager entityManager;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // 构造函数必须要要有这样的依赖注入</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public MyRepositoryImpl(JpaEntityInformation entityInformation, EntityManager entityManager) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    super(entityInformation, entityManager);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Keep the EntityManager around to used from the newly introduced methods.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    this.entityManager = entityManager;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public void sharedCustomMethod(ID id) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // implementation goes here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@EnableJpaRepositories(repositoryBaseClass = MyRepositoryImpl.class)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ApplicationConfiguration { … }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="在-query-中使用-spel-来书写通用的-sql">在 Query 中使用 SpEL 来书写通用的 SQL<a class="hash-link" href="#在-query-中使用-spel-来书写通用的-sql" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@MappedSuperclass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class AbstractMappedType {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  String attribute;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class ConcreteType extends AbstractMappedType { … }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@NoRepositoryBean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface MappedTypeRepository&lt;T extends AbstractMappedType&gt; extends Repository&lt;T, Long&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @Query(&quot;select t from #{#entityName} t where t.attribute = ?1&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  List&lt;T&gt; findAllByAttribute(String attribute);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface ConcreteRepository extends MappedTypeRepository&lt;ConcreteType&gt; { … }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="spring-web-集成">Spring Web 集成<a class="hash-link" href="#spring-web-集成" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="直接使用实体和特殊参数">直接使用实体和特殊参数<a class="hash-link" href="#直接使用实体和特殊参数" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@RequestMapping(&quot;/users&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class UserController {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @RequestMapping(&quot;/{id}&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public String showUserForm(@PathVariable(&quot;id&quot;) User user, Model model) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    model.addAttribute(&quot;user&quot;, user);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return &quot;userForm&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>通过 <code>DomainClassConverter</code> 实现参数实体的注入</li><li>通过 <code>HandlerMethodArgumentResolver</code> 实现特殊参数(Pageable,Sort)的注入</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="使用多个分页参数">使用多个分页参数<a class="hash-link" href="#使用多个分页参数" title="Direct link to heading">​</a></h3><p>以下两个参数分别通过 <code>foo_page</code> 和 <code>bar_page</code> 指定</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public String showUsers(Model model,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Qualifier(&quot;foo&quot;) Pageable first,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Qualifier(&quot;bar&quot;) Pageable second) { … }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="spring-hateoas-支持分页">Spring HATEOAS 支持分页<a class="hash-link" href="#spring-hateoas-支持分页" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class PersonController {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @Autowired PersonRepository repository;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @RequestMapping(value = &quot;/persons&quot;, method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  HttpEntity&lt;PagedResources&lt;Person&gt;&gt; persons(Pageable pageable,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PagedResourcesAssembler assembler) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Page&lt;Person&gt; persons = repository.findAll(pageable);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return new ResponseEntity&lt;&gt;(assembler.toResources(persons), HttpStatus.OK);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="使用-querydsl-实现查询参数绑定">使用 Querydsl 实现查询参数绑定<a class="hash-link" href="#使用-querydsl-实现查询参数绑定" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class UserController {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @Autowired UserRepository repository;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @RequestMapping(value = &quot;/&quot;, method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  String index(Model model, @QuerydslPredicate(root = User.class) Predicate predicate,    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Pageable pageable, @RequestParam MultiValueMap&lt;String, String&gt; parameters) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    model.addAttribute(&quot;users&quot;, repository.findAll(predicate, pageable));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return &quot;index&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/* 定制化绑定方式 */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface UserRepository extends CrudRepository&lt;User, String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 QueryDslPredicateExecutor&lt;User&gt;,                </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 QuerydslBinderCustomizer&lt;QUser&gt; {               </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  default public void customize(QuerydslBindings bindings, QUser user) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bindings.bind(user.username).first((path, value) -&gt; path.contains(value))    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bindings.bind(String.class)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      .first((StringPath path, String value) -&gt; path.containsIgnoreCase(value));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bindings.excluding(user.password);                                           </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="使用-hibernate-实现软删除">使用 Hibernate 实现软删除<a class="hash-link" href="#使用-hibernate-实现软删除" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Where(&quot;deleted = 0&quot;) // Hibernate 注解</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class User{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  String name;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Integer deleted;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="自动生成创建时间字段和更新时间字段">自动生成创建时间字段和更新时间字段<a class="hash-link" href="#自动生成创建时间字段和更新时间字段" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ==================== #1 =======================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@EntityListeners({AuditingEntityListener.class})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@MappedSuperclass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@ToString</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@EqualsAndHashCode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class AbstractEntity implements Serializable { }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ==================== #2 =======================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Table(name = &quot;entities&quot;)    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class Entity {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  private Date created;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  private Date updated;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @PrePersist</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  protected void onCreate() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    created = new Date();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @PreUpdate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  protected void onUpdate() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    updated = new Date();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// =================== #3 ========================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@MappedSuperclass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class AbstractTimestampEntity {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Temporal(TemporalType.TIMESTAMP)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Column(name = &quot;created&quot;, nullable = false)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private Date created;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Temporal(TemporalType.TIMESTAMP)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Column(name = &quot;updated&quot;, nullable = false)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private Date updated;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @PrePersist</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    protected void onCreate() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      updated = created = new Date();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @PreUpdate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    protected void onUpdate() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      updated = new Date();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Table(name = &quot;campaign&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class Campaign extends AbstractTimestampEntity implements Serializable {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// =================== #4 ========================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@EqualsAndHashCode(callSuper = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Accessors(chain = true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@EntityListeners(AuditingEntityListener.class)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class User extends AbstractPersistable&lt;Long&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    String username;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    String address;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @CreatedDate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Temporal(TemporalType.TIMESTAMP)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private Date createdDate;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @LastModifiedDate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Temporal(TemporalType.TIMESTAMP)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private Date lastModifiedDate;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="链接断开异常">链接断开异常<a class="hash-link" href="#链接断开异常" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DataAccessResourceFailureException: could not prepare statement; nested exception is org.hibernate.exception.JDBCConnectionException: could not prepare statement</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Caused by: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: The last packet successfully received from the server was 48,054,727 milliseconds ago.  The last packet sent successfully to the server was 48,054,727 milliseconds ago. is longer than the server configured value of &#x27;wait_timeout&#x27;. You should consider either expiring and/or testing connection validity before use in your application, increasing the server configured values for client timeouts, or using the Connector/J connection property &#x27;autoReconnect=true&#x27; to avoid this problem.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>为 MySQL 使用 <code>&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;maxReconnects=10</code> 链接参数</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="not-a-managed-type">Not a managed type<a class="hash-link" href="#not-a-managed-type" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@EntityScan(basePackageClasses = MyEntityPackage.class)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class MyApp{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="使用-querydsl-构建动态查询">使用 QueryDSL 构建动态查询<a class="hash-link" href="#使用-querydsl-构建动态查询" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface BaseRepository&lt;T, ID extends Serializable&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        extends JpaRepository&lt;T, ID&gt;, JpaSpecificationExecutor&lt;T&gt;, QueryDslPredicateExecutor&lt;T&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface UserRepository extends BaseRepository&lt;User,Long&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">PathBuilder builder = new PathBuilder&lt;&gt;(entityType, Preconditions.checkNotNull(CaseFormat.UPPER_CAMEL.converterTo(CaseFormat.LOWER_CAMEL).convert(entityType.getSimpleName())));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public Page&lt;T&gt; query(Map&lt;String, Object&gt; params, Pageable pageable) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    BooleanExpression[] expressions = new BooleanExpression[params.size()];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int i = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    for (Map.Entry&lt;String, Object&gt; entry : params.entrySet()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        expressions[i++] = builder.get(entry.getKey()).eq(entry.getValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Expressions.path(entityType, entry.getKey());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return repository.findAll(BooleanExpression.allOf(expressions), pageable);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wenerme/wener/edit/master/notes/java/spring/spring-data.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/notes/java/spring/cloud"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Spring Cloud</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/notes/java/spring/data-rest"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Spring Data REST</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tips" class="table-of-contents__link toc-highlight">Tips</a></li><li><a href="#note" class="table-of-contents__link toc-highlight">Note</a><ul><li><a href="#映射---orgspringframeworkdatamapping" class="table-of-contents__link toc-highlight">映射 - org.springframework.data.mapping</a></li></ul></li><li><a href="#mongodb" class="table-of-contents__link toc-highlight">MongoDB</a></li><li><a href="#entity-versions" class="table-of-contents__link toc-highlight">Entity Versions</a></li><li><a href="#spring-data-查询关键字" class="table-of-contents__link toc-highlight">Spring Data 查询关键字</a></li><li><a href="#spring-data-返回结果类型" class="table-of-contents__link toc-highlight">Spring Data 返回结果类型</a></li><li><a href="#jpa-repository-方法语法" class="table-of-contents__link toc-highlight">JPA Repository 方法语法</a></li><li><a href="#单独使用-repository" class="table-of-contents__link toc-highlight">单独使用 Repository</a></li><li><a href="#实现自定义接口" class="table-of-contents__link toc-highlight">实现自定义接口</a></li><li><a href="#为所有-repository-添加自定义方法" class="table-of-contents__link toc-highlight">为所有 Repository 添加自定义方法</a></li><li><a href="#在-query-中使用-spel-来书写通用的-sql" class="table-of-contents__link toc-highlight">在 Query 中使用 SpEL 来书写通用的 SQL</a></li><li><a href="#spring-web-集成" class="table-of-contents__link toc-highlight">Spring Web 集成</a><ul><li><a href="#直接使用实体和特殊参数" class="table-of-contents__link toc-highlight">直接使用实体和特殊参数</a></li><li><a href="#使用多个分页参数" class="table-of-contents__link toc-highlight">使用多个分页参数</a></li><li><a href="#spring-hateoas-支持分页" class="table-of-contents__link toc-highlight">Spring HATEOAS 支持分页</a></li><li><a href="#使用-querydsl-实现查询参数绑定" class="table-of-contents__link toc-highlight">使用 Querydsl 实现查询参数绑定</a></li></ul></li><li><a href="#使用-hibernate-实现软删除" class="table-of-contents__link toc-highlight">使用 Hibernate 实现软删除</a></li><li><a href="#自动生成创建时间字段和更新时间字段" class="table-of-contents__link toc-highlight">自动生成创建时间字段和更新时间字段</a></li><li><a href="#链接断开异常" class="table-of-contents__link toc-highlight">链接断开异常</a></li><li><a href="#not-a-managed-type" class="table-of-contents__link toc-highlight">Not a managed type</a></li><li><a href="#使用-querydsl-构建动态查询" class="table-of-contents__link toc-highlight">使用 QueryDSL 构建动态查询</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">笔记</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/notes/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/os/alpine">AlpineLinux</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/devops/kubernetes">Kubernates</a></li><li class="footer__item"><a class="footer__link-item" href="/notes/voip">VoIP</a></li></ul></div><div class="col footer__col"><div class="footer__title">Projects</div><ul class="footer__items"><li class="footer__item">
              <div>
              <a class="footer__link-item" href="https://github.com/wenerme/wener">Wener</a>
              - <a class="footer__link-item" href="https://github.com/wenerme/wener/actions" title="wenerme/wener - ci">
                <img style="vertical-align: middle;opacity: .4;" src="https://github.com/wenerme/wener/workflows/Build/badge.svg">
                </a>
              </div>
              </li><li class="footer__item"><a href="https://apis.wener.me" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Wener&#x27;s Apis<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/story">Blog</a></li><li class="footer__item"><a href="https://github.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/wenerme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/wener-logo.svg" alt="Wener Site" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/wener-logo.svg" alt="Wener Site" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></div><div class="footer__copyright">Copyright © 1992-2022 Wener - <img alt="cc-by-sa-4.0" src="https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg"> - Build @2022-02-17 01:52</div></div></div></footer></div>
<script src="/assets/js/runtime~main.30549a1d.js"></script>
<script src="/assets/js/main.98857471.js"></script>
</body>
</html>